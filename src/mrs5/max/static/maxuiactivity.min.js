/*! max.ui5.js - v5.1.12 - 2024-09-19 */
var Hogan={},uuid,max=(!function(t){t.Template=function(t,e,i,n){this.r=t||this.r,this.c=i,this.options=n,this.text=e||"",this.buf=""},t.Template.prototype={r:function(t,e,i){return""},v:function(t){return t=o(t),r.test(t)?t.replace(e,"&amp;").replace(i,"&lt;").replace(n,"&gt;").replace(a,"&#39;").replace(s,"&quot;"):t},t:o,render:function(t,e,i){return this.ri([t],e||{},i)},ri:function(t,e,i){return this.r(t,e,i)},rp:function(t,e,i,n){t=i[t];return t?(t=this.c&&"string"==typeof t?this.c.compile(t,this.options):t).ri(e,i,n):""},rs:function(t,e,i){var n=t[t.length-1];if(c(n))for(var a=0;a<n.length;a++)t.push(n[a]),i(t,e,this),t.pop();else i(t,e,this)},s:function(t,e,i,n,a,s,r){return(!c(t)||0!==t.length)&&(i=""===(t="function"==typeof t?this.ls(t,e,i,n,a,s,r):t)||!!t,!n&&i&&e&&e.push("object"==typeof t?t:e[e.length-1]),i)},d:function(t,e,i,n){var a=t.split("."),s=this.f(a[0],e,i,n),r=null;if("."===t&&c(e[e.length-2]))return e[e.length-1];for(var o=1;o<a.length;o++)s=s&&"object"==typeof s&&a[o]in s?(r=s)[a[o]]:"";return!(n&&!s)&&(n||"function"!=typeof s||(e.push(r),s=this.lv(s,e,i),e.pop()),s)},f:function(t,e,i,n){for(var a,s=!1,r=!1,o=e.length-1;0<=o;o--)if((a=e[o])&&"object"==typeof a&&t in a){s=a[t],r=!0;break}return r?n||"function"!=typeof s?s:this.lv(s,e,i):!n&&""},ho:function(t,e,i,n,a){var s=this.c,r=this.options;return r.delimiters=a,n=null==(n=t.call(e,n))?String(n):n.toString(),this.b(s.compile(n,r).render(e,i)),!1},b:function(t){this.buf+=t},fl:function(){var t=this.buf;return this.buf="",t},ls:function(t,e,i,n,a,s,r){e=e[e.length-1];if(!n&&this.c&&0<t.length)return this.ho(t,e,i,this.text.substring(a,s),r);if("function"==typeof(t=t.call(e))){if(n)return!0;if(this.c)return this.ho(t,e,i,this.text.substring(a,s),r)}return t},lv:function(t,e,i){e=e[e.length-1],t=t.call(e);return"function"==typeof t&&(t=o(t.call(e)),this.c&&~t.indexOf("{{"))?this.c.compile(t,this.options).render(e,i):o(t)}};var e=/&/g,i=/</g,n=/>/g,a=/\'/g,s=/\"/g,r=/[&<>\"\']/;function o(t){return String(null==t?"":t)}var c=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}("undefined"!=typeof exports?exports:Hogan),!function(n){var y=/\S/,e=/\"/g,i=/\n/g,a=/\r/g,s=/\\/g,w={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};function b(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function _(t,e,i){if(e.charAt(i)==t.charAt(0)){for(var n=1,a=t.length;n<a;n++)if(e.charAt(i+n)!=t.charAt(n))return;return 1}}function o(t,e,i,n){for(var a=[],s=null,r=null;0<t.length;)if("#"==(r=t.shift()).tag||"^"==r.tag||function(t,e){for(var i=0,n=e.length;i<n;i++)if(e[i].o==t.n)return t.tag="#"}(r,n))i.push(r),r.nodes=o(t,r.tag,i,n),a.push(r);else{if("/"==r.tag){if(0===i.length)throw new Error("Closing tag without opener: /"+r.n);if(s=i.pop(),r.n==s.n||function(t,e,i){for(var n=0,a=i.length;n<a;n++)if(i[n].c==t&&i[n].o==e)return 1}(r.n,s.n,n))return s.end=r.i,a;throw new Error("Nesting error: "+s.n+" vs. "+r.n)}a.push(r)}if(0<i.length)throw new Error("missing closing tag: "+i.pop().n);return a}function d(t){return t.replace(s,"\\\\").replace(e,'\\"').replace(i,"\\n").replace(a,"\\r")}function m(t){return~t.indexOf(".")?"d":"f"}function p(t){for(var e,i,n,a,s,r,o="",c=0,u=t.length;c<u;c++){var l=t[c].tag;"#"==l?o+=(e=t[c].nodes,i=t[c].n,n=m(t[c].n),a=t[c].i,s=t[c].end,r=t[c].otag+" "+t[c].ctag,"if(_.s(_."+n+'("'+d(i)+'",c,p,1),c,p,0,'+a+","+s+',"'+r+'")){_.rs(c,p,function(c,p,_){'+p(e)+"});c.pop();}"):"^"==l?o+=(n=t[c].nodes,i=t[c].n,"if(!_.s(_."+m(t[c].n)+'("'+d(i)+'",c,p,1),c,p,1,0,0,"")){'+p(n)+"};"):"<"==l||">"==l?o+='_.b(_.rp("'+d((a=t[c]).n)+'",c,p,"'+(a.indent||"")+'"));':"{"==l||"&"==l?o+=(s=t[c].n,"_.b(_.t(_."+m(t[c].n)+'("'+d(s)+'",c,p,0)));'):"\n"==l?o+=f('"\\n"'+(t.length-1==c?"":" + i")):"_v"==l?o+=(r=t[c].n,"_.b(_.v(_."+m(t[c].n)+'("'+d(r)+'",c,p,0)));'):void 0===l&&(o+=f('"'+d(t[c])+'"'))}return o}function f(t){return"_.b("+t+");"}n.scan=function(t,e){var i,n,a,s,r,o=t.length,c=0,u=null,l="",d=[],m=!1,p=0,f=0,v="{{",h="}}";function g(){0<l.length&&(d.push(new String(l)),l="")}function x(t,e){if(g(),t&&function(){for(var t=!0,e=f;e<d.length;e++)if(!(t=d[e].tag&&w[d[e].tag]<w._v||!d[e].tag&&null===d[e].match(y)))return;return t}())for(var i,n=f;n<d.length;n++)d[n].tag||((i=d[n+1])&&">"==i.tag&&(i.indent=d[n].toString()),d.splice(n,1));else e||d.push({tag:"\n"});m=!1,f=d.length}for(e&&(e=e.split(" "),v=e[0],h=e[1]),p=0;p<o;p++)0==c?_(v,t,p)?(--p,g(),c=1):"\n"==t.charAt(p)?x(m):l+=t.charAt(p):1==c?(p+=v.length-1,c="="==(u=(i=w[t.charAt(p+1)])?t.charAt(p+1):"_v")?(a=p,r=s=void 0,s="="+h,r=(n=t).indexOf(s,a),n=b(n.substring(n.indexOf("=",a)+1,r)).split(" "),v=n[0],h=n[1],p=r+s.length-1,0):(i&&p++,2),m=p):_(h,t,p)?(d.push({tag:u,n:b(l),otag:v,ctag:h,i:"/"==u?m-h.length:p+v.length}),l="",p+=h.length-1,c=0,"{"==u&&("}}"==h?p++:"}"===(a=d[d.length-1]).n.substr(a.n.length-1)&&(a.n=a.n.substring(0,a.n.length-1)))):l+=t.charAt(p);return x(m,!0),d},n.generate=function(t,e,i){t='var _=this;_.b(i=i||"");'+p(t)+"return _.fl();";return i.asString?"function(c,p,i){"+t+";}":new n.Template(new Function("c","p","i",t),e,n,i)},n.parse=function(t,e,i){return o(t,0,[],(i=i||{}).sectionTags||[])},n.cache={},n.compile=function(t,e){var i=t+"||"+!!(e=e||{}).asString,n=this.cache[i];return n||(n=this.generate(this.parse(this.scan(t,e.delimiters),t,e),t,e),this.cache[i]=n)}}("undefined"!=typeof exports?exports:Hogan),!function(c){c.easydate={},c.easydate.locales={},c.easydate.locales.en={future_format:"%s %t",past_format:"%t %s",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years",yesterday:"yesterday",tomorrow:"tomorrow",now:"just now",ago:"ago",in:"in"},c.easydate.locales.ca={future_format:"%s %t",past_format:"%s %t",second:"segon",seconds:"segons",minute:"minut",minutes:"minuts",hour:"hora",hours:"hores",day:"dia",days:"dies",week:"setmana",weeks:"setmanes",month:"mes",months:"mesos",year:"any",years:"anys",yesterday:"ahir",tomorrow:"demà",now:"fa un moment",ago:"fa",in:"en"},c.easydate.locales.es={future_format:"%s %t",past_format:"%s %t",second:"segundo",seconds:"segundos",minute:"minuto",minutes:"minutos",hour:"hora",hours:"horas",day:"dia",days:"dias",week:"semana",weeks:"semanas",month:"mes",months:"meses",year:"año",years:"años",yesterday:"ayer",tomorrow:"mañana",now:"hace un instante",ago:"hace",in:"en"};var u={live:!0,set_title:!0,format_future:!0,format_past:!0,units:[{name:"now",limit:5},{name:"second",limit:60,in_seconds:1},{name:"minute",limit:3600,in_seconds:60},{name:"hour",limit:86400,in_seconds:3600},{name:"yesterday",limit:172800,past_only:!0},{name:"tomorrow",limit:172800,future_only:!0},{name:"day",limit:604800,in_seconds:86400},{name:"week",limit:2629743,in_seconds:604800},{name:"month",limit:31556926,in_seconds:2629743},{name:"year",limit:1/0,in_seconds:31556926}],uneasy_format:function(t){return t.toLocaleDateString()},locale:c.easydate.locales.en};function l(t,e,i){return isNaN(e)||1==e||(t+="s"),i.locale[t]||t}c.easydate.format_date=function(t,e){var i=c.extend({},u);i.locale=c.easydate.locales[e];var n=((new Date).getTime()-t.getTime())/1e3,a=Math.abs(n);if(!isNaN(n)&&!(!i.format_future&&n<0||!i.format_past&&0<n)){for(var s in i.units){s=i.units[s];if(!(s.past_only&&n<0||s.future_only&&0<n)&&a<s.limit){if(isNaN(s.in_seconds))return l(s.name,NaN,i);var r=a/s.in_seconds,r=Math.round(r),o=n<0?l("future_format",NaN,i).replace("%s",l("in",NaN,i)):l("past_format",NaN,i).replace("%s",l("ago",NaN,i));return o.replace("%t",r+" "+l(s.name,r,i))}}return i.uneasy_format(t)}}}(jQuery),!function(t){var e;t.ajaxSettings.xdr=function(){return window.XDomainRequest?new window.XDomainRequest:null},e=t.ajaxSettings.xdr(),t.extend(t.support,{iecors:!!e}),t.support.iecors&&t.ajaxTransport(function(i){var n=i.xdr();return{send:function(t,e){n.onload=function(){var t={"Content-Type":n.contentType};e(200,"OK",{text:n.responseText},t)},i.xhrFields&&(xhr.onerror=i.xhrFields.error,xhr.ontimeout=i.xhrFields.timeout),n.open(i.type,i.url),n.send(i.hasContent&&i.data||null)},abort:function(){n.abort()}}})}(jQuery),!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(o){var c,u,t=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],e="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(o.event.fixHooks)for(var i=t.length;i;)o.event.fixHooks[t[--i]]=o.event.mouseHooks;var n=o.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var t=e.length;t;)this.addEventListener(e[--t],a,!1);else this.onmousewheel=a;o.data(this,"mousewheel-line-height",n.getLineHeight(this)),o.data(this,"mousewheel-page-height",n.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=e.length;t;)this.removeEventListener(e[--t],a,!1);else this.onmousewheel=null},getLineHeight:function(t){return parseInt(o(t)["offsetParent"in o.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(t){return o(t).height()},settings:{adjustOldDeltas:!0}};function a(t){var e,i=t||window.event,n=l.call(arguments,1),a=0,s=0,r=0;if((t=o.event.fix(i)).type="mousewheel","detail"in i&&(r=-1*i.detail),"wheelDelta"in i&&(r=i.wheelDelta),"wheelDeltaY"in i&&(r=i.wheelDeltaY),"wheelDeltaX"in i&&(s=-1*i.wheelDeltaX),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(s=-1*r,r=0),a=0===r?s:r,"deltaY"in i&&(a=r=-1*i.deltaY),"deltaX"in i&&(s=i.deltaX,0===r&&(a=-1*s)),0!==r||0!==s)return 1===i.deltaMode?(a*=e=o.data(this,"mousewheel-line-height"),r*=e,s*=e):2===i.deltaMode&&(a*=e=o.data(this,"mousewheel-page-height"),r*=e,s*=e),e=Math.max(Math.abs(r),Math.abs(s)),(!u||e<u)&&m(i,u=e)&&(u/=40),m(i,e)&&(a/=40,s/=40,r/=40),a=Math[1<=a?"floor":"ceil"](a/u),s=Math[1<=s?"floor":"ceil"](s/u),r=Math[1<=r?"floor":"ceil"](r/u),t.deltaX=s,t.deltaY=r,t.deltaFactor=u,t.deltaMode=0,n.unshift(t,a,s,r),c&&clearTimeout(c),c=setTimeout(d,200),(o.event.dispatch||o.event.handle).apply(this,n)}function d(){u=null}function m(t,e){return n.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}o.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),"object"!=typeof JSON&&(JSON={}),!function(){"use strict";function f(t){return t<10?"0"+t:t}var cx,escapable,gap,indent,meta,rep;function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,a,s,r,o=gap,c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),typeof(c="function"==typeof rep?rep.call(e,t,c):c)){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,i=0;i<s;i+=1)r[i]=str(i,c)||"null";a=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+o+"]":"["+r.join(",")+"]",gap=o}else{if(rep&&"object"==typeof rep)for(s=rep.length,i=0;i<s;i+=1)"string"==typeof rep[i]&&(a=str(n=rep[i],c))&&r.push(quote(n)+(gap?": ":":")+a);else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(a=str(n,c))&&r.push(quote(n)+(gap?": ":":")+a);a=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+o+"}":"{"+r.join(",")+"}",gap=o}return a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}),"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var n;if(indent=gap="","number"==typeof i)for(n=0;n<i;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(!(rep=e)||"function"==typeof e||"object"==typeof e&&"number"==typeof e.length)return str("",{"":t});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){var j;function walk(t,e){var i,n,a=t[e];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(void 0!==(n=walk(a,i))?a[i]=n:delete a[i]);return reviver.call(t,e,a)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),!function(){var x,i,p,f,o,v,s={}.hasOwnProperty,r=[].slice;function y(t,e,i,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=i?i:"",this.escapeHeaderValues=null!=n&&n}function t(e){this.ws_fn=function(){var t=e();return t.binaryType="arraybuffer",t},this.reconnect_delay=0,this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}x={LF:"\n",NULL:"\0"},y.prototype.toString=function(){var t,e,i,n=[this.command],a=!1===this.headers["content-length"];for(t in a&&delete this.headers["content-length"],e=this.headers)s.call(e,t)&&(i=e[t],this.escapeHeaderValues&&"CONNECT"!==this.command&&"CONNECTED"!==this.command?n.push(t+":"+y.frEscape(i)):n.push(t+":"+i));return this.body&&!a&&n.push("content-length:"+y.sizeOfUTF8(this.body)),n.push(x.LF+this.body),n.join(x.LF)},y.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},o=function(t,e){var i,n,a,s,r,o,c,u,l,d,m,p,f,v,h,g;for(null==e&&(e=!1),l=t.search(RegExp(""+x.LF+x.LF)),a=(h=t.substring(0,l).split(x.LF)).shift(),s={},g=function(t){return t.replace(/^\s+|\s+$/g,"")},c=0,d=(p=h.reverse()).length;c<d;c++)o=(m=p[c]).indexOf(":"),s[g(m.substring(0,o))]=e&&"CONNECT"!==a&&"CONNECTED"!==a?y.frUnEscape(g(m.substring(o+1))):g(m.substring(o+1));if(i="",h=l+2,s["content-length"])l=parseInt(s["content-length"]),i=(""+t).substring(h,h+l);else for(r=u=f=h,v=t.length;(f<=v?u<v:v<u)&&(n=t.charAt(r))!==x.NULL;r=f<=v?++u:--u)i+=n;return new y(a,s,i,e)},y.unmarshall=function(t,a){var s,r,e;return null==a&&(a=!1),r=t.split(RegExp(""+x.NULL+x.LF+"*")),(t={frames:[],partial:""}).frames=function(){for(var t=r.slice(0,-1),e=[],i=0,n=t.length;i<n;i++)s=t[i],e.push(o(s,a));return e}(),(e=r.slice(-1)[0])===x.LF||-1!==e.search(RegExp(""+x.NULL+x.LF+"*$"))?t.frames.push(o(e,a)):t.partial=e,t},y.marshall=function(t,e,i,n){return new y(t,e,i,n).toString()+x.NULL},y.frEscape=function(t){return(""+t).replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")},y.frUnEscape=function(t){return(""+t).replace(/\\r/g,"\r").replace(/\\n/g,"\n").replace(/\\c/g,":").replace(/\\\\/g,"\\")},p=y,t.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window&&null!=(e=window.console)?e.log(t):void 0},v=function(){return Date.now?Date.now():(new Date).valueOf},t.prototype._transmit=function(t,e,i){var n=p.marshall(t,e,i,this.escapeHeaderValues);for("function"==typeof this.debug&&this.debug(">>> "+n);;){if(!(n.length>this.maxWebSocketFrameSize))return this.ws.send(n);this.ws.send(n.substring(0,this.maxWebSocketFrameSize)),n=n.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+n.length)}},t.prototype._setupHeartbeat=function(a){var e,s,t,i,n,r;if((n=a.version)===f.VERSIONS.V1_1||n===f.VERSIONS.V1_2)return i=(n=function(){for(var t=a["heart-beat"].split(","),e=[],i=0,n=t.length;i<n;i++)s=t[i],e.push(parseInt(s));return e}())[0],n=n[1],0!==this.heartbeat.outgoing&&0!==n&&(e=Math.max(this.heartbeat.outgoing,n),"function"==typeof this.debug&&this.debug("send PING every "+e+"ms"),this.pinger=f.setInterval(e,(t=this,function(){return t.ws.send(x.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==i?(e=Math.max(this.heartbeat.incoming,i),"function"==typeof this.debug&&this.debug("check PONG every "+e+"ms"),this.ponger=f.setInterval(e,(r=this,function(){var t=v()-r.serverActivity;if(2*e<t)return"function"==typeof r.debug&&r.debug("did not receive server activity for the last "+t+"ms"),r.ws.close()}))):void 0},t.prototype._parseConnect=function(){var t,e,i,n=1<=arguments.length?r.call(arguments,0):[],a={};if(n.length<2)throw"Connect requires at least 2 arguments";return"function"==typeof n[1]?(a=n[0],e=n[1],i=n[2],t=n[3]):6===n.length?(a.login=n[0],a.passcode=n[1],e=n[2],i=n[3],t=n[4],a.host=n[5]):(a.login=n[0],a.passcode=n[1],e=n[2],i=n[3],t=n[4]),[a,e,i,t]},t.prototype.connect=function(){var t=1<=arguments.length?r.call(arguments,0):[];return this.escapeHeaderValues=!1,t=this._parseConnect.apply(this,t),this.headers=t[0],this.connectCallback=t[1],this.errorCallback=t[2],this.closeEventCallback=t[3],this._active=!0,this._connect()},t.prototype._connect=function(){var l,d,i,t,e=this.headers,m=this.errorCallback,n=this.closeEventCallback;{if(this._active)return"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws=this.ws_fn(),l=function(t){for(var e,i,n,a="",s=t.length,r=0;r<s;)switch((e=t[r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(e);break;case 12:case 13:i=t[r++],a+=String.fromCharCode((31&e)<<6|63&i);break;case 14:i=t[r++],n=t[r++],a+=String.fromCharCode((15&e)<<12|(63&i)<<6|(63&n)<<0)}return a},this.ws.onmessage=(d=this,function(t){var e,i,n,a,s,r,o,c,u="undefined"!=typeof ArrayBuffer&&t.data instanceof ArrayBuffer?(u=new Uint8Array(t.data),"function"==typeof d.debug&&d.debug("--- got data length: "+u.length),l(u)):t.data;if(d.serverActivity=v(),u===x.LF)"function"==typeof d.debug&&d.debug("<<< PONG");else for("function"==typeof d.debug&&d.debug("<<< "+u),t=p.unmarshall(d.partialData+u,d.escapeHeaderValues),d.partialData=t.partial,n=0,a=(o=t.frames).length;n<a;n++)switch((i=o[n]).command){case"CONNECTED":if("function"==typeof d.debug&&d.debug("connected to server "+i.headers.server),d.connected=!0,d.version=i.headers.version,d.version===f.VERSIONS.V1_2&&(d.escapeHeaderValues=!0),!d._active)return void d.disconnect();d._setupHeartbeat(i.headers),"function"==typeof d.connectCallback&&d.connectCallback(i);break;case"MESSAGE":c=i.headers.subscription,(r=d.subscriptions[c]||d.onreceive)?(s=(e=d).version===f.VERSIONS.V1_2?i.headers.ack:i.headers["message-id"],i.ack=function(t){return e.ack(s,c,t=null==t?{}:t)},i.nack=function(t){return e.nack(s,c,t=null==t?{}:t)},r(i)):"function"==typeof d.debug&&d.debug("Unhandled received MESSAGE: "+i);break;case"RECEIPT":i.headers["receipt-id"]===d.closeReceipt?(d.ws.onclose=null,d.ws.close(),d._cleanUp(),"function"==typeof d._disconnectCallback&&d._disconnectCallback()):"function"==typeof d.onreceipt&&d.onreceipt(i);break;case"ERROR":"function"==typeof m&&m(i);break;default:"function"==typeof d.debug&&d.debug("Unhandled frame: "+i)}}),this.ws.onclose=(i=this,function(t){var e="Whoops! Lost connection to "+i.ws.url;return"function"==typeof i.debug&&i.debug(e),"function"==typeof n&&n(t),i._cleanUp(),"function"==typeof m&&m(e),i._schedule_reconnect()}),this.ws.onopen=(t=this,function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),e["accept-version"]=f.VERSIONS.supportedVersions(),e["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",e)});this.debug("Client has been marked inactive, will not attempt to connect")}},t.prototype._schedule_reconnect=function(){if(0<this.reconnect_delay)return"function"==typeof this.debug&&this.debug("STOMP: scheduling reconnection in "+this.reconnect_delay+"ms"),this._reconnector=setTimeout(function(){return t.connected?"function"==typeof t.debug?t.debug("STOMP: already connected"):void 0:("function"==typeof t.debug&&t.debug("STOMP: attempting to reconnect"),t._connect())},(t=this).reconnect_delay);var t},t.prototype.disconnect=function(t,e){if(null==e&&(e={}),this._disconnectCallback=t,this._active=!1,this.connected){e.receipt||(e.receipt="close-"+this.counter++),this.closeReceipt=e.receipt;try{return this._transmit("DISCONNECT",e)}catch(t){return"function"==typeof this.debug?this.debug("Ignoring error during disconnect",t):void 0}}},t.prototype._cleanUp=function(){if(this._reconnector&&clearTimeout(this._reconnector),this.connected=!1,this.subscriptions={},this.partial="",this.pinger&&f.clearInterval(this.pinger),this.ponger)return f.clearInterval(this.ponger)},t.prototype.send=function(t,e,i){return null==i&&(i=""),(e=null==e?{}:e).destination=t,this._transmit("SEND",e,i)},t.prototype.subscribe=function(t,e,i){var n;return(i=null==i?{}:i).id||(i.id="sub-"+this.counter++),i.destination=t,this.subscriptions[i.id]=e,this._transmit("SUBSCRIBE",i),n=this,{id:i.id,unsubscribe:function(t){return n.unsubscribe(i.id,t)}}},t.prototype.unsubscribe=function(t,e){return null==e&&(e={}),delete this.subscriptions[t],e.id=t,this._transmit("UNSUBSCRIBE",e)},t.prototype.begin=function(t){var e,i=t||"tx-"+this.counter++;return this._transmit("BEGIN",{transaction:i}),e=this,{id:i,commit:function(){return e.commit(i)},abort:function(){return e.abort(i)}}},t.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},t.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},t.prototype.ack=function(t,e,i){return null==i&&(i={}),this.version===f.VERSIONS.V1_2?i.id=t:i["message-id"]=t,i.subscription=e,this._transmit("ACK",i)},t.prototype.nack=function(t,e,i){return null==i&&(i={}),this.version===f.VERSIONS.V1_2?i.id=t:i["message-id"]=t,i.subscription=e,this._transmit("NACK",i)},i=t,f={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.2,1.1,1.0"}},client:function(t,e){return null==e&&(e=["v10.stomp","v11.stomp","v12.stomp"]),new i(function(){return new(f.WebSocketClass||WebSocket)(t,e)})},over:function(t){return new i("function"==typeof t?t:function(){return t})},Frame:p,setInterval:function(t,e){return setInterval(e,t)},clearInterval:function(t){return clearInterval(t)}},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=f),"undefined"!=typeof window&&null!==window?window.Stomp=f:exports||(self.Stomp=f)}.call(this),!function(){function c(t){return null==t?T.identity:T.isFunction(t)?t:T.property(t)}function t(r){return function(i,n,a){var s={};return n=c(n),O(i,function(t,e){e=n.call(a,t,e,i);r(s,e,t)}),s}}function n(t,e,i){return e&&T.every(t,T.isArray)?p.apply(i,t):(O(t,function(t){T.isArray(t)||T.isArguments(t)?e?l.apply(i,t):n(t,e,i):i.push(t)}),i)}function r(){}function d(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof T&&(t=t._wrapped),e instanceof T&&(e=e._wrapped);var a=f.call(t);if(a!=f.call(e))return!1;switch(a){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;var r=t.constructor,o=e.constructor;if(r!==o&&!(T.isFunction(r)&&r instanceof r&&T.isFunction(o)&&o instanceof o)&&"constructor"in t&&"constructor"in e)return!1;i.push(t),n.push(e);var c=0,u=!0;if("[object Array]"==a){if(u=(c=t.length)==e.length)for(;c--&&(u=d(t[c],e[c],i,n)););}else{for(var l in t)if(T.has(t,l)&&(c++,!(u=T.has(e,l)&&d(t[l],e[l],i,n))))break;if(u){for(l in e)if(T.has(e,l)&&!c--)break;u=!c}}return i.pop(),n.pop(),u}var e=this,i=e._,o={},a=Array.prototype,s=Object.prototype,u=Function.prototype,l=a.push,m=a.slice,p=a.concat,f=s.toString,v=s.hasOwnProperty,h=a.forEach,g=a.map,x=a.reduce,y=a.reduceRight,w=a.filter,b=a.every,_=a.some,C=a.indexOf,S=a.lastIndexOf,s=Array.isArray,k=Object.keys,A=u.bind,T=function(t){return t instanceof T?t:this instanceof T?void(this._wrapped=t):new T(t)},O=("undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=T:exports)._=T:e._=T,T.VERSION="1.6.0",T.each=T.forEach=function(t,e,i){if(null!=t)if(h&&t.forEach===h)t.forEach(e,i);else if(t.length===+t.length){for(var n=0,a=t.length;n<a;n++)if(e.call(i,t[n],n,t)===o)return}else for(var s=T.keys(t),n=0,a=s.length;n<a;n++)if(e.call(i,t[s[n]],s[n],t)===o)return;return t}),E=(T.map=T.collect=function(t,n,a){var s=[];if(null!=t){if(g&&t.map===g)return t.map(n,a);O(t,function(t,e,i){s.push(n.call(a,t,e,i))})}return s},"Reduce of empty array with no initial value"),U=(T.reduce=T.foldl=T.inject=function(t,n,a,s){var r=2<arguments.length;if(null==t&&(t=[]),x&&t.reduce===x)return s&&(n=T.bind(n,s)),r?t.reduce(n,a):t.reduce(n);if(O(t,function(t,e,i){r?a=n.call(s,a,t,e,i):(a=t,r=!0)}),r)return a;throw new TypeError(E)},T.reduceRight=T.foldr=function(n,a,s,r){var o=2<arguments.length;if(null==n&&(n=[]),y&&n.reduceRight===y)return r&&(a=T.bind(a,r)),o?n.reduceRight(a,s):n.reduceRight(a);var c,u=n.length;if(u!==+u&&(c=T.keys(n),u=c.length),O(n,function(t,e,i){e=c?c[--u]:--u,o?s=a.call(r,s,n[e],e,i):(s=n[e],o=!0)}),o)return s;throw new TypeError(E)},T.find=T.detect=function(t,n,a){var s;return U(t,function(t,e,i){if(n.call(a,t,e,i))return s=t,!0}),s},T.filter=T.select=function(t,n,a){var s=[];if(null!=t){if(w&&t.filter===w)return t.filter(n,a);O(t,function(t,e,i){n.call(a,t,e,i)&&s.push(t)})}return s},T.reject=function(t,n,a){return T.filter(t,function(t,e,i){return!n.call(a,t,e,i)},a)},T.every=T.all=function(t,n,a){n=n||T.identity;var s=!0;return null==t?s:b&&t.every===b?t.every(n,a):(O(t,function(t,e,i){if(!(s=s&&n.call(a,t,e,i)))return o}),!!s)},T.some=T.any=function(t,n,a){n=n||T.identity;var s=!1;return null==t?s:_&&t.some===_?t.some(n,a):(O(t,function(t,e,i){if(s=s||n.call(a,t,e,i))return o}),!!s)}),j=(T.contains=T.include=function(t,e){return null!=t&&(C&&t.indexOf===C?-1!=t.indexOf(e):U(t,function(t){return t===e}))},T.invoke=function(t,e){var i=m.call(arguments,2),n=T.isFunction(e);return T.map(t,function(t){return(n?e:t[e]).apply(t,i)})},T.pluck=function(t,e){return T.map(t,T.property(e))},T.where=function(t,e){return T.filter(t,T.matches(e))},T.findWhere=function(t,e){return T.find(t,T.matches(e))},T.max=function(t,n,a){if(!n&&T.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);var s=-1/0,r=-1/0;return O(t,function(t,e,i){e=n?n.call(a,t,e,i):t;r<e&&(s=t,r=e)}),s},T.min=function(t,n,a){if(!n&&T.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);var s=1/0,r=1/0;return O(t,function(t,e,i){e=n?n.call(a,t,e,i):t;e<r&&(s=t,r=e)}),s},T.shuffle=function(t){var e,i=0,n=[];return O(t,function(t){e=T.random(i++),n[i-1]=n[e],n[e]=t}),n},T.sample=function(t,e,i){return null==e||i?(t=t.length!==+t.length?T.values(t):t)[T.random(t.length-1)]:T.shuffle(t).slice(0,Math.max(0,e))},T.sortBy=function(t,n,a){return n=c(n),T.pluck(T.map(t,function(t,e,i){return{value:t,index:e,criteria:n.call(a,t,e,i)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")},T.groupBy=t(function(t,e,i){T.has(t,e)?t[e].push(i):t[e]=[i]}),T.indexBy=t(function(t,e,i){t[e]=i}),T.countBy=t(function(t,e){T.has(t,e)?t[e]++:t[e]=1}),T.sortedIndex=function(t,e,i,n){for(var a=(i=c(i)).call(n,e),s=0,r=t.length;s<r;){var o=s+r>>>1;i.call(n,t[o])<a?s=1+o:r=o}return s},T.toArray=function(t){return t?T.isArray(t)?m.call(t):t.length===+t.length?T.map(t,T.identity):T.values(t):[]},T.size=function(t){return null==t?0:(t.length===+t.length?t:T.keys(t)).length},T.first=T.head=T.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:e<0?[]:m.call(t,0,e)},T.initial=function(t,e,i){return m.call(t,0,t.length-(null==e||i?1:e))},T.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:m.call(t,Math.max(t.length-e,0))},T.rest=T.tail=T.drop=function(t,e,i){return m.call(t,null==e||i?1:e)},T.compact=function(t){return T.filter(t,T.identity)},T.flatten=function(t,e){return n(t,e,[])},T.without=function(t){return T.difference(t,m.call(arguments,1))},T.partition=function(t,e,i){e=c(e);var n=[],a=[];return O(t,function(t){(e.call(i,t)?n:a).push(t)}),[n,a]},T.uniq=T.unique=function(i,n,t,e){T.isFunction(n)&&(e=t,t=n,n=!1);var t=t?T.map(i,t,e):i,a=[],s=[];return O(t,function(t,e){(n?e&&s[s.length-1]===t:T.contains(s,t))||(s.push(t),a.push(i[e]))}),a},T.union=function(){return T.uniq(T.flatten(arguments,!0))},T.intersection=function(t){var i=m.call(arguments,1);return T.filter(T.uniq(t),function(e){return T.every(i,function(t){return T.contains(t,e)})})},T.difference=function(t){var e=p.apply(a,m.call(arguments,1));return T.filter(t,function(t){return!T.contains(e,t)})},T.zip=function(){for(var t=T.max(T.pluck(arguments,"length").concat(0)),e=new Array(t),i=0;i<t;i++)e[i]=T.pluck(arguments,""+i);return e},T.object=function(t,e){if(null==t)return{};for(var i={},n=0,a=t.length;n<a;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},T.indexOf=function(t,e,i){if(null!=t){var n=0,a=t.length;if(i){if("number"!=typeof i)return t[n=T.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,a+i):i}if(C&&t.indexOf===C)return t.indexOf(e,i);for(;n<a;n++)if(t[n]===e)return n}return-1},T.lastIndexOf=function(t,e,i){if(null!=t){var n=null!=i;if(S&&t.lastIndexOf===S)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var a=n?i:t.length;a--;)if(t[a]===e)return a}return-1},T.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),a=0,s=new Array(n);a<n;)s[a++]=t,t+=i;return s},T.bind=function(i,n){var a,s;if(A&&i.bind===A)return A.apply(i,m.call(arguments,1));if(T.isFunction(i))return a=m.call(arguments,2),s=function(){if(!(this instanceof s))return i.apply(n,a.concat(m.call(arguments)));r.prototype=i.prototype;var t=new r,e=(r.prototype=null,i.apply(t,a.concat(m.call(arguments))));return Object(e)===e?e:t};throw new TypeError},T.partial=function(a){var s=m.call(arguments,1);return function(){for(var t=0,e=s.slice(),i=0,n=e.length;i<n;i++)e[i]===T&&(e[i]=arguments[t++]);for(;t<arguments.length;)e.push(arguments[t++]);return a.apply(this,e)}},T.bindAll=function(e){var t=m.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return O(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,i){var n={};return i=i||T.identity,function(){var t=i.apply(this,arguments);return T.has(n,t)?n[t]:n[t]=e.apply(this,arguments)}},T.delay=function(t,e){var i=m.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},T.defer=function(t){return T.delay.apply(T,[t,1].concat(m.call(arguments,1)))},T.throttle=function(i,n,a){function s(){l=!1===a.leading?0:T.now(),u=null,c=i.apply(r,o),r=o=null}var r,o,c,u=null,l=0;a=a||{};return function(){var t=T.now(),e=(l||!1!==a.leading||(l=t),n-(t-l));return r=this,o=arguments,e<=0?(clearTimeout(u),u=null,l=t,c=i.apply(r,o),r=o=null):u||!1===a.trailing||(u=setTimeout(s,e)),c}},T.debounce=function(e,i,n){function a(){var t=T.now()-c;t<i?s=setTimeout(a,i-t):(s=null,n||(u=e.apply(o,r),o=r=null))}var s,r,o,c,u;return function(){o=this,r=arguments,c=T.now();var t=n&&!s;return s=s||setTimeout(a,i),t&&(u=e.apply(o,r),o=r=null),u}},T.once=function(t){var e,i=!1;return function(){return i||(i=!0,e=t.apply(this,arguments),t=null),e}},T.wrap=function(t,e){return T.partial(e,t)},T.compose=function(){var i=arguments;return function(){for(var t=arguments,e=i.length-1;0<=e;e--)t=[i[e].apply(this,t)];return t[0]}},T.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},T.keys=function(t){if(!T.isObject(t))return[];if(k)return k(t);var e,i=[];for(e in t)T.has(t,e)&&i.push(e);return i},T.values=function(t){for(var e=T.keys(t),i=e.length,n=new Array(i),a=0;a<i;a++)n[a]=t[e[a]];return n},T.pairs=function(t){for(var e=T.keys(t),i=e.length,n=new Array(i),a=0;a<i;a++)n[a]=[e[a],t[e[a]]];return n},T.invert=function(t){for(var e={},i=T.keys(t),n=0,a=i.length;n<a;n++)e[t[i[n]]]=i[n];return e},T.functions=T.methods=function(t){var e,i=[];for(e in t)T.isFunction(t[e])&&i.push(e);return i.sort()},T.extend=function(i){return O(m.call(arguments,1),function(t){if(t)for(var e in t)i[e]=t[e]}),i},T.pick=function(e){var i={},t=p.apply(a,m.call(arguments,1));return O(t,function(t){t in e&&(i[t]=e[t])}),i},T.omit=function(t){var e,i={},n=p.apply(a,m.call(arguments,1));for(e in t)T.contains(n,e)||(i[e]=t[e]);return i},T.defaults=function(i){return O(m.call(arguments,1),function(t){if(t)for(var e in t)void 0===i[e]&&(i[e]=t[e])}),i},T.clone=function(t){return T.isObject(t)?T.isArray(t)?t.slice():T.extend({},t):t},T.tap=function(t,e){return e(t),t},T.isEqual=function(t,e){return d(t,e,[],[])},T.isEmpty=function(t){if(null!=t){if(T.isArray(t)||T.isString(t))return 0===t.length;for(var e in t)if(T.has(t,e))return!1}return!0},T.isElement=function(t){return!(!t||1!==t.nodeType)},T.isArray=s||function(t){return"[object Array]"==f.call(t)},T.isObject=function(t){return t===Object(t)},O(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(t){return!(!t||!T.has(t,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(t){return"function"==typeof t}),T.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},T.isNaN=function(t){return T.isNumber(t)&&t!=+t},T.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==f.call(t)},T.isNull=function(t){return null===t},T.isUndefined=function(t){return void 0===t},T.has=function(t,e){return v.call(t,e)},T.noConflict=function(){return e._=i,this},T.identity=function(t){return t},T.constant=function(t){return function(){return t}},T.property=function(e){return function(t){return t[e]}},T.matches=function(i){return function(t){if(t!==i)for(var e in i)if(i[e]!==t[e])return!1;return!0}},T.times=function(t,e,i){for(var n=Array(Math.max(0,t)),a=0;a<t;a++)n[a]=e.call(i,a);return n},T.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},T.now=Date.now||function(){return(new Date).getTime()},{escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}}),R=(j.unescape=T.invert(j.escape),{escape:new RegExp("["+T.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(j.unescape).join("|")+")","g")}),M=(T.each(["escape","unescape"],function(e){T[e]=function(t){return null==t?"":(""+t).replace(R[e],function(t){return j[e][t]})}}),T.result=function(t,e){if(null!=t)return e=t[e],T.isFunction(e)?e.call(t):e},T.mixin=function(i){O(T.functions(i),function(t){var e=T[t]=i[t];T.prototype[t]=function(){var t=[this._wrapped];return l.apply(t,arguments),L.call(this,e.apply(T,t))}})},0),N=(T.uniqueId=function(t){var e=++M+"";return t?t+e:e},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},/(.)^/),D={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\t|\u2028|\u2029/g,L=(T.template=function(s,t,e){e=T.defaults({},e,T.templateSettings);var i,n=new RegExp([(e.escape||N).source,(e.interpolate||N).source,(e.evaluate||N).source].join("|")+"|$","g"),r=0,o="__p+='";s.replace(n,function(t,e,i,n,a){return o+=s.slice(r,a).replace(P,function(t){return"\\"+D[t]}),e&&(o+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'"),i&&(o+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),n&&(o+="';\n"+n+"\n__p+='"),r=a+t.length,t}),o+="';\n",o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+(o=e.variable?o:"with(obj||{}){\n"+o+"}\n")+"return __p;\n";try{i=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}if(t)return i(t,T);function a(t){return i.call(this,t,T)}return a.source="function("+(e.variable||"obj")+"){\n"+o+"}",a},T.chain=function(t){return T(t).chain()},function(t){return this._chain?T(t).chain():t});T.mixin(T),O(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var i=a[e];T.prototype[e]=function(){var t=this._wrapped;return i.apply(t,arguments),"shift"!=e&&"splice"!=e||0!==t.length||delete t[0],L.call(this,t)}}),O(["concat","join","slice"],function(t){var e=a[t];T.prototype[t]=function(){return L.call(this,e.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return T})}.call(this),!function(){var t,i,e=this;if("function"==typeof e.require)try{var n=e.require("crypto").randomBytes,r=n&&function(){return n(16)}}catch(t){}!r&&e.crypto&&crypto.getRandomValues&&(t=new Uint8Array(16),r=function(){return crypto.getRandomValues(t),t}),r||(i=new Array(16),r=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i});for(var o="function"==typeof e.Buffer?e.Buffer:Array,a=[],s={},c=0;c<256;c++)a[c]=(c+256).toString(16).substr(1),s[a[c]]=c;function l(t,e){e=e||0;return a[t[e++]]+a[t[e++]]+a[t[e++]]+a[t[e++]]+"-"+a[t[e++]]+a[t[e++]]+"-"+a[t[e++]]+a[t[e++]]+"-"+a[t[e++]]+a[t[e++]]+"-"+a[t[e++]]+a[t[e++]]+a[t[e++]]+a[t[e++]]+a[t[e++]]+a[t[+e]]}var u,d=r(),m=[1|d[0],d[1],d[2],d[3],d[4],d[5]],p=16383&(d[6]<<8|d[7]),f=0,v=0;function h(t,e,i){var n=e&&i||0,a=("string"==typeof t&&(e="binary"==t?new o(16):null,t=null),(t=t||{}).random||(t.rng||r)());if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;s++)e[n+s]=a[s];return e||l(a)}(uuid=h).v1=function(t,e,i){var n=e&&i||0,a=e||[],i=null!=(t=t||{}).clockseq?t.clockseq:p,s=null!=t.msecs?t.msecs:(new Date).getTime(),r=null!=t.nsecs?t.nsecs:v+1;if((o=s-f+(r-v)/1e4)<0&&null==t.clockseq&&(i=i+1&16383),1e4<=(r=(o<0||f<s)&&null==t.nsecs?0:r))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=s,p=i;for(var o=(1e4*(268435455&(s+=122192928e5))+(v=r))%4294967296,r=(a[n++]=o>>>24&255,a[n++]=o>>>16&255,a[n++]=o>>>8&255,a[n++]=255&o,s/4294967296*1e4&268435455),c=(a[n++]=r>>>8&255,a[n++]=255&r,a[n++]=r>>>24&15|16,a[n++]=r>>>16&255,a[n++]=i>>>8|128,a[n++]=255&i,t.node||m),u=0;u<6;u++)a[n+u]=c[u];return e||l(a)},uuid.v4=h,uuid.parse=function(t,e,i){var n=e&&i||0,a=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){a<16&&(e[n+a++]=s[t])});a<16;)e[n+a++]=0;return e},uuid.unparse=l,uuid.BufferClass=o,"function"==typeof define&&define.amd?define("uuid",[],function(){return uuid}):"undefined"!=typeof module&&module.exports?module.exports=uuid:(u=e.uuid,uuid.noConflict=function(){return e.uuid=u,uuid},e.uuid=uuid)}.call(this),!function(a,d){"use strict";function s(t,e){if(!(this instanceof s))return new s(t,e).getResult();var i=t||(a&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:""),n=e?y.extend(_,e):_;this.getBrowser=function(){return w.rgx.apply(this,n.browser)},this.getCPU=function(){return w.rgx.apply(this,n.cpu)},this.getDevice=function(){return w.rgx.apply(this,n.device)},this.getEngine=function(){return w.rgx.apply(this,n.engine)},this.getOS=function(){return w.rgx.apply(this,n.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(t){return i=t,this},this.setUA(i)}var n,r,m="function",p="undefined",f="object",t="major",e="model",i="name",o="type",c="vendor",u="version",l="architecture",v="console",h="mobile",g="tablet",x="smarttv",y={extend:function(t,e){for(var i in e)-1!=="browser cpu device engine os".indexOf(i)&&e[i].length%2==0&&(t[i]=e[i].concat(t[i]));return t},has:function(t,e){if("string"==typeof t)return-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()}},w={rgx:function(){for(var t,e,i,n,a,s,r,o=0,c=arguments;o<c.length;o+=2){var u=c[o],l=c[o+1];if(typeof t==p)for(n in t={},l)typeof(a=l[n])==f?t[a[0]]=d:t[a]=d;for(e=i=0;e<u.length;e++)if(s=u[e].exec(this.getUA())){for(n=0;n<l.length;n++)r=s[++i],typeof(a=l[n])==f&&0<a.length?2==a.length?typeof a[1]==m?t[a[0]]=a[1].call(this,r):t[a[0]]=a[1]:3==a.length?typeof a[1]!=m||a[1].exec&&a[1].test?t[a[0]]=r?r.replace(a[1],a[2]):d:t[a[0]]=r?a[1].call(this,r,a[2]):d:4==a.length&&(t[a[0]]=r?a[3].call(this,r.replace(a[1],a[2])):d):t[a]=r||d;break}if(s)break}return t},str:function(t,e){for(var i in e)if(typeof e[i]==f&&0<e[i].length){for(var n=0;n<e[i].length;n++)if(y.has(e[i][n],t))return"?"===i?d:i}else if(y.has(e[i],t))return"?"===i?d:i;return t}},b={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},_={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[i,u,t],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[i,"Opera"],u,t],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[i,u,t],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[i,"IE"],u,t],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[i,"Yandex"],u,t],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[i,/_/g," "],u,t],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i],[i,u,t],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[i,"Dolphin"],u,t],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[i,"Chrome"],u,t],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[u,t,[i,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[u,t,i],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[i,[t,w.str,b.browser.oldsafari.major],[u,w.str,b.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[i,u,t],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[i,"Netscape"],u,t],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[i,u,t]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[l,"amd64"]],[/(ia32(?=;))/i],[[l,y.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[l,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[l,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[l,/ower/,"",y.lowerize]],[/(sun4\w)[;\)]/i],[[l,"sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[l,y.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[e,c,[o,g]],[/applecoremedia\/[\w\.]+ \((ipad)/],[e,[c,"Apple"],[o,g]],[/(apple\s{0,1}tv)/i],[[e,"Apple TV"],[c,"Apple"]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[c,e,[o,g]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[e,[c,"Amazon"],[o,g]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[e,w.str,b.device.amazon.model],[c,"Amazon"],[o,h]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[e,c,[o,h]],[/\((ip[honed|\s\w*]+);/i],[e,[c,"Apple"],[o,h]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[c,e,[o,h]],[/\((bb10);\s(\w+)/i],[[c,"BlackBerry"],e,[o,h]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7))/i],[[c,"Asus"],e,[o,g]],[/(sony)\s(tablet\s[ps])/i],[c,e,[o,g]],[/(nintendo)\s([wids3u]+)/i],[c,e,[o,v]],[/((playstation)\s[3portablevi]+)/i],[[c,"Sony"],e,[o,v]],[/(sprint\s(\w+))/i],[[c,w.str,b.device.sprint.vendor],[e,w.str,b.device.sprint.model],[o,h]],[/(Lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[[c,"Lenovo"],e,[o,g]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[c,[e,/_/g," "],[o,h]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[c,"Motorola"],e,[o,h]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[c,"Motorola"],e,[o,g]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[c,"Samsung"],e,[o,g]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[c,"Samsung"],e,[o,h]],[/(sie)-(\w+)*/i],[[c,"Siemens"],e,[o,h]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[c,"Nokia"],e,[o,h]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[c,"Acer"],e,[o,g]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[c,"LG"],e,[o,g]],[/(lg) netcast\.tv/i],[c,[o,x]],[/((nexus\s[45]))/i,/(lg)[e;\s\/-]+(\w+)*/i],[[c,"LG"],e,[o,h]],[/android.+((ideatab[a-z0-9\-\s]+))/i],[[c,"Lenovo"],e,[o,g]],[/linux;.+((jolla));/i],[c,e,[o,h]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[o,y.lowerize],c,e]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[i,u],[/rv\:([\w\.]+).*(gecko)/i],[u,i]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[i,u],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[i,[u,w.str,b.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[i,"Windows"],[u,w.str,b.os.windows.version]],[/\((bb)(10);/i],[[i,"BlackBerry"],u],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[i,u],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[i,"Symbian"],u],[/\((series40);/i],[i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[i,"Firefox OS"],u],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[i,u],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[i,"Chromium OS"],u],[/(sunos)\s?([\w\.]+\d)*/i],[[i,"Solaris"],u],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[i,u],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[i,"iOS"],[u,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[i,[u,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[i,u]]};s.VERSION="0.7.1",s.BROWSER={NAME:i,MAJOR:t,VERSION:u},s.CPU={ARCHITECTURE:l},s.DEVICE={MODEL:e,VENDOR:c,TYPE:o,CONSOLE:v,MOBILE:h,SMARTTV:x,TABLET:g},s.ENGINE={NAME:i,VERSION:u},s.OS={NAME:i,VERSION:u},typeof exports!=p?(exports=typeof module!=p&&module.exports?module.exports=s:exports).UAParser=s:(a.UAParser=s,typeof define==m&&define.amd&&define("UAParser",[],function(){return s}),typeof(n=a.jQuery||a.Zepto)!=p&&(r=new s,n.ua=r.getResult(),n.ua.get=function(){return r.getUA()},n.ua.set=function(t){r.setUA(t);var e,i=r.getResult();for(e in i)n.ua[e]=i[e]}))}(this),max||{}),max=(!function(a){function t(t){var i=this;i.minchars=t.minchars,i.maxui=t.maxui,i.source=t.source,i.action=t.action,i.filter=t.filter,i.requests={},i.$el=a(t.list),i.$list=i.$el.find("ul"),i.$el.on("click",".maxui-prediction",function(t){var e=a(t.currentTarget);i.select(e),i.choose(t)})}function e(t){var e=this;e.input=t.input,e.$input=a(e.input),e.placeholder=t.placeholder,e.$delegate=a(t.delegate),e.setBindings(),e.bindings=t.bindings,e.$input.val(e.placeholder)}max.views=max.views||{},a.extend(max.views,(t.prototype.select=function(t){this.$list.find(".maxui-prediction.selected").removeClass("selected"),t.addClass("selected")},t.prototype.choose=function(t){var e=this.$list.find(".maxui-prediction.selected");this.action.apply(this,[e]),this.hide()},t.prototype.moveup=function(t){var e=this.$list.find(".maxui-prediction.selected"),i=e.prev();0<i.length?this.select(i):this.select(e.siblings(":last"))},t.prototype.movedown=function(t){var e=this.$list.find(".maxui-prediction.selected"),i=e.next();e.removeClass("selected"),0<i.length?this.select(i):this.select(e.siblings(":first"))},t.prototype.matchingRequest=function(t){var i,n=t.substr(0,t.length-1);if(a.each(this.requests,function(t,e){n===t&&(i=e)}),i&&!i.remaining)return i.text},t.prototype.normalizeWhiteSpace=function(t,e){return t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n"),t=!0===(1<arguments.length?e:!0)?t.replace(/[ ]{2,}/gi," "):t},t.prototype.show=function(t){var e=this,i=a(t.target),n=e.normalizeWhiteSpace(i.val(),!1);n.length>=this.minchars?(i=e.matchingRequest(n),e.requests.hasOwnProperty(n)?e.render(n,n):i?e.render(n,i):this.source.apply(this,[t,n,function(t){e.requests[n]={text:n,data:t,remaining:this.getResponseHeader("X-Has-Remaining-Items")},e.render(n,n)}])):e.hide()},t.prototype.render=function(t,e){for(var i=this,n="",a=i.requests[e].data,s=i.filter(),r=!1,o=0;o<a.length;o++){var c=a[o],u=0<=c.username.search(new RegExp(t,"i")),u=0<=c.displayName.search(new RegExp(t,"i"))||u;-1===s.indexOf(c.username)&&u&&(u=i.maxui.settings.avatarURLpattern.format(c.username),c={username:c.username,displayName:c.displayName,avatarURL:u,cssclass:"maxui-prediction"+(r?"":" selected")},n+=i.maxui.templates.predictive.render(c),r=!0)}""===n&&(n="<li>"+i.maxui.settings.literals.no_match_found+"</li>"),i.$list.html(n),i.$el.show()},t.prototype.hide=function(t){this.$el.hide()},e.prototype.normalizeWhiteSpace=function(t,e){return t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n"),t=!0===(1<arguments.length?e:!0)?t.replace(/[ ]{2,}/gi," "):t},e.prototype.bind=function(t,e){this.$delegate.on(t,this.input,e)},e.prototype.execExtraBinding=function(t,e){this.bindings.hasOwnProperty(e.type)&&this.bindings[e.type].apply(t,[e])},e.prototype.getInputValue=function(){var t=this.$input.val();return this.normalizeWhiteSpace(t,!1)},e.prototype.setBindings=function(){var e=this;e.bind("focusin",function(t){t.preventDefault(),t.stopPropagation(),e.getInputValue()===e.placeholder&&a(this).val(""),e.execExtraBinding(this,t)}),e.bind("focusout",function(t){t.preventDefault(),t.stopPropagation(),""===e.getInputValue()&&(a(this).val(e.placeholder),e.$input.toggleClass("maxui-empty",!0)),e.execExtraBinding(this,t)});e.bind("maxui-input-submit maxui-input-cancel maxui-input-up maxui-input-down maxui-input-keypress",function(t){t.preventDefault(),t.stopPropagation(),e.execExtraBinding(this,t)}),e.bind("maxui-input-clear",function(t){e.$input.val(e.placeholder)}),e.bind("keydown",function(t){38===t.which?e.$input.trigger("maxui-input-up",[t]):40===t.which&&e.$input.trigger("maxui-input-down",[t]),e.$input.toggleClass("maxui-empty",!1)}),e.bind("keyup",function(t){t.preventDefault(),t.stopPropagation(),13!==t.which||t.shiftKey?27===t.which?e.$input.trigger("maxui-input-cancel",[t]):38!==t.which&&40!==t.which&&e.$input.trigger("maxui-input-keypress",[t]):e.$input.trigger("maxui-input-submit",[t]),e.execExtraBinding(this,t)})},{MaxInput:e,MaxPredictive:t}))}(jQuery),max||{}),max=(!function(i){function t(t){var e=this;e.maxui=t,e.title="Overlay Title",e.content="",e.el="#maxui-overlay-panel",e.overlay_show_class=0<i("#box_chat").length?"#box_chat .maxui-overlay":".maxui-overlay",i(e.el+" .maxui-close").click(function(t){t.preventDefault(),t.stopPropagation(),e.maxui.overlay.hide()})}max.views=max.views||{},i.extend(max.views,(t.prototype.$el=function(){return i(this.el)},t.prototype.setTitle=function(t){this.$el().find("#maxui-overlay-title").text(t)},t.prototype.setContent=function(t){this.$el().find("#maxui-overlay-content").html(t)},t.prototype.configure=function(t){this.setTitle(t.title),this.setContent(t.content),t.bind(this)},t.prototype.show=function(t){var e=this;t.load(function(t){e.configure(t)}),i(e.overlay_show_class).show(),e.$el().animate({opacity:1},200)},t.prototype.hide=function(){var e=this;e.$el().trigger("maxui-overlay-close",[]),e.$el().animate({opacity:0},200,function(t){i(e.overlay_show_class).hide()})},{MaxOverlay:t}))}(jQuery),max||{}),max=(!function(i){function t(t){var e=this;e.maxui=t.maxui,e.width=t.width,e.handle=t.handle,e.dragging=!1,e.scrollbar_selector=t.scrollbar,e.$bar=i(e.scrollbar_selector),e.$dragger=e.$bar.find(".maxui-dragger"),e.target_selector=t.target,e.$target=i(e.target_selector),e.bind()}max.views=max.views||{},i.extend(max.views,(t.prototype.bind=function(){var a=this;a.$target.on("mousewheel",function(t,e,i,n){t.preventDefault(),t.stopPropagation(),a.enabled()&&(t=a.$target.height()-a.maxtop-a.handle.height,n=parseInt(a.$target.css("margin-top"),10)+10*+n,a.$target.css({"margin-top":n=(n=0<n?0:n)<-1*t?-1*t:n}),n=100*(n*=-1)/t,a.setDraggerPosition(n))}),i(document).on("mousemove",function(t){a.dragging&&(t.stopPropagation(),t.preventDefault(),a.enabled()&&(t=100*(t=(t=(t=t.clientY+i(window).scrollTop()-a.$bar.offset().top)<0?0:t)>=a.maxtop?a.maxtop:t)/a.maxtop,a.setContentPosition(t)))}),i(document.body).on("mousedown",".maxui-dragger",function(t){t.stopPropagation(),t.preventDefault(),a.dragging=!0}),i(document).on("mouseup",function(t){a.dragging=!1})},t.prototype.setHeight=function(t){var e=i("#maxui-conversations .maxui-wrapper").offset().top-this.maxui.offset().top-1;this.$bar.css({height:t,top:e}),this.maxtop=t-this.handle.height-2},t.prototype.setTarget=function(t){this.$target=i(t)},t.prototype.setDraggerPosition=function(t){t=this.maxtop*t/100;this.$dragger.css({"margin-top":t})},t.prototype.setContentPosition=function(t){var e,i=this;i.enabled()?(e=i.$target.height()-i.maxtop-i.handle.height,i.$target.css({"margin-top":-1*(e*t/100)}),i.setDraggerPosition(t)):(i.$target.css({"margin-top":""}),i.setDraggerPosition(0))},t.prototype.enabled=function(){return this.$target.height()>this.maxtop},{MaxScrollbar:t}))}(jQuery),max||{}),max=(max.templates=function(){return{activity:Hogan.compile('<div class="maxui-activity {{#flagged}}maxui-flagged{{/flagged}}" id="{{id}}" userid="{{actor.id}}" username="{{actor.username}}">            <div class="maxui-activity-content">                <div class="maxui-topright">                    {{^showLikesCount}}<span class="maxui-publisheddate">{{date}}</span>{{/showLikesCount}}                    {{#showLikesCount}}<span class="maxui-likescount"><strong>{{likes}}</strong><i class="maxui-icon-thumbs-up"></i></span>{{/showLikesCount}}                </div>                <div class="maxui-actor">                    <a href="{{portalURL}}/profile/{{actor.username}}" title="{{literals.open_profile}}">                        <span class="maxui-avatar maxui-big"><img src="{{avatarURL}}"></span>                    </a>                    <a class="maxui-filter-actor" href="#">                        <span class="maxui-displayname">{{actor.displayName}}</span>                    </a>                    <span class="maxui-username">{{actor.username}}&nbsp;</span>                </div>                <div class="maxui-activity-message">                    {{#fileDownload}}                    <form action="{{maxServerURL}}/activities/{{id}}/file/download" method="POST">                        <input type="hidden" name="X-Oauth-Token" value="{{auth.token}}">                        <input type="hidden" name="X-Oauth-Username" value="{{auth.username}}">                        <input type="hidden" name="X-Oauth-Scope" value="widgetcli">                        <input type="hidden" name="X-HTTP-Method-Override" value="GET">                        <span class="maxui-icon-download"></span><input type="submit" class="maxui-download" name="submit" value="{{filename}}">                    </form>                    {{/fileDownload}}                    <p class="maxui-body">{{&text}}</p>                        </div>            </div>            <div class="maxui-footer">                {{#publishedIn}}                <div class="maxui-origin maxui-icon-">                       {{literals.context_published_in}}                       <a href="{{publishedIn.url}}">{{publishedIn.displayName}}</a>                       {{#via}}                           {{literals.generator_via}}                           <span class="maxui-via">                           {{via}}                           </span>                       {{/via}}                </div>                {{/publishedIn}}                <div class="maxui-actions">                    <a href="" class="maxui-action maxui-commentaction maxui-icon- {{#replies}}maxui-has-comments{{/replies}}"><strong>{{replies.length}}</strong> {{literals.toggle_comments}}</a>                    <a href="" class="maxui-action maxui-favorites {{#favorited}}maxui-favorited{{/favorited}} maxui-icon-">{{literals.favorite}}</a>                    <a {{#showLikes}}title="{{likesUsernames}}" {{/showLikes}}href="" class="maxui-action maxui-likes {{#liked}}maxui-liked{{/liked}} maxui-icon-"><strong>{{likes}}</strong> {{literals.like}}</a>                    {{#canFlagActivity}}                    <a href="" class="maxui-action maxui-flag {{#flagged}}maxui-flagged{{/flagged}} maxui-icon-">{{literals.flag_activity_icon}}</a>                    {{/canFlagActivity}}                    {{#canDeleteActivity}}                    <a href="" class="maxui-action maxui-delete maxui-icon-">{{literals.delete_activity_icon}}</a>                    <div class="maxui-popover left">                        <div class="maxui-arrow"></div>                            <h3 class="maxui-popover-title">{{literals.delete_activity_confirmation}}</h3>                            <div class="maxui-popover-content">                              <input type="button" class="maxui-button-delete" value="{{literals.delete_activity_delete}}">                              <input type="button" class="maxui-button-cancel" value="{{literals.delete_activity_cancel}}">                            </div>                    </div>                    {{/canDeleteActivity}}                        </div>            </div>                    {{#canViewComments}}            <div class="maxui-comments" style="display: none">                <div class="maxui-commentsbox">                    {{#replies}}                        {{> comment}}                    {{/replies}}                </div>                {{#canWriteComment}}                <div class="maxui-newcommentbox">                        <textarea class="maxui-empty maxui-text-input" id="maxui-commentBox" data-literal="{{literals.new_comment_text}}">{{literals.new_comment_text}}</textarea>                        <input disabled="disabled" type="button" class="maxui-button maxui-disabled" value="{{literals.new_comment_post}}"/>                </div>                {{/canWriteComment}}            </div>            {{/canViewComments}}                    <div class="maxui-clear"></div>        </div>            '),comment:Hogan.compile('<div class="maxui-comment" id="{{id}}" userid="{{actor.id}}" displayname="{{actor.username}}">            <div class="maxui-activity-content">               <span class="maxui-publisheddate">{{date}}</span>               <div class="maxui-actor">                   <a href="{{portalURL}}/profile/{{actor.username}}" title="{{literals.open_profile}}">                       <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                    </a>                    <a class="maxui-filter-actor" href="#">                       <span class="maxui-displayname">{{actor.displayName}}</span>                    </a>                    <span class="maxui-username">{{actor.username}}</span>               </div>               <div>                   <p class="maxui-body">{{&text}}</p>                   {{#canDeleteComment}}                   <span class="maxui-delete-comment maxui-icon-"></span>                   <div class="maxui-popover left">                        <div class="maxui-arrow"></div>                            <h3 class="maxui-popover-title">{{literals.delete_activity_confirmation}}</h3>                            <div class="maxui-popover-content">                              <input type="button" class="maxui-button-delete" value="{{literals.delete_activity_delete}}">                              <input type="button" class="maxui-button-cancel" value="{{literals.delete_activity_cancel}}">                            </div>                   </div>                   {{/canDeleteComment}}               </div>            </div>        </div>            '),postBox:Hogan.compile('      <span class="maxui-avatar maxui-big">                  <img src="{{avatar}}">              </span>              <div id="maxui-newactivity-box">                   <div class="maxui-wrapper">                       <textarea class="maxui-empty maxui-text-input" data-literal="{{textLiteral}}">{{textLiteral}}</textarea>                       <div class="maxui-error-box"></div>                   </div>                            {{#showSubscriptionList}}                    <select id="maxui-subscriptions">                      <option disabled selected value>{{selectCommunityLiteral}}</option>                      {{#subscriptionList}}                        <option value="{{hash}}">{{displayname}}</option>                      {{/subscriptionList}}                    </select>                    {{/showSubscriptionList}}                    <div id="preview"></div>                    <label for="maxui-file" class="upload-file">{{fileLiteral}}</label>                    <input type="file" id="maxui-file" class="maxui-file-image" accept="file/*" style="display:none">                    <label for="maxui-img" class="upload-img" style="">{{imgLiteral}}</label>                    <input type="file" id="maxui-img" class="maxui-file-image" accept="image/*" style="display:none">                   <input disabled="disabled" type="button" class="maxui-button maxui-disabled" value="{{buttonLiteral}}">              </div>            '),predictive:Hogan.compile('<li data-username="{{username}}" data-displayname="{{displayName}}" class="{{cssclass}}">        <img src="{{avatarURL}}"/><span>{{displayName}}</span>        </li>            '),filters:Hogan.compile('{{#filters}}            {{#visible}}            <div class="maxui-filter maxui-{{type}}" type="{{type}}" value="{{value}}"><span>{{prepend}}{{value}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>            {{/visible}}        {{/filters}}            '),message:Hogan.compile('<div class="maxui-message maxui-user-{{#othersMessage}}not{{/othersMessage}}me" id="{{id}}">            <div class="maxui-activity-content">                <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                <div class="maxui-balloon">                    {{#fileDownload}}                    <form action="{{maxServerURL}}/messages/{{id}}/file/download" method="POST">                        <input type="hidden" name="X-Oauth-Token" value="{{auth.token}}">                        <input type="hidden" name="X-Oauth-Username" value="{{auth.username}}">                        <input type="hidden" name="X-Oauth-Scope" value="widgetcli">                        <input type="hidden" name="X-HTTP-Method-Override" value="GET">                        <span class="maxui-icon-download"></span><input type="submit" class="maxui-download" name="submit" value="{{filename}}">                    </form>                    {{/fileDownload}}                    {{#showDisplayName}}<span class="maxui-displayname">{{displayName}}</span>{{/showDisplayName}}                    <p class="maxui-body">{{&text}}</p>                    <span class="maxui-publisheddate">{{date}}</span>                    <i class="maxui-icon-check{{#ack}} maxui-ack{{/ack}}"></i>                </div>            </div>            <div class="maxui-clear"></div>        </div>            '),mainUIActivity:Hogan.compile('<div id="maxui-container">        {{#username}}         <div id="maxui-mainpanel">                   <div id="maxui-newactivity" {{#hidePostbox}}style="display:none;"{{/hidePostbox}}>           </div>                   <div id="maxui-search" class="folded">               <a id="maxui-search-toggle" class="maxui-disabled maxui-icon-" href="#" alt="obre-tanca"></a>               <a href="#" id="maxui-favorites-filter" title="{{literals.favorites_filter_hint}}"><i class="maxui-icon-star"/></a>               <div id="maxui-search-box">                  <input id="maxui-search-text" type="search" data-literal="{{literals.search_text}}" class="maxui-empty maxui-text-input" value="{{literals.search_text}}" />               </div>               <div id="maxui-search-filters"></div>           </div>                   <div id="maxui-show-timeline" class="maxui-togglebar maxui-icon-" style="{{showTimelineToggle}}"><a href="#">{{literals.activity}}</a></div>                      <div id="maxui-activity-sort">                <a class="maxui-sort-action maxui-most-recent {{orderViewRecent}}" href="#">{{literals.recent_activity}}</a>                /                <a class="maxui-sort-action maxui-most-valued {{orderViewLikes}}" href="#">{{literals.valued_activity}}</a>                /                <a class="maxui-sort-action maxui-flagged {{orderViewFlagged}}" href="#">{{literals.flagged_activity}}</a>              </div>              <div id="maxui-news-activities" hidden>                  <input type="button" class="maxui-button" value="Carrega noves entrades">              </div>           <div id="maxui-timeline" style="{{showTimeline}}">              <div class="maxui-wrapper">                  <div id="maxui-preload" class="maxui-activities" style="height:0px;overflow:hidden">                      <div class="maxui-wrapper">                      </div>                  </div>                  <div id="maxui-activities" class="maxui-activities">                  </div>                  <div id="maxui-more-activities">                      <input type="button" class="maxui-button" value="{{literals.load_more}}">                  </div>              </div>           </div>           <div id="maxui-overlay-background" class="maxui-overlay">           </div>           <div id="maxui-overlay-wrapper" class="maxui-overlay">               <div id="maxui-overlay-panel">                   <div id="maxui-overlay-header">                        <h3 id="maxui-overlay-title">I\'m a overlay</h3>                        <i class="maxui-close maxui-icon-cancel"/>                   </div>                   <div id="maxui-overlay-content">                   </div>               </div>           </div>          </div>         </div>        {{/username}}        {{^username}}          No s\'ha definit cap usuari        {{/username}}        </div>            ')}},max||{}),max=(!function(n){function t(t){var a=this;a.logtag="MESSAGING",a.maxui=t,a.active=!1,a.vhost="/",a.max_retries=3,a.retry_interval=3e3,a.debug=a.maxui.settings.enableAlerts,a.token=a.maxui.settings.oAuthToken,a.stompServer=a.maxui.settings.maxTalkURL,t.settings.domain?a.domain=t.settings.domain:a.domain=a.domainFromMaxServer(a.maxui.settings.maxServerURL),a.login="",a.domain&&(a.login+=a.domain+":"),a.login+=a.maxui.settings.username,a.ws=new WebSocket(a.stompServer),a.bindings=[],a.specification={uuid:{id:"g",type:"string"},user:{id:"u",type:"object",fields:{username:{id:"u"},displayname:{id:"d"}}},action:{id:"a",type:"char",values:{add:{id:"a"},delete:{id:"d"},modify:{id:"m"},refresh:{id:"r"},ack:{id:"k"}}},object:{id:"o",type:"char",values:{message:{id:"m"},conversation:{id:"c"},tweet:{id:"t"},activity:{id:"a"},context:{id:"x"},comment:{id:"t"}}},data:{id:"d",type:"object"},source:{id:"s",type:"char",values:{max:{id:"m"},widget:{id:"w"},ios:{id:"i"},android:{id:"a"},tweety:{id:"t"},maxbunny:{id:"b"}}},domain:{id:"i",type:"string"},version:{id:"v",type:"string"},published:{id:"p",type:"date"}},a._specification={},_.each(a.specification,function(t,e,i){var n=_.clone(t);_.has(n,"values")&&(n.values={},_.each(t.values,function(t,e,i){n.values[t.id]=_.clone(t),n.values[t.id].name=e,delete n.values[t.id].id})),_.has(n,"fields")&&"object"===n.type&&(n.fields={},_.each(t.fields,function(t,e,i){n.fields[t.id]=_.clone(t),n.fields[t.id].name=e,delete n.fields[t.id].id})),n.name=e,delete n.id,a._specification[t.id]=n})}t.prototype.domainFromMaxServer=function(t){var t=t.replace(/\/$/,""),e=document.createElement("a");return e.href=t,_.last(e.pathname.split("/"))},t.prototype.start=function(){var e=this,i=(e.maxui.logger.info("Connecting ...",e.logtag),e.connect(),1),n=setInterval(function(t){!e.active&&i<=e.max_retries?(e.maxui.logger.debug("Connection retry #{0}".format(i),e.logtag),e.disconnect(),e.ws=new WebSocket(e.maxui.settings.maxTalkURL),e.connect()):(e.active||e.maxui.logger.error("Connection failure after {0} reconnect attempts".format(e.max_retries),e.logtag),clearInterval(n)),i+=1},e.retry_interval)},t.prototype.bind=function(t,e){this.bindings.push({key:this.pack(t),callback:e})},t.prototype.on_message=function(s,r){var o=this,t=_.filter(o.bindings,function(t){var e=_.pick(s,_.keys(t.key));if(_.isEqual(t.key,e))return t});_.isEmpty(t)?o.maxui.logger.warning("Ignoring received message\n{0}\n No binding found for this message".format(s),o.logtag):_.each(t,function(t,e,i){o.maxui.logger.debug('Matched binding "{1}"'.format(s,t.key),o.logtag);var n=o.unpack(s),a=r.replace(/(\w+)\.(.*)/g,"$1");n.destination=a,t.callback(n)})},t.prototype.disconnect=function(){this.stomp.disconnect()},t.prototype.connect=function(){var i=this,t=(i.stomp=Stomp.over(i.ws),i.stomp.heartbeat.outgoing=6e4,i.stomp.heartbeat.incoming=6e4,i.stomp.reconnect_delay=100,[i.stomp.heartbeat.outgoing,i.stomp.heartbeat.incoming].join(",")),e=(i.stomp.debug=function(t){i.maxui.logger.debug(t,i.logtag)},"maxui"),t=(i.maxui.settings.generator&&(e+="[{0}]".format(i.maxui.settings.generator)),{login:i.login,passcode:i.token,host:i.vhost,"heart-beat":t,product:e,"product-version":i.maxui.version,platform:"{0} {1} / {2} {3}".format(n.ua.browser.name,n.ua.browser.version,n.ua.os.name,n.ua.os.version)});i.stomp.connect(t,function(t){i.stomp.subscribe("/exchange/{0}.subscribe".format(i.maxui.settings.username),function(t){var e=JSON.parse(t.body),t=/([^/])+$/.exec(t.headers.destination)[0];i.on_message(e,t)}),i.active=!0,i.maxui.logger.info("Succesfully connected to {0}".format(i.stompServer),i.logtag)},function(t){i.maxui.logger.error(t)})},t.prototype.pack=function(r){var o,c=this,u={};return _.each(r,function(t,e,i){var n,a,s=c.specification[e];_.isUndefined(s)||(_.has(s,"values")?_.has(s.values,t)&&(a=s.values[t].id):(a=t,_.has(s,"fields")&&"object"===s.type&&_.isObject(a)&&(n={},_.each(r[e],function(t,e,i){o=_.has(s.fields,e)?s.fields[e].id:e,n[o]=t}),a=n)),_.isUndefined(a)||(u[s.id]=a))}),u},t.prototype.unpack=function(r){var o,c=this,u={};return _.each(r,function(t,e,i){var n,a,s=c._specification[e];_.isUndefined(s)||(_.has(s,"values")?_.has(s.values,t)&&(a=s.values[t].name):(a=t,_.has(s,"fields")&&"object"===s.type&&_.isObject(a)&&(n={},_.each(r[e],function(t,e,i){o=_.has(s.fields,e)?s.fields[e].name:e,n[o]=t}),a=n)),_.isUndefined(a)||(u[s.name]=a))}),u},t.prototype.prepare=function(t){var e=this,i={source:"widget",version:e.maxui.version,user:{username:e.maxui.settings.username,displayname:e.maxui.settings.displayName},published:e.maxui.utils.rfc3339(e.maxui.utils.now()),uuid:uuid.v1()};return e.domain&&(i.domain=e.domain),_.extend(_.pick(t,_.keys(e.specification)),i)},t.prototype.send=function(t,e){t=this.prepare(t);return this.stomp.send("/exchange/{0}.publish/{1}".format(this.maxui.settings.username,e),{},JSON.stringify(this.pack(t))),t},max.MaxMessaging=t}(jQuery),max||{}),max=(!function(){var i={debug:0,info:1,warn:2,error:3};function t(t){this.level=0}t.prototype.setLevel=function(t){this.level=i[t]},t.prototype.log=function(t,e){try{window.console.log("{0}: {1}".format(e,t))}catch(t){}},t.prototype.debug=function(t){var e="MAXUI";1<arguments.length&&(e=arguments[1]);this.level<=i.debug&&this.log(t,e)},t.prototype.info=function(t){var e="MAXUI";1<arguments.length&&(e=arguments[1]);this.level<=i.info&&this.log(t,e)},t.prototype.warn=function(t){var e="MAXUI";1<arguments.length&&(e=arguments[1]);this.level<=i.warn&&this.log(t,e)},t.prototype.error=function(t){var e="MAXUI";1<arguments.length&&(e=arguments[1]);this.level<=i.error&&this.log(t,e)},max.MaxLogging=t}(jQuery),max||{}),max=(max.literals=function(t){var e={en:{cancel:"Cancel",delete:"Delete",months:["January","February","March","April","May","June","July","August","September","October","November","December"],new_activity_text:"Write something...",activity:"activity",conversations_lower:"chats",conversations:"Chats",conversations_list:"chats list",conversations_info_title:"Chat information",conversations_info_participants:"Participants",conversations_info_owner:"owner",conversations_info_add:"Add participant...",conversations_info_created:"Created",conversations_info_leave:"Leave chat",conversations_info_delete:"Delete chat",conversations_info_delete_warning:"Warning!",conversations_info_delete_help:"If you delete the chat, the participants will not be able to see the messages anymore. To avoid this, cancel and transfer the ownership to someone else.",conversations_info_kick_message_1:"Click to kick",conversations_info_kick_message_2:"out of this chat",conversations_info_transfer_message_1:"Click to make",conversations_info_transfer_message_2:"the owner of this chat",participants:"Talk to",chats_load_older:"Load older",conversation_name:"Chat name",message:"Message",no_chats:"No chats already",no_match_found:"No match found",new_conversation_text:"Add participants and send a message to start a chat",new_img_post:"Add image",new_file_post:"Add file",new_activity_post:"Post activity",toggle_comments:"comments",new_comment_text:"Comment something...",new_comment_post:"Post comment",load_more:"Load more",context_published_in:"Published in",generator_via:"via",search_text:"Search in posts...",and_more:"and more...",new_message_post:"Send message",post_permission_unauthorized:"You''re not authorized to post on this context",post_permission_not_here:"You're not mentioning @anyone",post_permission_not_enough_participants:"You have to add participants",post_permission_missing_displayName:"You have to name the chat",delete_activity_confirmation:"Are you sure?",delete_activity_delete:"Delete",delete_activity_cancel:"Cancel",delete_activity_icon:"delete",flag_activity_icon:"flagged",favorites_filter_hint:"Filter by favorited activity",favorites:"Favorites",favorite:"favorite",unfavorite:"unfavorite",like:"like",unlike:"unlike",recent_activity:"Latest activity",valued_activity:"Most valued activity",flagged_activity:"Flagged activity",recent_favorited_activity:"Latest favorites",valued_favorited_activity:"Most valued favorites",open_profile:"Show profile",select_community:"Select a community"},es:{cancel:"Cancelar",delete:"Eliminar",months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],new_activity_text:"Escribe algo...",activity:"actividad",conversations_lower:"chats",conversations:"Chats",conversations_list:"lista de chats",conversations_info_title:"Información del chat",conversations_info_participants:"Participantes",conversations_info_owner:"propietario",conversations_info_add:"Añade participante...",conversations_info_created:"Creada",conversations_info_leave:"Abandonar chat",conversations_info_delete:"Borra el chat",conversations_info_delete_warning:"Atención!",conversations_info_delete_help:"Si eliminas el chat, los participantes dejarán de ver los mensajes. Para evitar esto, cancela y luego traspasa el chat a otra persona.",conversations_info_kick_message_1:"Clica para echar a",conversations_info_kick_message_2:"de este chat",conversations_info_transfer_message_1:"Clica para dar a ",conversations_info_transfer_message_2:"la administración del chat",participants:"Chatear con",chats_load_older:"Cargar antiguos",conversation_name:"Nombre del chat",message:"Mensaje",no_chats:"No hay chats",no_match_found:"No hay coincidencias",new_conversation_text:"Añade participantes y envia el mensaje para iniciar un chat",new_img_post:"Añadir imagen",new_file_post:"Añadir archivo",new_activity_post:"Publica",toggle_comments:"comentarios",new_comment_text:"Comenta algo...",new_comment_post:"Comenta",load_more:"Cargar más",context_published_in:"Publicado en",generator_via:"via",search_text:"Busca en las entradas...",and_more:"i más...",new_message_post:"Envia el mensaje",post_permission_unauthorized:"No estas autorizado a publicar en este contexto",post_permission_not_here:"No estas citando a @nadie",post_permission_not_enough_participants:"Tienes que añadir participantes",post_permission_missing_displayName:"Tienes que dar un nombre al chat",delete_activity_confirmation:"Estás seguro?",delete_activity_delete:"Borrar",delete_activity_cancel:"Cancelar",delete_activity_icon:"borrar",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra por actividad favorita",favorites:"Favoritos",favorite:"favorito",unfavorite:"quitar favorito",like:"me gusta",unlike:"ya no me gusta",recent_activity:"Últimas actividades",valued_activity:"Actividades más valoradas",flagged_activity:"Actividades destacadas",recent_favorited_activity:"Últimas favoritas",valued_favorited_activity:"Favoritas más valoradas",open_profile:"Ver el perfil",select_community:"Selecciona una comunidad"},ca:{cancel:"Cancelar",delete:"Elimina",months:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],new_activity_text:"Escriu alguna cosa...",activity:"activitat",conversations_lower:"xats",conversations:"Xats",conversations_list:"llista de xats",conversations_info_title:"Informació del xat",conversations_info_participants:"Participants",conversations_info_owner:"propietari",conversations_info_add:"Afegeix participant...",conversations_info_created:"Creada",conversations_info_leave:"Marxar del xat",conversations_info_delete:"Esborra el xat",conversations_info_delete_warning:"Alerta!",conversations_info_delete_help:"Si elimines el xat, la resta de participants deixaran de veure els missatges. Per evitar-ho, cancela i traspassa el xat a algú altre.",conversations_info_kick_message_1:"Clica per fer fora a ",conversations_info_kick_message_2:"d'aquest xat",conversations_info_transfer_message_1:"Clica per fer a",conversations_info_transfer_message_2:"l'administrador d'aquest xat",participants:"Xateja amb",chats_load_older:"Carregar antics",conversation_name:"Nom del xat",message:"Missatge",no_chats:"No hi ha xats",no_match_found:"No s'han trobat coincidències",new_conversation_text:"Afegeix participants i envia el missatge per iniciar un xat",new_img_post:"Afegir imatge",new_file_post:"Afegir arxiu",new_activity_post:"Publica",toggle_comments:"comentaris",new_comment_text:"Comenta alguna cosa...",new_comment_post:"Comenta",load_more:"Carrega'n més",context_published_in:"Publicat a",generator_via:"via",search_text:"Cerca a les entrades...",and_more:"i més...",new_message_post:"Envia el missatge",post_permission_unauthorized:"No estàs autoritzat a publicar en aquest contexte",post_permission_not_here:"No estas citant a @ningú",post_permission_not_enough_participants:"Has d'afegir participants",post_permission_missing_displayName:"Has de posar nom al xat",delete_activity_confirmation:"Estàs segur?",delete_activity_delete:"Esborra",delete_activity_cancel:"No ho toquis!",delete_activity_icon:"esborra",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra per activitat favorita",favorites:"Favorits",favorite:"favorit",unfavorite:"treure favorit",like:"m'agrada",unlike:"ja no m'agrada",recent_activity:"Darreres activitats",valued_activity:"Activitats més valorades",flagged_activity:"Activitats destacades",recent_favorited_activity:"Darreres favorites",valued_favorited_activity:"Favorites més valorades",open_profile:"Veure el perfil",select_community:"Selecciona una comunitat"}};return e[t]},max||{});function MaxClient(){this.ROUTES={users:"/people",user:"/people/{0}",avatar:"/people/{0}/avatar",user_activities:"/people/{0}/activities",timeline:"/people/{0}/timeline",user_comments:"/people/{0}/comments",user_shares:"/people/{0}/shares",user_likes:"/people/{0}/likes",follows:"/people/{0}/follows",follow:"/people/{0}/follows/{1}",subscriptions:"/people/{0}/subscriptions",activities:"/contexts/{0}/activities",activity:"/activities/{0}",comments:"/activities/{0}/comments",comment:"/activities/{0}/comments/{1}",likes:"/activities/{0}/likes",like:"/activities/{0}/likes/{1}",flag:"/activities/{0}/flag",favorites:"/activities/{0}/favorites",favorite:"/activities/{0}/favorites/{1}",shares:"/activities/{0}/shares",share:"/activities/{0}/shares/{1}",conversations:"/conversations",conversation:"/conversations/{0}",conversation_owner:"/conversations/{0}/owner",user_conversation:"/people/{0}/conversations/{1}",messages:"/conversations/{0}/messages",context:"/contexts/{0}"}}max.utils=function(){var u={};return{setSettings:function(t){u=t},freezeEvent:function(t){return t.preventDefault&&t.preventDefault(),t.returnValue=!1,t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),!1},normalizeWhiteSpace:function(t,e){return t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n"),t=!0===(1<arguments.length?e:!0)?t.replace(/[ ]{2,}/gi," "):t},formatText:function(t){return t=t&&(t=(t=t.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(t){var e=t;return'<a href="'+(e=e.match("^https?://")?e:"http://"+e)+'">'+t+"</a>"})).replace(/(\s|^)#{1}(\w+)/gi,function(){var t=arguments[1],e=arguments[2];return'<a class="maxui-hashtag" href="#" value="'+e+'">'+t+"#"+e+"</a>"})).replace(/\r?\n/gi,"<br/>")},isCORSCapable:function(){return void 0!==(new XMLHttpRequest).withCredentials},removeValueFrom:function(t){for(var e,i,n=arguments,a=n.length;1<a&&t.length;)for(e=n[--a];-1!==(i=t.indexOf(e));)t.splice(i,1);return t},timestamp:function(){return+new Date},now:function(){return new Date},rfc3339:function(t){function e(t){return t<10?"0"+t:t}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"},formatDate:function(t,e){var i=new Date,n="",a="",s=new Date,r=t.match("^([-+]?)(\\d{4,})(?:-?(\\d{2})(?:-?(\\d{2})(?:[Tt ](\\d{2})(?::?(\\d{2})(?::?(\\d{2})(?:\\.(\\d{1,3})(?:\\d+)?)?)?)?(?:[Zz]|(?:([-+])(\\d{2})(?::?(\\d{2}))?)?)?)?)?)?$");if(r){for(var o=[2,3,4,5,6,7,8,10,11],c=o.length-1;0<=c;--c)r[o[c]]=void 0!==r[o[c]]&&0<r[o[c]].length?parseInt(r[o[c]],10):0;"-"===r[1]&&(r[2]*=-1);t=Date.UTC(r[2],r[3]-1,r[4],r[5],r[6],r[7],r[8]);void 0!==r[9]&&0<r[9].length&&(t+=("+"===r[9]?-1:1)*(3600*r[10]*1e3+60*r[11]*1e3)),0<=r[2]&&r[2]<=99&&(t-=59958144e6);return s.setTime(t),i.getTime()-t<2592e5?n=jQuery.easydate.format_date(s,e):("en"===e?n="{0} {1}".format(r[4],u.literals.months[r[3]-1]):"es"===e?n="{0} de {1}".format(r[4],u.literals.months[r[3]-1]):"ca"===e&&(a="de ",4!==r[3]&&8!==r[3]&&10!==r[3]||(a="d'"),n="{0} {2}{1}".format(r[4],u.literals.months[r[3]-1],a)),31536e6<i.getTime()-t&&(n="{0}/{1}/{2}".format(r[4],r[3],r[2]))),n}return null},utf8_decode:function(t){var e,i,n=[],a=0,s=0,r=0;for(t+="";a<t.length;)(e=t.charCodeAt(a))<128?(n[s++]=String.fromCharCode(e),a++):191<e&&e<224?(r=t.charCodeAt(a+1),n[s++]=String.fromCharCode((31&e)<<6|63&r),a+=2):(r=t.charCodeAt(a+1),i=t.charCodeAt(a+2),n[s++]=String.fromCharCode((15&e)<<12|(63&r)<<6|63&i),a+=3);return n.join("")},sha1:function(t){function e(t,e){return t<<e|t>>>32-e}function i(t){for(var e="",i=7;0<=i;i--)e+=(t>>>4*i&15).toString(16);return e}for(var n,a,s,r,o,c,u,l,d=new Array(80),m=1732584193,p=4023233417,f=2562383102,v=271733878,h=3285377520,g=(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e+=String.fromCharCode(n):e=127<n&&n<2048?(e+=String.fromCharCode(n>>6|192))+String.fromCharCode(63&n|128):(e=(e+=String.fromCharCode(n>>12|224))+String.fromCharCode(n>>6&63|128))+String.fromCharCode(63&n|128)}return e}(t)).length,x=[],y=0;y<g-3;y+=4)a=t.charCodeAt(y)<<24|t.charCodeAt(y+1)<<16|t.charCodeAt(y+2)<<8|t.charCodeAt(y+3),x.push(a);switch(g%4){case 0:y=2147483648;break;case 1:y=t.charCodeAt(g-1)<<24|8388608;break;case 2:y=t.charCodeAt(g-2)<<24|t.charCodeAt(g-1)<<16|32768;break;case 3:y=t.charCodeAt(g-3)<<24|t.charCodeAt(g-2)<<16|t.charCodeAt(g-1)<<8|128}for(x.push(y);x.length%16!=14;)x.push(0);for(x.push(g>>>29),x.push(g<<3&4294967295),n=0;n<x.length;n+=16){for(y=0;y<16;y++)d[y]=x[n+y];for(y=16;y<=79;y++)d[y]=e(d[y-3]^d[y-8]^d[y-14]^d[y-16],1);for(s=m,r=p,o=f,c=v,u=h,y=0;y<=19;y++)l=e(s,5)+(r&o|~r&c)+u+d[y]+1518500249&4294967295,u=c,c=o,o=e(r,30),r=s,s=l;for(y=20;y<=39;y++)l=e(s,5)+(r^o^c)+u+d[y]+1859775393&4294967295,u=c,c=o,o=e(r,30),r=s,s=l;for(y=40;y<=59;y++)l=e(s,5)+(r&o|r&c|o&c)+u+d[y]+2400959708&4294967295,u=c,c=o,o=e(r,30),r=s,s=l;for(y=60;y<=79;y++)l=e(s,5)+(r^o^c)+u+d[y]+3395469782&4294967295,u=c,c=o,o=e(r,30),r=s,s=l;m=m+s&4294967295,p=p+r&4294967295,f=f+o&4294967295,v=v+c&4294967295,h=h+u&4294967295}return(l=i(m)+i(p)+i(f)+i(v)+i(h)).toLowerCase()}}},Object.keys||(Object.keys=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}),String.prototype.format=function(){var e=arguments;return this.replace(/\{\d+\}/g,function(t){return e[t.match(/\d+/)]})},MaxClient.prototype.configure=function(t){this.url=t.server,this.mode=t.mode,this.token=t.token,this.actor={objectType:"person",username:t.username}},MaxClient.prototype.POST=function(t,e,i){var n=this,a="{0}{1}".format(this.url,t),s=3<arguments.length?arguments[3]:{};return jQuery.ajax({url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",n.token),t.setRequestHeader("X-Oauth-Username",n.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli")},type:"POST",contentType:"application/json",data:JSON.stringify(e),async:!0,dataType:"json"}).done(function(t){i.call(t),s.done&&jQuery(window).trigger(s.done,t)}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail,t)}),!0},MaxClient.prototype.POSTFILE=function(t,e,i){var n=this,a="{0}{1}".format(this.url,t),s=3<arguments.length?arguments[3]:{};return jQuery.ajax({url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",n.token),t.setRequestHeader("X-Oauth-Username",n.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli")},type:"POST",processData:!1,contentType:!1,data:e,async:!0,dataType:"json"}).done(function(t){i.call(t),s.done&&jQuery(window).trigger(s.done,t)}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail,t)}),!0},MaxClient.prototype.PUT=function(t,e,i){var n=this,a="{0}{1}".format(this.url,t),s=3<arguments.length?arguments[3]:{};return jQuery.ajax({url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",n.token),t.setRequestHeader("X-Oauth-Username",n.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli"),t.setRequestHeader("X-HTTP-Method-Override","PUT")},contentType:"application/json",type:"POST",data:JSON.stringify(e),async:!0,dataType:"json"}).done(function(t){i.call(t),s.done&&jQuery(window).trigger(s.done,t)}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail,t)}),!0},MaxClient.prototype.DELETE=function(t,e,i){var n=this,a="{0}{1}".format(this.url,t),s=2<arguments.length?i:{};return jQuery.ajax({url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",n.token),t.setRequestHeader("X-Oauth-Username",n.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli"),t.setRequestHeader("X-HTTP-Method-Override","DELETE")},type:"POST",data:JSON.stringify(e),async:!0,dataType:"json"}).done(function(t){i.call(t),s.done&&jQuery(window).trigger(s.done,t)}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail,t)}),!0},MaxClient.prototype.GET=function(t,e,n){var i=this,a="{0}{1}".format(this.url,t),s=3<arguments.length?arguments[3]:{},a=(0<Object.keys(e).length&&(a+="?"+jQuery.param(e,!0)),{url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",i.token),t.setRequestHeader("X-Oauth-Username",i.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli")},processData:!0,type:"GET",async:!0,dataType:"json"});return 3<arguments.length&&_.extend(a,arguments[3]),jQuery.ajax(a).done(function(t,e,i){s.done&&jQuery(window).trigger(s.done),n.apply(i,[t])}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail)}),!0},MaxClient.prototype.getUserData=function(t,e){t=this.ROUTES.user.format(t);this.GET(t,{},e)},MaxClient.prototype.getUsersList=function(t,e){var i=this.ROUTES.users;this.GET(i,{username:t},e)},MaxClient.prototype.getContext=function(t,e){t=this.ROUTES.context.format(t);this.GET(t,{},e)},MaxClient.prototype.getUserTimeline=function(t,e){var i=this.ROUTES.timeline.format(t),n=2<arguments.length?arguments[2]:{};this.GET(i,n,e)},MaxClient.prototype.getActivities=function(t,e){var i=this.ROUTES.activities.format(t.context),n=2<arguments.length?arguments[2]:{};t.tags&&0<t.tags.length&&(n.context_tags=t.tags),this.GET(i,n,e)},MaxClient.prototype.getCommentsForActivity=function(t,e){t=this.ROUTES.comments.format(t);this.GET(t,{},e)},MaxClient.prototype.addComment=function(t,e,i){var n={actor:{},object:{objectType:"comment",content:""}},t=(n.actor=this.actor,n.object.content=t,this.ROUTES.comments.format(e));this.POST(t,n,i)},MaxClient.prototype.addActivity=function(t,e,i,n){var a={},a=void 0===n?{object:{objectType:"note",content:""}}:"image"===n.type.split("/")[0]?{object:{objectType:"image",content:"",mimetype:n.type}}:{object:{objectType:"file",content:"",mimetype:n.type}};if(0<e.length){a.contexts=[];for(var s=0;s<e.length;s++)a.contexts.push({objectType:"context",url:e[s]})}a.object.content=t,3<arguments.length&&(a.generator=n);var r=this.ROUTES.user_activities.format(this.actor.username),o={done:"maxui-posted-activity",fail:"maxui-failed-activity"};if(void 0===n)this.POST(r,a,i,o);else{let t=new FormData;t.append("json_data",JSON.stringify(a)),t.append("file",new Blob([n],{type:n.type}),n.name),this.POSTFILE(r,t,i,o)}},MaxClient.prototype.removeActivity=function(t,e){t=this.ROUTES.activity.format(t);this.DELETE(t,{},e)},MaxClient.prototype.removeActivityComment=function(t,e,i){t=this.ROUTES.comment.format(t,e);this.DELETE(t,{},i)},MaxClient.prototype.getConversationSubscription=function(t,e,i){e=this.ROUTES.user_conversation.format(e,t);this.GET(e,{},i)},MaxClient.prototype.getConversation=function(t,e){t=this.ROUTES.conversation.format(t);this.GET(t,{},e)},MaxClient.prototype.modifyConversation=function(t,e,i){e={displayName:e},t=this.ROUTES.conversation.format(t);this.PUT(t,e,i)},MaxClient.prototype.addUserToConversation=function(t,e,i){e=this.ROUTES.user_conversation.format(e,t);this.POST(e,{},i)},MaxClient.prototype.kickUserFromConversation=function(t,e,i){e=this.ROUTES.user_conversation.format(e,t);this.DELETE(e,{},i)},MaxClient.prototype.deleteConversation=function(t,e){t=this.ROUTES.conversation.format(t);this.DELETE(t,{},e)},MaxClient.prototype.leaveConversation=function(t,e,i){e=this.ROUTES.user_conversation.format(e,t);this.DELETE(e,{},i)},MaxClient.prototype.transferConversationOwnership=function(t,e,i){e={actor:{username:e}},t=this.ROUTES.conversation_owner.format(t);this.PUT(t,e,i)},MaxClient.prototype.getConversationsForUser=function(t,e){var i=this.ROUTES.conversations;this.GET(i,{},e)},MaxClient.prototype.getMessageImage=function(t,e){this.GET(t,{},e,{processData:!1,dataType:void 0,contentType:"application/base64"})},MaxClient.prototype.getMessagesForConversation=function(t,e,i){t=this.ROUTES.messages.format(t);this.GET(t,e,i)},MaxClient.prototype.addMessageAndConversation=function(t,e){var i={object:{objectType:"note",content:t.message},contexts:[{objectType:"conversation",participants:t.participants}]},t=(t.displayName&&(i.contexts[0].displayName=t.displayName),this.ROUTES.conversations);this.POST(t,i,e)},MaxClient.prototype.addMessage=function(t,e,i){var n={},t=((n={object:{objectType:"note",content:""}}).object.content=t,this.ROUTES.messages.format(e));this.POST(t,n,i)},MaxClient.prototype.follow=function(t,e){var i={object:{objectType:"person",username:""}},t=(i.object.username=t,this.ROUTES.follow.format(this.actor.username,t));this.POST(t,i,e)},MaxClient.prototype.favoriteActivity=function(t,e){t=this.ROUTES.favorites.format(t);this.POST(t,{},e)},MaxClient.prototype.unfavoriteActivity=function(t,e){t=this.ROUTES.favorite.format(t,this.actor.username);this.DELETE(t,{},e)},MaxClient.prototype.likeActivity=function(t,e){t=this.ROUTES.likes.format(t);this.POST(t,{},e)},MaxClient.prototype.unlikeActivity=function(t,e){t=this.ROUTES.like.format(t,this.actor.username);this.DELETE(t,{},e)},MaxClient.prototype.flagActivity=function(t,e){t=this.ROUTES.flag.format(t);this.POST(t,{},e)},MaxClient.prototype.unflagActivity=function(t,e){t=this.ROUTES.flag.format(t);this.DELETE(t,{},e)},!function(w){w.fn.maxUIActivity=function(t){var v=this,e=(v.version="4.1.21",v.templates=max.templates(),v.utils=max.utils(),{maxRequestsAPI:"jquery",maxServerURL:"https://max.upc.edu",readContext:void 0,writeContexts:[],activitySource:"timeline",enableAlerts:!1,UISection:"timeline",disableTimeline:!1,disableConversations:!0,conversationsSection:"conversations",currentConversationSection:"conversations",activitySortOrder:"comments",activitySortView:"recent",maximumConversations:20,contextTagsFilter:[],scrollbarWidth:10,widgetWidth:"0",sectionHorizontalPadding:20,widgetBorder:2,loglevel:"info",hidePostboxOnTimeline:!1,maxTalkURL:"",generator:"",domain:"",showSubscriptionList:!1,showLikes:!0}),e=(v.settings=w.extend(e,t),v.logger=new max.MaxLogging(v),v.logger.setLevel(v.settings.loglevel),v.utils.isCORSCapable()||v.settings.maxServerURLAlias&&(v.settings.maxServerURL=v.settings.maxServerURLAlias),v.settings.maxTalkURL=v.utils.normalizeWhiteSpace(v.settings.maxTalkURL),!_.isUndefined(v.settings.maxTalkURL)&&""!==v.settings.maxTalkURL||(e=v.settings.maxServerURL,v.settings.maxTalkURL=e.replace("http","ws")+"/ws"),v.settings.domain=v.utils.normalizeWhiteSpace(v.settings.domain),"none"===v.settings.domain.toLowerCase()&&(v.settings.domain=""),"timeline"===v.settings.UISection&&"timeline"===v.settings.activitySource&&v.settings.readContext&&(v.settings.readContext=void 0,v.settings.writeContexts=[]),v.settings.showSubscriptionList&&"activities"===v.settings.activitySource&&(v.settings.showSubscriptionList=!1),v.language=t.language||"en",t.literals||{});if(v.settings.literals=w.extend(max.literals(v.language),e),v.settings.readContext){v.settings.readContextHash=v.utils.sha1(v.settings.readContext),v.settings.writeContexts.push(v.settings.readContext),v.settings.writeContextsHashes=[];for(var i=0;i<v.settings.writeContexts.length;i++)v.settings.writeContextsHashes.push(v.utils.sha1(v.settings.writeContexts[i]))}v.settings.avatarURLpattern||(v.settings.avatarURLpattern=v.settings.maxServerURL+"/people/{0}/avatar"),v.settings.contextAvatarURLpattern||(v.settings.contextAvatarURLpattern=v.settings.maxServerURL+"/contexts/{0}/avatar"),v.settings.conversationAvatarURLpattern||(v.settings.conversationAvatarURLpattern=v.settings.maxServerURL+"/conversations/{0}/avatar"),v.settings.enableAlerts&&w(window).bind("maxclienterror",function(t,e){e=JSON.parse(e.responseText);alert('The server responded with a "{0}" error, with the following message: "{1}". \n\nPlease try again later or contact administrator at admin@max.upc.edu.'.format(e.error,e.error_description))}),v.maxClient=new MaxClient;t={server:v.settings.maxServerURL,mode:v.settings.maxRequestsAPI,username:v.settings.username,token:v.settings.oAuthToken};return v.maxClient.configure(t),v.messaging=new max.MaxMessaging(v),v.conversations=new max.views.MaxConversations(v,{}),v.settings.disableConversations||(v.messaging.bind({action:"add",object:"message"},function(t){v.conversations.ReceiveMessage(t)}),v.messaging.bind({action:"add",object:"conversation"},function(t){v.conversations.ReceiveConversation(t)}),v.messaging.bind({action:"refresh",object:"conversation"},function(t){v.conversations.messagesview.load(t.destination)}),v.messaging.bind({action:"ack",object:"message"},function(t){v.conversations.messagesview.ack(t)})),v.utils.setSettings(v.settings),w.fn.hidePostboxActivity=function(){var t,e=this;if("timeline"===e.settings.activitySource&&0<e.settings.subscriptionsWrite.length)return e.settings.hidePostboxOnTimeline;for(t in e.settings.subscriptionsWrite)if(e.settings.subscriptionsWrite[t].hash===e.settings.readContext)return e.settings.hidePostboxOnTimeline;return!0},this.maxClient.getUserData(v.settings.username,function(t){v.settings.displayName=t.displayName||v.settings.username;var e={},i=[];if(t.subscribedTo&&t.subscribedTo&&0<t.subscribedTo.length)for(var n=0;n<t.subscribedTo.length;n++){var a=t.subscribedTo[n];e[a.hash]={},e[a.hash].permissions={};for(var s=0;s<a.permissions.length;s++){var r=a.permissions[s];e[a.hash].permissions[r]=!0,"write"===r&&i.push({hash:a.url,displayname:a.displayName})}}v.settings.subscriptionsWrite=i,v.settings.subscriptions=e,"timeline"===v.settings.activitySource&&0<i.length&&v.settings.writeContexts.push(i[0].hash),v.settings.disableConversations||(v.messaging.start(),w(window).on("beforeunload",function(t){return v.messaging.disconnect()}));var o="conversations"===v.settings.UISection,c="timeline"===v.settings.UISection,u=!1===v.settings.disableTimeline&&!c,l=!1===v.settings.disableConversations&&!o,d=v.width()-v.settings.scrollbarWidth,m="recent"===v.settings.activitySortView,p="likes"===v.settings.activitySortView,f="flagged"===v.settings.activitySortView,o={username:v.settings.username,literals:v.settings.literals,showMaxUIClass:o?"maxui-container-chat":"maxui-container-activity",showConversations:o?"display:block;":"display:none;",showConversationsToggle:l?"display:block;":"display:none;",showTimeline:c?"display:block;":"display:none;",showTimelineToggle:u?"display:block;":"display:none;",orderViewRecent:m?"active":"",orderViewLikes:p?"active":"",orderViewFlagged:f?"active":"",messagesStyle:"width:{0}px;left:{0}px;".format(d),hidePostbox:v.hidePostboxActivity()},l=v.templates.mainUIActivity.render(o);v.html(l),v.overlay=new max.views.MaxOverlay(v),v.settings.widgetWidth=v.width(),v.settings.sectionsWidth=v.settings.widgetWidth-v.settings.scrollbarWidth-v.settings.widgetBorder,v.settings.disableConversations||(v.conversations.render(),v.conversations.listview.load(t.talkingIn)),"conversations"===v.settings.UISection?(v.bindEventsActivity(),v.toggleSectionActivity("conversations"),v.renderPostboxActivity(),c=v.settings.literals.new_conversation_text,w("#maxuiactivity-widget-container #maxui-newactivity-box textarea").val(c).attr("data-literal",c)):"timeline"===v.settings.UISection&&(u={recent:v.settings.activitySortOrder,likes:"likes",flagged:"flagged"},v.printActivitiesActivity({sortBy:u[v.settings.activitySortView]},function(t){v.bindEventsActivity()}))}),v},w.fn.bindEventsActivity=function(){var d=this,t=(w("#maxuiactivity-widget-container #maxui-more-activities .maxui-button").click(function(t){t.preventDefault(),d.loadMoreActivities()}),w("#maxuiactivity-widget-container #maxui-news-activities .maxui-button").click(function(t){d.loadNewsActivitiesActivity()}),w("#maxuiactivity-widget-container #maxui-search-toggle").click(function(t){t.preventDefault(),w(this).hasClass("maxui-disabled")||(w("#maxuiactivity-widget-container #maxui-search").toggleClass("folded"),w("#maxuiactivity-widget-container #maxui-search").hasClass("folded")?d.printActivitiesActivity({}):d.reloadFiltersActivity())}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-commentaction",function(t){t.preventDefault(),window.status="",w(this).closest(".maxui-activity").find(".maxui-comments").toggle(200)}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-filter-actor",function(t){t.preventDefault();t=w(this).parent().find(".maxui-username").text();d.addFilterActivity({type:"actor",value:t}),w("#maxuiactivity-widget-container #maxui-search").toggleClass("folded",!1)}),w("#maxuiactivity-widget-container #maxui-search").on("click","#maxui-favorites-filter",function(t){t.preventDefault();var t=w(t.currentTarget),e=!t.hasClass("active"),i="",n="",n=e?(d.addFilterActivity({type:"favorites",value:!0,visible:!1}),i=d.settings.literals.valued_favorited_activity,d.settings.literals.recent_favorited_activity):(d.delFilterActivity({type:"favorites",value:!0}),i=d.settings.literals.valued_activity,d.settings.literals.recent_activity);t.toggleClass("active",e),w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-most-recent").text(n),w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-most-valued").text(i)}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-hashtag",function(t){t.preventDefault(),d.addFilterActivity({type:"hashtag",value:w(this).attr("value")}),w("#maxuiactivity-widget-container #maxui-search").toggleClass("folded",!1)}),w("#maxuiactivity-widget-container #maxui-subscriptions").on("change",function(){var t=w("#maxuiactivity-widget-container #maxui-subscriptions :selected").val();if("timeline"!==t){d.settings.writeContexts=[],d.settings.writeContextsHashes=[],d.settings.writeContexts.push(t);for(var e=0;e<d.settings.writeContexts.length;e++)d.settings.writeContextsHashes.push(d.utils.sha1(d.settings.writeContexts[e]))}else d.settings.writeContexts=[],d.settings.writeContextsHashes=void 0}),w("#maxuiactivity-widget-container #maxui-search-filters").on("click",".maxui-close",function(t){t.preventDefault();t=w(this.parentNode.parentNode);d.delFilterActivity({type:t.attr("type"),value:t.attr("value")})}),w("#maxuiactivity-widget-container #maxui-new-participants").on("click",".maxui-close",function(t){t.preventDefault();t=w(this.parentNode.parentNode);d.delPersonActivity({username:t.attr("username")})}),w("#maxuiactivity-widget-container #maxui-new-displayName").on("keyup","input",function(t){t.preventDefault(),d.reloadPersonsActivity()}),w("#maxuiactivity-widget-container #maxui-newactivity").on("click",".maxui-prediction",function(t){t.preventDefault();var t=w(this),e=w("#maxuiactivity-widget-container #maxui-newactivity-box textarea"),i=w("#maxuiactivity-widget-container #maxui-newactivity #maxui-predictive"),n=e.val(),a=new RegExp("^\\s*@([\\w\\.]+)"),n=n.replace(a,"@"+t.text()+" ");i.hide(),e.val(n),e.focus()}),w(document).on("click",function(t){w(".maxui-predictive").hide()}),w("#maxuiactivity-widget-container #maxui-conversation-predictive").on("click",".maxui-prediction",function(t){t.preventDefault();var t=w(this),e=w("#maxuiactivity-widget-container #maxui-add-people-box .maxui-text-input"),i=w("#maxuiactivity-widget-container #maxui-conversation-predictive"),n=t.attr("data-username"),t=t.attr("data-displayname");d.addPersonActivity({username:n,displayName:t}),i.hide(),e.val("").focus()}),w("#maxuiactivity-widget-container #maxui-show-conversations").on("click",function(t){t.preventDefault(),window.status="",d.toggleSectionActivity("conversations")}),w("#maxuiactivity-widget-container #maxui-show-timeline").on("click",function(t){t.preventDefault(),window.status="",d.printActivitiesActivity({},function(t){d.toggleSectionActivity("timeline")})}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-action.maxui-favorites",function(t){t.preventDefault();var e=w(this),t=w(this).closest(".maxui-activity").attr("id");e.hasClass("maxui-favorited")?d.maxClient.unfavoriteActivity(t,function(t){e.toggleClass("maxui-favorited",!1)}):d.maxClient.favoriteActivity(t,function(t){e.toggleClass("maxui-favorited",!0)})}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-action.maxui-likes",function(t){t.preventDefault();var e=w(this),t=w(this).closest(".maxui-activity").attr("id"),i=e.hasClass("maxui-liked"),n=e.children("strong"),a=[];e.attr("title")&&""!==e.attr("title")&&(a=e.attr("title").split("\n")),i?(d.maxClient.unlikeActivity(t,function(t){e.toggleClass("maxui-liked",!1)}),n.text(parseInt(n.text(),10)-1),a=w.grep(a,function(t){return t!==d.settings.username})):(d.maxClient.likeActivity(t,function(t){e.toggleClass("maxui-liked",!0)}),n.text(parseInt(n.text(),10)+1),a.push(d.settings.username)),d.settings.showLikes&&e.attr("title",a.join("\n"))}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-action.maxui-flag",function(t){t.preventDefault();var e=w(this),i=w(this).closest(".maxui-activity"),t=i.attr("id");e.hasClass("maxui-flagged")?d.maxClient.unflagActivity(t,function(t){e.toggleClass("maxui-flagged",!1),i.toggleClass("maxui-flagged",!1),d.printActivitiesActivity({})}):d.maxClient.flagActivity(t,function(t){e.toggleClass("maxui-flagged",!0),i.toggleClass("maxui-flagged",!1),d.printActivitiesActivity({})})}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-action.maxui-delete",function(t){t.preventDefault();t=w(this).closest(".maxui-activity").find(".maxui-actions > .maxui-popover");t.is(":visible")?(t.animate({opacity:0},300),w(".maxui-popover").css({opacity:0}).hide()):(w(".maxui-popover").css({opacity:0}).hide(),t.show(),t.animate({opacity:1},300))}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-actions .maxui-button-cancel",function(t){t.preventDefault(),w(".maxui-popover:visible").css({opacity:0}).hide()}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-actions .maxui-button-delete",function(t){t.preventDefault();var i=w(this).closest(".maxui-activity"),t=i.attr("id");d.maxClient.removeActivity(t,function(t){var e=w(".maxui-popover:visible").animate({opacity:0},300);i.css({height:i.height(),"min-height":"auto"}),i.animate({height:0,opacity:0},100,function(t){i.remove(),e.hide()})})}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-delete-comment",function(t){t.preventDefault();t=w(this).closest(".maxui-comment").find(".maxui-popover");t.is(":visible")?(t.animate({opacity:0},300),w(".maxui-popover").css({opacity:0}).hide()):(w(".maxui-popover").css({opacity:0}).hide(),t.show(),t.animate({opacity:1},300))}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-comment .maxui-button-cancel",function(t){t.preventDefault(),w(".maxui-popover").css({opacity:0}).hide()}),w("#maxuiactivity-widget-container #maxui-activities").on("click",".maxui-comment .maxui-button-delete",function(t){t.preventDefault();var i=w(this).closest(".maxui-comment"),n=i.closest(".maxui-activity"),t=n.attr("id"),e=i.attr("id");d.maxClient.removeActivityComment(t,e,function(){var e=w(".maxui-popover").animate({opacity:0},300);i.css({height:n.height(),"min-height":"auto"}),i.animate({height:0,opacity:0},100,function(t){i.remove(),e.hide()})})}),w("#maxuiactivity-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-recent",function(t){t.preventDefault();t=w(this);t.hasClass("active")||(w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),t.toggleClass("active",!0),d.printActivitiesActivity({}))}),w("#maxuiactivity-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-valued",function(t){t.preventDefault();t=w(this);t.hasClass("active")||(w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),t.toggleClass("active",!0),d.printActivitiesActivity({sortBy:"likes"}))}),w("#maxuiactivity-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-flagged",function(t){t.preventDefault();t=w(this);t.hasClass("active")||(w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),t.toggleClass("active",!0),d.printActivitiesActivity({sortBy:"flagged"}))}),".maxui-text-input");w("#maxuiactivity-widget-container #maxui-add-people-box").on("focusin",t,function(t){t.preventDefault();var t=w(this).val(),e=w(this).attr("data-literal");d.utils.normalizeWhiteSpace(t,!1)===e&&w(this).val("")}).on("keydown",t,function(t){0<w("#maxuiactivity-widget-container #maxui-conversation-predictive:visible").length&&(40===t.which||38===t.which||13===t.which||9===t.which)&&d.utils.freezeEvent(t)}).on("keyup",t,function(t){t.preventDefault(),t.stopPropagation();var e,i=w(this).val(),t=(""===d.utils.normalizeWhiteSpace(i,!1)?(w(this).attr("class","maxui-empty maxui-text-input"),w(this).removeAttr("title")):d.settings.canwrite&&w(this).attr("class","maxui-text-input"),t.which),n=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*"),n=i.match(n),a=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*$"),a=i.match(a),s=w("#maxuiactivity-widget-container #maxui-conversation-predictive .maxui-prediction.selected"),r=w(this),o=w("#maxuiactivity-widget-container #maxui-conversation-predictive"),c=o.find(".maxui-prediction").length,u=0<w("#maxuiactivity-widget-container #maxui-conversation-predictive:visible").length;40===t&&u&&1<c?(e=s.next(),s.removeClass("selected"),(0<e.length?e:s.siblings(":first")).addClass("selected")):38===t&&u&&1<c?(e=s.prev(),s.removeClass("selected"),(0<e.length?e:s.siblings(":last")).addClass("selected")):27===t?o.hide():13!==t&&9!==t||!u?"conversations"===d.settings.conversationsSection&&(n?(r.attr("class","maxui-text-input"),a&&(o.show(),o.html("<ul></ul>"),d.printPredictionsActivity(n[1],"#maxui-conversation-predictive"))):(o.hide(),r.attr("class","maxui-empty maxui-text-input"),i.match(new RegExp("^\\s*@"))||(r.attr("class","maxui-text-input error"),r.attr("title",d.settings.literals.post_permission_not_here)))):(c=s.attr("data-username"),e=s.attr("data-displayname"),d.addPersonActivity({username:c,displayName:e}),o.hide(),r.val("").focus())}).on("focusout",t,function(t){t.preventDefault();var t=w(this).val(),e=w(this).attr("data-literal");""===d.utils.normalizeWhiteSpace(t,!1)&&w(this).val(e)}),d.bindActionBehaviourActivity("#maxui-newactivity","#maxui-newactivity-box",{},function(t,e){if("timeline"===d.settings.UISection)d.sendActivityActivity(t,e),w("#maxuiactivity-widget-container #maxui-search").toggleClass("folded",!0);else if("conversations"===d.settings.UISection)if("conversations"===d.settings.conversationsSection){for(var i=w("#maxuiactivity-widget-container #maxui-new-participants")[0],n=[],a=0;a<i.people.length;a++)n.push(i.people[a].username);var s,e={participants:n,message:w("#maxuiactivity-widget-container #maxui-newactivity textarea").val()};1<n.length&&(s=w("#maxuiactivity-widget-container #maxui-add-people-box #maxui-new-displayName input").val(),e.displayName=s),d.conversations.create(e)}else d.conversations.send(t)},function(t,e,i,n){var a,n=n.which,s=new RegExp("^\\s*@([\\w\\.]+)\\s*"),s=t.match(s),r=new RegExp("^\\s*@([\\w\\.]+)\\s*$"),r=t.match(r),o=w("#maxuiactivity-widget-container #maxui-newactivity .maxui-prediction.selected"),e=w(e),c=w("#maxuiactivity-widget-container #maxui-newactivity #maxui-predictive"),u=c.find(".maxui-prediction").length,l=0<w("#maxuiactivity-widget-container #maxui-newactivity #maxui-predictive:visible").length;40===n&&l&&1<u?(a=o.next(),o.removeClass("selected"),(0<a.length?a:o.siblings(":first")).addClass("selected")):38===n&&l&&1<u?(a=o.prev(),o.removeClass("selected"),(0<a.length?a:o.siblings(":last")).addClass("selected")):27===n?c.hide():13!==n&&9!==n||!l?""===t?"timeline"===d.settings.UISection&&w(i).val(d.settings.literals.new_activity_post):"timeline"===d.settings.UISection?s?(w(i).val(d.settings.literals.new_message_post),r&&(c.show(),c.html("<ul></ul>"),d.printPredictionsActivity(s[1],"#maxui-newactivity #maxui-predictive")),w(i).removeAttr("disabled"),w(i).attr("class","maxui-button"),e.attr("class","maxui-text-input")):(w(i).val(d.settings.literals.new_activity_post),c.hide(),t.match(new RegExp("^\\s*@"))||d.settings.canwrite||(e.attr("class","maxui-text-input error"),e.attr("title",d.settings.literals.post_permission_unauthorized))):"conversations"===d.settings.UISection&&("conversations"===d.settings.conversationsSection?d.reloadPersonsActivity():"messages"===d.settings.conversationsSection&&(c.hide(),w(i).removeAttr("disabled"),w(i).attr("class","maxui-button"),e.attr("class","maxui-text-input"))):(u=new RegExp("^\\s*@([\\w\\.]+)"),a=t.replace(u,"@"+o.text()+" "),c.hide(),e.val(a).focus())}),d.bindActionBehaviourActivity("#maxuiactivity-widget-container #maxui-activities",".maxui-newcommentbox",{},function(t){var e=w(this).closest(".maxui-activity").attr("id");d.maxClient.addComment(t,e,function(){w("#maxuiactivity-widget-container #activityContainer textarea").val("");var t=this.object.inReplyTo[0].id;d.printCommentsForActivityActivity(t),w("#maxuiactivity-widget-container #"+t+" .maxui-newcommentbox textarea").val(""),w("#maxuiactivity-widget-container #"+t+" .maxui-newcommentbox .maxui-button").attr("disabled","disabled")})}),d.bindActionBehaviourActivity("#maxuiactivity-widget-container #maxui-search","#maxui-search-box",{},function(t){d.textSearchActivity(t),w("#maxuiactivity-widget-container #maxui-search").toggleClass("folded",!1),w("#maxuiactivity-widget-container #maxui-search-text").val("")})},w.fn.bindActionBehaviourActivity=function(n,t,a,s){var r=this,e=t+" .maxui-text-input",o=4<arguments.length?arguments[4]:null;w(n).on("focusin",e,function(t){t.preventDefault();var t=w(this).val(),e=w(this).attr("data-literal");r.utils.normalizeWhiteSpace(t,!1)===e&&w(this).val("")}).on("keydown",e,function(t){var e,i;0<w(n+" #maxui-predictive:visible").length&&(40===t.which||38===t.which||13===t.which||9===t.which)?r.utils.freezeEvent(t):13!==t.which||!1!==t.shiftKey||a.ignore_button||w(this).is("textarea")||(t.preventDefault(),e=(t=w(this).parent().find(".maxui-text-input")).attr("data-literal"),t=t.val(),(i=r.utils.normalizeWhiteSpace(t,!1))!==e&""!==i&&s.apply(this,[t]))}).on("keyup",e,function(t){t.preventDefault(),t.stopPropagation();var e=w(this).val(),i=w(this).parent().parent().find(".maxui-button");""!==r.utils.normalizeWhiteSpace(e,!1)||a.ignore_button?r.settings.canwrite&&!a.ignore_button&&(w(i).removeAttr("disabled"),w(i).attr("class","maxui-button"),w(this).attr("class","maxui-text-input")):(w(i).attr("disabled","disabled"),w(i).attr("class","maxui-button maxui-disabled"),w(this).attr("class","maxui-empty maxui-text-input"),w(this).removeAttr("title")),null!==o&&o(e,this,i,t)}).on("paste",e,function(t){var e=w(this).parent().parent().find(".maxui-button"),i=(r.settings.canwrite&&!a.ignore_button&&(w(e).removeAttr("disabled"),w(e).attr("class","maxui-button"),w(this).attr("class","maxui-text-input")),w(this).val());null!==o&&o(i,this,e,t)}).on("focusout",e,function(t){t.preventDefault();var t=w(this).val(),e=w(this).attr("data-literal");""===r.utils.normalizeWhiteSpace(t,!1)&&w(this).val(e)}).on("click",t+" .maxui-button",function(t){t.preventDefault(),t=void 0;var e=document.getElementById("maxui-file").files[0],e=(void 0!==e?t=e:void 0!==(e=document.getElementById("maxui-img").files[0])&&(t=e),w(this).parent().find(".maxui-text-input")),i=e.attr("data-literal"),e=e.val(),n=r.utils.normalizeWhiteSpace(e,!1);(n!==i&""!==n||a.empty_click||t)&&(s.apply(this,[e,t]),w("#maxui-file").value="",w("#maxui-img").value="",w("#maxui-newactivity-box > .upload-img").removeClass("label-disabled"),w("#maxui-img").prop("disabled",!1),w("#maxui-newactivity-box > .upload-file").removeClass("label-disabled"),w("#maxui-file").prop("disabled",!1))})},w.fn.textSearchActivity=function(t){for(var e=this.utils.normalizeWhiteSpace(t).split(" "),i=0;i<e.length;i++){var n="keyword",a=e[i];switch(a[0]){case"#":n="hashtag",a=a.substr(1);break;case"@":n="actor",a=a.substr(1);break;default:n="keyword"}3<=a.length&&this.addFilterActivity({type:n,value:a},!1)}this.reloadFiltersActivity()},w.fn.getFiltersActivity=function(){for(var t={filters:this.filters},e=(void 0===t.filters&&(t.filters=[]),{}),i=!1,n=0;n<t.filters.length;n++){var a=t.filters[n];a.visible&&(i=!0),e[a.type]||(e[a.type]=[]),e[a.type].push(a.value)}return 0<arguments.length&&(e.before=arguments[0]),{filters:e,visible:i}},w.fn.reloadFiltersActivity=function(){var t=this,e={filters:t.filters},e=t.templates.filters.render(e);w("#maxuiactivity-widget-container #maxui-search-filters").html(e),e=0<arguments.length?t.getFiltersActivity(arguments[0]):t.getFiltersActivity(),t.printActivitiesActivity({}),w("#maxuiactivity-widget-container #maxui-search").toggleClass("folded",!e.visible)},w.fn.delFilterActivity=function(t){for(var e=!1,i=0;i<this.filters.length;i++)this.filters[i].value===t.value&this.filters[i].type===t.type&&(e=!0,this.filters.splice(i,1));e&&this.reloadFiltersActivity()},w.fn.addFilterActivity=function(t){var e=this,i=1<arguments.length?arguments[1]:!0;switch(e.filters||(e.filters=[]),t.hasOwnProperty("visible")||(t.visible=!0),t.type){case"hashtag":t.prepend="#";break;case"actor":t.prepend="@";break;default:t.prepend=""}for(var n=!1,a=0;a<e.filters.length;a++)e.filters[a].value===t.value&e.filters[a].type===t.type&&(n=!0);n||(e.filters.push(t),!0===i&&this.reloadFiltersActivity())},w.fn.reloadPersonsActivity=function(){var t=this,e=w("#maxuiactivity-widget-container #maxui-new-participants"),i=e[0],n=(i.people||(i.people=[]),w("#maxuiactivity-widget-container #maxui-newactivity input.maxui-button")),a=w("#maxuiactivity-widget-container #maxui-newactivity"),s=a.find("textarea").val(),r=a.find("textarea").attr("data-literal"),s=t.utils.normalizeWhiteSpace(s),o=w("#maxuiactivity-widget-container #maxui-add-people-box #maxui-new-displayName"),c=o.find("input").val(),c=t.utils.normalizeWhiteSpace(c),u={persons:i.people},u=t.templates.participants.render(u);w("#maxuiactivity-widget-container #maxui-new-participants").html(u),w("#maxuiactivity-widget-container #maxui-add-people-box .maxui-label .maxui-count").text("({0}/{1})".format(i.people.length+1,t.settings.maximumConversations)),0<i.people.length?(1<i.people.length&&!(""!==c)?(n.attr("disabled","disabled"),n.attr("class","maxui-button maxui-disabled"),""===c&&(a.find("textarea").attr("class","maxui-text-input error"),a.find(".maxui-error-box").text(t.settings.literals.post_permission_missing_displayName),a.find(".maxui-error-box").width(a.find("textarea").width()-4),a.find(".maxui-error-box").animate({bottom:-25},200))):(n.removeAttr("disabled"),n.attr("class","maxui-button"),a.find("textarea").attr("class","maxui-text-input"),a.find(".maxui-error-box").width(a.find("textarea").width()-4),a.find(".maxui-error-box").animate({bottom:0},200)),e.show(),a.show(),1<i.people.length?o.show():(o.hide(),o.find(".maxui-text-input").val(""))):""!==s&&s!==r&&(n.attr("disabled","disabled"),n.attr("class","maxui-button maxui-disabled"),e.hide(),a.find("textarea").attr("class","maxui-text-input error"),a.find(".maxui-error-box").text(t.settings.literals.post_permission_not_enough_participants),a.find(".maxui-error-box").width(a.find("textarea").width()-4),a.find(".maxui-error-box").animate({bottom:-25},200),o.hide(),o.find(".maxui-text-input").val(""))},w.fn.delPersonActivity=function(t){for(var e=!1,i=w("#maxuiactivity-widget-container #maxui-new-participants")[0],n=0;n<i.people.length;n++)i.people[n].username===t.username&&(e=!0,i.people.splice(n,1));e&&this.reloadPersonsActivity()},w.fn.addPersonActivity=function(t){var e=w("#maxuiactivity-widget-container #maxui-new-participants")[0],i=!0,n=(1<arguments.length&&(i=arguments[1]),!1);if(e.people||(e.people=[]),t.username!==this.settings.username&&e.people.length<this.settings.maximumConversations-1){for(var a=0;a<e.people.length;a++)e.people[a].username===t.username&&(n=!0);n||(e.people.push(t),!0===i&&this.reloadPersonsActivity())}},w.fn.toggleSectionActivity=function(t){var e,i=this,n=w("#maxuiactivity-widget-container #maxui-search"),a=w("#maxuiactivity-widget-container #maxui-activity-sort"),s=w("#maxuiactivity-widget-container #maxui-timeline"),r=w("#maxuiactivity-widget-container #maxui-timeline .maxui-wrapper"),o=w("#maxuiactivity-widget-container #maxui-conversations"),c=w("#maxuiactivity-widget-container #maxui-common-header"),u=o.find("input#add-user-input"),l=w("#maxuiactivity-widget-container #maxui-conversations #maxui-conversations-list"),d=w("#maxuiactivity-widget-container #maxui-conversations .maxui-wrapper"),m=w("#maxuiactivity-widget-container #maxui-newactivity-box .maxui-button"),p=w("#maxuiactivity-widget-container #maxui-newactivity-box #maxui-subscriptions"),f=w("#maxuiactivity-widget-container #maxui-newactivity"),v=w("#maxuiactivity-widget-container #maxui-newactivity-box textarea"),h=w("#maxuiactivity-widget-container #maxui-show-conversations"),g=w("#maxuiactivity-widget-container #maxui-show-timeline"),x=w("#maxuiactivity-widget-container #maxui-add-people-box"),y=i.width()-i.conversations.scrollbar.width-20-2;"conversations"===t&&"conversations"===i.settings.currentConversationSection&&(p.attr("style","display:none;"),o.show(),c.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),x.show(),u.focus(),o.animate({height:320},400,function(t){d.height(320)}),l.width(y),s.animate({height:0},400),n.hide(400),a.hide(400),i.settings.UISection="conversations",m.val(i.settings.literals.new_message_post),e=i.settings.literals.new_conversation_text,v.val(e).attr("data-literal",e),h.hide(),i.settings.disableTimeline||g.show(),i.conversations.scrollbar.setHeight(245),i.conversations.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),f.show()),"timeline"===t&&(!0===i.settings.showSubscriptionList&&p.attr("style","display:inline;"),i.conversations.listview.toggle(),s.show(),c=r.height(),s.animate({height:c},400,function(t){s.css("height","")}),o.animate({height:0},400,function(t){o.hide(),x.hide()}),n.show(400),a.show(400),i.settings.UISection="timeline",m.val(i.settings.literals.new_activity_post),e=i.settings.literals.new_activity_text,v.val(e).attr("data-literal",e),i.settings.disableConversations||h.show(),g.hide(),i.settings.hidePostboxOnTimeline&&f.hide(),i.hidePostboxActivity()&&f.hide())},w.fn.Settings=function(){return this.settings},w.fn.sendActivityActivity=function(t,e){var i=this,n=(t=w("#maxuiactivity-widget-container #maxui-newactivity textarea").val(),[]);w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-recent").toggleClass("active",!0),n.push(t),n.push(i.settings.writeContexts),n.push(function(){w("#maxuiactivity-widget-container #maxui-newactivity textarea").val(""),w("#maxuiactivity-widget-container #maxui-newactivity .maxui-button").attr("disabled","disabled");var t=w(".maxui-activity:first");0<t.length?(t={after:t.attr("id")},i.printActivitiesActivity(t)):i.printActivitiesActivity({})}),i.settings.generatorName&&n.push(i.settings.generatorName),e&&n.push(e),i.maxClient.addActivity.apply(i.maxClient,n),document.getElementById("preview").style.display="none",w("#maxui-subscriptions option:first-child").attr("selected","selected")},w.fn.loadMoreActivitiesActivity=function(){var t=w(".maxui-activity:last").attr("id"),t={before:t=w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-recent").hasClass("active")&&0<w("#"+t+" .maxui-comment").length?w("#"+t+" .maxui-comment:last").attr("id"):t};this.printActivitiesActivity(t)},w.fn.loadNewsActivitiesActivity=function(){this.printActivitiesActivity()},w.fn.printPredictionsActivity=function(t,e){var i=this,n=[];n.push(t),n.push(function(t){i.formatPredictionsActivity(t,e)}),this.maxClient.getUsersList.apply(this.maxClient,n)},w.fn.formatPredictionsActivity=function(t,e){for(var i="",n=0;n<t.length;n++){var a,s=t[n];s.username!==this.username&&(a=this.settings.avatarURLpattern.format(s.username),s={username:s.username,displayName:s.displayName,avatarURL:a,cssclass:"maxui-prediction"+(0===n?" selected":"")},i+=this.templates.predictive.render(s))}""===i&&(i="<li>"+this.settings.literals.no_match_found+"</li>"),w(e+" ul").html(i),2<arguments.length&&(0,arguments[2])()},w.fn.canCommentActivityActivity=function(t){for(var e in this.settings.subscriptionsWrite)if(this.settings.subscriptionsWrite[e].hash===t)return!0;return!1},w.fn.formatActivitiesActivity=function(t,e){for(var n=this,i="",a=[],s=0;s<t.length;s++){var r=t[s],o=null,c=(r.hasOwnProperty("contexts")&&0<r.contexts.length&&(o=r.contexts[0]),null),u=(r.hasOwnProperty("generator")&&r.generator!==n.settings.generatorName&&(c=r.generator),""),l=("person"===r.actor.objectType?u=n.settings.avatarURLpattern.format(r.actor.username):"context"===r.actor.objectType&&(u=n.settings.contextAvatarURLpattern.format(r.actor.hash)),[]),d="";if(r.replies&&0<r.replies.length){for(var m=0;m<r.replies.length;m++){var p=r.replies[m],p={id:p.id,actor:p.actor,date:n.utils.formatDate(p.published,n.language),text:n.utils.formatText(p.content),avatarURL:n.settings.avatarURLpattern.format(p.actor.username),canDeleteComment:p.deletable,literals:n.settings.literals};l.push(p)}d="Comentat "+l[l.length-1].date}_.defaults(r.object,{filename:r.id});var f,v=n.settings.canwrite,h=(r.contexts&&(v=n.canCommentActivityActivity(r.contexts[0].url)),[]);for(f in r.likes)h.push(r.likes[f].username);d={id:r.id,actor:r.actor,auth:{token:n.settings.oAuthToken,username:n.settings.username},literals:n.settings.literals,date:n.utils.formatDate(r.published,n.language),dateLastComment:d,text:n.utils.formatText(r.object.content),replies:l,favorited:r.favorited,likes:r.likesCount||0,showLikesCount:"likes"===n.currentSortOrder,showLikes:n.settings.showLikes,liked:r.liked,likesUsernames:h.join("\n"),flagged:r.flagged,avatarURL:u,maxServerURL:n.settings.maxServerURL,publishedIn:o,canDeleteActivity:r.deletable,canFlagActivity:n.settings.canflag,via:c,fileDownload:"file"===r.object.objectType,filename:r.object.filename,canViewComments:v||0<r.replies.length,canWriteComment:v},u={comment:n.templates.comment};i+=n.templates.activity.render(d,u),"image"===r.object.objectType&&a.push(r)}if("beggining"===e){w("#maxuiactivity-widget-container #maxui-preload .maxui-wrapper").prepend(i);for(var g=w("#maxuiactivity-widget-container #maxui-preload .maxui-wrapper .maxui-activity"),x=0,s=0;s<g.length;s++)x+=w(g[s]).height()+18;var y=w("#maxuiactivity-widget-container #maxui-preload").height();w("#maxuiactivity-widget-container #maxui-preload").height(x-y),w("#maxuiactivity-widget-container #maxui-preload").css({"margin-top":-1*(x-y)}),w("#maxuiactivity-widget-container #maxui-preload").animate({"margin-top":0},200,function(){w("#maxuiactivity-widget-container #maxui-preload .maxui-wrapper").html(""),w("#maxuiactivity-widget-container #maxui-activities").prepend(i),w("#maxuiactivity-widget-container #maxui-preload").height(0)})}else"end"===e?w("#maxuiactivity-widget-container #maxui-activities").append(i):w("#maxuiactivity-widget-container #maxui-activities").html(i);2<arguments.length&&arguments[2].call(),_.each(a,function(e,t,i){n.maxClient.getMessageImage("/activities/{0}/image/thumb".format(e.id),function(t){t='<img class="maxui-embedded fullImage" alt="" src="data:image/png;base64,{0}" />'.format(t);w(".maxui-activity#{0} .maxui-activity-message .maxui-body".format(e.id)).after(t),w(".maxui-activity#{0} .maxui-activity-message img.fullImage".format(e.id)).on("click",function(){n.maxClient.getMessageImage(e.object.fullURL,function(t){var e=new Image;e.src="data:image/png;base64,"+t,window.open("").document.write(e.outerHTML)})})})})},w.fn.formatCommentActivity=function(t,e){for(var i=this,n="",a=0;a<t.length;a++){var s=t[a],s={literals:i.settings.literals,id:s.id,actor:s.actor,date:i.utils.formatDate(s.published,i.language),text:i.utils.formatText(s.content),avatarURL:i.settings.avatarURLpattern.format(s.actor.username),canDeleteComment:s.deletable};n+=i.templates.comment.render(s)}w(".maxui-activity#"+e+" .maxui-commentsbox").html(n);e=w(".maxui-activity#"+e+" .maxui-commentaction strong");w(e).text(parseInt(w(e).text(),10)+1)},w.fn.renderPostboxActivity=function(){var t=this,e="conversations"===t.settings.UISection,e=!1===t.settings.disableConversations&&!e,e={avatar:t.settings.avatarURLpattern.format(t.settings.username),allowPosting:t.settings.canwrite,imgLiteral:t.settings.literals.new_img_post,fileLiteral:t.settings.literals.new_file_post,buttonLiteral:t.settings.literals.new_activity_post,textLiteral:t.settings.literals.new_activity_text,literals:t.settings.literals,showConversationsToggle:e?"display:block;":"display:none;",showSubscriptionList:t.settings.showSubscriptionList&&0<t.settings.subscriptionsWrite.length,subscriptionList:t.settings.subscriptionsWrite},t=t.templates.postBox.render(e);w("#maxuiactivity-widget-container #maxui-newactivity").html(t)},w.fn.printActivitiesActivity=function(t){var e,s,r=this,i=[],o="replace",n=r.getFiltersActivity().filters,a=(w.extend(n,t),n.before&&(o="end"),n.after&&(o="beggining"),n.sortBy||(w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-valued").hasClass("active")?n.sortBy="likes":w("#maxuiactivity-widget-container #maxui-activity-sort .maxui-sort-action.maxui-flagged").hasClass("active")?n.sortBy="flagged":n.sortBy=r.settings.activitySortOrder),r.currentSortOrder=n.sortBy,null);"timeline"===r.settings.activitySource?(a=this.maxClient.getUserTimeline,i.push(r.settings.username)):"activities"===r.settings.activitySource&&(a=this.maxClient.getActivities,e={context:r.settings.readContextHash,tags:r.settings.contextTagsFilter},i.push(e)),1<arguments.length?(s=arguments[1],i.push(function(a){void 0===window._MAXUI||null===window._MAXUI?r.settings.showLikes=!0:r.settings.showLikes=window._MAXUI.showLikes,r.settings.canwrite=!0,"activities"===r.settings.activitySource?r.maxClient.getContext(r.settings.readContextHash,function(t){var e=r.settings.subscriptions;e[t.hash]||(e[t.hash]={},e[t.hash].permissions={},e[t.hash].permissions.read="public"===t.permissions.read,e[t.hash].permissions.write="public"===t.permissions.write);for(var i=0;i<r.settings.writeContexts.length;i++){var n=r.settings.writeContextsHashes[i];e[n].permissions?(!0!==e[n].permissions.write&&(r.settings.canwrite=!1),!0===e[n].permissions.flag?r.settings.canflag=!0:r.settings.canflag=!1):(r.settings.canwrite=!1,r.settings.canflag=!1)}r.renderPostboxActivity(),r.formatActivitiesActivity(a,o,s)}):(r.renderPostboxActivity(a,o,s),r.formatActivitiesActivity(a,o,s))})):i.push(function(t){r.formatActivitiesActivity(t,o)}),i.push(n),a.apply(this.maxClient,i)},w.fn.printCommentsForActivityActivity=function(e){var i=this,t=[];t.push(e),t.push(function(t){i.formatCommentActivity(t,e)}),this.maxClient.getCommentsForActivity.apply(this.maxClient,t)},w.maxui=function(){},w.maxui.settings=function(){return this.settings}}(jQuery),window.setTimeout(function(){window._MAXUI_Activity&&window._MAXUI_Activity.onReady&&!window._MAXUI_Activity.hasRun&&(window._MAXUI_Activity.hasRun=!0,_MAXUI_Activity.onReady())},0);
//# sourceMappingURL=maxuiactivity.min.js.map
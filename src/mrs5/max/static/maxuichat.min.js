/*! max.ui5.js - v5.0.2 - 2018-02-08 */
var Hogan={},uuid;!function(t,e){t.Template=function(t,e,i,n){this.r=t||this.r,this.c=i,this.options=n,this.text=e||"",this.buf=""},t.Template.prototype={r:function(t,e,i){return""},v:function(t){return t=c(t),r.test(t)?t.replace(i,"&amp;").replace(n,"&lt;").replace(a,"&gt;").replace(s,"&#39;").replace(o,"&quot;"):t},t:c,render:function(t,e,i){return this.ri([t],e||{},i)},ri:function(t,e,i){return this.r(t,e,i)},rp:function(t,e,i,n){var a=i[t];return a?(this.c&&"string"==typeof a&&(a=this.c.compile(a,this.options)),a.ri(e,i,n)):""},rs:function(t,e,i){var n=t[t.length-1];if(u(n))for(var a=0;a<n.length;a++)t.push(n[a]),i(t,e,this),t.pop();else i(t,e,this)},s:function(t,e,i,n,a,s,o){var r;return(!u(t)||0!==t.length)&&("function"==typeof t&&(t=this.ls(t,e,i,n,a,s,o)),r=""===t||!!t,!n&&r&&e&&e.push("object"==typeof t?t:e[e.length-1]),r)},d:function(t,e,i,n){var a=t.split("."),s=this.f(a[0],e,i,n),o=null;if("."===t&&u(e[e.length-2]))return e[e.length-1];for(var r=1;r<a.length;r++)s&&"object"==typeof s&&a[r]in s?(o=s,s=s[a[r]]):s="";return!(n&&!s)&&(n||"function"!=typeof s||(e.push(o),s=this.lv(s,e,i),e.pop()),s)},f:function(t,e,i,n){for(var a=!1,s=null,o=!1,r=e.length-1;r>=0;r--)if((s=e[r])&&"object"==typeof s&&t in s){a=s[t],o=!0;break}return o?(n||"function"!=typeof a||(a=this.lv(a,e,i)),a):!n&&""},ho:function(t,e,i,n,a){var s=this.c,o=this.options;return o.delimiters=a,n=null==(n=t.call(e,n))?String(n):n.toString(),this.b(s.compile(n,o).render(e,i)),!1},b:function(t){this.buf+=t},fl:function(){var t=this.buf;return this.buf="",t},ls:function(t,e,i,n,a,s,o){var r,c=e[e.length-1];if(!n&&this.c&&t.length>0)return this.ho(t,c,i,this.text.substring(a,s),o);if("function"==typeof(r=t.call(c))){if(n)return!0;if(this.c)return this.ho(r,c,i,this.text.substring(a,s),o)}return r},lv:function(t,e,i){var n=e[e.length-1],a=t.call(n);return"function"==typeof a&&(a=c(a.call(n)),this.c&&~a.indexOf("{{"))?this.c.compile(a,this.options).render(n,i):c(a)}};var i=/&/g,n=/</g,a=/>/g,s=/\'/g,o=/\"/g,r=/[&<>\"\']/;function c(t){return String(null===t||void 0===t?"":t)}var u=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}("undefined"!=typeof exports?exports:Hogan),function(t){var e=/\S/,i=/\"/g,n=/\n/g,a=/\r/g,s=/\\/g,o={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};function r(t){"}"===t.n.substr(t.n.length-1)&&(t.n=t.n.substring(0,t.n.length-1))}function c(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function u(t,e,i){if(e.charAt(i)!=t.charAt(0))return!1;for(var n=1,a=t.length;n<a;n++)if(e.charAt(i+n)!=t.charAt(n))return!1;return!0}function l(t,e){for(var i=0,n=e.length;i<n;i++)if(e[i].o==t.n)return t.tag="#",!0}function d(t,e,i){for(var n=0,a=i.length;n<a;n++)if(i[n].c==t&&i[n].o==e)return!0}function m(t){return t.replace(s,"\\\\").replace(i,'\\"').replace(n,"\\n").replace(a,"\\r")}function p(t){return~t.indexOf(".")?"d":"f"}function f(t){for(var e,i,n,a,s,o,r,c,u,l,d,v="",g=0,x=t.length;g<x;g++){var w=t[g].tag;"#"==w?v+=(o=t[g].nodes,r=t[g].n,c=p(t[g].n),u=t[g].i,l=t[g].end,d=t[g].otag+" "+t[g].ctag,"if(_.s(_."+c+'("'+m(r)+'",c,p,1),c,p,0,'+u+","+l+',"'+d+'")){_.rs(c,p,function(c,p,_){'+f(o)+"});c.pop();}"):"^"==w?v+=(a=t[g].nodes,s=t[g].n,"if(!_.s(_."+p(t[g].n)+'("'+m(s)+'",c,p,1),c,p,1,0,0,"")){'+f(a)+"};"):"<"==w||">"==w?v+='_.b(_.rp("'+m((n=t[g]).n)+'",c,p,"'+(n.indent||"")+'"));':"{"==w||"&"==w?v+=(i=t[g].n,"_.b(_.t(_."+p(t[g].n)+'("'+m(i)+'",c,p,0)));'):"\n"==w?v+=h('"\\n"'+(t.length-1==g?"":" + i")):"_v"==w?v+=(e=t[g].n,"_.b(_.v(_."+p(t[g].n)+'("'+m(e)+'",c,p,0)));'):void 0===w&&(v+=h('"'+m(t[g])+'"'))}return v}function h(t){return"_.b("+t+");"}t.scan=function(t,i){var n,a,s,l,d,m=t.length,p=0,f=null,h=null,v="",g=[],x=!1,w=0,y=0,b="{{",_="}}";function C(){v.length>0&&(g.push(new String(v)),v="")}function S(t,i){if(C(),t&&function(){for(var t=!0,i=y;i<g.length;i++)if(!(t=g[i].tag&&o[g[i].tag]<o._v||!g[i].tag&&null===g[i].match(e)))return!1;return t}())for(var n,a=y;a<g.length;a++)g[a].tag||((n=g[a+1])&&">"==n.tag&&(n.indent=g[a].toString()),g.splice(a,1));else i||g.push({tag:"\n"});x=!1,y=g.length}for(i&&(i=i.split(" "),b=i[0],_=i[1]),w=0;w<m;w++)0==p?u(b,t,w)?(--w,C(),p=1):"\n"==t.charAt(w)?S(x):v+=t.charAt(w):1==p?(w+=b.length-1,"="==(f=(h=o[t.charAt(w+1)])?t.charAt(w+1):"_v")?(a=w,void 0,void 0,void 0,s="="+_,l=(n=t).indexOf(s,a),d=c(n.substring(n.indexOf("=",a)+1,l)).split(" "),b=d[0],_=d[1],w=l+s.length-1,p=0):(h&&w++,p=2),x=w):u(_,t,w)?(g.push({tag:f,n:c(v),otag:b,ctag:_,i:"/"==f?x-_.length:w+b.length}),v="",w+=_.length-1,p=0,"{"==f&&("}}"==_?w++:r(g[g.length-1]))):v+=t.charAt(w);return S(x,!0),g},t.generate=function(e,i,n){var a='var _=this;_.b(i=i||"");'+f(e)+"return _.fl();";return n.asString?"function(c,p,i){"+a+";}":new t.Template(new Function("c","p","i",a),i,t,n)},t.parse=function(t,e,i){return function t(e,i,n,a){for(var s=[],o=null,r=null;e.length>0;)if("#"==(r=e.shift()).tag||"^"==r.tag||l(r,a))n.push(r),r.nodes=t(e,r.tag,n,a),s.push(r);else{if("/"==r.tag){if(0===n.length)throw new Error("Closing tag without opener: /"+r.n);if(o=n.pop(),r.n!=o.n&&!d(r.n,o.n,a))throw new Error("Nesting error: "+o.n+" vs. "+r.n);return o.end=r.i,s}s.push(r)}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return s}(t,0,[],(i=i||{}).sectionTags||[])},t.cache={},t.compile=function(t,e){var i=t+"||"+!!(e=e||{}).asString,n=this.cache[i];return n||(n=this.generate(this.parse(this.scan(t,e.delimiters),t,e),t,e),this.cache[i]=n)}}("undefined"!=typeof exports?exports:Hogan),function(t){t.easydate={},t.easydate.locales={},t.easydate.locales.en={future_format:"%s %t",past_format:"%t %s",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years",yesterday:"yesterday",tomorrow:"tomorrow",now:"just now",ago:"ago",in:"in"},t.easydate.locales.ca={future_format:"%s %t",past_format:"%s %t",second:"segon",seconds:"segons",minute:"minut",minutes:"minuts",hour:"hora",hours:"hores",day:"dia",days:"dies",week:"setmana",weeks:"setmanes",month:"mes",months:"mesos",year:"any",years:"anys",yesterday:"ahir",tomorrow:"demà",now:"fa un moment",ago:"fa",in:"en"},t.easydate.locales.es={future_format:"%s %t",past_format:"%s %t",second:"segundo",seconds:"segundos",minute:"minuto",minutes:"minutos",hour:"hora",hours:"horas",day:"dia",days:"dias",week:"semana",weeks:"semanas",month:"mes",months:"meses",year:"año",years:"años",yesterday:"ayer",tomorrow:"mañana",now:"hace un instante",ago:"hace",in:"en"};var e={live:!0,set_title:!0,format_future:!0,format_past:!0,units:[{name:"now",limit:5},{name:"second",limit:60,in_seconds:1},{name:"minute",limit:3600,in_seconds:60},{name:"hour",limit:86400,in_seconds:3600},{name:"yesterday",limit:172800,past_only:!0},{name:"tomorrow",limit:172800,future_only:!0},{name:"day",limit:604800,in_seconds:86400},{name:"week",limit:2629743,in_seconds:604800},{name:"month",limit:31556926,in_seconds:2629743},{name:"year",limit:1/0,in_seconds:31556926}],uneasy_format:function(t){return t.toLocaleDateString()},locale:t.easydate.locales.en};function i(t,e,i){return isNaN(e)||1==e||(t+="s"),i.locale[t]||t}t.easydate.format_date=function(n,a){var s=t.extend({},e);s.locale=t.easydate.locales[a];var o=((new Date).getTime()-n.getTime())/1e3,r=Math.abs(o);if(!isNaN(o)&&!(!s.format_future&&o<0||!s.format_past&&o>0)){for(var c in s.units){var u=s.units[c];if(!(u.past_only&&o<0||u.future_only&&o>0)&&r<u.limit){if(isNaN(u.in_seconds))return i(u.name,NaN,s);var l=r/u.in_seconds;return l=Math.round(l),(o<0?i("future_format",NaN,s).replace("%s",i("in",NaN,s)):i("past_format",NaN,s).replace("%s",i("ago",NaN,s))).replace("%t",l+" "+i(u.name,l,s))}}return s.uneasy_format(n)}}}(jQuery),function(t){var e;t.ajaxSettings.xdr=function(){return window.XDomainRequest?new window.XDomainRequest:null},e=t.ajaxSettings.xdr(),t.extend(t.support,{iecors:!!e}),t.support.iecors&&t.ajaxTransport(function(t){var e=t.xdr();return{send:function(i,n){e.onload=function(){var t={"Content-Type":e.contentType};n(200,"OK",{text:e.responseText},t)},t.xhrFields&&(xhr.onerror=t.xhrFields.error,xhr.ontimeout=t.xhrFields.timeout),e.open(t.type,t.url),e.send(t.hasContent&&t.data||null)},abort:function(){e.abort()}}})}(jQuery),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){var e,i,n=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],s=Array.prototype.slice;if(t.event.fixHooks)for(var o=n.length;o;)t.event.fixHooks[n[--o]]=t.event.mouseHooks;var r=t.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var e=a.length;e;)this.addEventListener(a[--e],c,!1);else this.onmousewheel=c;t.data(this,"mousewheel-line-height",r.getLineHeight(this)),t.data(this,"mousewheel-page-height",r.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=a.length;t;)this.removeEventListener(a[--t],c,!1);else this.onmousewheel=null},getLineHeight:function(e){return parseInt(t(e)["offsetParent"in t.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0}};function c(n){var a,o=n||window.event,r=s.call(arguments,1),c=0,d=0,m=0;if((n=t.event.fix(o)).type="mousewheel","detail"in o&&(m=-1*o.detail),"wheelDelta"in o&&(m=o.wheelDelta),"wheelDeltaY"in o&&(m=o.wheelDeltaY),"wheelDeltaX"in o&&(d=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(d=-1*m,m=0),c=0===m?d:m,"deltaY"in o&&(c=m=-1*o.deltaY),"deltaX"in o&&(d=o.deltaX,0===m&&(c=-1*d)),0!==m||0!==d){if(1===o.deltaMode){var p=t.data(this,"mousewheel-line-height");c*=p,m*=p,d*=p}else if(2===o.deltaMode){var f=t.data(this,"mousewheel-page-height");c*=f,m*=f,d*=f}return a=Math.max(Math.abs(m),Math.abs(d)),(!i||a<i)&&(i=a,l(o,a)&&(i/=40)),l(o,a)&&(c/=40,d/=40,m/=40),c=Math[c>=1?"floor":"ceil"](c/i),d=Math[d>=1?"floor":"ceil"](d/i),m=Math[m>=1?"floor":"ceil"](m/i),n.deltaX=d,n.deltaY=m,n.deltaFactor=i,n.deltaMode=0,r.unshift(n,c,d,m),e&&clearTimeout(e),e=setTimeout(u,200),(t.event.dispatch||t.event.handle).apply(this,r)}}function u(){i=null}function l(t,e){return r.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}var cx,escapable,gap,indent,meta,rep;function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,a,s,o,r=gap,c=e[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof rep&&(c=rep.call(e,t,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,i=0;i<s;i+=1)o[i]=str(i,c)||"null";return a=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+r+"]":"["+o.join(",")+"]",gap=r,a}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;i<s;i+=1)"string"==typeof rep[i]&&(a=str(n=rep[i],c))&&o.push(quote(n)+(gap?": ":":")+a);else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(a=str(n,c))&&o.push(quote(n)+(gap?": ":":")+a);return a=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+r+"}":"{"+o.join(",")+"}",gap=r,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}),"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;n<i;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){var j;function walk(t,e){var i,n,a=t[e];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(void 0!==(n=walk(a,i))?a[i]=n:delete a[i]);return reviver.call(t,e,a)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var t=document,e=window,i={},n=function(){};n.prototype.addEventListener=function(t,e){this._listeners||(this._listeners={}),t in this._listeners||(this._listeners[t]=[]);var n=this._listeners[t];-1===i.arrIndexOf(n,e)&&n.push(e)},n.prototype.removeEventListener=function(t,e){if(this._listeners&&t in this._listeners){var n=this._listeners[t],a=i.arrIndexOf(n,e);-1===a||(n.length>1?this._listeners[t]=n.slice(0,a).concat(n.slice(a+1)):delete this._listeners[t])}},n.prototype.dispatchEvent=function(t){var e=t.type,i=Array.prototype.slice.call(arguments,0);if(this["on"+e]&&this["on"+e].apply(this,i),this._listeners&&e in this._listeners)for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].apply(this,i)};var a=function(t,e){if(this.type=t,void 0!==e)for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i])};a.prototype.toString=function(){var t=[];for(var e in this)if(this.hasOwnProperty(e)){var i=this[e];"function"==typeof i&&(i="[function]"),t.push(e+"="+i)}return"SimpleEvent("+t.join(", ")+")"};var s=function(t){this._events=t||[],this._listeners={}};s.prototype.emit=function(t){var e=this;if(e._verifyType(t),!e._nuked){var i=Array.prototype.slice.call(arguments,1);if(e["on"+t]&&e["on"+t].apply(e,i),t in e._listeners)for(var n=0;n<e._listeners[t].length;n++)e._listeners[t][n].apply(e,i)}},s.prototype.on=function(t,e){var i=this;i._verifyType(t),i._nuked||(t in i._listeners||(i._listeners[t]=[]),i._listeners[t].push(e))},s.prototype._verifyType=function(t){-1===i.arrIndexOf(this._events,t)&&i.log("Event "+JSON.stringify(t)+" not listed "+JSON.stringify(this._events)+" in "+this)},s.prototype.nuke=function(){var t=this;t._nuked=!0;for(var e=0;e<t._events.length;e++)delete t[t._events[e]];t._listeners={}};var o="abcdefghijklmnopqrstuvwxyz0123456789_";i.random_string=function(t,e){e=e||o.length;var i,n=[];for(i=0;i<t;i++)n.push(o.substr(Math.floor(Math.random()*e),1));return n.join("")},i.random_number=function(t){return Math.floor(Math.random()*t)},i.random_number_string=function(t){var e=(""+(t-1)).length;return(Array(e+1).join("0")+i.random_number(t)).slice(-e)},i.getOrigin=function(t){return(t+="/").split("/").slice(0,3).join("/")},i.isSameOriginUrl=function(t,i){return i||(i=e.location.href),t.split("/").slice(0,3).join("/")===i.split("/").slice(0,3).join("/")},i.getParentDomain=function(t){return/^[0-9.]*$/.test(t)?t:/^\[/.test(t)?t:/[.]/.test(t)?t.split(".").slice(1).join("."):t},i.objectExtend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t};var r="_jp";i.polluteGlobalNamespace=function(){r in e||(e._jp={})},i.closeFrame=function(t,e){return"c"+JSON.stringify([t,e])},i.userSetCode=function(t){return 1e3===t||t>=3e3&&t<=4999},i.countRTO=function(t){return t>100?3*t:t+200},i.log=function(){e.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},i.bind=function(t,e){return t.bind?t.bind(e):function(){return t.apply(e,arguments)}},i.flatUrl=function(t){return-1===t.indexOf("?")&&-1===t.indexOf("#")},i.amendUrl=function(e){var n=t.location;if(!e)throw new Error("Wrong url for SockJS");if(!i.flatUrl(e))throw new Error("Only basic urls are supported in SockJS");return 0===e.indexOf("//")&&(e=n.protocol+e),0===e.indexOf("/")&&(e=n.protocol+"//"+n.host+e),e=e.replace(/[/]+$/,"")},i.arrIndexOf=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1},i.arrSkip=function(t,e){var n=i.arrIndexOf(t,e);return-1===n?t.slice():t.slice(0,n).concat(t.slice(n+1))},i.isArray=Array.isArray||function(t){return{}.toString.call(t).indexOf("Array")>=0},i.delay=function(t,e){return"function"==typeof t&&(e=t,t=0),setTimeout(e,t)};var c,u=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},d=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,m=JSON&&JSON.stringify||function(t){return u.lastIndex=0,u.test(t)&&(t=t.replace(u,function(t){return l[t]})),'"'+t+'"'};i.quote=function(t){var e=m(t);return d.lastIndex=0,d.test(e)?(c||(c=function(t){var e,i={},n=[];for(e=0;e<65536;e++)n.push(String.fromCharCode(e));return t.lastIndex=0,n.join("").replace(t,function(t){return i[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,i}(d)),e.replace(d,function(t){return c[t]})):e};var p=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];i.probeProtocols=function(){for(var t={},e=0;e<p.length;e++){var i=p[e];t[i]=y[i]&&y[i].enabled()}return t},i.detectProtocols=function(t,e,i){var n={},a=[];e||(e=p);for(var s=0;s<e.length;s++){var o=e[s];n[o]=t[o]}var r=function(t){var e=t.shift();n[e]?a.push(e):t.length>0&&r(t)};return!1!==i.websocket&&r(["websocket"]),n["xhr-streaming"]&&!i.null_origin?a.push("xhr-streaming"):!n["xdr-streaming"]||i.cookie_needed||i.null_origin?r(["iframe-eventsource","iframe-htmlfile"]):a.push("xdr-streaming"),n["xhr-polling"]&&!i.null_origin?a.push("xhr-polling"):!n["xdr-polling"]||i.cookie_needed||i.null_origin?r(["iframe-xhr-polling","jsonp-polling"]):a.push("xdr-polling"),a};var f="_sockjs_global";i.createHook=function(){var t="a"+i.random_string(8);if(!(f in e)){var n={};e[f]=function(t){return t in n||(n[t]={id:t,del:function(){delete n[t]}}),n[t]}}return e[f](t)},i.attachMessage=function(t){i.attachEvent("message",t)},i.attachEvent=function(i,n){void 0!==e.addEventListener?e.addEventListener(i,n,!1):(t.attachEvent("on"+i,n),e.attachEvent("on"+i,n))},i.detachMessage=function(t){i.detachEvent("message",t)},i.detachEvent=function(i,n){void 0!==e.addEventListener?e.removeEventListener(i,n,!1):(t.detachEvent("on"+i,n),e.detachEvent("on"+i,n))};var h={},v=!1,g=function(){for(var t in h)h[t](),delete h[t]};i.attachEvent("unload",function(){v||(v=!0,g())}),i.unload_add=function(t){var e=i.random_string(8);return h[e]=t,v&&i.delay(g),e},i.unload_del=function(t){t in h&&delete h[t]},i.createIframe=function(e,n){var a,s,o=t.createElement("iframe"),r=function(){clearTimeout(a);try{o.onload=null}catch(t){}o.onerror=null},c=function(){o&&(r(),setTimeout(function(){o&&o.parentNode.removeChild(o),o=null},0),i.unload_del(s))},u=function(t){o&&(c(),n(t))};return o.src=e,o.style.display="none",o.style.position="absolute",o.onerror=function(){u("onerror")},o.onload=function(){clearTimeout(a),a=setTimeout(function(){u("onload timeout")},2e3)},t.body.appendChild(o),a=setTimeout(function(){u("timeout")},15e3),s=i.unload_add(c),{post:function(t,e){try{o&&o.contentWindow&&o.contentWindow.postMessage(t,e)}catch(t){}},cleanup:c,loaded:r}},i.createHtmlfile=function(t,n){var a,s,o,r=new ActiveXObject("htmlfile"),c=function(){clearTimeout(a)},u=function(){r&&(c(),i.unload_del(s),o.parentNode.removeChild(o),o=r=null,CollectGarbage())};r.open(),r.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),r.close(),r.parentWindow._jp=e._jp;var l=r.createElement("div");return r.body.appendChild(l),o=r.createElement("iframe"),l.appendChild(o),o.src=t,a=setTimeout(function(){var t;t="timeout",r&&(u(),n(t))},15e3),s=i.unload_add(u),{post:function(t,e){try{o&&o.contentWindow&&o.contentWindow.postMessage(t,e)}catch(t){}},cleanup:u,loaded:c}};var x=function(){};(x.prototype=new s(["chunk","finish"]))._start=function(t,n,a,s){var o=this;try{o.xhr=new XMLHttpRequest}catch(t){}if(!o.xhr)try{o.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),o.unload_ref=i.unload_add(function(){o._cleanup(!0)});try{o.xhr.open(t,n,!0)}catch(t){return o.emit("finish",0,""),void o._cleanup()}if(s&&s.no_credentials||(o.xhr.withCredentials="true"),s&&s.headers)for(var r in s.headers)o.xhr.setRequestHeader(r,s.headers[r]);o.xhr.onreadystatechange=function(){if(o.xhr){var t=o.xhr;switch(t.readyState){case 3:try{var e=t.status,i=t.responseText}catch(t){}1223===e&&(e=204),i&&i.length>0&&o.emit("chunk",e,i);break;case 4:1223===(e=t.status)&&(e=204),o.emit("finish",e,t.responseText),o._cleanup(!1)}}},o.xhr.send(a)},x.prototype._cleanup=function(t){var e=this;if(e.xhr){if(i.unload_del(e.unload_ref),e.xhr.onreadystatechange=function(){},t)try{e.xhr.abort()}catch(t){}e.unload_ref=e.xhr=null}},x.prototype.close=function(){this.nuke(),this._cleanup(!0)},(i.XHRCorsObject=function(){var t=this,e=arguments;i.delay(function(){t._start.apply(t,e)})}).prototype=new x,(i.XHRLocalObject=function(t,e,n){var a=this;i.delay(function(){a._start(t,e,n,{no_credentials:!0})})}).prototype=new x;var w=i.XDRObject=function(t,e,n){var a=this;i.delay(function(){a._start(t,e,n)})};w.prototype=new s(["chunk","finish"]),w.prototype._start=function(t,e,n){var a=this,s=new XDomainRequest;e+=(-1===e.indexOf("?")?"?":"&")+"t="+ +new Date;var o=s.ontimeout=s.onerror=function(){a.emit("finish",0,""),a._cleanup(!1)};s.onprogress=function(){a.emit("chunk",200,s.responseText)},s.onload=function(){a.emit("finish",200,s.responseText),a._cleanup(!1)},a.xdr=s,a.unload_ref=i.unload_add(function(){a._cleanup(!0)});try{a.xdr.open(t,e),a.xdr.send(n)}catch(t){o()}},w.prototype._cleanup=function(t){var e=this;if(e.xdr){if(i.unload_del(e.unload_ref),e.xdr.ontimeout=e.xdr.onerror=e.xdr.onprogress=e.xdr.onload=null,t)try{e.xdr.abort()}catch(t){}e.unload_ref=e.xdr=null}},w.prototype.close=function(){this.nuke(),this._cleanup(!0)},i.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:U.enabled()?3:4};var y=function(t,n,a){if(this===e)return new y(t,n,a);var s,o=this;o._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},a&&i.objectExtend(o._options,a),o._base_url=i.amendUrl(t),o._server=o._options.server||i.random_number_string(1e3),o._options.protocols_whitelist&&o._options.protocols_whitelist.length?s=o._options.protocols_whitelist:(s="string"==typeof n&&n.length>0?[n]:i.isArray(n)?n:null)&&o._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),o._protocols=[],o.protocol=null,o.readyState=y.CONNECTING,o._ir=$(o._base_url),o._ir.onfinish=function(t,e){o._ir=null,t?(o._options.info&&(t=i.objectExtend(t,o._options.info)),o._options.rtt&&(e=o._options.rtt),o._applyInfo(t,e,s),o._didClose()):o._didClose(1002,"Can't connect to server",!0)}};y.prototype=new n,y.version="0.3.4",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&i.log.apply(i,arguments)},y.prototype._dispatchOpen=function(){var t=this;t.readyState===y.CONNECTING?(t._transport_tref&&(clearTimeout(t._transport_tref),t._transport_tref=null),t.readyState=y.OPEN,t.dispatchEvent(new a("open"))):t._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(t){this.readyState===y.OPEN&&this.dispatchEvent(new a("message",{data:t}))},y.prototype._dispatchHeartbeat=function(t){this.readyState===y.OPEN&&this.dispatchEvent(new a("heartbeat",{}))},y.prototype._didClose=function(t,e,n){var s=this;if(s.readyState!==y.CONNECTING&&s.readyState!==y.OPEN&&s.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");s._ir&&(s._ir.nuke(),s._ir=null),s._transport&&(s._transport.doCleanup(),s._transport=null);var o=new a("close",{code:t,reason:e,wasClean:i.userSetCode(t)});if(!i.userSetCode(t)&&s.readyState===y.CONNECTING&&!n){if(s._try_next_protocol(o))return;o=new a("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:o})}s.readyState=y.CLOSED,i.delay(function(){s.dispatchEvent(o)})},y.prototype._didMessage=function(t){var e=this;switch(t.slice(0,1)){case"o":e._dispatchOpen();break;case"a":for(var i=JSON.parse(t.slice(1)||"[]"),n=0;n<i.length;n++)e._dispatchMessage(i[n]);break;case"m":i=JSON.parse(t.slice(1)||"null");e._dispatchMessage(i);break;case"c":i=JSON.parse(t.slice(1)||"[]");e._didClose(i[0],i[1]);break;case"h":e._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var a=n.protocol=n._protocols.shift();if(!a)return!1;if(y[a]&&!0===y[a].need_body&&(!t.body||void 0!==t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(a),n.protocol="waiting-for-load",i.attachEvent("load",function(){n._try_next_protocol()}),!0;if(y[a]&&y[a].enabled(n._options)){var s=y[a].roundTrips||1,o=(n._options.rto||0)*s||5e3;n._transport_tref=i.delay(o,function(){n.readyState===y.CONNECTING&&n._didClose(2007,"Transport timeouted")});var r=i.random_string(8),c=n._base_url+"/"+n._server+"/"+r;return n._debug("Opening transport:",a," url:"+c," RTO:"+n._options.rto),n._transport=new y[a](n,c,n._base_url),!0}n._debug("Skipping transport:",a)}},y.prototype.close=function(t,e){if(t&&!i.userSetCode(t))throw new Error("INVALID_ACCESS_ERR");return(this.readyState===y.CONNECTING||this.readyState===y.OPEN)&&(this.readyState=y.CLOSING,this._didClose(t||1e3,e||"Normal closure"),!0)},y.prototype.send=function(t){if(this.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return this.readyState===y.OPEN&&this._transport.doSend(i.quote(""+t)),!0},y.prototype._applyInfo=function(e,n,a){var s=this;s._options.info=e,s._options.rtt=n,s._options.rto=i.countRTO(n),s._options.info.null_origin=!t.domain;var o=i.probeProtocols();s._protocols=i.detectProtocols(o,a,e)};var b=y.websocket=function(t,n){var a=this,s=n+"/websocket";s="https"===s.slice(0,5)?"wss"+s.slice(5):"ws"+s.slice(4),a.ri=t,a.url=s;var o=e.WebSocket||e.MozWebSocket;a.ws=new o(a.url),a.ws.onmessage=function(t){a.ri._didMessage(t.data)},a.unload_ref=i.unload_add(function(){a.ws.close()}),a.ws.onclose=function(){a.ri._didMessage(i.closeFrame(1006,"WebSocket connection broken"))}};b.prototype.doSend=function(t){this.ws.send("["+t+"]")},b.prototype.doCleanup=function(){var t=this,e=t.ws;e&&(e.onmessage=e.onclose=null,e.close(),i.unload_del(t.unload_ref),t.unload_ref=t.ri=t.ws=null)},b.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},b.roundTrips=2;var _=function(){};_.prototype.send_constructor=function(t){this.send_buffer=[],this.sender=t},_.prototype.doSend=function(t){this.send_buffer.push(t),this.send_stop||this.send_schedule()},_.prototype.send_schedule_wait=function(){var t,e=this;e.send_stop=function(){e.send_stop=null,clearTimeout(t)},t=i.delay(25,function(){e.send_stop=null,e.send_schedule()})},_.prototype.send_schedule=function(){var t=this;if(t.send_buffer.length>0){var e="["+t.send_buffer.join(",")+"]";t.send_stop=t.sender(t.trans_url,e,function(e,i){t.send_stop=null,!1===e?t.ri._didClose(1006,"Sending error "+i):t.send_schedule_wait()}),t.send_buffer=[]}},_.prototype.send_destructor=function(){this._send_stop&&this._send_stop(),this._send_stop=null};var C=function(e,n,a){var s=this;if(!("_send_form"in s)){var o=s._send_form=t.createElement("form");(c=s._send_area=t.createElement("textarea")).name="d",o.style.display="none",o.style.position="absolute",o.method="POST",o.enctype="application/x-www-form-urlencoded",o.acceptCharset="UTF-8",o.appendChild(c),t.body.appendChild(o)}o=s._send_form;var r,c=s._send_area,u="a"+i.random_string(8);o.target=u,o.action=e+"/jsonp_send?i="+u;try{r=t.createElement('<iframe name="'+u+'">')}catch(e){(r=t.createElement("iframe")).name=u}r.id=u,o.appendChild(r),r.style.display="none";try{c.value=n}catch(t){i.log("Your browser is seriously broken. Go home! "+t.message)}o.submit();var l=function(t){r.onerror&&(r.onreadystatechange=r.onerror=r.onload=null,i.delay(500,function(){r.parentNode.removeChild(r),r=null}),c.value="",a(!0))};return r.onerror=r.onload=l,r.onreadystatechange=function(t){"complete"==r.readyState&&l()},l},S=function(e,n){var a,s,o=t.createElement("script"),r=function(t){s&&(s.parentNode.removeChild(s),s=null),o&&(clearTimeout(a),o.parentNode.removeChild(o),o.onreadystatechange=o.onerror=o.onload=o.onclick=null,o=null,n(t),n=null)},c=!1,u=null;if(o.id="a"+i.random_string(8),o.src=e,o.type="text/javascript",o.charset="UTF-8",o.onerror=function(t){u||(u=setTimeout(function(){c||r(i.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},o.onload=function(t){r(i.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},o.onreadystatechange=function(t){if(/loaded|closed/.test(o.readyState)){if(o&&o.htmlFor&&o.onclick){c=!0;try{o.onclick()}catch(t){}}o&&r(i.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===o.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))(s=t.createElement("script")).text="try{var a = document.getElementById('"+o.id+"'); if(a)a.onerror();}catch(x){};",o.async=s.async=!1;else{try{o.htmlFor=o.id,o.event="onclick"}catch(t){}o.async=!0}void 0!==o.async&&(o.async=!0),a=setTimeout(function(){r(i.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(o,l.firstChild),s&&l.insertBefore(s,l.firstChild),r},k=y["jsonp-polling"]=function(t,e){i.polluteGlobalNamespace();this.ri=t,this.trans_url=e,this.send_constructor(C),this._schedule_recv()};k.prototype=new _,k.prototype._schedule_recv=function(){var t=this;t._recv_stop=T(t.trans_url+"/jsonp",S,function(e){t._recv_stop=null,e&&(t._is_closing||t.ri._didMessage(e)),t._is_closing||t._schedule_recv()})},k.enabled=function(){return!0},k.need_body=!0,k.prototype.doCleanup=function(){var t=this;t._is_closing=!0,t._recv_stop&&t._recv_stop(),t.ri=t._recv_stop=null,t.send_destructor()};var T=function(t,n,a){var s="a"+i.random_string(6),o=0,r=n(t+"?c="+escape("_jp."+s),function(t){switch(o){case 0:delete e._jp[s],a(t);break;case 1:a(t),o=2;break;case 2:delete e._jp[s]}});e._jp[s]=r;return function(){e._jp[s]&&(o=1,e._jp[s](i.closeFrame(1e3,"JSONP user aborted read")))}},O=function(){};(O.prototype=new _).run=function(t,e,i,n,a){var s;this.ri=t,this.trans_url=e,this.send_constructor((s=a,function(t,e,i){return new s("POST",t+"/xhr_send",e).onfinish=function(t,e){i(200===t||204===t,"http status "+t)},function(t){i(!1,t)}})),this.poll=new q(t,n,e+i,a)},O.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};var E=y["xhr-streaming"]=function(t,e){this.run(t,e,"/xhr_streaming",J,i.XHRCorsObject)};E.prototype=new O,E.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},E.roundTrips=2,E.need_body=!0;var j=y["xdr-streaming"]=function(t,e){this.run(t,e,"/xhr_streaming",J,i.XDRObject)};j.prototype=new O,j.enabled=function(){return!!e.XDomainRequest},j.roundTrips=2;var N=y["xhr-polling"]=function(t,e){this.run(t,e,"/xhr",J,i.XHRCorsObject)};N.prototype=new O,N.enabled=E.enabled,N.roundTrips=2;var A=y["xdr-polling"]=function(t,e){this.run(t,e,"/xhr",J,i.XDRObject)};A.prototype=new O,A.enabled=j.enabled,A.roundTrips=2;var R,U=function(){};U.prototype.i_constructor=function(t,e,n){var a=this;a.ri=t,a.origin=i.getOrigin(n),a.base_url=n,a.trans_url=e;var s=n+"/iframe.html";a.ri._options.devel&&(s+="?t="+ +new Date),a.window_id=i.random_string(8),s+="#"+a.window_id,a.iframeObj=i.createIframe(s,function(t){a.ri._didClose(1006,"Unable to load an iframe ("+t+")")}),a.onmessage_cb=i.bind(a.onmessage,a),i.attachMessage(a.onmessage_cb)},U.prototype.doCleanup=function(){var t=this;if(t.iframeObj){i.detachMessage(t.onmessage_cb);try{t.iframeObj.iframe.contentWindow&&t.postMessage("c")}catch(t){}t.iframeObj.cleanup(),t.iframeObj=null,t.onmessage_cb=t.iframeObj=null}},U.prototype.onmessage=function(t){var e=this;if(t.origin===e.origin){var i=t.data.slice(0,8),n=t.data.slice(8,9),a=t.data.slice(9);if(i===e.window_id)switch(n){case"s":e.iframeObj.loaded(),e.postMessage("s",JSON.stringify([y.version,e.protocol,e.trans_url,e.base_url]));break;case"t":e.ri._didMessage(a)}}},U.prototype.postMessage=function(t,e){this.iframeObj.post(this.window_id+t+(e||""),this.origin)},U.prototype.doSend=function(t){this.postMessage("m",t)},U.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var M=function(t,n){parent!==e?parent.postMessage(R+t+(n||""),"*"):i.log("Can't postMessage, no parent window.",t,n)},L=function(){};L.prototype._didClose=function(t,e){M("t",i.closeFrame(t,e))},L.prototype._didMessage=function(t){M("t",t)},L.prototype._doSend=function(t){this._transport.doSend(t)},L.prototype._doCleanup=function(){this._transport.doCleanup()},i.parent_origin=void 0,y.bootstrap_iframe=function(){var n;R=t.location.hash.slice(1);i.attachMessage(function(t){if(t.source===parent&&(void 0===i.parent_origin&&(i.parent_origin=t.origin),t.origin===i.parent_origin)){var a=t.data.slice(0,8),s=t.data.slice(8,9),o=t.data.slice(9);if(a===R)switch(s){case"s":var r=JSON.parse(o),c=r[0],u=r[1],l=r[2],d=r[3];if(c!==y.version&&i.log('Incompatibile SockJS! Main site uses: "'+c+'", the iframe: "'+y.version+'".'),!i.flatUrl(l)||!i.flatUrl(d))return void i.log("Only basic urls are supported in SockJS");if(!i.isSameOriginUrl(l)||!i.isSameOriginUrl(d))return void i.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,l,d])+")");(n=new L)._transport=new L[u](n,l,d);break;case"m":n._doSend(o);break;case"c":n&&n._doCleanup(),n=null}}}),M("s")};var D=function(t,e){var n=this;i.delay(function(){n.doXhr(t,e)})};(D.prototype=new s(["finish"])).doXhr=function(t,e){var n=this,a=(new Date).getTime(),s=new e("GET",t+"/info"),o=i.delay(8e3,function(){s.ontimeout()});s.onfinish=function(t,e){if(clearTimeout(o),o=null,200===t){var i=(new Date).getTime()-a,s=JSON.parse(e);"object"!=typeof s&&(s={}),n.emit("finish",s,i)}else n.emit("finish")},s.ontimeout=function(){s.close(),n.emit("finish")}};var P=function(e){var n=this,a=function(){var t=new U;t.protocol="w-iframe-info-receiver";var i=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var i=JSON.parse(e.substr(1)),a=i[0],s=i[1];n.emit("finish",a,s)}else n.emit("finish");t.doCleanup(),t=null},a={_options:{},_didClose:i,_didMessage:i};t.i_constructor(a,e,e)};t.body?a():i.attachEvent("load",a)};P.prototype=new s(["finish"]);var I=function(){var t=this;i.delay(function(){t.emit("finish",{},2e3)})};I.prototype=new s(["finish"]);var $=function(t){if(i.isSameOriginUrl(t))return new D(t,i.XHRLocalObject);switch(i.isXHRCorsCapable()){case 1:return new D(t,i.XHRLocalObject);case 2:return new D(t,i.XDRObject);case 3:return new P(t);default:return new I}};(L["w-iframe-info-receiver"]=function(t,e,n){new D(n,i.XHRLocalObject).onfinish=function(e,i){t._didMessage("m"+JSON.stringify([e,i])),t._didClose()}}).prototype.doCleanup=function(){};var F=y["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource",this.i_constructor.apply(this,arguments)};F.prototype=new U,F.enabled=function(){return"EventSource"in e&&U.enabled()},F.need_body=!0,F.roundTrips=3,(L["w-iframe-eventsource"]=function(t,e){this.run(t,e,"/eventsource",z,i.XHRLocalObject)}).prototype=new O;var H=y["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling",this.i_constructor.apply(this,arguments)};H.prototype=new U,H.enabled=function(){return e.XMLHttpRequest&&U.enabled()},H.need_body=!0,H.roundTrips=3,(L["w-iframe-xhr-polling"]=function(t,e){this.run(t,e,"/xhr",J,i.XHRLocalObject)}).prototype=new O;var X=y["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile",this.i_constructor.apply(this,arguments)};X.prototype=new U,X.enabled=function(){return U.enabled()},X.need_body=!0,X.roundTrips=3,(L["w-iframe-htmlfile"]=function(t,e){this.run(t,e,"/htmlfile",B,i.XHRLocalObject)}).prototype=new O;var q=function(t,e,i,n){var a=this;a.ri=t,a.Receiver=e,a.recv_url=i,a.AjaxObject=n,a._scheduleRecv()};q.prototype._scheduleRecv=function(){var t=this,e=t.poll=new t.Receiver(t.recv_url,t.AjaxObject);e.onmessage=function(e){1,t.ri._didMessage(e.data)},e.onclose=function(i){t.poll=e=e.onmessage=e.onclose=null,t.poll_is_closing||("permanent"===i.reason?t.ri._didClose(1006,"Polling error ("+i.reason+")"):t._scheduleRecv())}},q.prototype.abort=function(){this.poll_is_closing=!0,this.poll&&this.poll.abort()};var W,z=function(t){var e=this,n=new EventSource(t);n.onmessage=function(t){e.dispatchEvent(new a("message",{data:unescape(t.data)}))},e.es_close=n.onerror=function(t,s){var o=s?"user":2!==n.readyState?"network":"permanent";e.es_close=n.onmessage=n.onerror=null,n.close(),n=null,i.delay(200,function(){e.dispatchEvent(new a("close",{reason:o}))})}};z.prototype=new n,z.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var B=function(t){var n=this;i.polluteGlobalNamespace(),n.id="a"+i.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape("_jp."+n.id);var s,o=function(){if(void 0===W)if("ActiveXObject"in e)try{W=!!new ActiveXObject("htmlfile")}catch(t){}else W=!1;return W}()?i.createHtmlfile:i.createIframe;e._jp[n.id]={start:function(){s.loaded()},message:function(t){n.dispatchEvent(new a("message",{data:t}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,i){s.cleanup(),n.iframe_close=s=null,delete e._jp[n.id],n.dispatchEvent(new a("close",{reason:i}))},s=o(t,function(t){n.iframe_close({},"permanent")})};B.prototype=new n,B.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var J=function(t,e){var i=this,n=0;i.xo=new e("POST",t,null),i.xo.onchunk=function(t,e){if(200===t)for(;;){var s=e.slice(n),o=s.indexOf("\n");if(-1===o)break;n+=o+1;var r=s.slice(0,o);i.dispatchEvent(new a("message",{data:r}))}},i.xo.onfinish=function(t,e){i.xo.onchunk(t,e),i.xo=null;var n=200===t?"network":"permanent";i.dispatchEvent(new a("close",{reason:n}))}};return J.prototype=new n,J.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new a("close",{reason:"user"})),this.xo=null)},y.getUtils=function(){return i},y.getIframeTransport=function(){return U},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),function(){var t,e,i,n,a={}.hasOwnProperty,s=[].slice;t={LF:"\n",NULL:"\0"},i=function(){var e;function i(t,e,i){this.command=t,this.headers=null!=e?e:{},this.body=null!=i?i:""}return i.prototype.toString=function(){var e,n,s,o;for(n in e=[this.command],o=this.headers)a.call(o,n)&&(s=o[n],e.push(n+":"+s));return this.body&&e.push("content-length:"+i.sizeOfUTF8(this.body)),e.push(t.LF+this.body),e.join(t.LF)},i.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},e=function(e){var n,a,s,o,r,c,u,l,d,m,p,f,h,v,g,x,w;for(o=e.search(RegExp(""+t.LF+t.LF)),s=(r=e.substring(0,o).split(t.LF)).shift(),c={},f=function(t){return t.replace(/^\s+|\s+$/g,"")},h=0,g=(x=r.reverse()).length;h<g;h++)l=(m=x[h]).indexOf(":"),c[f(m.substring(0,l))]=f(m.substring(l+1));if(n="",p=o+2,c["content-length"])d=parseInt(c["content-length"]),n=(""+e).substring(p,p+d);else for(a=null,u=v=p,w=e.length;(p<=w?v<w:v>w)&&(a=e.charAt(u))!==t.NULL;u=p<=w?++v:--v)n+=a;return new i(s,c,n)},i.unmarshall=function(i){var n;return function(){var a,s,o,r;for(r=[],a=0,s=(o=i.split(RegExp(""+t.NULL+t.LF+"*"))).length;a<s;a++)(null!=(n=o[a])?n.length:void 0)>0&&r.push(e(n));return r}()},i.marshall=function(e,n,a){return new i(e,n,a).toString()+t.NULL},i}(),e=function(){var e;function a(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return a.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window&&null!=(e=window.console)?e.log(t):void 0},e=function(){return Date.now?Date.now():(new Date).valueOf},a.prototype._transmit=function(t,e,n){var a;for(a=i.marshall(t,e,n),"function"==typeof this.debug&&this.debug(">>> "+a);;){if(!(a.length>this.maxWebSocketFrameSize))return this.ws.send(a);this.ws.send(a.substring(0,this.maxWebSocketFrameSize)),a=a.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+a.length)}},a.prototype._setupHeartbeat=function(i){var a,s,o,r,c,u,l=this;if((c=i.version)===n.VERSIONS.V1_1||c===n.VERSIONS.V1_2)return s=(u=function(){var t,e,n,a;for(a=[],t=0,e=(n=i["heart-beat"].split(",")).length;t<e;t++)r=n[t],a.push(parseInt(r));return a}())[0],a=u[1],0!==this.heartbeat.outgoing&&0!==a&&(o=Math.max(this.heartbeat.outgoing,a),"function"==typeof this.debug&&this.debug("send PING every "+o+"ms"),this.pinger=n.setInterval(o,function(){return l.ws.send(t.LF),"function"==typeof l.debug?l.debug(">>> PING"):void 0})),0!==this.heartbeat.incoming&&0!==s?(o=Math.max(this.heartbeat.incoming,s),"function"==typeof this.debug&&this.debug("check PONG every "+o+"ms"),this.ponger=n.setInterval(o,function(){var t;if((t=e()-l.serverActivity)>2*o)return"function"==typeof l.debug&&l.debug("did not receive server activity for the last "+t+"ms"),l.ws.close()})):void 0},a.prototype._parseConnect=function(){var t,e,i,n;switch(n={},(t=1<=arguments.length?s.call(arguments,0):[]).length){case 2:n=t[0],e=t[1];break;case 3:t[1]instanceof Function?(n=t[0],e=t[1],i=t[2]):(n.login=t[0],n.passcode=t[1],e=t[2]);break;case 4:n.login=t[0],n.passcode=t[1],e=t[2],i=t[3];break;default:n.login=t[0],n.passcode=t[1],e=t[2],i=t[3],n.host=t[4]}return[n,e,i]},a.prototype.connect=function(){var a,o,r,c,u=this;return a=1<=arguments.length?s.call(arguments,0):[],c=this._parseConnect.apply(this,a),r=c[0],this.connectCallback=c[1],o=c[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(n){var a,s,r,c,l,d,m,p,f,h,v,g;if(c="undefined"!=typeof ArrayBuffer&&n.data instanceof ArrayBuffer?(a=new Uint8Array(n.data),"function"==typeof u.debug&&u.debug("--- got data length: "+a.length),function(){var t,e,i;for(i=[],t=0,e=a.length;t<e;t++)s=a[t],i.push(String.fromCharCode(s));return i}().join("")):n.data,u.serverActivity=e(),c!==t.LF){for("function"==typeof u.debug&&u.debug("<<< "+c),g=[],f=0,h=(v=i.unmarshall(c)).length;f<h;f++)switch((l=v[f]).command){case"CONNECTED":"function"==typeof u.debug&&u.debug("connected to server "+l.headers.server),u.connected=!0,u._setupHeartbeat(l.headers),g.push("function"==typeof u.connectCallback?u.connectCallback(l):void 0);break;case"MESSAGE":p=l.headers.subscription,(m=u.subscriptions[p]||u.onreceive)?(r=u,d=l.headers["message-id"],l.ack=function(t){return null==t&&(t={}),r.ack(d,p,t)},l.nack=function(t){return null==t&&(t={}),r.nack(d,p,t)},g.push(m(l))):g.push("function"==typeof u.debug?u.debug("Unhandled received MESSAGE: "+l):void 0);break;case"RECEIPT":g.push("function"==typeof u.onreceipt?u.onreceipt(l):void 0);break;case"ERROR":g.push("function"==typeof o?o(l):void 0);break;default:g.push("function"==typeof u.debug?u.debug("Unhandled frame: "+l):void 0)}return g}"function"==typeof u.debug&&u.debug("<<< PONG")},this.ws.onclose=function(){var t;return t="Whoops! Lost connection to "+u.ws.url,"function"==typeof u.debug&&u.debug(t),u._cleanUp(),"function"==typeof o?o(t):void 0},this.ws.onopen=function(){return"function"==typeof u.debug&&u.debug("Web Socket Opened..."),r["accept-version"]=n.VERSIONS.supportedVersions(),r["heart-beat"]=[u.heartbeat.outgoing,u.heartbeat.incoming].join(","),u._transmit("CONNECT",r)}},a.prototype.disconnect=function(t){return this._transmit("DISCONNECT"),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},a.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&n.clearInterval(this.pinger),this.ponger)return n.clearInterval(this.ponger)},a.prototype.send=function(t,e,i){return null==e&&(e={}),null==i&&(i=""),e.destination=t,this._transmit("SEND",e,i)},a.prototype.subscribe=function(t,e,i){var n;return null==i&&(i={}),i.id||(i.id="sub-"+this.counter++),i.destination=t,this.subscriptions[i.id]=e,this._transmit("SUBSCRIBE",i),n=this,{id:i.id,unsubscribe:function(){return n.unsubscribe(i.id)}}},a.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},a.prototype.begin=function(t){var e,i;return i=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:i}),e=this,{id:i,commit:function(){return e.commit(i)},abort:function(){return e.abort(i)}}},a.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},a.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},a.prototype.ack=function(t,e,i){return null==i&&(i={}),i["message-id"]=t,i.subscription=e,this._transmit("ACK",i)},a.prototype.nack=function(t,e,i){return null==i&&(i={}),i["message-id"]=t,i.subscription=e,this._transmit("NACK",i)},a}(),n={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,i){var a;return null==i&&(i=["v10.stomp","v11.stomp"]),a=new(n.WebSocketClass||WebSocket)(t,i),new e(a)},over:function(t){return new e(t)},Frame:i},"undefined"!=typeof window&&null!==window?(n.setInterval=function(t,e){return window.setInterval(e,t)},n.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=n):"undefined"!=typeof exports&&null!==exports?exports.Stomp=n:self.Stomp=n}.call(this),function(){var t=this,e=t._,i={},n=Array.prototype,a=Object.prototype,s=Function.prototype,o=n.push,r=n.slice,c=n.concat,u=a.toString,l=a.hasOwnProperty,d=n.forEach,m=n.map,p=n.reduce,f=n.reduceRight,h=n.filter,v=n.every,g=n.some,x=n.indexOf,w=n.lastIndexOf,y=Array.isArray,b=Object.keys,_=s.bind,C=function(t){return t instanceof C?t:this instanceof C?void(this._wrapped=t):new C(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=C),exports._=C):t._=C,C.VERSION="1.6.0";var S=C.each=C.forEach=function(t,e,n){if(null==t)return t;if(d&&t.forEach===d)t.forEach(e,n);else if(t.length===+t.length){for(var a=0,s=t.length;a<s;a++)if(e.call(n,t[a],a,t)===i)return}else{var o=C.keys(t);for(a=0,s=o.length;a<s;a++)if(e.call(n,t[o[a]],o[a],t)===i)return}return t};C.map=C.collect=function(t,e,i){var n=[];return null==t?n:m&&t.map===m?t.map(e,i):(S(t,function(t,a,s){n.push(e.call(i,t,a,s))}),n)};var k="Reduce of empty array with no initial value";C.reduce=C.foldl=C.inject=function(t,e,i,n){var a=arguments.length>2;if(null==t&&(t=[]),p&&t.reduce===p)return n&&(e=C.bind(e,n)),a?t.reduce(e,i):t.reduce(e);if(S(t,function(t,s,o){a?i=e.call(n,i,t,s,o):(i=t,a=!0)}),!a)throw new TypeError(k);return i},C.reduceRight=C.foldr=function(t,e,i,n){var a=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return n&&(e=C.bind(e,n)),a?t.reduceRight(e,i):t.reduceRight(e);var s=t.length;if(s!==+s){var o=C.keys(t);s=o.length}if(S(t,function(r,c,u){c=o?o[--s]:--s,a?i=e.call(n,i,t[c],c,u):(i=t[c],a=!0)}),!a)throw new TypeError(k);return i},C.find=C.detect=function(t,e,i){var n;return T(t,function(t,a,s){if(e.call(i,t,a,s))return n=t,!0}),n},C.filter=C.select=function(t,e,i){var n=[];return null==t?n:h&&t.filter===h?t.filter(e,i):(S(t,function(t,a,s){e.call(i,t,a,s)&&n.push(t)}),n)},C.reject=function(t,e,i){return C.filter(t,function(t,n,a){return!e.call(i,t,n,a)},i)},C.every=C.all=function(t,e,n){e||(e=C.identity);var a=!0;return null==t?a:v&&t.every===v?t.every(e,n):(S(t,function(t,s,o){if(!(a=a&&e.call(n,t,s,o)))return i}),!!a)};var T=C.some=C.any=function(t,e,n){e||(e=C.identity);var a=!1;return null==t?a:g&&t.some===g?t.some(e,n):(S(t,function(t,s,o){if(a||(a=e.call(n,t,s,o)))return i}),!!a)};C.contains=C.include=function(t,e){return null!=t&&(x&&t.indexOf===x?-1!=t.indexOf(e):T(t,function(t){return t===e}))},C.invoke=function(t,e){var i=r.call(arguments,2),n=C.isFunction(e);return C.map(t,function(t){return(n?e:t[e]).apply(t,i)})},C.pluck=function(t,e){return C.map(t,C.property(e))},C.where=function(t,e){return C.filter(t,C.matches(e))},C.findWhere=function(t,e){return C.find(t,C.matches(e))},C.max=function(t,e,i){if(!e&&C.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);var n=-1/0,a=-1/0;return S(t,function(t,s,o){var r=e?e.call(i,t,s,o):t;r>a&&(n=t,a=r)}),n},C.min=function(t,e,i){if(!e&&C.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);var n=1/0,a=1/0;return S(t,function(t,s,o){var r=e?e.call(i,t,s,o):t;r<a&&(n=t,a=r)}),n},C.shuffle=function(t){var e,i=0,n=[];return S(t,function(t){e=C.random(i++),n[i-1]=n[e],n[e]=t}),n},C.sample=function(t,e,i){return null==e||i?(t.length!==+t.length&&(t=C.values(t)),t[C.random(t.length-1)]):C.shuffle(t).slice(0,Math.max(0,e))};var O=function(t){return null==t?C.identity:C.isFunction(t)?t:C.property(t)};C.sortBy=function(t,e,i){return e=O(e),C.pluck(C.map(t,function(t,n,a){return{value:t,index:n,criteria:e.call(i,t,n,a)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index}),"value")};var E=function(t){return function(e,i,n){var a={};return i=O(i),S(e,function(s,o){var r=i.call(n,s,o,e);t(a,r,s)}),a}};C.groupBy=E(function(t,e,i){C.has(t,e)?t[e].push(i):t[e]=[i]}),C.indexBy=E(function(t,e,i){t[e]=i}),C.countBy=E(function(t,e){C.has(t,e)?t[e]++:t[e]=1}),C.sortedIndex=function(t,e,i,n){for(var a=(i=O(i)).call(n,e),s=0,o=t.length;s<o;){var r=s+o>>>1;i.call(n,t[r])<a?s=r+1:o=r}return s},C.toArray=function(t){return t?C.isArray(t)?r.call(t):t.length===+t.length?C.map(t,C.identity):C.values(t):[]},C.size=function(t){return null==t?0:t.length===+t.length?t.length:C.keys(t).length},C.first=C.head=C.take=function(t,e,i){if(null!=t)return null==e||i?t[0]:e<0?[]:r.call(t,0,e)},C.initial=function(t,e,i){return r.call(t,0,t.length-(null==e||i?1:e))},C.last=function(t,e,i){if(null!=t)return null==e||i?t[t.length-1]:r.call(t,Math.max(t.length-e,0))},C.rest=C.tail=C.drop=function(t,e,i){return r.call(t,null==e||i?1:e)},C.compact=function(t){return C.filter(t,C.identity)};var j=function(t,e,i){return e&&C.every(t,C.isArray)?c.apply(i,t):(S(t,function(t){C.isArray(t)||C.isArguments(t)?e?o.apply(i,t):j(t,e,i):i.push(t)}),i)};C.flatten=function(t,e){return j(t,e,[])},C.without=function(t){return C.difference(t,r.call(arguments,1))},C.partition=function(t,e,i){e=O(e);var n=[],a=[];return S(t,function(t){(e.call(i,t)?n:a).push(t)}),[n,a]},C.uniq=C.unique=function(t,e,i,n){C.isFunction(e)&&(n=i,i=e,e=!1);var a=i?C.map(t,i,n):t,s=[],o=[];return S(a,function(i,n){(e?n&&o[o.length-1]===i:C.contains(o,i))||(o.push(i),s.push(t[n]))}),s},C.union=function(){return C.uniq(C.flatten(arguments,!0))},C.intersection=function(t){var e=r.call(arguments,1);return C.filter(C.uniq(t),function(t){return C.every(e,function(e){return C.contains(e,t)})})},C.difference=function(t){var e=c.apply(n,r.call(arguments,1));return C.filter(t,function(t){return!C.contains(e,t)})},C.zip=function(){for(var t=C.max(C.pluck(arguments,"length").concat(0)),e=new Array(t),i=0;i<t;i++)e[i]=C.pluck(arguments,""+i);return e},C.object=function(t,e){if(null==t)return{};for(var i={},n=0,a=t.length;n<a;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},C.indexOf=function(t,e,i){if(null==t)return-1;var n=0,a=t.length;if(i){if("number"!=typeof i)return t[n=C.sortedIndex(t,e)]===e?n:-1;n=i<0?Math.max(0,a+i):i}if(x&&t.indexOf===x)return t.indexOf(e,i);for(;n<a;n++)if(t[n]===e)return n;return-1},C.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(w&&t.lastIndexOf===w)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var a=n?i:t.length;a--;)if(t[a]===e)return a;return-1},C.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),a=0,s=new Array(n);a<n;)s[a++]=t,t+=i;return s};var N=function(){};C.bind=function(t,e){var i,n;if(_&&t.bind===_)return _.apply(t,r.call(arguments,1));if(!C.isFunction(t))throw new TypeError;return i=r.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(r.call(arguments)));N.prototype=t.prototype;var a=new N;N.prototype=null;var s=t.apply(a,i.concat(r.call(arguments)));return Object(s)===s?s:a}},C.partial=function(t){var e=r.call(arguments,1);return function(){for(var i=0,n=e.slice(),a=0,s=n.length;a<s;a++)n[a]===C&&(n[a]=arguments[i++]);for(;i<arguments.length;)n.push(arguments[i++]);return t.apply(this,n)}},C.bindAll=function(t){var e=r.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return S(e,function(e){t[e]=C.bind(t[e],t)}),t},C.memoize=function(t,e){var i={};return e||(e=C.identity),function(){var n=e.apply(this,arguments);return C.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},C.delay=function(t,e){var i=r.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},C.defer=function(t){return C.delay.apply(C,[t,1].concat(r.call(arguments,1)))},C.throttle=function(t,e,i){var n,a,s,o=null,r=0;i||(i={});var c=function(){r=!1===i.leading?0:C.now(),o=null,s=t.apply(n,a),n=a=null};return function(){var u=C.now();r||!1!==i.leading||(r=u);var l=e-(u-r);return n=this,a=arguments,l<=0?(clearTimeout(o),o=null,r=u,s=t.apply(n,a),n=a=null):o||!1===i.trailing||(o=setTimeout(c,l)),s}},C.debounce=function(t,e,i){var n,a,s,o,r,c=function(){var u=C.now()-o;u<e?n=setTimeout(c,e-u):(n=null,i||(r=t.apply(s,a),s=a=null))};return function(){s=this,a=arguments,o=C.now();var u=i&&!n;return n||(n=setTimeout(c,e)),u&&(r=t.apply(s,a),s=a=null),r}},C.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},C.wrap=function(t,e){return C.partial(e,t)},C.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},C.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},C.keys=function(t){if(!C.isObject(t))return[];if(b)return b(t);var e=[];for(var i in t)C.has(t,i)&&e.push(i);return e},C.values=function(t){for(var e=C.keys(t),i=e.length,n=new Array(i),a=0;a<i;a++)n[a]=t[e[a]];return n},C.pairs=function(t){for(var e=C.keys(t),i=e.length,n=new Array(i),a=0;a<i;a++)n[a]=[e[a],t[e[a]]];return n},C.invert=function(t){for(var e={},i=C.keys(t),n=0,a=i.length;n<a;n++)e[t[i[n]]]=i[n];return e},C.functions=C.methods=function(t){var e=[];for(var i in t)C.isFunction(t[i])&&e.push(i);return e.sort()},C.extend=function(t){return S(r.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},C.pick=function(t){var e={},i=c.apply(n,r.call(arguments,1));return S(i,function(i){i in t&&(e[i]=t[i])}),e},C.omit=function(t){var e={},i=c.apply(n,r.call(arguments,1));for(var a in t)C.contains(i,a)||(e[a]=t[a]);return e},C.defaults=function(t){return S(r.call(arguments,1),function(e){if(e)for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t},C.clone=function(t){return C.isObject(t)?C.isArray(t)?t.slice():C.extend({},t):t},C.tap=function(t,e){return e(t),t};var A=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof C&&(t=t._wrapped),e instanceof C&&(e=e._wrapped);var a=u.call(t);if(a!=u.call(e))return!1;switch(a){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;var o=t.constructor,r=e.constructor;if(o!==r&&!(C.isFunction(o)&&o instanceof o&&C.isFunction(r)&&r instanceof r)&&"constructor"in t&&"constructor"in e)return!1;i.push(t),n.push(e);var c=0,l=!0;if("[object Array]"==a){if(l=(c=t.length)==e.length)for(;c--&&(l=A(t[c],e[c],i,n)););}else{for(var d in t)if(C.has(t,d)&&(c++,!(l=C.has(e,d)&&A(t[d],e[d],i,n))))break;if(l){for(d in e)if(C.has(e,d)&&!c--)break;l=!c}}return i.pop(),n.pop(),l};C.isEqual=function(t,e){return A(t,e,[],[])},C.isEmpty=function(t){if(null==t)return!0;if(C.isArray(t)||C.isString(t))return 0===t.length;for(var e in t)if(C.has(t,e))return!1;return!0},C.isElement=function(t){return!(!t||1!==t.nodeType)},C.isArray=y||function(t){return"[object Array]"==u.call(t)},C.isObject=function(t){return t===Object(t)},S(["Arguments","Function","String","Number","Date","RegExp"],function(t){C["is"+t]=function(e){return u.call(e)=="[object "+t+"]"}}),C.isArguments(arguments)||(C.isArguments=function(t){return!(!t||!C.has(t,"callee"))}),"function"!=typeof/./&&(C.isFunction=function(t){return"function"==typeof t}),C.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},C.isNaN=function(t){return C.isNumber(t)&&t!=+t},C.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==u.call(t)},C.isNull=function(t){return null===t},C.isUndefined=function(t){return void 0===t},C.has=function(t,e){return l.call(t,e)},C.noConflict=function(){return t._=e,this},C.identity=function(t){return t},C.constant=function(t){return function(){return t}},C.property=function(t){return function(e){return e[t]}},C.matches=function(t){return function(e){if(e===t)return!0;for(var i in t)if(t[i]!==e[i])return!1;return!0}},C.times=function(t,e,i){for(var n=Array(Math.max(0,t)),a=0;a<t;a++)n[a]=e.call(i,a);return n},C.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},C.now=Date.now||function(){return(new Date).getTime()};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};R.unescape=C.invert(R.escape);var U={escape:new RegExp("["+C.keys(R.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(R.unescape).join("|")+")","g")};C.each(["escape","unescape"],function(t){C[t]=function(e){return null==e?"":(""+e).replace(U[t],function(e){return R[t][e]})}}),C.result=function(t,e){if(null!=t){var i=t[e];return C.isFunction(i)?i.call(t):i}},C.mixin=function(t){S(C.functions(t),function(e){var i=C[e]=t[e];C.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),I.call(this,i.apply(C,t))}})};var M=0;C.uniqueId=function(t){var e=++M+"";return t?t+e:e},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(t,e,i){var n;i=C.defaults({},i,C.templateSettings);var a=new RegExp([(i.escape||L).source,(i.interpolate||L).source,(i.evaluate||L).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(a,function(e,i,n,a,r){return o+=t.slice(s,r).replace(P,function(t){return"\\"+D[t]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),a&&(o+="';\n"+a+"\n__p+='"),s=r+e.length,e}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(t){throw t.source=o,t}if(e)return n(e,C);var r=function(t){return n.call(this,t,C)};return r.source="function("+(i.variable||"obj")+"){\n"+o+"}",r},C.chain=function(t){return C(t).chain()};var I=function(t){return this._chain?C(t).chain():t};C.mixin(C),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];C.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],I.call(this,i)}}),S(["concat","join","slice"],function(t){var e=n[t];C.prototype[t]=function(){return I.call(this,e.apply(this._wrapped,arguments))}}),C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return C})}.call(this),function(){var t,e=this;if("function"==typeof e.require)try{var i=e.require("crypto").randomBytes;t=i&&function(){return i(16)}}catch(t){}if(!t&&e.crypto&&crypto.getRandomValues){var n=new Uint8Array(16);t=function(){return crypto.getRandomValues(n),n}}if(!t){var a=new Array(16);t=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),a[e]=t>>>((3&e)<<3)&255;return a}}for(var s="function"==typeof e.Buffer?e.Buffer:Array,o=[],r={},c=0;c<256;c++)o[c]=(c+256).toString(16).substr(1),r[o[c]]=c;function u(t,e){var i=e||0,n=o;return n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]}var l=t(),d=[1|l[0],l[1],l[2],l[3],l[4],l[5]],m=16383&(l[6]<<8|l[7]),p=0,f=0;function h(e,i,n){var a=i&&n||0;"string"==typeof e&&(i="binary"==e?new s(16):null,e=null);var o=(e=e||{}).random||(e.rng||t)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,i)for(var r=0;r<16;r++)i[a+r]=o[r];return i||u(o)}if((uuid=h).v1=function(t,e,i){var n=e&&i||0,a=e||[],s=null!=(t=t||{}).clockseq?t.clockseq:m,o=null!=t.msecs?t.msecs:(new Date).getTime(),r=null!=t.nsecs?t.nsecs:f+1,c=o-p+(r-f)/1e4;if(c<0&&null==t.clockseq&&(s=s+1&16383),(c<0||o>p)&&null==t.nsecs&&(r=0),r>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=o,f=r,m=s;var l=(1e4*(268435455&(o+=122192928e5))+r)%4294967296;a[n++]=l>>>24&255,a[n++]=l>>>16&255,a[n++]=l>>>8&255,a[n++]=255&l;var h=o/4294967296*1e4&268435455;a[n++]=h>>>8&255,a[n++]=255&h,a[n++]=h>>>24&15|16,a[n++]=h>>>16&255,a[n++]=s>>>8|128,a[n++]=255&s;for(var v=t.node||d,g=0;g<6;g++)a[n+g]=v[g];return e||u(a)},uuid.v4=h,uuid.parse=function(t,e,i){var n=e&&i||0,a=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){a<16&&(e[n+a++]=r[t])});a<16;)e[n+a++]=0;return e},uuid.unparse=u,uuid.BufferClass=s,"function"==typeof define&&define.amd)define("uuid",[],function(){return uuid});else if("undefined"!=typeof module&&module.exports)module.exports=uuid;else{var v=e.uuid;uuid.noConflict=function(){return e.uuid=v,uuid},e.uuid=uuid}}.call(this),function(t,e){"use strict";var i="function",n="undefined",a="object",s="major",o="model",r="name",c="type",u="vendor",l="version",d="architecture",m="console",p="mobile",f="tablet",h="smarttv",v={extend:function(t,e){for(var i in e)-1!=="browser cpu device engine os".indexOf(i)&&e[i].length%2==0&&(t[i]=e[i].concat(t[i]));return t},has:function(t,e){if("string"==typeof t)return-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()}},g={rgx:function(){for(var t,s,o,r,c,u,l,d=0,m=arguments;d<m.length;d+=2){var p=m[d],f=m[d+1];if(typeof t===n)for(r in t={},f)typeof(c=f[r])===a?t[c[0]]=e:t[c]=e;for(s=o=0;s<p.length;s++)if(u=p[s].exec(this.getUA())){for(r=0;r<f.length;r++)l=u[++o],typeof(c=f[r])===a&&c.length>0?2==c.length?typeof c[1]==i?t[c[0]]=c[1].call(this,l):t[c[0]]=c[1]:3==c.length?typeof c[1]!==i||c[1].exec&&c[1].test?t[c[0]]=l?l.replace(c[1],c[2]):e:t[c[0]]=l?c[1].call(this,l,c[2]):e:4==c.length&&(t[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):e):t[c]=l||e;break}if(u)break}return t},str:function(t,i){for(var n in i)if(typeof i[n]===a&&i[n].length>0){for(var s=0;s<i[n].length;s++)if(v.has(i[n][s],t))return"?"===n?e:n}else if(v.has(i[n],t))return"?"===n?e:n;return t}},x={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},w={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[r,l,s],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[r,"Opera"],l,s],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[r,l,s],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[r,"IE"],l,s],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[r,"Yandex"],l,s],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[r,/_/g," "],l,s],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i],[r,l,s],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[r,"Dolphin"],l,s],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[r,"Chrome"],l,s],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[l,s,[r,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[l,s,r],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[r,[s,g.str,x.browser.oldsafari.major],[l,g.str,x.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[r,l,s],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[r,"Netscape"],l,s],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[r,l,s]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[d,"amd64"]],[/(ia32(?=;))/i],[[d,v.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[d,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[d,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[d,/ower/,"",v.lowerize]],[/(sun4\w)[;\)]/i],[[d,"sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[d,v.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[o,u,[c,f]],[/applecoremedia\/[\w\.]+ \((ipad)/],[o,[u,"Apple"],[c,f]],[/(apple\s{0,1}tv)/i],[[o,"Apple TV"],[u,"Apple"]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[u,o,[c,f]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[o,[u,"Amazon"],[c,f]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[o,g.str,x.device.amazon.model],[u,"Amazon"],[c,p]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[o,u,[c,p]],[/\((ip[honed|\s\w*]+);/i],[o,[u,"Apple"],[c,p]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[u,o,[c,p]],[/\((bb10);\s(\w+)/i],[[u,"BlackBerry"],o,[c,p]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7))/i],[[u,"Asus"],o,[c,f]],[/(sony)\s(tablet\s[ps])/i],[u,o,[c,f]],[/(nintendo)\s([wids3u]+)/i],[u,o,[c,m]],[/((playstation)\s[3portablevi]+)/i],[[u,"Sony"],o,[c,m]],[/(sprint\s(\w+))/i],[[u,g.str,x.device.sprint.vendor],[o,g.str,x.device.sprint.model],[c,p]],[/(Lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[[u,"Lenovo"],o,[c,f]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[u,[o,/_/g," "],[c,p]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[u,"Motorola"],o,[c,p]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[u,"Motorola"],o,[c,f]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[u,"Samsung"],o,[c,f]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[u,"Samsung"],o,[c,p]],[/(sie)-(\w+)*/i],[[u,"Siemens"],o,[c,p]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[u,"Nokia"],o,[c,p]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[u,"Acer"],o,[c,f]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[u,"LG"],o,[c,f]],[/(lg) netcast\.tv/i],[u,[c,h]],[/((nexus\s[45]))/i,/(lg)[e;\s\/-]+(\w+)*/i],[[u,"LG"],o,[c,p]],[/android.+((ideatab[a-z0-9\-\s]+))/i],[[u,"Lenovo"],o,[c,f]],[/linux;.+((jolla));/i],[u,o,[c,p]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[c,v.lowerize],u,o]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[r,l],[/rv\:([\w\.]+).*(gecko)/i],[l,r]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[r,l],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[r,[l,g.str,x.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[r,"Windows"],[l,g.str,x.os.windows.version]],[/\((bb)(10);/i],[[r,"BlackBerry"],l],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[r,l],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[r,"Symbian"],l],[/\((series40);/i],[r],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[r,"Firefox OS"],l],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[r,l],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[r,"Chromium OS"],l],[/(sunos)\s?([\w\.]+\d)*/i],[[r,"Solaris"],l],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[r,l],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[r,"iOS"],[l,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[r,[l,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[r,l]]},y=function(e,i){if(!(this instanceof y))return new y(e,i).getResult();var n=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:""),a=i?v.extend(w,i):w;this.getBrowser=function(){return g.rgx.apply(this,a.browser)},this.getCPU=function(){return g.rgx.apply(this,a.cpu)},this.getDevice=function(){return g.rgx.apply(this,a.device)},this.getEngine=function(){return g.rgx.apply(this,a.engine)},this.getOS=function(){return g.rgx.apply(this,a.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(t){return n=t,this},this.setUA(n)};if(y.VERSION="0.7.1",y.BROWSER={NAME:r,MAJOR:s,VERSION:l},y.CPU={ARCHITECTURE:d},y.DEVICE={MODEL:o,VENDOR:u,TYPE:c,CONSOLE:m,MOBILE:p,SMARTTV:h,TABLET:f},y.ENGINE={NAME:r,VERSION:l},y.OS={NAME:r,VERSION:l},typeof exports!==n)typeof module!==n&&module.exports&&(exports=module.exports=y),exports.UAParser=y;else{t.UAParser=y,typeof define===i&&define.amd&&define("UAParser",[],function(){return y});var b=t.jQuery||t.Zepto;if(typeof b!==n){var _=new y;b.ua=_.getResult(),b.ua.get=function(){return _.getUA()},b.ua.set=function(t){_.setUA(t);var e=_.getResult();for(var i in e)b.ua[i]=e[i]}}}}(this);var max=max||{};!function(t){max.views=max.views||{},t.extend(max.views,function(){function e(e){var i=this;i.minchars=e.minchars,i.maxui=e.maxui,i.source=e.source,i.action=e.action,i.filter=e.filter,i.requests={},i.$el=t(e.list),i.$list=i.$el.find("ul"),i.$el.on("click",".maxui-prediction",function(e){var n=t(e.currentTarget);i.select(n),i.choose(e)})}function i(e){var i=this;i.input=e.input,i.$input=t(i.input),i.placeholder=e.placeholder,i.$delegate=t(e.delegate),i.setBindings(),i.bindings=e.bindings,i.$input.val(i.placeholder)}return e.prototype.select=function(t){this.$list.find(".maxui-prediction.selected").removeClass("selected"),t.addClass("selected")},e.prototype.choose=function(t){var e=this.$list.find(".maxui-prediction.selected");this.action.apply(this,[e]),this.hide()},e.prototype.moveup=function(t){var e=this.$list.find(".maxui-prediction.selected"),i=e.prev();i.length>0?this.select(i):this.select(e.siblings(":last"))},e.prototype.movedown=function(t){var e=this.$list.find(".maxui-prediction.selected"),i=e.next();e.removeClass("selected"),i.length>0?this.select(i):this.select(e.siblings(":first"))},e.prototype.matchingRequest=function(e){var i,n=e.substr(0,e.length-1);if(t.each(this.requests,function(t,e){n===t&&(i=e)}),i&&!i.remaining)return i.text},e.prototype.normalizeWhiteSpace=function(t,e){t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return arguments.length>1&&(i=e),!0===i&&(t=t.replace(/[ ]{2,}/gi," ")),t},e.prototype.show=function(e){var i=this,n=t(e.target),a=i.normalizeWhiteSpace(n.val(),!1);if(a.length>=this.minchars){var s=i.matchingRequest(a);i.requests.hasOwnProperty(a)?i.render(a,a):s?i.render(a,s):this.source.apply(this,[e,a,function(t){i.requests[a]={text:a,data:t,remaining:this.getResponseHeader("X-Has-Remaining-Items")},i.render(a,a)}])}else i.hide()},e.prototype.render=function(t,e){for(var i=this,n="",a=i.requests[e].data,s=i.filter(),o=!1,r=0;r<a.length;r++){var c=a[r],u=c.username.search(new RegExp(t,"i"))>=0,l=c.displayName.search(new RegExp(t,"i"))>=0||u;if(-1===s.indexOf(c.username)&&l){var d=i.maxui.settings.avatarURLpattern.format(c.username),m={username:c.username,displayName:c.displayName,avatarURL:d,cssclass:"maxui-prediction"+(o?"":" selected")};n+=i.maxui.templates.predictive.render(m),o=!0}}""===n&&(n="<li>"+i.maxui.settings.literals.no_match_found+"</li>"),i.$list.html(n),i.$el.show()},e.prototype.hide=function(t){this.$el.hide()},i.prototype.normalizeWhiteSpace=function(t,e){t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return arguments.length>1&&(i=e),!0===i&&(t=t.replace(/[ ]{2,}/gi," ")),t},i.prototype.bind=function(t,e){this.$delegate.on(t,this.input,e)},i.prototype.execExtraBinding=function(t,e){this.bindings.hasOwnProperty(e.type)&&this.bindings[e.type].apply(t,[e])},i.prototype.getInputValue=function(){var t=this.$input.val();return this.normalizeWhiteSpace(t,!1)},i.prototype.setBindings=function(){var e=this;e.bind("focusin",function(i){i.preventDefault(),i.stopPropagation(),e.getInputValue()===e.placeholder&&t(this).val(""),e.execExtraBinding(this,i)}),e.bind("focusout",function(i){i.preventDefault(),i.stopPropagation(),""===e.getInputValue()&&(t(this).val(e.placeholder),e.$input.toggleClass("maxui-empty",!0)),e.execExtraBinding(this,i)}),e.bind("maxui-input-submit maxui-input-cancel maxui-input-up maxui-input-down maxui-input-keypress",function(t){t.preventDefault(),t.stopPropagation(),e.execExtraBinding(this,t)}),e.bind("maxui-input-clear",function(t){e.$input.val(e.placeholder)}),e.bind("keydown",function(t){38===t.which?e.$input.trigger("maxui-input-up",[t]):40===t.which&&e.$input.trigger("maxui-input-down",[t]),e.$input.toggleClass("maxui-empty",!1)}),e.bind("keyup",function(t){t.preventDefault(),t.stopPropagation(),13!==t.which||t.shiftKey?27===t.which?e.$input.trigger("maxui-input-cancel",[t]):38!==t.which&&40!==t.which&&e.$input.trigger("maxui-input-keypress",[t]):e.$input.trigger("maxui-input-submit",[t]),e.execExtraBinding(this,t)})},{MaxInput:i,MaxPredictive:e}}())}(jQuery);var max=max||{};!function(t){max.views=max.views||{},t.extend(max.views,function(){function e(e){var i=this;i.maxui=e,i.title="Overlay Title",i.content="",i.el="#maxui-overlay-panel",i.overlay_show_class=".maxui-overlay",t(i.el+" .maxui-close").click(function(t){t.preventDefault(),t.stopPropagation(),i.maxui.overlay.hide()})}return e.prototype.$el=function(){return t(this.el)},e.prototype.setTitle=function(t){this.$el().find("#maxui-overlay-title").text(t)},e.prototype.setContent=function(t){this.$el().find("#maxui-overlay-content").html(t)},e.prototype.configure=function(t){this.setTitle(t.title),this.setContent(t.content),t.bind(this)},e.prototype.show=function(e){var i=this;e.load(function(t){i.configure(t)}),t(i.overlay_show_class).show(),i.$el().animate({opacity:1},200)},e.prototype.hide=function(){var e=this;e.$el().trigger("maxui-overlay-close",[]),e.$el().animate({opacity:0},200,function(i){t(e.overlay_show_class).hide()})},{MaxOverlay:e}}())}(jQuery);var max=max||{};!function(t){max.views=max.views||{},t.extend(max.views,function(){function e(e){var i=this;i.maxui=e.maxui,i.width=e.width,i.handle=e.handle,i.dragging=!1,i.scrollbar_selector=e.scrollbar,i.$bar=t(i.scrollbar_selector),i.$dragger=i.$bar.find(".maxui-dragger"),i.target_selector=e.target,i.$target=t(i.target_selector),i.bind()}return e.prototype.bind=function(){var e=this;e.$target.on("mousewheel",function(t,i,n,a){if(t.preventDefault(),t.stopPropagation(),e.enabled()){var s=e.$target.height()-e.maxtop-e.handle.height,o=parseInt(e.$target.css("margin-top"),10)+1*a*10;o>0&&(o=0),o<-1*s&&(o=-1*s),e.$target.css({"margin-top":o});var r=100*(o*=-1)/s;e.setDraggerPosition(r)}}),t(document).on("mousemove",function(t){if(e.dragging&&(t.stopPropagation(),t.preventDefault(),e.enabled())){var i=t.clientY-e.$bar.offset().top;i<0&&(i=0),i>=e.maxtop&&(i=e.maxtop);var n=100*i/e.maxtop;e.setContentPosition(n)}}),t(document.body).on("mousedown",".maxui-dragger",function(t){t.stopPropagation(),t.preventDefault(),e.dragging=!0}),t(document).on("mouseup",function(t){e.dragging=!1})},e.prototype.setHeight=function(e){var i=t("#maxui-conversations .maxui-wrapper").offset().top-this.maxui.offset().top-1;this.$bar.css({height:e,top:i}),this.maxtop=e-this.handle.height-2},e.prototype.setTarget=function(e){this.$target=t(e)},e.prototype.setDraggerPosition=function(t){var e=this.maxtop*t/100;this.$dragger.css({"margin-top":e})},e.prototype.setContentPosition=function(t){var e=this;if(e.enabled()){var i=(e.$target.height()-e.maxtop-e.handle.height)*t/100;e.$target.css({"margin-top":-1*i}),e.setDraggerPosition(t)}else e.$target.css({"margin-top":""}),e.setDraggerPosition(0)},e.prototype.enabled=function(){return this.$target.height()>this.maxtop},{MaxScrollbar:e}}())}(jQuery);var max=max||{};!function(t){max.views=max.views||{},t.extend(max.views,function(){function e(e){var i=this;i.maxui=e,i.title=e.settings.literals.conversations_info_title,i.content="<div>Hello world</div>",i.panelID="conversation-settings-panel",i.displayNameSlot={show:function(){var e=t(i.getOwnerSelector("")),n=t(i.getOwnerSelector("> #maxui-conversation-displayname-edit")),a=t(i.getOwnerSelector("> .maxui-displayname"));t(i.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname")).width(e.width()-82),a.hide(),n.show().val(a.text()).focus()},hide:function(){var e=t(i.getOwnerSelector("> #maxui-conversation-displayname-edit"));t(i.getOwnerSelector("> .maxui-displayname")).show(),e.hide().val("")},save:function(){var n=t(i.getOwnerSelector("> .maxui-displayname")),a=t(i.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname"));e.maxClient.modifyConversation(i.data.id,a.val(),function(t){i.displayNameSlot.hide(),n.text(this.displayName),e.conversations.messagesview.setTitle(this.displayName)})}}}return e.prototype.getOwnerSelector=function(t){return"#maxui-"+this.panelID+".maxui-owner "+t},e.prototype.getSelector=function(t){return"#maxui-"+this.panelID+" "+t},e.prototype.bind=function(e){var i=this;e.$el().unbind(),e.$el().on("maxui-overlay-close",function(t){var e=_.where(i.maxui.conversations.listview.conversations,{id:i.maxui.conversations.active});_.isEmpty(e)||i.maxui.conversations.listview.loadConversation(i.maxui.conversations.active)}),e.$el().on("click",i.getOwnerSelector("> .maxui-displayname"),function(t){i.displayNameSlot.show()}),e.$el().on("keyup",i.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname"),function(t){27===t.which?i.displayNameSlot.hide():13===t.which&&i.displayNameSlot.save()}),e.$el().on("click",i.getOwnerSelector("#maxui-conversation-displayname-edit i.maxui-icon-ok-circled"),function(t){i.displayNameSlot.save()}),e.$el().on("click",i.getOwnerSelector("#maxui-conversation-displayname-edit i.maxui-icon-cancel-circled"),function(t){i.displayNameSlot.hide()}),e.$el().on("click",i.getOwnerSelector(".maxui-conversation-user-action"),function(e){var i=t(e.currentTarget),n=i.closest(".maxui-participant");n.find(".maxui-conversation-confirmation:visible").hide(),n.find(".maxui-conversation-user-action.active").removeClass("active"),i.addClass("active"),i.hasClass("maxui-icon-crown-plus")?n.find(".maxui-conversation-transfer-to").show():i.hasClass("maxui-icon-trash")&&n.find(".maxui-conversation-kick-user").show()}),e.$el().on("click",i.getSelector(".maxui-participant .maxui-conversation-transfer-to .maxui-icon-ok-circled"),function(n){var a=t(n.currentTarget).closest(".maxui-participant"),s=a.attr("data-username"),o=t(i.getSelector(".maxui-participant.maxui-owner")),r=o.find(".maxui-icon-crown"),c=a.find(".maxui-icon-crown-plus");i.maxui.maxClient.transferConversationOwnership(i.data.id,s,function(t){a.find(".maxui-conversation-transfer-to").hide(),r.removeClass("maxui-icon-crown").addClass("maxui-icon-crown-plus"),c.removeClass("maxui-icon-crown-plus").addClass("maxui-icon-crown"),o.removeClass("maxui-owner"),a.addClass("maxui-owner"),e.$el().find(i.getSelector("")).toggleClass("maxui-owner",!1),e.$el().find(i.getSelector("#maxui-new-participant")).remove(),c.removeClass("active")})}),e.$el().on("click",i.getSelector(".maxui-participant .maxui-conversation-kick-user .maxui-icon-ok-circled"),function(e){var n=t(e.currentTarget).closest(".maxui-participant"),a=n.attr("data-username");i.maxui.maxClient.kickUserFromConversation(i.data.id,a,function(t){n.remove()})}),e.$el().on("click",i.getSelector(".maxui-participant .maxui-conversation-confirmation .maxui-icon-cancel-circled"),function(e){var i=t(e.currentTarget).closest(".maxui-participant");i.find(".maxui-conversation-confirmation:visible").hide(),i.find(".maxui-conversation-user-action.active").removeClass("active")}),i.predictive=new max.views.MaxPredictive({maxui:i.maxui,minchars:3,filter:function(e){return t.map(i.data.participants,function(t,e){return t.username})},source:function(t,e,n){i.maxui.maxClient.getUsersList(e,n)},action:function(e){var n=e.attr("data-username"),a={style:"opacity:0; height:0px;",username:n,displayName:e.attr("data-username"),literals:i.maxui.settings.literals,avatarURL:i.maxui.settings.avatarURLpattern.format(n)},s=i.maxui.templates.participant.render(a);t(i.getSelector(".maxui-participants > ul")).append(s);var o=t(i.getSelector(".maxui-participant:last"));o.animate({height:36},100,function(t){o.animate({opacity:1},200)}),o.find(".maxui-conversation-add-user").show().focus(),t(i.getSelector("#maxui-new-participant .maxui-text-input")).trigger("maxui-input-clear")},list:"#maxui-new-participant #maxui-conversation-predictive"}),i.newparticipant=new max.views.MaxInput({input:"#maxui-new-participant .maxui-text-input",delegate:e.el,placeholder:i.maxui.settings.literals.conversations_info_add,bindings:{"maxui-input-keypress":function(t){i.predictive.show(t)},"maxui-input-submit":function(t){i.predictive.choose(t)},"maxui-input-cancel":function(t){i.predictive.hide(t)},"maxui-input-up":function(t){i.predictive.moveup(t)},"maxui-input-down":function(t){i.predictive.movedown(t)}}}),e.$el().on("click",i.getOwnerSelector(".maxui-participant .maxui-conversation-add-user .maxui-icon-ok-circled"),function(e){var n=t(e.target).closest(".maxui-participant"),a=n.attr("data-username");i.maxui.maxClient.addUserToConversation(i.data.id,a,function(t){n.animate({opacity:0},200,function(t){n.find(".maxui-conversation-add-user").remove(),n.animate({opacity:1},200),n.find(".maxui-conversation-user-action").show()})})}),e.$el().on("click",i.getOwnerSelector(".maxui-participant .maxui-conversation-add-user .maxui-icon-cancel-circled"),function(e){var i=t(e.currentTarget).closest(".maxui-participant");i.animate({opacity:0},200,function(t){i.animate({height:0},200,function(t){i.remove()})})}),e.$el().on("click",i.getSelector("#maxui-conversation-leave .maxui-button"),function(n){var a=i.maxui.settings.username;i.maxui.maxClient.kickUserFromConversation(i.data.id,a,function(n){i.maxui.conversations.listview.remove(i.data.id),e.hide(),t("#maxui-back-conversations a").trigger("click")})}),e.$el().on("click",i.getSelector("#maxui-conversation-delete .maxui-button"),function(e){t(i.getSelector("#maxui-conversation-delete .maxui-help")).show()}),e.$el().on("click",i.getSelector("#maxui-conversation-delete .maxui-help .maxui-confirmation-ok"),function(n){i.maxui.maxClient.deleteConversation(i.data.id,function(n){i.maxui.conversations.listview.remove(i.data.id),e.hide(),t("#maxui-back-conversations a").trigger("click")})}),e.$el().on("click",i.getSelector("#maxui-conversation-delete .maxui-help .maxui-confirmation-cancel"),function(e){t(i.getSelector("#maxui-conversation-delete .maxui-help")).hide()})},e.prototype.load=function(t){var e=this;e.maxui.maxClient.getConversation(e.maxui.conversations.active,function(i){e.maxui.maxClient.getConversationSubscription(e.maxui.conversations.active,e.maxui.settings.username,function(n){e.data=i;for(var a=[],s=0;s<e.data.participants.length;s++){var o=e.data.participants[s];o.avatarURL=e.maxui.settings.avatarURLpattern.format(o.username),o.owner=o.username===e.data.owner,a.push(o)}var r=e.maxui.settings.conversationAvatarURLpattern.format(e.data.id),c=e.data.displayName;if(e.data.participants.length<=2){var u=e.data.participants[0];1===e.data.participants.length?c="[Archive] "+u.displayName:e.data.participants[0].username===e.maxui.settings.username&&e.data.participants.length>1&&(u=e.data.participants[1]),r=e.maxui.settings.avatarURLpattern.format(u.username)}var l={displayName:c,conversationAvatarURL:r,participants:a,literals:e.maxui.settings.literals,panelID:e.panelID,published:e.maxui.utils.formatDate(e.data.published,e.maxui.language),canManage:e.maxui.settings.username===e.data.owner,canAdd:_.contains(n.permissions,"invite")};e.content=e.maxui.templates.conversationSettings.render(l),t(e)})})},{MaxChatInfo:e}}())}(jQuery);var max=max||{};!function(t){max.views=max.views||{},t.extend(max.views,function(){function e(t,e){this.conversations=[],this.mainview=t,this.maxui=this.mainview.maxui}function i(t,e){var i=this;i.messages={},i.mainview=t,i.maxui=i.mainview.maxui,i.remaining=!0}function n(n,a){var s=this;s.logtag="CONVERSATIONS",s.el="#maxuichat-widget-container #maxui-conversations",s.$el=t(s.el),s.maxui=n,s.height=320,s.listview=new e(s,{}),s.messagesview=new i(s,{}),s.conversationSettings=new max.views.MaxChatInfo(s.maxui),s.active=""}return e.prototype.load=function(t){var e=this;_.isArray(t)?(e.conversations=t,e.render(!1)):_.isFunction(t)&&e.maxui.maxClient.getConversationsForUser.apply(e.maxui.maxClient,[e.maxui.settings.username,function(i){e.maxui.logger.info("Loaded {0} conversations from max".format(e.maxui.settings.username),e.mainview.logtag),e.conversations=i,e.render(),t()}])},e.prototype.loadConversation=function(t){var e,i=this;arguments.length>1&&(e=arguments[1]),i.maxui.maxClient.getConversationSubscription(t,i.maxui.settings.username,function(t){_.findWhere(i.conversations,{id:t.id})?i.conversations=_.map(i.conversations,function(e){return e.id===t.id?t:e}):(t.unread_messages=1,i.conversations.push(t)),i.sort(),i.render(),_.isUndefined(e)||e.call(i.mainview)})},e.prototype.updateLastMessage=function(t,e){var i=this;i.conversations=_.map(i.conversations,function(n){return n.id===t&&(n.lastMessage=e,_.defaults(n,{unread_messages:0}),i.maxui.settings.username!==e.user&&(n.unread_messages+=1)),n},i),i.sort()},e.prototype.resetUnread=function(t){this.conversations=_.map(this.conversations,function(e){return e.id===t&&(e.unread_messages=0),e},this),this.mainview.updateUnreadConversations()},e.prototype.sort=function(){this.conversations=_.sortBy(this.conversations,function(t){return t.lastMessage.published}),this.conversations.reverse()},e.prototype.remove=function(t){this.conversations=_.filter(this.conversations,function(e){return e.id!==t}),this.sort(),this.render()},e.prototype.insert=function(t){this.conversations.push(t),this.sort(),this.render()},e.prototype.show=function(){var t=this;t.mainview.loadWrappers(),t.mainview.$newparticipants.show(),0===t.conversations.length?(t.load(),t.toggle()):(t.render(),t.toggle())},e.prototype.toggle=function(){var t=this;t.mainview.loadWrappers();var e="";if(!t.mainview.visible()){t.mainview.$addpeople.css({"border-color":"#ccc"}),t.mainview.$common_header.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),t.mainview.scrollbar.setHeight(t.mainview.height-45),t.mainview.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),t.mainview.scrollbar.setContentPosition(0),t.mainview.$addpeople.animate({height:19,"padding-top":6,"padding-bottom":6},400,function(e){t.mainview.$addpeople.removeAttr("style")});var i=t.mainview.$conversations_list.width()+11;t.mainview.$conversations_list.animate({"margin-left":0},400),t.mainview.$messages.animate({left:i+20},400),t.maxui.settings.conversationsSection="conversations",e=t.maxui.settings.literals.new_conversation_text,t.mainview.$postbox.val(e).attr("data-literal",e)}},e.prototype.render=function(){var e=!0;arguments.length>0&&(e=arguments[0]);var i=this,n='<span id="maxui-info">'+i.maxui.settings.literals.no_chats+"<span>",a="conversations"===i.maxui.settings.UISection,s=!1===i.maxui.settings.disableConversations&&!a,o={avatar:i.maxui.settings.avatarURLpattern.format(i.maxui.settings.username),allowPosting:!0,buttonLiteral:i.maxui.settings.literals.new_message_post,textLiteral:i.maxui.settings.literals.new_conversation_text,literals:i.maxui.settings.literals,showConversationsToggle:s?"display:block;":"display:none;",showSubscriptionList:!1},r=i.maxui.templates.postBoxChat.render(o),c=t("#maxuichat-widget-container #maxui-newactivity-chat");e&&c.html(r),i.conversations.length>0&&(n="");for(var u=0;u<i.conversations.length;u++){var l=i.conversations[u],d=l.participants[0],m=i.maxui.settings.conversationAvatarURLpattern.format(l.id),p="";l.participants.length<=2&&(1===l.participants.length?(d=l.participants[0],p+="[Archive] "):l.participants[0].username===i.maxui.settings.username&&(d=l.participants[1]),m=i.maxui.settings.avatarURLpattern.format(d.username)),p+=l.displayName;var f={id:l.id,displayName:p,text:i.maxui.utils.formatText(l.lastMessage.content),messages:l.unread_messages,literals:i.maxui.settings.literals,date:i.maxui.utils.formatDate(l.lastMessage.published,i.maxui.language),avatarURL:m,hasUnread:l.unread_messages>0};n+=i.maxui.templates.conversation.render(f)}t("#maxuichat-widget-container #maxui-conversations-list").html(n)},i.prototype.load=function(){var t=this,e=t.mainview.active;arguments.length>0&&(e=arguments[0]),t.messages[e]=[],t.maxui.maxClient.getMessagesForConversation(e,{limit:10},function(i){t.maxui.logger.info("Loaded conversation {0} messages from max".format(e),t.mainview.logtag),t.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(i,function(e,i,n){e.ack=!0,t.append(e)});var n=_.last(t.messages[e]);t.mainview.listview.updateLastMessage(e,{content:n.data.text,published:n.published,user:n.user.username}),t.mainview.listview.resetUnread(e),t.mainview.listview.render(!1),t.mainview.updateUnreadConversations(),t.render()})},i.prototype.ack=function(e){var i=this;i.maxui.logger.info("Acknowledged Message {0} --\x3e {1}".format(e.uuid,e.data.id),i.mainview.logtag);var n=t("#"+e.uuid),a=n.hasClass("maxui-user-me"),s=n.find(".maxui-icon-check");s&&a&&(s.addClass("maxui-ack"),i.messages[i.mainview.active]=_.map(i.messages[i.mainview.active],function(t){return e.uuid===t.uuid&&(t.ack=!0),t}),n.attr("id",e.data.id))},i.prototype.exists=function(t){var e=_.findWhere(this.messages[t.destination],{uuid:t.uuid});return _.isUndefined(e)},i.prototype.setTitle=function(t){this.mainview.$common_header.find("#maxui-back-conversations .maxui-title").text(t)},i.prototype.loadNew=function(){var t=this,e=_.last(t.messages[t.mainview.active]);t.maxui.maxClient.getMessagesForConversation(t.mainview.active,{limit:10,after:e.uuid},function(e){t.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(e,function(e,i,n){e.ack=!0,t.prepend(e,i)}),t.render()})},i.prototype.loadOlder=function(){var t=this,e=_.first(t.messages[t.mainview.active]);t.maxui.maxClient.getMessagesForConversation(t.mainview.active,{limit:10,before:e.uuid},function(e){t.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(e,function(e,i,n){e.ack=!0,t.prepend(e,i)}),t.render()})},i.prototype.append=function(t){var e,i=this;_.has(t,"data")?(e=t,i.mainview.listview.updateLastMessage(e.destination,{content:e.data.text,published:e.published,user:e.user.username})):(e={action:"add",object:"message",user:{username:t.actor.username,displayname:t.actor.displayName},published:t.published,data:{text:t.object.content,objectType:t.object.objectType},uuid:t.id,destination:t.contexts[0].id,ack:t.ack},_.contains(["image","file"],t.object.objectType)&&(e.data.fullURL=t.object.fullURL,e.data.thumbURL=t.object.thumbURL),i.mainview.listview.updateLastMessage(e.destination,{content:e.data.text,published:e.published,user:e.user.username})),i.messages[e.destination]=i.messages[e.destination]||[],i.messages[e.destination].push(e)},i.prototype.prepend=function(t,e){var i,n=this;_.has(t,"data")||(i={action:"add",object:"message",user:{username:t.actor.username,displayname:t.actor.displayName},published:t.published,data:{text:t.object.content,objectType:t.object.objectType},uuid:t.id,destination:t.contexts[0].id,ack:t.ack},_.contains(["image","file"],t.object.objectType)&&(i.data.fullURL=t.object.fullURL,i.data.thumbURL=t.object.thumbURL)),n.messages[n.mainview.active]=n.messages[n.mainview.active]||[],n.messages[n.mainview.active].splice(e,0,i)},i.prototype.render=function(){var e=this,i="",n=[];if(e.messages[e.mainview.active]){e.setTitle(e.mainview.getActive().displayName);for(var a=0;a<e.messages[e.mainview.active].length;a++){var s=e.messages[e.mainview.active][a],o=e.maxui.settings.avatarURLpattern.format(s.user.username),r="maxui-user-notme",c=!0;s.user.username===e.maxui.settings.username&&(r="maxui-user-me",c=!1),_.defaults(s.data,{filename:s.uuid});var u=_.contains(_.findWhere(e.mainview.listview.conversations,{id:e.mainview.active}).tags,"group"),l={id:s.uuid,text:e.maxui.utils.formatText(s.data.text),date:e.maxui.utils.formatDate(s.published,e.maxui.language),othersMessage:c,literals:e.maxui.settings.literals,avatarURL:o,displayName:s.user.displayname,showDisplayName:c&&u,ack:!!s.ack&&"maxui-user-me"===r,fileDownload:"file"===s.data.objectType,filename:s.data.filename,auth:{token:e.maxui.settings.oAuthToken,username:e.maxui.settings.username}};i+=e.maxui.templates.message.render(l),"image"===s.data.objectType&&n.push(s)}t("#maxuichat-widget-container #maxui-messages #maxui-message-list").html(i),_.each(n,function(i,n,a){e.maxui.maxClient.getMessageImage("/messages/{0}/image/thumb".format(i.uuid),function(n){var a='<img class="maxui-embedded" alt="" src="data:image/png;base64,{0}" />'.format(n);t("#maxuichat-widget-container .maxui-message#{0} .maxui-body".format(i.uuid)).after(a),e.mainview.scrollbar.setContentPosition(100)})});var d=t("#maxuichat-widget-container #maxui-messages #maxui-more-messages");"1"===e.remaining?d.show():d.hide()}},i.prototype.show=function(e){var i=this;i.mainview.loadWrappers();var n=t("#maxuichat-widget-container #maxui-newactivity-chat").find("input.maxui-button");n.removeAttr("disabled"),n.attr("class","maxui-button"),i.mainview.$newmessagebox.find("textarea").attr("class","maxui-text-input"),i.mainview.$newmessagebox.find(".maxui-error-box").animate({"margin-top":-26},200),i.mainview.$newparticipants.hide(),i.mainview.active=e,i.mainview.listview.resetUnread(e),_.has(i.messages,e)?(i.render(),i.toggle()):(i.load(),i.toggle())},i.prototype.toggle=function(){var t=this;t.mainview.loadWrappers();var e="";"messages"!==t.maxui.settings.conversationsSection&&(t.mainview.$addpeople.animate({height:0,"padding-top":0,"padding-bottom":0},400,function(e){t.mainview.$addpeople.css({"border-color":"transparent"})}),t.setTitle(t.mainview.getActive().displayName),t.mainview.$common_header.removeClass("maxui-showing-conversations").addClass("maxui-showing-messages"),t.mainview.$conversations_list.animate({"margin-left":-1*t.maxui.settings.sectionsWidth},400),t.mainview.$messages.animate({left:0,"margin-left":0},400,function(e){t.mainview.scrollbar.setHeight(t.mainview.height-45),t.mainview.scrollbar.setTarget("#maxui-conversations #maxui-messages"),t.mainview.scrollbar.setContentPosition(100)}),t.mainview.$messages.width(t.maxui.settings.sectionsWidth),t.maxui.settings.conversationsSection="messages",e=t.maxui.settings.literals.new_activity_text,t.mainview.$postbox.val(e).attr("data-literal",e))},n.prototype.visible=function(){return this.$conversations.is(":visible")&&this.$conversations.height>0},n.prototype.loadScrollbar=function(){var t=this;t.scrollbar=new max.views.MaxScrollbar({maxui:t.maxui,width:t.maxui.settings.scrollbarWidth,handle:{height:20},scrollbar:t.el+" #maxui-scrollbar",target:t.el})},n.prototype.getActive=function(){return _.findWhere(this.listview.conversations,{id:this.active})},n.prototype.loadWrappers=function(){var e=this;e.$conversations=t("#maxuichat-widget-container #maxui-conversations"),e.$conversations_list=t("#maxuichat-widget-container #maxui-conversations-list"),e.$conversations_wrapper=e.$conversations.find(".maxui-wrapper"),e.$messages=t("#maxuichat-widget-container #maxui-messages"),e.$message_list=t("#maxuichat-widget-container #maxui-message-list"),e.$postbox=t("#maxuichat-widget-container #maxui-newactivity-box textarea"),e.$common_header=e.$conversations.find("#maxui-common-header"),e.$addpeople=t("#maxuichat-widget-container #maxui-add-people-box"),e.$newparticipants=t("#maxuichat-widget-container #maxui-new-participants"),e.$newmessagebox=t("#maxuichat-widget-container #maxui-newactivity-chat")},n.prototype.render=function(){this.loadScrollbar(),this.bindEventsChat()},n.prototype.bindEventsChat=function(){var e=this;t("#maxuichat-widget-container #maxui-conversation-info").click(function(t){t.preventDefault(),t.stopPropagation(),e.maxui.overlay.show(e.conversationSettings)}),t("#maxuichat-widget-container #maxui-back-conversations").on("click",function(t){t.preventDefault(),t.stopPropagation(),window.status="",e.listview.show()}),t("#maxuichat-widget-container #maxui-conversations").on("click",".maxui-conversation",function(i){i.preventDefault(),i.stopPropagation(),window.status="";var n=t(i.target).closest(".maxui-conversation").attr("id");e.messagesview.show(n)}),t("#maxuichat-widget-container #maxui-conversations").on("click","#maxui-more-messages .maxui-button",function(t){t.preventDefault(),t.stopPropagation(),window.status="",e.messagesview.loadOlder()})},n.prototype.send=function(e){var i=this,n={data:{text:e},action:"add",object:"message"},a=i.maxui.messaging.send(n,"{0}.messages".format(i.active));t("#maxuichat-widget-container #maxui-newactivity-chat textarea").val(""),t("#maxuichat-widget-container #maxui-newactivity-chat .maxui-button").attr("disabled","disabled"),a.ack=!1,a.destination=i.active,i.messagesview.append(a),i.messagesview.show(i.active),i.scrollbar.setContentPosition(100),i.listview.updateLastMessage(i.active,{content:a.data.text,published:a.published,user:a.user.username})},n.prototype.create=function(t){var e=this;t.participants.push(e.maxui.settings.username),e.maxui.maxClient.addMessageAndConversation(t,function(i){var n=this,a=n.contexts[0].id,s={id:a,displayName:n.contexts[0].displayName,lastMessage:{content:n.object.content,published:n.published},participants:t.participants,tags:n.contexts[0].tags};e.active=a,e.listview.insert(s),e.messagesview.remaining=0,n.ack=!0,e.loadWrappers(),e.messagesview.append(n),e.messagesview.render(),e.messagesview.show(a),e.hideNameChat(),e.$newparticipants[0].people=[],e.maxui.reloadPersonsChat()})},n.prototype.hideNameChat=function(){t("#maxuichat-widget-container #maxui-add-people-box #maxui-new-displayName input").val(""),t("#maxuichat-widget-container #maxui-add-people-box #maxui-new-displayName").hide()},n.prototype.updateUnreadConversations=function(e){var i=t("#maxuichat-widget-container #maxui-show-conversations .maxui-unread-conversations"),n=_.filter(this.listview.conversations,function(t){if(t.unread_messages>0)return t});n.length>0?(i.text(n.length),i.removeClass("maxui-hidden")):i.addClass("maxui-hidden")},n.prototype.ReceiveMessage=function(t){var e=this,i=t.user.username!==e.maxui.settings.username,n=e.messagesview.exists(t);(i||n)&&(i?e.maxui.logger.log("New message from user {0} on {1}".format(t.user.username,t.destination),e.logtag):e.maxui.logger.log("Updating {1} messages sent from other {0} instances".format(t.user.username,t.destination),e.logtag),e.messagesview.append(t),e.updateUnreadConversations(),"conversations"===e.maxui.settings.UISection&&"messages"===e.maxui.settings.conversationsSection?(e.messagesview.render(!1),e.scrollbar.setContentPosition(100)):"conversations"===e.maxui.settings.UISection&&"conversations"===e.maxui.settings.conversationsSection?e.listview.render(!1):"timeline"===e.maxui.settings.UISection&&e.listview.render(!1))},n.prototype.ReceiveConversation=function(t){var e=this,i=t.user.username!==e.maxui.settings.username,n=e.messagesview.exists(t);(i||n)&&("conversations"===e.maxui.settings.UISection&&"conversations"===e.maxui.settings.conversationsSection?(e.active=t.destination,e.listview.loadConversation(t.destination,function(e){this.messagesview.show(t.destination)})):"conversations"===e.maxui.settings.UISection&&"messages"===e.maxui.settings.conversationsSection?(e.active=t.destination,e.listview.loadConversation(t.destination,function(e){this.messagesview.load(),this.listview.resetUnread(t.destination)})):"timeline"===e.maxui.settings.UISection&&e.listview.loadConversation(t.destination,function(t){e.updateUnreadConversations(),e.listview.render()}))},{MaxConversations:n}}())}(jQuery);var max=max||{};max.templates=function(){return{conversation:Hogan.compile('<div class="maxui-conversation" id="{{id}}" data-displayname="{{displayName}}">            <div class="maxui-activity-content">                <div class="maxui-topright">                            <div class="maxui-publisheddate">{{date}}</div>                    <div class="maxui-enterconversation">                        <a class="maxui-enterconversation maxui-icon-" href="#"></a>                        {{#hasUnread}}<span class="maxui-unread-messages">{{messages}}</span>{{/hasUnread}}                    </div>                </div>                <div class="maxui-actor">                      <a href="#"><span class="maxui-avatar maxui-big"><img src="{{avatarURL}}"></span>                      <span class="maxui-displayname">{{displayName}}</span></a>                </div>                <div>                    <p class="maxui-body">{{&text}}</p>                </div>            </div>                    <div class="maxui-clear"></div>        </div>            '),conversationSettings:Hogan.compile('<div id="maxui-{{panelID}}" {{#canManage}}class="maxui-owner"{{/canManage}}>          <span class="maxui-avatar maxui-big"><img src="{{conversationAvatarURL}}"></span>          <div id="maxui-conversation-displayname-edit">              <input type="text" class="maxui-displayname" value="{{displayName}}"/>              <i class="maxui-icon-cancel-circled"></i>              <i class="maxui-icon-ok-circled"></i>          </div>          <span class="maxui-displayname">{{displayName}}</span>          <span class="maxui-published">{{literals.conversations_info_created}} {{published}}</span>          <div class="maxui-participants">            <h4>{{literals.conversations_info_participants}}</h4>            <ul>              {{#participants}}              <li class="maxui-participant {{#owner}}maxui-owner{{/owner}}" data-username="{{username}}">                  <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                  <span class="maxui-displayname">{{displayName}}                      <i class="maxui-conversation-user-action maxui-icon-trash" {{^owner}}title="{{literals.conversations_info_kick_message_1}} {{displayName}} {{literals.conversations_info_kick_message_2}}"{{/owner}}></i>                      <i class="maxui-conversation-user-action maxui-icon-crown{{^owner}}-plus{{/owner}}" {{^owner}}title="{{literals.conversations_info_transfer_message_1}} {{displayName}} {{literals.conversations_info_transfer_message_2}}"{{/owner}}></i>                      <div class="maxui-conversation-transfer-to maxui-conversation-confirmation">                          <i class="maxui-icon-cancel-circled"></i>                          <i class="maxui-icon-ok-circled"></i>                      </div>                      <div class="maxui-conversation-kick-user maxui-conversation-confirmation">                          <i class="maxui-icon-cancel-circled"></i>                          <i class="maxui-icon-ok-circled"></i>                      </div>                  </span>                  <span class="maxui-username">{{username}}</span>              </li>              {{/participants}}            </ul>            {{#canAdd}}            <div id="maxui-new-participant">                <i class="maxui-icon-user-add"/>                <input type="text" class="maxui-text-input maxui-empty"/>                <div id="maxui-conversation-predictive" class="maxui-predictive" style="display:none;"><ul></ul></div>            </div>            {{/canAdd}}            </div>            <div id="maxui-conversation-leave">              <input type="button" class="maxui-button maxui-button-red maxui-button-wide" value="{{literals.conversations_info_leave}}">          </div>          <div id="maxui-conversation-delete">              <input type="button" class="maxui-button maxui-button-red maxui-button-wide" value="{{literals.conversations_info_delete}}">              <div class="maxui-help">                  <p><b>{{literals.conversations_info_delete_warning}}</b> {{literals.conversations_info_delete_help}}</p>                  <button class="maxui-button maxui-button-red maxui-confirmation-cancel">{{literals.cancel}}</button>                  <button class="maxui-button maxui-button-green maxui-confirmation-ok">{{literals.delete}}</button>              </div>          </div>        </div>            '),participant:Hogan.compile('  <li class="maxui-participant {{#owner}}maxui-owner{{/owner}}" data-username="{{username}}" style="{{style}}">              <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>              <span class="maxui-displayname">{{displayName}}                  <i class="maxui-conversation-user-action maxui-icon-trash" {{^owner}}title="Click to kick {{displayName}} out of this conversation"{{/owner}} style="display:none;"></i>                  <i class="maxui-conversation-user-action maxui-icon-crown{{^owner}}-plus{{/owner}}" {{^owner}}title="Click to make {{displayName}} the owner of this conversation"{{/owner}} style="display:none;"></i>                  <div class="maxui-conversation-transfer-to maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>                  <div class="maxui-conversation-kick-user maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>                  <div class="maxui-conversation-add-user maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>              </span>              <span class="maxui-username">{{username}}</span>          </li>            '),participants:Hogan.compile('{{#persons}}        <div class="maxui-filter maxui-participant" type="participant" username="{{username}}"><span>{{prepend}}{{displayName}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>        {{/persons}}            '),postBoxChat:Hogan.compile('      <span class="maxui-avatar maxui-big">                  <img src="{{avatar}}">              </span>              <div id="maxui-newactivity-box">                   <div class="maxui-wrapper">                       <textarea class="maxui-empty maxui-text-input" data-literal="{{textLiteral}}">{{textLiteral}}</textarea>                       <div class="maxui-error-box"></div>                   </div>                           <input disabled="disabled" type="button" class="maxui-button maxui-disabled" value="{{buttonLiteral}}">              </div>            '),predictive:Hogan.compile('<li data-username="{{username}}" data-displayname="{{displayName}}" class="{{cssclass}}">        <img src="{{avatarURL}}"/><span>{{displayName}}</span>        </li>            '),filters:Hogan.compile('{{#filters}}            {{#visible}}            <div class="maxui-filter maxui-{{type}}" type="{{type}}" value="{{value}}"><span>{{prepend}}{{value}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>            {{/visible}}        {{/filters}}            '),message:Hogan.compile('<div class="maxui-message maxui-user-{{#othersMessage}}not{{/othersMessage}}me" id="{{id}}">            <div class="maxui-activity-content">                <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                <div class="maxui-balloon">                    {{#fileDownload}}                    <form action="/messages/{{id}}/file/download" method="POST">                        <input type="hidden" name="X-Oauth-Token" value="{{auth.token}}">                        <input type="hidden" name="X-Oauth-Username" value="{{auth.username}}">                        <input type="hidden" name="X-Oauth-Scope" value="widgetcli">                        <input type="hidden" name="X-HTTP-Method-Override" value="GET">                        <span class="maxui-icon-download"></span><input type="submit" class="maxui-download" name="submit" value="File download">                    </form>                    {{/fileDownload}}                    {{#showDisplayName}}<span class="maxui-displayname">{{displayName}}</span>{{/showDisplayName}}                    <p class="maxui-body">{{&text}}</p>                    <span class="maxui-publisheddate">{{date}}</span>                    <i class="maxui-icon-check{{#ack}} maxui-ack{{/ack}}"></i>                </div>            </div>            <div class="maxui-clear"></div>        </div>            '),mainUIChat:Hogan.compile('<div id="maxui-container" class="{{showMaxUIClass}}">        {{#username}}         <div id="maxui-mainpanel">           <div id="maxui-conversations" style="height:0px; {{showConversations}}">               <div id="maxui-common-header">                  <div id="maxui-conversations-header" class="maxui-togglebar">                      <h2 class="maxui-title">{{literals.conversations}}</h3></a>                  </div>                  <div id="maxui-back-conversations" class="maxui-togglebar">                      <a class="maxui-icon-" href="#"> {{literals.conversations_list}}                      <h2 class="maxui-title">displayName</h3></a>                      <i id="maxui-conversation-info" class="maxui-icon-cog"/>                  </div>               </div>               <div class="maxui-wrapper">                   <div id="maxui-conversations-list" class="maxui-activities">                       <span id="maxui-info">{{literals.no_chats}}<span>                   </div>                           <div id="maxui-messages" style="{{messagesStyle}}">                       <div id="maxui-more-messages">                           <input type="button" class="maxui-button maxui-button-grey" value="{{literals.chats_load_older}}">                       </div>                       <div id="maxui-message-list">                       </div>                   </div>                </div>                   <div id="maxui-scrollbar">                          <div class="maxui-dragger handle"/>                   </div>           </div>                    <div id="maxui-show-conversations" class="maxui-togglebar maxui-icon-" style="{{showConversationsToggle}}">                <span class="maxui-unread-conversations maxui-hidden"></span> <a href="#">{{literals.conversations_lower}}</a>            </div>                    <div id="maxui-conversation-predictive" class="maxui-predictive" style="display:none;"><ul></ul></div>            <div id="maxui-add-people-box" style="display:none;">                <div>                  <label class="maxui-label">{{literals.participants}}: <span class="maxui-count">(1/20)</span></label>                  <input tabindex="20" type="text" data-literal="{{literals.conversations_info_add}}" value="{{literals.conversations_info_add}}" class="maxui-text-input" id="add-user-input">                </div>                <div id="maxui-new-participants" style="display:none;"></div>                <div id="maxui-new-displayName" style="display:none;">                    <label class="maxui-label">{{literals.conversation_name}}: </label>                    <input tabindex="21" type="text" class="maxui-simple-text-input"/>                </div>            </div>                    <div id="maxui-newactivity-chat" {{#hidePostbox}}style="display:none;"{{/hidePostbox}}>            </div>          </div>         </div>        {{/username}}        {{^username}}          No s\'ha definit cap usuari        {{/username}}        </div>            ')}};var max=max||{};!function(t){function e(t){var e=this;e.logtag="MESSAGING",e.maxui=t,e.active=!1,e.vhost="/",e.max_retries=3,e.retry_interval=3e3,e.debug=e.maxui.settings.enableAlerts,e.token=e.maxui.settings.oAuthToken,e.stompServer=e.maxui.settings.maxTalkURL,t.settings.domain?e.domain=t.settings.domain:e.domain=e.domainFromMaxServer(e.maxui.settings.maxServerURL),e.login="",e.domain&&(e.login+=e.domain+":"),e.login+=e.maxui.settings.username,e.ws=new SockJS(e.stompServer),e.bindings=[],e.specification={uuid:{id:"g",type:"string"},user:{id:"u",type:"object",fields:{username:{id:"u"},displayname:{id:"d"}}},action:{id:"a",type:"char",values:{add:{id:"a"},delete:{id:"d"},modify:{id:"m"},refresh:{id:"r"},ack:{id:"k"}}},object:{id:"o",type:"char",values:{message:{id:"m"},conversation:{id:"c"},tweet:{id:"t"},activity:{id:"a"},context:{id:"x"},comment:{id:"t"}}},data:{id:"d",type:"object"},source:{id:"s",type:"char",values:{max:{id:"m"},widget:{id:"w"},ios:{id:"i"},android:{id:"a"},tweety:{id:"t"},maxbunny:{id:"b"}}},domain:{id:"i",type:"string"},version:{id:"v",type:"string"},published:{id:"p",type:"date"}},e._specification={},_.each(e.specification,function(t,i,n){var a=_.clone(t);_.has(a,"values")&&(a.values={},_.each(t.values,function(t,e,i){a.values[t.id]=_.clone(t),a.values[t.id].name=e,delete a.values[t.id].id})),_.has(a,"fields")&&"object"===a.type&&(a.fields={},_.each(t.fields,function(t,e,i){a.fields[t.id]=_.clone(t),a.fields[t.id].name=e,delete a.fields[t.id].id})),a.name=i,delete a.id,e._specification[t.id]=a})}e.prototype.domainFromMaxServer=function(t){var e=t.replace(/\/$/,""),i=document.createElement("a");return i.href=e,_.last(i.pathname.split("/"))},e.prototype.start=function(){var t=this;t.maxui.logger.info("Connecting ...",t.logtag),t.connect();var e=1,i=setInterval(function(n){!t.active&&e<=t.max_retries?(t.maxui.logger.debug("Connection retry #{0}".format(e),t.logtag),t.ws.close(),t.ws=new SockJS(t.maxui.settings.maxTalkURL),t.connect()):(t.active||t.maxui.logger.error("Connection failure after {0} reconnect attempts".format(t.max_retries),t.logtag),clearInterval(i)),e+=1},t.retry_interval)},e.prototype.bind=function(t,e){this.bindings.push({key:this.pack(t),callback:e})},e.prototype.on_message=function(t,e){var i=this,n=_.filter(i.bindings,function(e){var i=_.pick(t,_.keys(e.key));if(_.isEqual(e.key,i))return e});_.isEmpty(n)?i.maxui.logger.warning("Ignoring received message\n{0}\n No binding found for this message".format(t),i.logtag):_.each(n,function(n,a,s){i.maxui.logger.debug('Matched binding "{1}"'.format(t,n.key),i.logtag);var o=i.unpack(t),r=e.replace(/(\w+)\.(.*)/g,"$1");o.destination=r,n.callback(o)})},e.prototype.disconnect=function(){this.stomp.disconnect()},e.prototype.connect=function(){var e=this;e.stomp=Stomp.over(e.ws),e.stomp.heartbeat.outgoing=0,e.stomp.heartbeat.incoming=0,e.stomp.debug=function(t){e.maxui.logger.debug(t,e.logtag)};var i="maxui";e.maxui.settings.generator&&(i+="[{0}]".format(e.maxui.settings.generator));var n={login:e.login,passcode:e.token,host:e.vhost,product:i,"product-version":e.maxui.version,platform:"{0} {1} / {2} {3}".format(t.ua.browser.name,t.ua.browser.version,t.ua.os.name,t.ua.os.version)};e.stomp.connect(n,function(t){e.stomp.subscribe("/exchange/{0}.subscribe".format(e.maxui.settings.username),function(t){var i=JSON.parse(t.body),n=/([^/])+$/.exec(t.headers.destination)[0];e.on_message(i,n)}),e.active=!0,e.maxui.logger.info("Succesfully connected to {0}".format(e.stompServer),e.logtag)},function(t){e.maxui.logger.error(t.body)})},e.prototype.pack=function(t){var e,i=this,n={};return _.each(t,function(a,s,o){var r=i.specification[s];if(_.isUndefined(r));else{var c;if(_.has(r,"values"))_.has(r.values,a)&&(c=r.values[a].id);else if(c=a,_.has(r,"fields")&&"object"===r.type&&_.isObject(c)){var u={};_.each(t[s],function(t,i,n){e=_.has(r.fields,i)?r.fields[i].id:i,u[e]=t}),c=u}_.isUndefined(c)||(n[r.id]=c)}}),n},e.prototype.unpack=function(t){var e,i=this,n={};return _.each(t,function(a,s,o){var r=i._specification[s];if(_.isUndefined(r));else{var c;if(_.has(r,"values"))_.has(r.values,a)&&(c=r.values[a].name);else if(c=a,_.has(r,"fields")&&"object"===r.type&&_.isObject(c)){var u={};_.each(t[s],function(t,i,n){e=_.has(r.fields,i)?r.fields[i].name:i,u[e]=t}),c=u}_.isUndefined(c)||(n[r.name]=c)}}),n},e.prototype.prepare=function(t){var e=this,i={source:"widget",version:e.maxui.version,user:{username:e.maxui.settings.username,displayname:e.maxui.settings.displayName},published:e.maxui.utils.rfc3339(e.maxui.utils.now()),uuid:uuid.v1()};return e.domain&&(i.domain=e.domain),_.extend(_.pick(t,_.keys(e.specification)),i)},e.prototype.send=function(t,e){var i=this.prepare(t);return this.stomp.send("/exchange/{0}.publish/{1}".format(this.maxui.settings.username,e),{},JSON.stringify(this.pack(i))),i},max.MaxMessaging=e}(jQuery);var max=max||{};!function(t){var e={debug:0,info:1,warn:2,error:3};function i(t){this.level=0}i.prototype.setLevel=function(t){this.level=e[t]},i.prototype.log=function(t,e){try{window.console.log("{0}: {1}".format(e,t))}catch(t){}},i.prototype.debug=function(t){var i="MAXUI";arguments.length>1&&(i=arguments[1]);this.level<=e.debug&&this.log(t,i)},i.prototype.info=function(t){var i="MAXUI";arguments.length>1&&(i=arguments[1]);this.level<=e.info&&this.log(t,i)},i.prototype.warn=function(t){var i="MAXUI";arguments.length>1&&(i=arguments[1]);this.level<=e.warn&&this.log(t,i)},i.prototype.error=function(t){var i="MAXUI";arguments.length>1&&(i=arguments[1]);this.level<=e.error&&this.log(t,i)},max.MaxLogging=i}(jQuery);var max=max||{};max.literals=function(t){var e={en:{cancel:"Cancel",delete:"Delete",months:["January","February","March","April","May","June","July","August","September","October","November","December"],new_activity_text:"Write something...",activity:"activity",conversations_lower:"chats",conversations:"Chats",conversations_list:"chats list",conversations_info_title:"Chat information",conversations_info_participants:"Participants",conversations_info_owner:"owner",conversations_info_add:"Add participant...",conversations_info_created:"Created",conversations_info_leave:"Leave chat",conversations_info_delete:"Delete chat",conversations_info_delete_warning:"Warning!",conversations_info_delete_help:"If you delete the chat, the participants will not be able to see the messages anymore. To avoid this, cancel and transfer the ownership to someone else.",conversations_info_kick_message_1:"Click to kick",conversations_info_kick_message_2:"out of this chat",conversations_info_transfer_message_1:"Click to make",conversations_info_transfer_message_2:"the owner of this chat",participants:"Talk to",chats_load_older:"Load older",conversation_name:"Chat name",message:"Message",no_chats:"No chats already",no_match_found:"No match found",new_conversation_text:"Add participants and send a message to start a chat",new_activity_post:"Post activity",toggle_comments:"comments",new_comment_text:"Comment something...",new_comment_post:"Post comment",load_more:"Load more",context_published_in:"Published in",generator_via:"via",search_text:"Search in posts...",and_more:"and more...",new_message_post:"Send message",post_permission_unauthorized:"You''re not authorized to post on this context",post_permission_not_here:"You're not mentioning @anyone",post_permission_not_enough_participants:"You have to add participants",post_permission_missing_displayName:"You have to name the chat",delete_activity_confirmation:"Are you sure?",delete_activity_delete:"Delete",delete_activity_cancel:"Cancel",delete_activity_icon:"delete",flag_activity_icon:"flagged",favorites_filter_hint:"Filter by favorited activity",favorites:"Favorites",favorite:"favorite",unfavorite:"unfavorite",like:"like",unlike:"unlike",recent_activity:"Latest activity",valued_activity:"Most valued activity",flagged_activity:"Flagged activity",recent_favorited_activity:"Latest favorites",valued_favorited_activity:"Most valued favorites"},es:{cancel:"Cancelar",delete:"Eliminar",months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],new_activity_text:"Escribe algo...",activity:"actividad",conversations_lower:"chats",conversations:"Chats",conversations_list:"lista de chats",conversations_info_title:"Información del chat",conversations_info_participants:"Participantes",conversations_info_owner:"propietario",conversations_info_add:"Añade participante...",conversations_info_created:"Creada",conversations_info_leave:"Abandonar chat",conversations_info_delete:"Borra el chat",conversations_info_delete_warning:"Atención!",conversations_info_delete_help:"Si eliminas el chat, los participantes dejarán de ver los mensajes. Para evitar esto, cancela y luego traspasa el chat a otra persona.",conversations_info_kick_message_1:"Clica para echar a",conversations_info_kick_message_2:"de este chat",conversations_info_transfer_message_1:"Clica para dar a ",conversations_info_transfer_message_2:"la administración del chat",participants:"Chatear con",chats_load_older:"Cargar antiguos",conversation_name:"Nombre del chat",message:"Mensaje",no_chats:"No hay chats",no_match_found:"No hay coincidencias",new_conversation_text:"Añade participantes y envia el mensaje para iniciar un chat",new_activity_post:"Publica",toggle_comments:"comentarios",new_comment_text:"Comenta algo...",new_comment_post:"Comenta",load_more:"Cargar más",context_published_in:"Publicado en",generator_via:"via",search_text:"Busca en las entradas...",and_more:"i más...",new_message_post:"Envia el mensaje",post_permission_unauthorized:"No estas autorizado a publicar en este contexto",post_permission_not_here:"No estas citando a @nadie",post_permission_not_enough_participants:"Tienes que añadir participantes",post_permission_missing_displayName:"Tienes que dar un nombre al chat",delete_activity_confirmation:"Estás seguro?",delete_activity_delete:"Borrar",delete_activity_cancel:"Cancelar",delete_activity_icon:"borrar",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra por actividad favorita",favorites:"Favoritos",favorite:"favorito",unfavorite:"quitar favorito",like:"me gusta",unlike:"ya no me gusta",recent_activity:"Últimas actividades",valued_activity:"Actividades más valoradas",flagged_activity:"Actividades destacadas",recent_favorited_activity:"Últimas favoritas",valued_favorited_activity:"Favoritas más valoradas"},ca:{cancel:"Cancelar",delete:"Elimina",months:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],new_activity_text:"Escriu alguna cosa...",activity:"activitat",conversations_lower:"xats",conversations:"Xats",conversations_list:"llista de xats",conversations_info_title:"Informació del xat",conversations_info_participants:"Participants",conversations_info_owner:"propietari",conversations_info_add:"Afegeix participant...",conversations_info_created:"Creada",conversations_info_leave:"Marxar del xat",conversations_info_delete:"Esborra el xat",conversations_info_delete_warning:"Alerta!",conversations_info_delete_help:"Si elimines el xat, la resta de participants deixaran de veure els missatges. Per evitar-ho, cancela i traspassa el xat a algú altre.",conversations_info_kick_message_1:"Clica per fer fora a ",conversations_info_kick_message_2:"d'aquest xat",conversations_info_transfer_message_1:"Clica per fer a",conversations_info_transfer_message_2:"l'administrador d'aquest xat",participants:"Xateja amb",chats_load_older:"Carregar antics",conversation_name:"Nom del xat",message:"Missatge",no_chats:"No hi ha xats",no_match_found:"No s'han trobat coincidències",new_conversation_text:"Afegeix participants i envia el missatge per iniciar un xat",new_activity_post:"Publica",toggle_comments:"comentaris",new_comment_text:"Comenta alguna cosa...",new_comment_post:"Comenta",load_more:"Carrega'n més",context_published_in:"Publicat a",generator_via:"via",search_text:"Cerca a les entrades...",and_more:"i més...",new_message_post:"Envia el missatge",post_permission_unauthorized:"No estàs autoritzat a publicar en aquest contexte",post_permission_not_here:"No estas citant a @ningú",post_permission_not_enough_participants:"Has d'afegir participants",post_permission_missing_displayName:"Tens que posar nom al xat",delete_activity_confirmation:"Estàs segur?",delete_activity_delete:"Esborra",delete_activity_cancel:"No ho toquis!",delete_activity_icon:"esborra",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra per activitat favorita",favorites:"Favorits",favorite:"favorit",unfavorite:"treure favorit",like:"m'agrada",unlike:"ja no m'agrada",recent_activity:"Darreres activitats",valued_activity:"Activitats més valorades",flagged_activity:"Activitats destacades",recent_favorited_activity:"Darreres favorites",valued_favorited_activity:"Favorites més valorades"}};return e[t]};var max=max||{};function MaxClient(){this.ROUTES={users:"/people",user:"/people/{0}",avatar:"/people/{0}/avatar",user_activities:"/people/{0}/activities",timeline:"/people/{0}/timeline",user_comments:"/people/{0}/comments",user_shares:"/people/{0}/shares",user_likes:"/people/{0}/likes",follows:"/people/{0}/follows",follow:"/people/{0}/follows/{1}",subscriptions:"/people/{0}/subscriptions",activities:"/contexts/{0}/activities",activity:"/activities/{0}",comments:"/activities/{0}/comments",comment:"/activities/{0}/comments/{1}",likes:"/activities/{0}/likes",like:"/activities/{0}/likes/{1}",flag:"/activities/{0}/flag",favorites:"/activities/{0}/favorites",favorite:"/activities/{0}/favorites/{1}",shares:"/activities/{0}/shares",share:"/activities/{0}/shares/{1}",conversations:"/conversations",conversation:"/conversations/{0}",conversation_owner:"/conversations/{0}/owner",user_conversation:"/people/{0}/conversations/{1}",messages:"/conversations/{0}/messages",context:"/contexts/{0}"}}max.utils=function(){var t={};return{setSettings:function(e){t=e},freezeEvent:function(t){return t.preventDefault&&t.preventDefault(),t.returnValue=!1,t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),!1},normalizeWhiteSpace:function(t,e){t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return arguments.length>1&&(i=e),!0===i&&(t=t.replace(/[ ]{2,}/gi," ")),t},formatText:function(t){return t&&(t=(t=(t=t.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(t){var e=t;return e.match("^https?://")||(e="http://"+e),'<a href="'+e+'">'+t+"</a>"})).replace(/(\s|^)#{1}(\w+)/gi,function(){var t=arguments[1],e=arguments[2];return'<a class="maxui-hashtag" href="#" value="'+e+'">'+t+"#"+e+"</a>"})).replace(/\r?\n/gi,"<br/>")),t},isCORSCapable:function(){return void 0!==(new XMLHttpRequest).withCredentials},removeValueFrom:function(t){for(var e,i,n=arguments,a=n.length;a>1&&t.length;)for(e=n[--a];-1!==(i=t.indexOf(e));)t.splice(i,1);return t},timestamp:function(){return new Date/1},now:function(){return new Date},rfc3339:function(t){function e(t){return t<10?"0"+t:t}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"},formatDate:function(e,i){var n=new Date,a="",s="",o=new Date,r=e.match("^([-+]?)(\\d{4,})(?:-?(\\d{2})(?:-?(\\d{2})(?:[Tt ](\\d{2})(?::?(\\d{2})(?::?(\\d{2})(?:\\.(\\d{1,3})(?:\\d+)?)?)?)?(?:[Zz]|(?:([-+])(\\d{2})(?::?(\\d{2}))?)?)?)?)?)?$");if(r){for(var c=[2,3,4,5,6,7,8,10,11],u=c.length-1;u>=0;--u)r[c[u]]=void 0!==r[c[u]]&&r[c[u]].length>0?parseInt(r[c[u]],10):0;"-"===r[1]&&(r[2]*=-1);var l=Date.UTC(r[2],r[3]-1,r[4],r[5],r[6],r[7],r[8]);void 0!==r[9]&&r[9].length>0&&(l+=("+"===r[9]?-1:1)*(3600*r[10]*1e3+60*r[11]*1e3)),r[2]>=0&&r[2]<=99&&(l-=59958144e6);return o.setTime(l),n.getTime()-l<2592e5?a=jQuery.easydate.format_date(o,i):("en"===i?a="{0} {1}".format(r[4],t.literals.months[r[3]-1]):"es"===i?a="{0} de {1}".format(r[4],t.literals.months[r[3]-1]):"ca"===i&&(s="de ",4!==r[3]&&8!==r[3]&&10!==r[3]||(s="d'"),a="{0} {2}{1}".format(r[4],t.literals.months[r[3]-1],s)),n.getTime()-l>31536e6&&(a="{0}/{1}/{2}".format(r[4],r[3],r[2]))),a}return null},utf8_decode:function(t){var e=[],i=0,n=0,a=0,s=0,o=0;for(t+="";i<t.length;)(a=t.charCodeAt(i))<128?(e[n++]=String.fromCharCode(a),i++):a>191&&a<224?(s=t.charCodeAt(i+1),e[n++]=String.fromCharCode((31&a)<<6|63&s),i+=2):(s=t.charCodeAt(i+1),o=t.charCodeAt(i+2),e[n++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&o),i+=3);return e.join("")},sha1:function(t){function e(t,e){return t<<e|t>>>32-e}function i(t){var e,i="";for(e=7;e>=0;e--)i+=(t>>>4*e&15).toString(16);return i}var n,a,s,o,r,c,u,l,d,m=new Array(80),p=1732584193,f=4023233417,h=2562383102,v=271733878,g=3285377520,x=(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}(t)).length,w=[];for(a=0;a<x-3;a+=4)s=t.charCodeAt(a)<<24|t.charCodeAt(a+1)<<16|t.charCodeAt(a+2)<<8|t.charCodeAt(a+3),w.push(s);switch(x%4){case 0:a=2147483648;break;case 1:a=t.charCodeAt(x-1)<<24|8388608;break;case 2:a=t.charCodeAt(x-2)<<24|t.charCodeAt(x-1)<<16|32768;break;case 3:a=t.charCodeAt(x-3)<<24|t.charCodeAt(x-2)<<16|t.charCodeAt(x-1)<<8|128}for(w.push(a);w.length%16!=14;)w.push(0);for(w.push(x>>>29),w.push(x<<3&4294967295),n=0;n<w.length;n+=16){for(a=0;a<16;a++)m[a]=w[n+a];for(a=16;a<=79;a++)m[a]=e(m[a-3]^m[a-8]^m[a-14]^m[a-16],1);for(o=p,r=f,c=h,u=v,l=g,a=0;a<=19;a++)d=e(o,5)+(r&c|~r&u)+l+m[a]+1518500249&4294967295,l=u,u=c,c=e(r,30),r=o,o=d;for(a=20;a<=39;a++)d=e(o,5)+(r^c^u)+l+m[a]+1859775393&4294967295,l=u,u=c,c=e(r,30),r=o,o=d;for(a=40;a<=59;a++)d=e(o,5)+(r&c|r&u|c&u)+l+m[a]+2400959708&4294967295,l=u,u=c,c=e(r,30),r=o,o=d;for(a=60;a<=79;a++)d=e(o,5)+(r^c^u)+l+m[a]+3395469782&4294967295,l=u,u=c,c=e(r,30),r=o,o=d;p=p+o&4294967295,f=f+r&4294967295,h=h+c&4294967295,v=v+u&4294967295,g=g+l&4294967295}return(d=i(p)+i(f)+i(h)+i(v)+i(g)).toLowerCase()}}},Object.keys||(Object.keys=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}),String.prototype.format=function(){var t=arguments;return this.replace(/\{\d+\}/g,function(e){return t[e.match(/\d+/)]})},MaxClient.prototype.configure=function(t){this.url=t.server,this.mode=t.mode,this.token=t.token,this.actor={objectType:"person",username:t.username}},MaxClient.prototype.POST=function(t,e,i){var n=this,a="{0}{1}".format(this.url,t),s={};return arguments.length>3&&(s=arguments[3]),jQuery.ajax({url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",n.token),t.setRequestHeader("X-Oauth-Username",n.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli")},type:"POST",contentType:"application/json",data:JSON.stringify(e),async:!0,dataType:"json"}).done(function(t){i.call(t),s.done&&jQuery(window).trigger(s.done,t)}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail,t)}),!0},MaxClient.prototype.PUT=function(t,e,i){var n=this,a="{0}{1}".format(this.url,t),s={};return arguments.length>3&&(s=arguments[3]),jQuery.ajax({url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",n.token),t.setRequestHeader("X-Oauth-Username",n.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli"),t.setRequestHeader("X-HTTP-Method-Override","PUT")},contentType:"application/json",type:"POST",data:JSON.stringify(e),async:!0,dataType:"json"}).done(function(t){i.call(t),s.done&&jQuery(window).trigger(s.done,t)}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail,t)}),!0},MaxClient.prototype.DELETE=function(t,e,i){var n=this,a="{0}{1}".format(this.url,t),s={};return arguments.length>2&&(s=arguments[2]),jQuery.ajax({url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",n.token),t.setRequestHeader("X-Oauth-Username",n.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli"),t.setRequestHeader("X-HTTP-Method-Override","DELETE")},type:"POST",data:JSON.stringify(e),async:!0,dataType:"json"}).done(function(t){i.call(t),s.done&&jQuery(window).trigger(s.done,t)}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail,t)}),!0},MaxClient.prototype.GET=function(t,e,i){var n=this,a="{0}{1}".format(this.url,t),s={};arguments.length>3&&(s=arguments[3]),Object.keys(e).length>0&&(a+="?"+jQuery.param(e,!0));var o={url:a,beforeSend:function(t){t.setRequestHeader("X-Oauth-Token",n.token),t.setRequestHeader("X-Oauth-Username",n.actor.username),t.setRequestHeader("X-Oauth-Scope","widgetcli")},processData:!0,type:"GET",async:!0,dataType:"json"};return arguments.length>3&&_.extend(o,arguments[3]),jQuery.ajax(o).done(function(t,e,n){s.done&&jQuery(window).trigger(s.done),i.apply(n,[t])}).fail(function(t){jQuery(window).trigger("maxclienterror",t),s.fail&&jQuery(window).trigger(s.fail)}),!0},MaxClient.prototype.getUserData=function(t,e){var i=this.ROUTES.user.format(t);this.GET(i,{},e)},MaxClient.prototype.getUsersList=function(t,e){var i=this.ROUTES.users,n={username:t};this.GET(i,n,e)},MaxClient.prototype.getContext=function(t,e){var i=this.ROUTES.context.format(t);this.GET(i,{},e)},MaxClient.prototype.getUserTimeline=function(t,e){var i=this.ROUTES.timeline.format(t),n={};arguments.length>2&&(n=arguments[2]),this.GET(i,n,e)},MaxClient.prototype.getActivities=function(t,e){var i=this.ROUTES.activities.format(t.context),n={};arguments.length>2&&(n=arguments[2]),t.tags&&t.tags.length>0&&(n.context_tags=t.tags),this.GET(i,n,e)},MaxClient.prototype.getCommentsForActivity=function(t,e){var i=this.ROUTES.comments.format(t);this.GET(i,{},e)},MaxClient.prototype.addComment=function(t,e,i){var n={actor:{},object:{objectType:"comment",content:""}};n.actor=this.actor,n.object.content=t;var a=this.ROUTES.comments.format(e);this.POST(a,n,i)},MaxClient.prototype.addActivity=function(t,e,i){var n={object:{objectType:"note",content:""}};if(e.length>0){n.contexts=[];for(var a=0;a<e.length;a++)n.contexts.push({objectType:"context",url:e[a]})}n.object.content=t,arguments.length>3&&(n.generator=arguments[3]);var s=this.ROUTES.user_activities.format(this.actor.username);this.POST(s,n,i,{done:"maxui-posted-activity",fail:"maxui-failed-activity"})},MaxClient.prototype.removeActivity=function(t,e){var i=this.ROUTES.activity.format(t);this.DELETE(i,{},e)},MaxClient.prototype.removeActivityComment=function(t,e,i){var n=this.ROUTES.comment.format(t,e);this.DELETE(n,{},i)},MaxClient.prototype.getConversationSubscription=function(t,e,i){var n=this.ROUTES.user_conversation.format(e,t);this.GET(n,{},i)},MaxClient.prototype.getConversation=function(t,e){var i=this.ROUTES.conversation.format(t);this.GET(i,{},e)},MaxClient.prototype.modifyConversation=function(t,e,i){var n={displayName:e},a=this.ROUTES.conversation.format(t);this.PUT(a,n,i)},MaxClient.prototype.addUserToConversation=function(t,e,i){var n=this.ROUTES.user_conversation.format(e,t);this.POST(n,{},i)},MaxClient.prototype.kickUserFromConversation=function(t,e,i){var n=this.ROUTES.user_conversation.format(e,t);this.DELETE(n,{},i)},MaxClient.prototype.deleteConversation=function(t,e){var i=this.ROUTES.conversation.format(t);this.DELETE(i,{},e)},MaxClient.prototype.leaveConversation=function(t,e,i){var n=this.ROUTES.user_conversation.format(e,t);this.DELETE(n,{},i)},MaxClient.prototype.transferConversationOwnership=function(t,e,i){var n={actor:{username:e}},a=this.ROUTES.conversation_owner.format(t);this.PUT(a,n,i)},MaxClient.prototype.getConversationsForUser=function(t,e){var i=this.ROUTES.conversations;this.GET(i,{},e)},MaxClient.prototype.getMessageImage=function(t,e){var i={processData:!1,dataType:void 0,contentType:"application/base64"};this.GET(t,{},e,i)},MaxClient.prototype.getMessagesForConversation=function(t,e,i){var n=this.ROUTES.messages.format(t),a=e;this.GET(n,a,i)},MaxClient.prototype.addMessageAndConversation=function(t,e){var i={object:{objectType:"note",content:t.message},contexts:[{objectType:"conversation",participants:t.participants}]};t.displayName&&(i.contexts[0].displayName=t.displayName);var n=this.ROUTES.conversations;this.POST(n,i,e)},MaxClient.prototype.addMessage=function(t,e,i){var n={object:{objectType:"note",content:""}};n.object.content=t;var a=this.ROUTES.messages.format(e);this.POST(a,n,i)},MaxClient.prototype.follow=function(t,e){var i={object:{objectType:"person",username:""}};i.object.username=t;var n=this.ROUTES.follow.format(this.actor.username,t);this.POST(n,i,e)},MaxClient.prototype.favoriteActivity=function(t,e){var i=this.ROUTES.favorites.format(t);this.POST(i,{},e)},MaxClient.prototype.unfavoriteActivity=function(t,e){var i=this.ROUTES.favorite.format(t,this.actor.username);this.DELETE(i,{},e)},MaxClient.prototype.likeActivity=function(t,e){var i=this.ROUTES.likes.format(t);this.POST(i,{},e)},MaxClient.prototype.unlikeActivity=function(t,e){var i=this.ROUTES.like.format(t,this.actor.username);this.DELETE(i,{},e)},MaxClient.prototype.flagActivity=function(t,e){var i=this.ROUTES.flag.format(t);this.POST(i,{},e)},MaxClient.prototype.unflagActivity=function(t,e){var i=this.ROUTES.flag.format(t);this.DELETE(i,{},e)},function(t){t.fn.maxUIChat=function(e){var i=this;i.version="4.1.21",i.templates=max.templates(),i.utils=max.utils();var n={maxRequestsAPI:"jquery",maxServerURL:"https://max.upc.edu",readContext:void 0,writeContexts:[],activitySource:"timeline",enableAlerts:!1,UISection:"conversations",disableTimeline:!0,disableConversations:!1,conversationsSection:"conversations",currentConversationSection:"conversations",activitySortOrder:"comments",activitySortView:"recent",maximumConversations:20,contextTagsFilter:[],scrollbarWidth:10,widgetWidth:"0",sectionHorizontalPadding:20,widgetBorder:2,loglevel:"info",hidePostboxChatOnTimeline:!1,maxTalkURL:"",generator:"",domain:"",showSubscriptionList:!1};i.settings=t.extend(n,e),i.logger=new max.MaxLogging(i),i.logger.setLevel(i.settings.loglevel),i.utils.isCORSCapable()||i.settings.maxServerURLAlias&&(i.settings.maxServerURL=i.settings.maxServerURLAlias),i.settings.maxTalkURL=i.utils.normalizeWhiteSpace(i.settings.maxTalkURL),(_.isUndefined(i.settings.maxTalkURL)||""===i.settings.maxTalkURL)&&(i.settings.maxTalkURL=i.settings.maxServerURL+"/stomp"),i.settings.domain=i.utils.normalizeWhiteSpace(i.settings.domain),"none"===i.settings.domain.toLowerCase()&&(i.settings.domain=""),"timeline"===i.settings.UISection&&"timeline"===i.settings.activitySource&&i.settings.readContext&&(i.settings.readContext=void 0,i.settings.writeContexts=[]),i.settings.showSubscriptionList&&"activities"===i.settings.activitySource&&(i.settings.showSubscriptionList=!1),i.language=e.language||"en";var a=e.literals||{};if(i.settings.literals=t.extend(max.literals(i.language),a),i.settings.readContext){i.settings.readContextHash=i.utils.sha1(i.settings.readContext),i.settings.writeContexts.push(i.settings.readContext),i.settings.writeContextsHashes=[];for(var s=0;s<i.settings.writeContexts.length;s++)i.settings.writeContextsHashes.push(i.utils.sha1(i.settings.writeContexts[s]))}i.settings.avatarURLpattern||(i.settings.avatarURLpattern=i.settings.maxServerURL+"/people/{0}/avatar"),i.settings.contextAvatarURLpattern||(i.settings.contextAvatarURLpattern=i.settings.maxServerURL+"/contexts/{0}/avatar"),i.settings.conversationAvatarURLpattern||(i.settings.conversationAvatarURLpattern=i.settings.maxServerURL+"/conversations/{0}/avatar"),i.settings.enableAlerts&&t(window).bind("maxclienterror",function(t,e){var i=JSON.parse(e.responseText);alert('The server responded with a "{0}" error, with the following message: "{1}". \n\nPlease try again later or contact administrator at admin@max.upc.edu.'.format(i.error,i.error_description))}),i.maxClient=new MaxClient;var o={server:i.settings.maxServerURL,mode:i.settings.maxRequestsAPI,username:i.settings.username,token:i.settings.oAuthToken};return i.maxClient.configure(o),i.messaging=new max.MaxMessaging(i),i.conversations=new max.views.MaxConversations(i,{}),i.settings.disableConversations||(i.messaging.bind({action:"add",object:"message"},function(t){i.conversations.ReceiveMessage(t)}),i.messaging.bind({action:"add",object:"conversation"},function(t){i.conversations.ReceiveConversation(t)}),i.messaging.bind({action:"refresh",object:"conversation"},function(t){i.conversations.messagesview.load(t.destination)}),i.messaging.bind({action:"ack",object:"message"},function(t){i.conversations.messagesview.ack(t)})),i.utils.setSettings(i.settings),t.fn.hidePostboxChat=function(){var t=this;if("timeline"===t.settings.activitySource&&t.settings.subscriptionsWrite.length>0)return t.settings.hidePostboxChatOnTimeline;for(var e in t.settings.subscriptionsWrite){if(t.settings.subscriptionsWrite[e].hash===t.settings.readContext)return t.settings.hidePostboxChatOnTimeline}return!0},this.maxClient.getUserData(i.settings.username,function(e){i.settings.displayName=e.displayName||i.settings.username;var n={},a=[];if(e.subscribedTo&&e.subscribedTo&&e.subscribedTo.length>0)for(var s=0;s<e.subscribedTo.length;s++){var o=e.subscribedTo[s];n[o.hash]={},n[o.hash].permissions={};for(var r=0;r<o.permissions.length;r++){var c=o.permissions[r];n[o.hash].permissions[c]=!0,"write"===c&&a.push({hash:o.url,displayname:o.displayName})}}i.settings.subscriptionsWrite=a,i.settings.subscriptions=n,"timeline"===i.settings.activitySource&&a.length>0&&i.settings.writeContexts.push(a[0].hash),i.settings.disableConversations||(i.messaging.start(),t(window).on("beforeunload",function(t){return i.messaging.disconnect()}));var u="conversations"===i.settings.UISection,l="timeline"===i.settings.UISection,d=!1===i.settings.disableTimeline&&!l,m=!1===i.settings.disableConversations&&!u,p=i.width()-i.settings.scrollbarWidth,f="recent"===i.settings.activitySortView,h="likes"===i.settings.activitySortView,v="flagged"===i.settings.activitySortView,g={username:i.settings.username,literals:i.settings.literals,showMaxUIClass:u?"maxui-container-chat":"maxui-container-activity",showConversations:u?"display:block;":"display:none;",showConversationsToggle:m?"display:block;":"display:none;",showTimeline:l?"display:block;":"display:none;",showTimelineToggle:d?"display:block;":"display:none;",orderViewRecent:f?"active":"",orderViewLikes:h?"active":"",orderViewFlagged:v?"active":"",messagesStyle:"width:{0}px;left:{0}px;".format(p),hidePostboxChat:i.hidePostboxChat()},x=i.templates.mainUIChat.render(g);if(i.html(x),i.overlay=new max.views.MaxOverlay(i),i.settings.widgetWidth=i.width(),i.settings.sectionsWidth=i.settings.widgetWidth-i.settings.scrollbarWidth-i.settings.widgetBorder,i.settings.disableConversations||(i.conversations.render(),i.conversations.listview.load(e.talkingIn)),"conversations"===i.settings.UISection){i.bindEventsChat(),i.toggleSectionChat("conversations"),i.renderPostboxChat();var w=i.settings.literals.new_conversation_text;t("#maxuichat-widget-container #maxui-newactivity-box textarea").val(w).attr("data-literal",w)}else if("timeline"===i.settings.UISection){var y={recent:i.settings.activitySortOrder,likes:"likes",flagged:"flagged"};i.printActivitiesChat({sortBy:y[i.settings.activitySortView]},function(t){i.bindEventsChat()})}}),i},t.fn.bindEventsChat=function(){var e=this;t("#maxuichat-widget-container #maxui-more-activities .maxui-button").click(function(i){if(i.preventDefault(),t("#maxuichat-widget-container #maxui-search").hasClass("folded"))e.loadMoreActivitiesChat();else{var n=t(".maxui-activity:last").attr("id");e.reloadFiltersChat(n)}}),t("#maxuichat-widget-container #maxui-news-activities .maxui-button").click(function(t){e.loadNewsActivitiesChat()}),t("#maxuichat-widget-container #maxui-search-toggle").click(function(i){i.preventDefault(),t(this).hasClass("maxui-disabled")||(t("#maxuichat-widget-container #maxui-search").toggleClass("folded"),t("#maxuichat-widget-container #maxui-search").hasClass("folded")?e.printActivitiesChat({}):e.reloadFiltersChat())}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-commentaction",function(e){e.preventDefault(),window.status="",t(this).closest(".maxui-activity").find(".maxui-comments").toggle(200)}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-actor",function(i){i.preventDefault();var n=t(this).find(".maxui-username").text();e.addFilterChat({type:"actor",value:n}),t("#maxuichat-widget-container #maxui-search").toggleClass("folded",!1)}),t("#maxuichat-widget-container #maxui-search").on("click","#maxui-favorites-filter",function(i){i.preventDefault();var n=t(i.currentTarget),a=!n.hasClass("active"),s="",o="";a?(e.addFilterChat({type:"favorites",value:!0,visible:!1}),s=e.settings.literals.valued_favorited_activity,o=e.settings.literals.recent_favorited_activity):(e.delFilterChat({type:"favorites",value:!0}),s=e.settings.literals.valued_activity,o=e.settings.literals.recent_activity),n.toggleClass("active",a),t("#maxuichat-widget-container #maxui-activity-sort .maxui-most-recent").text(o),t("#maxuichat-widget-container #maxui-activity-sort .maxui-most-valued").text(s)}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-hashtag",function(i){i.preventDefault(),e.addFilterChat({type:"hashtag",value:t(this).attr("value")}),t("#maxuichat-widget-container #maxui-search").toggleClass("folded",!1)}),t("#maxuichat-widget-container #maxui-subscriptions").on("change",function(){var i=t("#maxuichat-widget-container #maxui-subscriptions :selected").val();if("timeline"!==i){e.settings.writeContexts=[],e.settings.writeContextsHashes=[],e.settings.writeContexts.push(i);for(var n=0;n<e.settings.writeContexts.length;n++)e.settings.writeContextsHashes.push(e.utils.sha1(e.settings.writeContexts[n]))}else e.settings.writeContexts=[],e.settings.writeContextsHashes=void 0}),t("#maxuichat-widget-container #maxui-search-filters").on("click",".maxui-close",function(i){i.preventDefault();var n=t(this.parentNode.parentNode);e.delFilterChat({type:n.attr("type"),value:n.attr("value")})}),t("#maxuichat-widget-container #maxui-new-participants").on("click",".maxui-close",function(i){i.preventDefault();var n=t(this.parentNode.parentNode);e.delPersonChat({username:n.attr("username")})}),t("#maxuichat-widget-container #maxui-new-displayName").on("keyup","input",function(t){t.preventDefault(),e.reloadPersonsChat()}),t("#maxuichat-widget-container #maxui-newactivity-chat").on("click",".maxui-prediction",function(e){e.preventDefault();var i=t(this),n=t("#maxuichat-widget-container #maxui-newactivity-box textarea"),a=t("#maxuichat-widget-container #maxui-newactivity-chat #maxui-predictive"),s=n.val(),o=new RegExp("^\\s*@([\\w\\.]+)"),r=s.replace(o,"@"+i.text()+" ");a.hide(),n.val(r),n.focus()}),t(document).on("click",function(e){t(".maxui-predictive").hide()}),t("#maxuichat-widget-container #maxui-conversation-predictive").on("click",".maxui-prediction",function(i){i.preventDefault();var n=t(this),a=t("#maxuichat-widget-container #maxui-add-people-box .maxui-text-input"),s=t("#maxuichat-widget-container #maxui-conversation-predictive"),o=n.attr("data-username"),r=n.attr("data-displayname");e.addPersonChat({username:o,displayName:r}),s.hide(),a.val("").focus()}),t("#maxuichat-widget-container #maxui-show-conversations").on("click",function(t){t.preventDefault(),window.status="",e.toggleSectionChat("conversations")}),t("#maxuichat-widget-container #maxui-show-timeline").on("click",function(t){t.preventDefault(),window.status="",e.printActivitiesChat({},function(t){e.toggleSectionChat("timeline")})}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-action.maxui-favorites",function(i){i.preventDefault();var n=t(this),a=t(this).closest(".maxui-activity").attr("id");n.hasClass("maxui-favorited")?e.maxClient.unfavoriteActivity(a,function(t){n.toggleClass("maxui-favorited",!1)}):e.maxClient.favoriteActivity(a,function(t){n.toggleClass("maxui-favorited",!0)})}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-action.maxui-likes",function(i){i.preventDefault();var n=t(this),a=t(this).closest(".maxui-activity").attr("id"),s=n.hasClass("maxui-liked"),o=n.children("strong");s?(e.maxClient.unlikeActivity(a,function(t){n.toggleClass("maxui-liked",!1)}),o.text(parseInt(o.text(),10)-1)):(e.maxClient.likeActivity(a,function(t){n.toggleClass("maxui-liked",!0)}),o.text(parseInt(o.text(),10)+1))}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-action.maxui-flag",function(i){i.preventDefault();var n=t(this),a=t(this).closest(".maxui-activity"),s=a.attr("id");n.hasClass("maxui-flagged")?e.maxClient.unflagActivity(s,function(t){n.toggleClass("maxui-flagged",!1),a.toggleClass("maxui-flagged",!1),e.printActivitiesChat({})}):e.maxClient.flagActivity(s,function(t){n.toggleClass("maxui-flagged",!0),a.toggleClass("maxui-flagged",!1),e.printActivitiesChat({})})}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-action.maxui-delete",function(e){e.preventDefault();var i=t(this).closest(".maxui-activity").find(".maxui-actions > .maxui-popover");i.is(":visible")?(i.animate({opacity:0},300),t(".maxui-popover").css({opacity:0}).hide()):(t(".maxui-popover").css({opacity:0}).hide(),i.show(),i.animate({opacity:1},300))}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-actions .maxui-button-cancel",function(e){e.preventDefault(),t(".maxui-popover:visible").css({opacity:0}).hide()}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-actions .maxui-button-delete",function(i){i.preventDefault();var n=t(this).closest(".maxui-activity"),a=n.attr("id");e.maxClient.removeActivity(a,function(e){var i=t(".maxui-popover:visible").animate({opacity:0},300);n.css({height:n.height(),"min-height":"auto"}),n.animate({height:0,opacity:0},100,function(t){n.remove(),i.hide()})})}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-delete-comment",function(e){e.preventDefault();var i=t(this).closest(".maxui-comment").find(".maxui-popover");i.is(":visible")?(i.animate({opacity:0},300),t(".maxui-popover").css({opacity:0}).hide()):(t(".maxui-popover").css({opacity:0}).hide(),i.show(),i.animate({opacity:1},300))}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-comment .maxui-button-cancel",function(e){e.preventDefault(),t(".maxui-popover").css({opacity:0}).hide()}),t("#maxuichat-widget-container #maxui-activities").on("click",".maxui-comment .maxui-button-delete",function(i){i.preventDefault();var n=t(this).closest(".maxui-comment"),a=n.closest(".maxui-activity"),s=a.attr("id"),o=n.attr("id");e.maxClient.removeActivityComment(s,o,function(){var e=t(".maxui-popover").animate({opacity:0},300);n.css({height:a.height(),"min-height":"auto"}),n.animate({height:0,opacity:0},100,function(t){n.remove(),e.hide()})})}),t("#maxuichat-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-recent",function(i){i.preventDefault();var n=t(this);n.hasClass("active")||(t("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),n.toggleClass("active",!0),e.printActivitiesChat({}))}),t("#maxuichat-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-valued",function(i){i.preventDefault();var n=t(this);n.hasClass("active")||(t("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),n.toggleClass("active",!0),e.printActivitiesChat({sortBy:"likes"}))}),t("#maxuichat-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-flagged",function(i){i.preventDefault();var n=t(this);n.hasClass("active")||(t("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),n.toggleClass("active",!0),e.printActivitiesChat({sortBy:"flagged"}))});var i=".maxui-text-input";t("#maxuichat-widget-container #maxui-add-people-box").on("focusin",i,function(i){i.preventDefault();var n=t(this).val(),a=t(this).attr("data-literal");e.utils.normalizeWhiteSpace(n,!1)===a&&t(this).val("")}).on("keydown",i,function(i){t("#maxuichat-widget-container #maxui-conversation-predictive:visible").length>0&&(40===i.which||38===i.which||13===i.which||9===i.which)&&e.utils.freezeEvent(i)}).on("keyup",i,function(i){i.preventDefault(),i.stopPropagation();var n=t(this).val();""===e.utils.normalizeWhiteSpace(n,!1)?(t(this).attr("class","maxui-empty maxui-text-input"),t(this).removeAttr("title")):e.settings.canwrite&&t(this).attr("class","maxui-text-input");var a=i.which,s=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*"),o=n.match(s),r=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*$"),c=n.match(r),u=t("#maxuichat-widget-container #maxui-conversation-predictive .maxui-prediction.selected"),l=t(this),d=t("#maxuichat-widget-container #maxui-conversation-predictive"),m=d.find(".maxui-prediction").length,p=t("#maxuichat-widget-container #maxui-conversation-predictive:visible").length>0;if(40===a&&p&&m>1){var f=u.next();u.removeClass("selected"),f.length>0?f.addClass("selected"):u.siblings(":first").addClass("selected")}else if(38===a&&p&&m>1){var h=u.prev();u.removeClass("selected"),h.length>0?h.addClass("selected"):u.siblings(":last").addClass("selected")}else if(27===a)d.hide();else if(13!==a&&9!==a||!p)"conversations"===e.settings.conversationsSection&&(o?(l.attr("class","maxui-text-input"),c&&(d.show(),d.html("<ul></ul>"),e.printPredictionsChat(o[1],"#maxui-conversation-predictive"))):(d.hide(),l.attr("class","maxui-empty maxui-text-input"),n.match(new RegExp("^\\s*@"))||(l.attr("class","maxui-text-input error"),l.attr("title",e.settings.literals.post_permission_not_here))));else{var v=u.attr("data-username"),g=u.attr("data-displayname");e.addPersonChat({username:v,displayName:g}),d.hide(),l.val("").focus()}}).on("focusout",i,function(i){i.preventDefault();var n=t(this).val(),a=t(this).attr("data-literal");""===e.utils.normalizeWhiteSpace(n,!1)&&t(this).val(a)}),e.bindActionBehaviourChat("#maxuichat-widget-container #maxui-newactivity-chat","#maxui-newactivity-box",{},function(i){if("timeline"===e.settings.UISection)e.sendActivityChat(i),t("#maxuichat-widget-container #maxui-search").toggleClass("folded",!0);else if("conversations"===e.settings.UISection)if("conversations"===e.settings.conversationsSection){for(var n=t("#maxuichat-widget-container #maxui-new-participants")[0],a=[],s=0;s<n.people.length;s++)a.push(n.people[s].username);var o={participants:a,message:t("#maxuichat-widget-container #maxui-newactivity-chat textarea").val()};if(a.length>1){var r=t("#maxuichat-widget-container #maxui-add-people-box #maxui-new-displayName input").val();o.displayName=r}e.conversations.create(o)}else e.conversations.send(i)},function(i,n,a,s){var o=s.which,r=new RegExp("^\\s*@([\\w\\.]+)\\s*"),c=i.match(r),u=new RegExp("^\\s*@([\\w\\.]+)\\s*$"),l=i.match(u),d=t("#maxuichat-widget-container #maxui-newactivity-chat .maxui-prediction.selected"),m=t(n),p=t("#maxuichat-widget-container #maxui-newactivity-chat #maxui-predictive"),f=p.find(".maxui-prediction").length,h=t("#maxuichat-widget-container #maxui-newactivity-chat #maxui-predictive:visible").length>0;if(40===o&&h&&f>1){var v=d.next();d.removeClass("selected"),v.length>0?v.addClass("selected"):d.siblings(":first").addClass("selected")}else if(38===o&&h&&f>1){var g=d.prev();d.removeClass("selected"),g.length>0?g.addClass("selected"):d.siblings(":last").addClass("selected")}else if(27===o)p.hide();else if(13!==o&&9!==o||!h)""===i?"timeline"===e.settings.UISection&&t(a).val(e.settings.literals.new_activity_post):"timeline"===e.settings.UISection?c?(t(a).val(e.settings.literals.new_message_post),l&&(p.show(),p.html("<ul></ul>"),e.printPredictionsChat(c[1],"#maxui-newactivity-chat #maxui-predictive")),t(a).removeAttr("disabled"),t(a).attr("class","maxui-button"),m.attr("class","maxui-text-input")):(t(a).val(e.settings.literals.new_activity_post),p.hide(),i.match(new RegExp("^\\s*@"))||e.settings.canwrite||(m.attr("class","maxui-text-input error"),m.attr("title",e.settings.literals.post_permission_unauthorized))):"conversations"===e.settings.UISection&&("conversations"===e.settings.conversationsSection?e.reloadPersonsChat():"messages"===e.settings.conversationsSection&&(p.hide(),t(a).removeAttr("disabled"),t(a).attr("class","maxui-button"),m.attr("class","maxui-text-input")));else{var x=new RegExp("^\\s*@([\\w\\.]+)"),w=i.replace(x,"@"+d.text()+" ");p.hide(),m.val(w).focus()}}),e.bindActionBehaviourChat("#maxuichat-widget-container #maxui-activities",".maxui-newcommentbox",{},function(i){var n=t(this).closest(".maxui-activity").attr("id");e.maxClient.addComment(i,n,function(){t("#maxuichat-widget-container #activityContainer textarea").val("");var i=this.object.inReplyTo[0].id;e.printCommentsForActivityChat(i),t("#maxuichat-widget-container #"+i+" .maxui-newcommentbox textarea").val(""),t("#maxuichat-widget-container #"+i+" .maxui-newcommentbox .maxui-button").attr("disabled","disabled")})}),e.bindActionBehaviourChat("#maxuichat-widget-container #maxui-search","#maxui-search-box",{},function(i){e.textSearchChat(i),t("#maxuichat-widget-container #maxui-search").toggleClass("folded",!1),t("#maxuichat-widget-container #maxui-search-text").val("")})},t.fn.bindActionBehaviourChat=function(e,i,n,a){var s=this,o=i+" .maxui-text-input",r=null;arguments.length>4&&(r=arguments[4]),t(e).on("focusin",o,function(e){e.preventDefault();var i=t(this).val(),n=t(this).attr("data-literal");s.utils.normalizeWhiteSpace(i,!1)===n&&t(this).val("")}).on("keydown",o,function(i){if(t(e+" #maxui-predictive:visible").length>0&&(40===i.which||38===i.which||13===i.which||9===i.which))s.utils.freezeEvent(i);else if(13===i.which&&!1===i.shiftKey&&!n.ignore_button){i.preventDefault();var o=t(this).parent().find(".maxui-text-input"),r=o.attr("data-literal"),c=o.val(),u=s.utils.normalizeWhiteSpace(c,!1);u!==r&""!==u&&a.apply(this,[c])}}).on("keyup",o,function(e){e.preventDefault(),e.stopPropagation();var i=t(this).val(),a=t(this).parent().parent().find(".maxui-button");""!==s.utils.normalizeWhiteSpace(i,!1)||n.ignore_button?s.settings.canwrite&&!n.ignore_button&&(t(a).removeAttr("disabled"),t(a).attr("class","maxui-button"),t(this).attr("class","maxui-text-input")):(t(a).attr("disabled","disabled"),t(a).attr("class","maxui-button maxui-disabled"),t(this).attr("class","maxui-empty maxui-text-input"),t(this).removeAttr("title"),t(".maxui-error-box").width(t(this).width()-4),t(".maxui-error-box").animate({bottom:0},200)),null!==r&&r(i,this,a,e)}).on("paste",o,function(e){var i=t(this).parent().parent().find(".maxui-button");s.settings.canwrite&&!n.ignore_button&&(t(i).removeAttr("disabled"),t(i).attr("class","maxui-button"),t(this).attr("class","maxui-text-input"));var a=t(this).val();null!==r&&r(a,this,i,e)}).on("focusout",o,function(e){e.preventDefault();var i=t(this).val(),n=t(this).attr("data-literal");""===s.utils.normalizeWhiteSpace(i,!1)&&t(this).val(n)}).on("click",i+" .maxui-button",function(e){e.preventDefault();var i=t(this).parent().find(".maxui-text-input"),o=i.attr("data-literal"),r=i.val(),c=s.utils.normalizeWhiteSpace(r,!1);(c!==o&""!==c||n.empty_click)&&a.apply(this,[r])})},t.fn.textSearchChat=function(t){for(var e=this.utils.normalizeWhiteSpace(t).split(" "),i=0;i<e.length;i++){var n="keyword",a=e[i];switch(a[0]){case"#":n="hashtag",a=a.substr(1);break;case"@":n="actor",a=a.substr(1);break;default:n="keyword"}a.length>=3&&this.addFilterChat({type:n,value:a},!1)}this.reloadFiltersChat()},t.fn.getFiltersChat=function(){var t={filters:this.filters};void 0===t.filters&&(t.filters=[]);for(var e={},i=!1,n=0;n<t.filters.length;n++){var a=t.filters[n];a.visible&&(i=!0),e[a.type]||(e[a.type]=[]),e[a.type].push(a.value)}return arguments.length>0&&(e.before=arguments[0]),{filters:e,visible:i}},t.fn.reloadFiltersChat=function(){var e,i=this,n={filters:i.filters},a=i.templates.filters.render(n);t("#maxuichat-widget-container #maxui-search-filters").html(a),e=arguments.length>0?i.getFiltersChat(arguments[0]):i.getFiltersChat(),i.printActivitiesChat({}),t("#maxuichat-widget-container #maxui-search").toggleClass("folded",!e.visible)},t.fn.delFilterChat=function(t){for(var e=!1,i=0;i<this.filters.length;i++)this.filters[i].value===t.value&this.filters[i].type===t.type&&(e=!0,this.filters.splice(i,1));e&&this.reloadFiltersChat()},t.fn.addFilterChat=function(t){var e=this,i=!0;switch(arguments.length>1&&(i=arguments[1]),e.filters||(e.filters=[]),t.hasOwnProperty("visible")||(t.visible=!0),t.type){case"hashtag":t.prepend="#";break;case"actor":t.prepend="@";break;default:t.prepend=""}for(var n=!1,a=0;a<e.filters.length;a++)e.filters[a].value===t.value&e.filters[a].type===t.type&&(n=!0);n||(e.filters.push(t),!0===i&&this.reloadFiltersChat())},t.fn.reloadPersonsChat=function(){var e=this,i=t("#maxuichat-widget-container #maxui-new-participants"),n=i[0];n.people||(n.people=[]);var a=t("#maxuichat-widget-container #maxui-newactivity-chat input.maxui-button"),s=t("#maxuichat-widget-container #maxui-newactivity-chat"),o=s.find("textarea").val(),r=s.find("textarea").attr("data-literal");o=e.utils.normalizeWhiteSpace(o);var c=t("#maxuichat-widget-container #maxui-add-people-box #maxui-new-displayName"),u=c.find("input").val();u=e.utils.normalizeWhiteSpace(u);var l={persons:n.people},d=e.templates.participants.render(l);(t("#maxuichat-widget-container #maxui-new-participants").html(d),t("#maxuichat-widget-container #maxui-add-people-box .maxui-label .maxui-count").text("({0}/{1})".format(n.people.length+1,e.settings.maximumConversations)),n.people.length>0)?(n.people.length>1&&!(""!==u)?(a.attr("disabled","disabled"),a.attr("class","maxui-button maxui-disabled"),""===u&&(s.find("textarea").attr("class","maxui-text-input error"),s.find(".maxui-error-box").text(e.settings.literals.post_permission_missing_displayName),s.find(".maxui-error-box").width(s.find("textarea").width()-4),s.find(".maxui-error-box").animate({bottom:-25},200))):(a.removeAttr("disabled"),a.attr("class","maxui-button"),s.find("textarea").attr("class","maxui-text-input"),s.find(".maxui-error-box").width(s.find("textarea").width()-4),s.find(".maxui-error-box").animate({bottom:0},200)),i.show(),s.show(),n.people.length>1?c.show():(c.hide(),c.find("#maxuichat-widget-container .maxui-text-input").val(""))):""!==o&&o!==r&&(a.attr("disabled","disabled"),a.attr("class","maxui-button maxui-disabled"),i.hide(),s.find("textarea").attr("class","maxui-text-input error"),s.find(".maxui-error-box").text(e.settings.literals.post_permission_not_enough_participants),s.find(".maxui-error-box").width(s.find("textarea").width()-4),s.find(".maxui-error-box").animate({bottom:-25},200),c.hide(),c.find("#maxuichat-widget-container .maxui-text-input").val(""))},t.fn.delPersonChat=function(e){for(var i=!1,n=t("#maxuichat-widget-container #maxui-new-participants")[0],a=0;a<n.people.length;a++)n.people[a].username===e.username&&(i=!0,n.people.splice(a,1));i&&this.reloadPersonsChat()},t.fn.addPersonChat=function(e){var i=t("#maxuichat-widget-container #maxui-new-participants")[0],n=!0;arguments.length>1&&(n=arguments[1]);var a=!1;if(i.people||(i.people=[]),e.username!==this.settings.username&&i.people.length<this.settings.maximumConversations-1){for(var s=0;s<i.people.length;s++)i.people[s].username===e.username&&(a=!0);a||(i.people.push(e),!0===n&&this.reloadPersonsChat())}},t.fn.toggleSectionChat=function(e){var i,n=this,a=t("#maxuichat-widget-container #maxui-search"),s=t("#maxuichat-widget-container #maxui-activity-sort"),o=t("#maxuichat-widget-container #maxui-timeline"),r=t("#maxuichat-widget-container #maxui-timeline .maxui-wrapper"),c=t("#maxuichat-widget-container #maxui-conversations"),u=t("#maxuichat-widget-container #maxui-common-header"),l=c.find("input#add-user-input"),d=t("#maxuichat-widget-container #maxui-conversations #maxui-conversations-list"),m=t("#maxuichat-widget-container #maxui-conversations .maxui-wrapper"),p=t("#maxuichat-widget-container #maxui-newactivity-box .maxui-button"),f=t("#maxuichat-widget-container #maxui-newactivity-box #maxui-subscriptions"),h=t("#maxuichat-widget-container #maxui-newactivity-chat"),v=t("#maxuichat-widget-container #maxui-newactivity-box textarea"),g=t("#maxuichat-widget-container #maxui-show-conversations"),x=t("#maxuichat-widget-container #maxui-show-timeline"),w=t("#maxuichat-widget-container #maxui-add-people-box"),y=n.width()-n.conversations.scrollbar.width-20-2;if("conversations"===e&&"conversations"===n.settings.currentConversationSection&&(f.attr("style","display:none;"),c.show(),u.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),w.show(),l.focus(),c.animate({height:320},400,function(t){m.height(320)}),d.width(y),o.animate({height:0},400),a.hide(400),s.hide(400),n.settings.UISection="conversations",p.val(n.settings.literals.new_message_post),i=n.settings.literals.new_conversation_text,v.val(i).attr("data-literal",i),g.hide(),n.settings.disableTimeline||x.show(),n.conversations.scrollbar.setHeight(275),n.conversations.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),h.show()),"timeline"===e){!0===n.settings.showSubscriptionList&&f.attr("style","display:inline;"),n.conversations.listview.toggle(),o.show();var b=r.height();o.animate({height:b},400,function(t){o.css("height","")}),c.animate({height:0},400,function(t){c.hide(),w.hide()}),a.show(400),s.show(400),n.settings.UISection="timeline",p.val(n.settings.literals.new_activity_post),i=n.settings.literals.new_activity_text,v.val(i).attr("data-literal",i),n.settings.disableConversations||g.show(),x.hide(),n.settings.hidePostboxChatOnTimeline&&h.hide(),n.hidePostboxChat()&&h.hide()}},t.fn.settings=function(){return this.settings},t.fn.sendActivityChat=function(){var e=this,i=t("#maxuichat-widget-container #maxui-newactivity-chat textarea").val(),n=[];t("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),t("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-recent").toggleClass("active",!0),n.push(i),n.push(e.settings.writeContexts),n.push(function(){t("#maxuichat-widget-container #maxui-newactivity-chat textarea").val(""),t("#maxuichat-widget-container #maxui-newactivity-chat .maxui-button").attr("disabled","disabled");var i=t("#maxuichat-widget-container .maxui-activity:first");if(i.length>0){var n={after:i.attr("id")};e.printActivitiesChat(n)}else e.printActivitiesChat({})}),e.settings.generatorName&&n.push(e.settings.generatorName),e.maxClient.addActivity.apply(e.maxClient,n),t("#maxui-subscriptions option:first-child").attr("selected","selected")},t.fn.loadMoreActivitiesChat=function(){var e=t("#maxuichat-widget-container .maxui-activity:last").attr("id");t("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-recent").hasClass("active")&&t("#"+e+" .maxui-comment").length>0&&(e=t("#"+e+" .maxui-comment:last").attr("id"));var i={before:e};this.printActivitiesChat(i)},t.fn.loadNewsActivitiesChat=function(){this.printActivitiesChat()},t.fn.printPredictionsChat=function(t,e){var i=this,n=[];n.push(t),n.push(function(t){i.formatPredictionsChat(t,e)}),this.maxClient.getUsersList.apply(this.maxClient,n)},t.fn.formatPredictionsChat=function(e,i){for(var n="",a=0;a<e.length;a++){var s=e[a];if(s.username!==this.username){var o=this.settings.avatarURLpattern.format(s.username),r={username:s.username,displayName:s.displayName,avatarURL:o,cssclass:"maxui-prediction"+(0===a?" selected":"")};n+=this.templates.predictive.render(r)}}(""===n&&(n="<li>"+this.settings.literals.no_match_found+"</li>"),t(i+" ul").html(n),arguments.length>2)&&(0,arguments[2])()},t.fn.canCommentActivityChat=function(t){for(var e in this.settings.subscriptionsWrite){if(this.settings.subscriptionsWrite[e].hash===t)return!0}return!1},t.fn.formatActivitiesChat=function(e,i){for(var n=this,a="",s=[],o=0;o<e.length;o++){var r=e[o],c=null;r.hasOwnProperty("contexts")&&r.contexts.length>0&&(c=r.contexts[0]);var u=null;r.hasOwnProperty("generator")&&r.generator!==n.settings.generatorName&&(u=r.generator);var l="";"person"===r.actor.objectType?l=n.settings.avatarURLpattern.format(r.actor.username):"context"===r.actor.objectType&&(l=n.settings.contextAvatarURLpattern.format(r.actor.hash));var d=[],m="";if(r.replies&&r.replies.length>0){for(var p=0;p<r.replies.length;p++){var f=r.replies[p],h={id:f.id,actor:f.actor,date:n.utils.formatDate(f.published,n.language),text:n.utils.formatText(f.content),avatarURL:n.settings.avatarURLpattern.format(f.actor.username),canDeleteComment:f.deletable,literals:n.settings.literals};d.push(h)}m="Comentat "+d[d.length-1].date}_.defaults(r.object,{filename:r.id});var v=n.settings.canwrite;r.contexts&&(v=n.canCommentActivityChat(r.contexts[0].url));var g={id:r.id,actor:r.actor,auth:{token:n.settings.oAuthToken,username:n.settings.username},literals:n.settings.literals,date:n.utils.formatDate(r.published,n.language),dateLastComment:m,text:n.utils.formatText(r.object.content),replies:d,favorited:r.favorited,likes:r.likesCount?r.likesCount:0,showLikesCount:"likes"===n.currentSortOrder,liked:r.liked,flagged:r.flagged,avatarURL:l,publishedIn:c,canDeleteActivity:r.deletable,canFlagActivity:n.settings.canflag,via:u,fileDownload:"file"===r.object.objectType,filename:r.object.filename,canViewComments:v||r.replies.length>0,canWriteComment:v},x={comment:n.templates.comment};a+=n.templates.activity.render(g,x),"image"===r.object.objectType&&s.push(r)}if("beggining"===i){t("#maxuichat-widget-container #maxui-preload .maxui-wrapper").prepend(a);var w=t("#maxuichat-widget-container #maxui-preload .maxui-wrapper .maxui-activity"),y=0;for(o=0;o<w.length;o++)y+=t(w[o]).height()+18;var b=t("#maxuichat-widget-container #maxui-preload").height();t("#maxuichat-widget-container #maxui-preload").height(y-b),t("#maxuichat-widget-container #maxui-preload").css({"margin-top":-1*(y-b)}),t("#maxuichat-widget-container #maxui-preload").animate({"margin-top":0},200,function(){t("#maxuichat-widget-container #maxui-preload .maxui-wrapper").html(""),t("#maxuichat-widget-container #maxui-activities").prepend(a),t("#maxuichat-widget-container #maxui-preload").height(0)})}else"end"===i?t("#maxuichat-widget-container #maxui-activities").append(a):t("#maxuichat-widget-container #maxui-activities").html(a);arguments.length>2&&arguments[2].call(),_.each(s,function(e,i,a){n.maxClient.getMessageImage("/activities/{0}/image/thumb".format(e.id),function(i){var n='<img class="maxui-embedded" alt="" src="data:image/png;base64,{0}" />'.format(i);t(".maxui-activity#{0} .maxui-activity-message .maxui-body".format(e.id)).after(n)})})},t.fn.formatCommentChat=function(e,i){for(var n=this,a="",s=0;s<e.length;s++){var o=e[s],r={literals:n.settings.literals,id:o.id,actor:o.actor,date:n.utils.formatDate(o.published,n.language),text:n.utils.formatText(o.content),avatarURL:n.settings.avatarURLpattern.format(o.actor.username),canDeleteComment:o.deletable};a+=n.templates.comment.render(r)}t(".maxui-activity#"+i+" .maxui-commentsbox").html(a);var c=t(".maxui-activity#"+i+" .maxui-commentaction strong");t(c).text(parseInt(t(c).text(),10)+1)},t.fn.renderPostboxChat=function(){var e=this,i="conversations"===e.settings.UISection,n=!1===e.settings.disableConversations&&!i,a={avatar:e.settings.avatarURLpattern.format(e.settings.username),allowPosting:e.settings.canwrite,buttonLiteral:e.settings.literals.new_activity_post,textLiteral:e.settings.literals.new_activity_text,literals:e.settings.literals,showConversationsToggle:n?"display:block;":"display:none;",showSubscriptionList:e.settings.showSubscriptionList&&e.settings.subscriptionsWrite.length>0,subscriptionList:e.settings.subscriptionsWrite},s=e.templates.postBoxChat.render(a);t("#maxuichat-widget-container #maxui-newactivity-chat").html(s)},t.fn.printActivitiesChat=function(e){var i=this,n=[],a="replace",s=i.getFiltersChat().filters;t.extend(s,e),s.before&&(a="end"),s.after&&(a="beggining"),s.sortBy||(t("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-valued").hasClass("active")?s.sortBy="likes":t("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.maxui-flagged").hasClass("active")?s.sortBy="flagged":s.sortBy=i.settings.activitySortOrder),i.currentSortOrder=s.sortBy;var o=null;if("timeline"===i.settings.activitySource)o=this.maxClient.getUserTimeline,n.push(i.settings.username);else if("activities"===i.settings.activitySource){o=this.maxClient.getActivities;var r={context:i.settings.readContextHash,tags:i.settings.contextTagsFilter};n.push(r)}if(arguments.length>1){var c=arguments[1];n.push(function(t){i.settings.canwrite=!0,"activities"===i.settings.activitySource?i.maxClient.getContext(i.settings.readContextHash,function(e){var n=i.settings.subscriptions;n[e.hash]||(n[e.hash]={},n[e.hash].permissions={},n[e.hash].permissions.read="public"===e.permissions.read,n[e.hash].permissions.write="public"===e.permissions.write);for(var s=0;s<i.settings.writeContexts.length;s++){var o=i.settings.writeContextsHashes[s];n[o].permissions?(!0!==n[o].permissions.write&&(i.settings.canwrite=!1),!0===n[o].permissions.flag?i.settings.canflag=!0:i.settings.canflag=!1):(i.settings.canwrite=!1,i.settings.canflag=!1)}i.renderPostboxChat(),i.formatActivitiesChat(t,a,c)}):(i.renderPostboxChat(t,a,c),i.formatActivitiesChat(t,a,c))})}else n.push(function(t){i.formatActivitiesChat(t,a)});n.push(s),o.apply(this.maxClient,n)},t.fn.printCommentsForActivityChat=function(t){var e=this,i=[];i.push(t),i.push(function(i){e.formatCommentChat(i,t)}),this.maxClient.getCommentsForActivity.apply(this.maxClient,i)},t.maxui=function(){},t.maxui.settings=function(){return this.settings}}(jQuery),window.setTimeout(function(){window._MAXUI_Chat&&window._MAXUI_Chat.onReady&&!window._MAXUI_Chat.hasRun&&(window._MAXUI_Chat.hasRun=!0,_MAXUI_Chat.onReady())},0);
//# sourceMappingURL=maxuichat.min.js.map
/*! max.ui5.js - v5.0.13 - 2019-11-05 */
var Hogan={},uuid;!function(e,t){e.Template=function(e,t,i,n){this.r=e||this.r,this.c=i,this.options=n,this.text=t||"",this.buf=""},e.Template.prototype={r:function(e,t,i){return""},v:function(e){return e=c(e),o.test(e)?e.replace(i,"&amp;").replace(n,"&lt;").replace(a,"&gt;").replace(s,"&#39;").replace(r,"&quot;"):e},t:c,render:function(e,t,i){return this.ri([e],t||{},i)},ri:function(e,t,i){return this.r(e,t,i)},rp:function(e,t,i,n){var a=i[e];return a?(this.c&&"string"==typeof a&&(a=this.c.compile(a,this.options)),a.ri(t,i,n)):""},rs:function(e,t,i){var n=e[e.length-1];if(u(n))for(var a=0;a<n.length;a++)e.push(n[a]),i(e,t,this),e.pop();else i(e,t,this)},s:function(e,t,i,n,a,s,r){var o;return(!u(e)||0!==e.length)&&("function"==typeof e&&(e=this.ls(e,t,i,n,a,s,r)),o=""===e||!!e,!n&&o&&t&&t.push("object"==typeof e?e:t[t.length-1]),o)},d:function(e,t,i,n){var a=e.split("."),s=this.f(a[0],t,i,n),r=null;if("."===e&&u(t[t.length-2]))return t[t.length-1];for(var o=1;o<a.length;o++)s=s&&"object"==typeof s&&a[o]in s?(r=s)[a[o]]:"";return!(n&&!s)&&(n||"function"!=typeof s||(t.push(r),s=this.lv(s,t,i),t.pop()),s)},f:function(e,t,i,n){for(var a=!1,s=null,r=!1,o=t.length-1;0<=o;o--)if((s=t[o])&&"object"==typeof s&&e in s){a=s[e],r=!0;break}return r?(n||"function"!=typeof a||(a=this.lv(a,t,i)),a):!n&&""},ho:function(e,t,i,n,a){var s=this.c,r=this.options;return r.delimiters=a,n=null==(n=e.call(t,n))?String(n):n.toString(),this.b(s.compile(n,r).render(t,i)),!1},b:function(e){this.buf+=e},fl:function(){var e=this.buf;return this.buf="",e},ls:function(e,t,i,n,a,s,r){var o,c=t[t.length-1];if(!n&&this.c&&0<e.length)return this.ho(e,c,i,this.text.substring(a,s),r);if("function"==typeof(o=e.call(c))){if(n)return!0;if(this.c)return this.ho(o,c,i,this.text.substring(a,s),r)}return o},lv:function(e,t,i){var n=t[t.length-1],a=e.call(n);return"function"==typeof a&&(a=c(a.call(n)),this.c&&~a.indexOf("{{"))?this.c.compile(a,this.options).render(n,i):c(a)}};var i=/&/g,n=/</g,a=/>/g,s=/\'/g,r=/\"/g,o=/[&<>\"\']/;function c(e){return String(null==e?"":e)}var u=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}}("undefined"!=typeof exports?exports:Hogan),function(a){var y=/\S/,t=/\"/g,i=/\n/g,n=/\r/g,s=/\\/g,_={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};function b(e){"}"===e.n.substr(e.n.length-1)&&(e.n=e.n.substring(0,e.n.length-1))}function C(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function S(e,t,i){if(t.charAt(i)!=e.charAt(0))return!1;for(var n=1,a=e.length;n<a;n++)if(t.charAt(i+n)!=e.charAt(n))return!1;return!0}function c(e,t){for(var i=0,n=t.length;i<n;i++)if(t[i].o==e.n)return e.tag="#",!0}function u(e,t,i){for(var n=0,a=i.length;n<a;n++)if(i[n].c==e&&i[n].o==t)return!0}function v(e){return e.replace(s,"\\\\").replace(t,'\\"').replace(i,"\\n").replace(n,"\\r")}function g(e){return~e.indexOf(".")?"d":"f"}function x(e){for(var t,i,n,a,s,r,o,c,u,l,d,m="",p=0,f=e.length;p<f;p++){var h=e[p].tag;"#"==h?m+=(r=e[p].nodes,o=e[p].n,c=g(e[p].n),u=e[p].i,l=e[p].end,d=e[p].otag+" "+e[p].ctag,"if(_.s(_."+c+'("'+v(o)+'",c,p,1),c,p,0,'+u+","+l+',"'+d+'")){_.rs(c,p,function(c,p,_){'+x(r)+"});c.pop();}"):"^"==h?m+=(a=e[p].nodes,s=e[p].n,"if(!_.s(_."+g(e[p].n)+'("'+v(s)+'",c,p,1),c,p,1,0,0,"")){'+x(a)+"};"):"<"==h||">"==h?m+='_.b(_.rp("'+v((n=e[p]).n)+'",c,p,"'+(n.indent||"")+'"));':"{"==h||"&"==h?m+=(i=e[p].n,"_.b(_.t(_."+g(e[p].n)+'("'+v(i)+'",c,p,0)));'):"\n"==h?m+=w('"\\n"'+(e.length-1==p?"":" + i")):"_v"==h?m+=(t=e[p].n,"_.b(_.v(_."+g(e[p].n)+'("'+v(t)+'",c,p,0)));'):void 0===h&&(m+=w('"'+v(e[p])+'"'))}return m}function w(e){return"_.b("+e+");"}a.scan=function(e,t){var i,n,a,s,r,o=e.length,c=0,u=null,l=null,d="",m=[],p=!1,f=0,h=0,v="{{",g="}}";function x(){0<d.length&&(m.push(new String(d)),d="")}function w(e,t){if(x(),e&&function(){for(var e=!0,t=h;t<m.length;t++)if(!(e=m[t].tag&&_[m[t].tag]<_._v||!m[t].tag&&null===m[t].match(y)))return!1;return e}())for(var i,n=h;n<m.length;n++)m[n].tag||((i=m[n+1])&&">"==i.tag&&(i.indent=m[n].toString()),m.splice(n,1));else t||m.push({tag:"\n"});p=!1,h=m.length}for(t&&(t=t.split(" "),v=t[0],g=t[1]),f=0;f<o;f++)0==c?S(v,e,f)?(--f,x(),c=1):"\n"==e.charAt(f)?w(p):d+=e.charAt(f):1==c?(f+=v.length-1,c="="==(u=(l=_[e.charAt(f+1)])?e.charAt(f+1):"_v")?(n=f,void 0,a="="+g,s=(i=e).indexOf(a,n),r=C(i.substring(i.indexOf("=",n)+1,s)).split(" "),v=r[0],g=r[1],f=s+a.length-1,0):(l&&f++,2),p=f):S(g,e,f)?(m.push({tag:u,n:C(d),otag:v,ctag:g,i:"/"==u?p-g.length:f+v.length}),d="",f+=g.length-1,c=0,"{"==u&&("}}"==g?f++:b(m[m.length-1]))):d+=e.charAt(f);return w(p,!0),m},a.generate=function(e,t,i){var n='var _=this;_.b(i=i||"");'+x(e)+"return _.fl();";return i.asString?"function(c,p,i){"+n+";}":new a.Template(new Function("c","p","i",n),t,a,i)},a.parse=function(e,t,i){return function e(t,i,n,a){for(var s=[],r=null,o=null;0<t.length;)if("#"==(o=t.shift()).tag||"^"==o.tag||c(o,a))n.push(o),o.nodes=e(t,o.tag,n,a),s.push(o);else{if("/"==o.tag){if(0===n.length)throw new Error("Closing tag without opener: /"+o.n);if(r=n.pop(),o.n!=r.n&&!u(o.n,r.n,a))throw new Error("Nesting error: "+r.n+" vs. "+o.n);return r.end=o.i,s}s.push(o)}if(0<n.length)throw new Error("missing closing tag: "+n.pop().n);return s}(e,0,[],(i=i||{}).sectionTags||[])},a.cache={},a.compile=function(e,t){var i=e+"||"+!!(t=t||{}).asString,n=this.cache[i];return n||(n=this.generate(this.parse(this.scan(e,t.delimiters),e,t),e,t),this.cache[i]=n)}}("undefined"!=typeof exports?exports:Hogan),function(c){c.easydate={},c.easydate.locales={},c.easydate.locales.en={future_format:"%s %t",past_format:"%t %s",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years",yesterday:"yesterday",tomorrow:"tomorrow",now:"just now",ago:"ago",in:"in"},c.easydate.locales.ca={future_format:"%s %t",past_format:"%s %t",second:"segon",seconds:"segons",minute:"minut",minutes:"minuts",hour:"hora",hours:"hores",day:"dia",days:"dies",week:"setmana",weeks:"setmanes",month:"mes",months:"mesos",year:"any",years:"anys",yesterday:"ahir",tomorrow:"demà",now:"fa un moment",ago:"fa",in:"en"},c.easydate.locales.es={future_format:"%s %t",past_format:"%s %t",second:"segundo",seconds:"segundos",minute:"minuto",minutes:"minutos",hour:"hora",hours:"horas",day:"dia",days:"dias",week:"semana",weeks:"semanas",month:"mes",months:"meses",year:"año",years:"años",yesterday:"ayer",tomorrow:"mañana",now:"hace un instante",ago:"hace",in:"en"};var u={live:!0,set_title:!0,format_future:!0,format_past:!0,units:[{name:"now",limit:5},{name:"second",limit:60,in_seconds:1},{name:"minute",limit:3600,in_seconds:60},{name:"hour",limit:86400,in_seconds:3600},{name:"yesterday",limit:172800,past_only:!0},{name:"tomorrow",limit:172800,future_only:!0},{name:"day",limit:604800,in_seconds:86400},{name:"week",limit:2629743,in_seconds:604800},{name:"month",limit:31556926,in_seconds:2629743},{name:"year",limit:1/0,in_seconds:31556926}],uneasy_format:function(e){return e.toLocaleDateString()},locale:c.easydate.locales.en};function l(e,t,i){return isNaN(t)||1==t||(e+="s"),i.locale[e]||e}c.easydate.format_date=function(e,t){var i=c.extend({},u);i.locale=c.easydate.locales[t];var n=((new Date).getTime()-e.getTime())/1e3,a=Math.abs(n);if(!isNaN(n)&&!(!i.format_future&&n<0||!i.format_past&&0<n)){for(var s in i.units){var r=i.units[s];if(!(r.past_only&&n<0||r.future_only&&0<n)&&a<r.limit){if(isNaN(r.in_seconds))return l(r.name,NaN,i);var o=a/r.in_seconds;return o=Math.round(o),(n<0?l("future_format",NaN,i).replace("%s",l("in",NaN,i)):l("past_format",NaN,i).replace("%s",l("ago",NaN,i))).replace("%t",o+" "+l(r.name,o,i))}}return i.uneasy_format(e)}}}(jQuery),function(e){var t;e.ajaxSettings.xdr=function(){return window.XDomainRequest?new window.XDomainRequest:null},t=e.ajaxSettings.xdr(),e.extend(e.support,{iecors:!!t}),e.support.iecors&&e.ajaxTransport(function(i){var n=i.xdr();return{send:function(e,t){n.onload=function(){var e={"Content-Type":n.contentType};t(200,"OK",{text:n.responseText},e)},i.xhrFields&&(xhr.onerror=i.xhrFields.error,xhr.ontimeout=i.xhrFields.timeout),n.open(i.type,i.url),n.send(i.hasContent&&i.data||null)},abort:function(){n.abort()}}})}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(u){var l,d,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],t="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],m=Array.prototype.slice;if(u.event.fixHooks)for(var i=e.length;i;)u.event.fixHooks[e[--i]]=u.event.mouseHooks;var n=u.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],a,!1);else this.onmousewheel=a;u.data(this,"mousewheel-line-height",n.getLineHeight(this)),u.data(this,"mousewheel-page-height",n.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],a,!1);else this.onmousewheel=null},getLineHeight:function(e){return parseInt(u(e)["offsetParent"in u.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(e){return u(e).height()},settings:{adjustOldDeltas:!0}};function a(e){var t,i=e||window.event,n=m.call(arguments,1),a=0,s=0,r=0;if((e=u.event.fix(i)).type="mousewheel","detail"in i&&(r=-1*i.detail),"wheelDelta"in i&&(r=i.wheelDelta),"wheelDeltaY"in i&&(r=i.wheelDeltaY),"wheelDeltaX"in i&&(s=-1*i.wheelDeltaX),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(s=-1*r,r=0),a=0===r?s:r,"deltaY"in i&&(a=r=-1*i.deltaY),"deltaX"in i&&(s=i.deltaX,0===r&&(a=-1*s)),0!==r||0!==s){if(1===i.deltaMode){var o=u.data(this,"mousewheel-line-height");a*=o,r*=o,s*=o}else if(2===i.deltaMode){var c=u.data(this,"mousewheel-page-height");a*=c,r*=c,s*=c}return t=Math.max(Math.abs(r),Math.abs(s)),(!d||t<d)&&f(i,d=t)&&(d/=40),f(i,t)&&(a/=40,s/=40,r/=40),a=Math[1<=a?"floor":"ceil"](a/d),s=Math[1<=s?"floor":"ceil"](s/d),r=Math[1<=r?"floor":"ceil"](r/d),e.deltaX=s,e.deltaY=r,e.deltaFactor=d,e.deltaMode=0,n.unshift(e,a,s,r),l&&clearTimeout(l),l=setTimeout(p,200),(u.event.dispatch||u.event.handle).apply(this,n)}}function p(){d=null}function f(e,t){return n.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}u.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}var cx,escapable,gap,indent,meta,rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,a,s,r,o=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,i=0;i<s;i+=1)r[i]=str(i,c)||"null";return a=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+o+"]":"["+r.join(",")+"]",gap=o,a}if(rep&&"object"==typeof rep)for(s=rep.length,i=0;i<s;i+=1)"string"==typeof rep[i]&&(a=str(n=rep[i],c))&&r.push(quote(n)+(gap?": ":":")+a);else for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(a=str(n,c))&&r.push(quote(n)+(gap?": ":":")+a);return a=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+o+"}":"{"+r.join(",")+"}",gap=o,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}),"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,i){var n;if(indent=gap="","number"==typeof i)for(n=0;n<i;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if((rep=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){var j;function walk(e,t){var i,n,a=e[t];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(void 0!==(n=walk(a,i))?a[i]=n:delete a[i]);return reviver.call(e,t,a)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var l=document,d=window,m={},e=function(){};e.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var i=this._listeners[e];-1===m.arrIndexOf(i,t)&&i.push(t)},e.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var i=this._listeners[e],n=m.arrIndexOf(i,t);-1===n||(1<i.length?this._listeners[e]=i.slice(0,n).concat(i.slice(n+1)):delete this._listeners[e])}},e.prototype.dispatchEvent=function(e){var t=e.type,i=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,i),this._listeners&&t in this._listeners)for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].apply(this,i)};var o=function(e,t){if(this.type=e,void 0!==t)for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])};o.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var i=this[t];"function"==typeof i&&(i="[function]"),e.push(t+"="+i)}return"SimpleEvent("+e.join(", ")+")"};var t=function(e){this._events=e||[],this._listeners={}};t.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var i=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,i),e in t._listeners)for(var n=0;n<t._listeners[e].length;n++)t._listeners[e][n].apply(t,i)}},t.prototype.on=function(e,t){var i=this;i._verifyType(e),i._nuked||(e in i._listeners||(i._listeners[e]=[]),i._listeners[e].push(t))},t.prototype._verifyType=function(e){-1===m.arrIndexOf(this._events,e)&&m.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(this._events)+" in "+this)},t.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var a="abcdefghijklmnopqrstuvwxyz0123456789_";m.random_string=function(e,t){t=t||a.length;var i,n=[];for(i=0;i<e;i++)n.push(a.substr(Math.floor(Math.random()*t),1));return n.join("")},m.random_number=function(e){return Math.floor(Math.random()*e)},m.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+m.random_number(e)).slice(-t)},m.getOrigin=function(e){return(e+="/").split("/").slice(0,3).join("/")},m.isSameOriginUrl=function(e,t){return t||(t=d.location.href),e.split("/").slice(0,3).join("/")===t.split("/").slice(0,3).join("/")},m.getParentDomain=function(e){return/^[0-9.]*$/.test(e)?e:/^\[/.test(e)?e:/[.]/.test(e)?e.split(".").slice(1).join("."):e},m.objectExtend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e};var i="_jp";m.polluteGlobalNamespace=function(){i in d||(d._jp={})},m.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},m.userSetCode=function(e){return 1e3===e||3e3<=e&&e<=4999},m.countRTO=function(e){return 100<e?3*e:e+200},m.log=function(){d.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},m.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},m.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},m.amendUrl=function(e){var t=l.location;if(!e)throw new Error("Wrong url for SockJS");if(!m.flatUrl(e))throw new Error("Only basic urls are supported in SockJS");return 0===e.indexOf("//")&&(e=t.protocol+e),0===e.indexOf("/")&&(e=t.protocol+"//"+t.host+e),e=e.replace(/[/]+$/,"")},m.arrIndexOf=function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1},m.arrSkip=function(e,t){var i=m.arrIndexOf(e,t);return-1===i?e.slice():e.slice(0,i).concat(e.slice(i+1))},m.isArray=Array.isArray||function(e){return 0<={}.toString.call(e).indexOf("Array")},m.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var n,s=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},c=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,u=JSON&&JSON.stringify||function(e){return s.lastIndex=0,s.test(e)&&(e=e.replace(s,function(e){return r[e]})),'"'+e+'"'};m.quote=function(e){var t=u(e);return c.lastIndex=0,c.test(t)?(n||(n=function(e){var t,i={},n=[];for(t=0;t<65536;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return i[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,i}(c)),t.replace(c,function(e){return n[e]})):t};var p=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];m.probeProtocols=function(){for(var e={},t=0;t<p.length;t++){var i=p[t];e[i]=y[i]&&y[i].enabled()}return e},m.detectProtocols=function(e,t,i){var n={},a=[];t||(t=p);for(var s=0;s<t.length;s++){var r=t[s];n[r]=e[r]}var o=function(e){var t=e.shift();n[t]?a.push(t):0<e.length&&o(e)};return!1!==i.websocket&&o(["websocket"]),n["xhr-streaming"]&&!i.null_origin?a.push("xhr-streaming"):!n["xdr-streaming"]||i.cookie_needed||i.null_origin?o(["iframe-eventsource","iframe-htmlfile"]):a.push("xdr-streaming"),n["xhr-polling"]&&!i.null_origin?a.push("xhr-polling"):!n["xdr-polling"]||i.cookie_needed||i.null_origin?o(["iframe-xhr-polling","jsonp-polling"]):a.push("xdr-polling"),a};var f="_sockjs_global";m.createHook=function(){var e="a"+m.random_string(8);if(!(f in d)){var t={};d[f]=function(e){return e in t||(t[e]={id:e,del:function(){delete t[e]}}),t[e]}}return d[f](e)},m.attachMessage=function(e){m.attachEvent("message",e)},m.attachEvent=function(e,t){void 0!==d.addEventListener?d.addEventListener(e,t,!1):(l.attachEvent("on"+e,t),d.attachEvent("on"+e,t))},m.detachMessage=function(e){m.detachEvent("message",e)},m.detachEvent=function(e,t){void 0!==d.addEventListener?d.removeEventListener(e,t,!1):(l.detachEvent("on"+e,t),d.detachEvent("on"+e,t))};var h={},v=!1,g=function(){for(var e in h)h[e](),delete h[e]};m.attachEvent("unload",function(){v||(v=!0,g())}),m.unload_add=function(e){var t=m.random_string(8);return h[t]=e,v&&m.delay(g),t},m.unload_del=function(e){e in h&&delete h[e]},m.createIframe=function(e,t){var i,n,a=l.createElement("iframe"),s=function(){clearTimeout(i);try{a.onload=null}catch(e){}a.onerror=null},r=function(){a&&(s(),setTimeout(function(){a&&a.parentNode.removeChild(a),a=null},0),m.unload_del(n))},o=function(e){a&&(r(),t(e))};return a.src=e,a.style.display="none",a.style.position="absolute",a.onerror=function(){o("onerror")},a.onload=function(){clearTimeout(i),i=setTimeout(function(){o("onload timeout")},2e3)},l.body.appendChild(a),i=setTimeout(function(){o("timeout")},15e3),n=m.unload_add(r),{post:function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}},cleanup:r,loaded:s}},m.createHtmlfile=function(e,t){var i,n,a,s=new ActiveXObject("htmlfile"),r=function(){clearTimeout(i)},o=function(){s&&(r(),m.unload_del(n),a.parentNode.removeChild(a),a=s=null,CollectGarbage())};s.open(),s.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),s.close(),s.parentWindow._jp=d._jp;var c=s.createElement("div");return s.body.appendChild(c),a=s.createElement("iframe"),c.appendChild(a),a.src=e,i=setTimeout(function(){var e;e="timeout",s&&(o(),t(e))},15e3),n=m.unload_add(o),{post:function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}},cleanup:o,loaded:r}};var x=function(){};(x.prototype=new t(["chunk","finish"]))._start=function(e,t,i,n){var a=this;try{a.xhr=new XMLHttpRequest}catch(e){}if(!a.xhr)try{a.xhr=new d.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(d.ActiveXObject||d.XDomainRequest)&&(t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date),a.unload_ref=m.unload_add(function(){a._cleanup(!0)});try{a.xhr.open(e,t,!0)}catch(e){return a.emit("finish",0,""),void a._cleanup()}if(n&&n.no_credentials||(a.xhr.withCredentials="true"),n&&n.headers)for(var s in n.headers)a.xhr.setRequestHeader(s,n.headers[s]);a.xhr.onreadystatechange=function(){if(a.xhr){var e=a.xhr;switch(e.readyState){case 3:try{var t=e.status,i=e.responseText}catch(e){}1223===t&&(t=204),i&&0<i.length&&a.emit("chunk",t,i);break;case 4:1223===(t=e.status)&&(t=204),a.emit("finish",t,e.responseText),a._cleanup(!1)}}},a.xhr.send(i)},x.prototype._cleanup=function(e){var t=this;if(t.xhr){if(m.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},x.prototype.close=function(){this.nuke(),this._cleanup(!0)},(m.XHRCorsObject=function(){var e=this,t=arguments;m.delay(function(){e._start.apply(e,t)})}).prototype=new x,(m.XHRLocalObject=function(e,t,i){var n=this;m.delay(function(){n._start(e,t,i,{no_credentials:!0})})}).prototype=new x;var w=m.XDRObject=function(e,t,i){var n=this;m.delay(function(){n._start(e,t,i)})};w.prototype=new t(["chunk","finish"]),w.prototype._start=function(e,t,i){var n=this,a=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=a.ontimeout=a.onerror=function(){n.emit("finish",0,""),n._cleanup(!1)};a.onprogress=function(){n.emit("chunk",200,a.responseText)},a.onload=function(){n.emit("finish",200,a.responseText),n._cleanup(!1)},n.xdr=a,n.unload_ref=m.unload_add(function(){n._cleanup(!0)});try{n.xdr.open(e,t),n.xdr.send(i)}catch(e){s()}},w.prototype._cleanup=function(e){var t=this;if(t.xdr){if(m.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},w.prototype.close=function(){this.nuke(),this._cleanup(!0)},m.isXHRCorsCapable=function(){return d.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:d.XDomainRequest&&l.domain?2:U.enabled()?3:4};var y=function(e,t,i){if(this===d)return new y(e,t,i);var n,a=this;a._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&m.objectExtend(a._options,i),a._base_url=m.amendUrl(e),a._server=a._options.server||m.random_number_string(1e3),a._options.protocols_whitelist&&a._options.protocols_whitelist.length?n=a._options.protocols_whitelist:(n="string"==typeof t&&0<t.length?[t]:m.isArray(t)?t:null)&&a._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),a._protocols=[],a.protocol=null,a.readyState=y.CONNECTING,a._ir=$(a._base_url),a._ir.onfinish=function(e,t){a._ir=null,e?(a._options.info&&(e=m.objectExtend(e,a._options.info)),a._options.rtt&&(t=a._options.rtt),a._applyInfo(e,t,n),a._didClose()):a._didClose(1002,"Can't connect to server",!0)}};y.prototype=new e,y.version="0.3.4",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&m.log.apply(m,arguments)},y.prototype._dispatchOpen=function(){var e=this;e.readyState===y.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=y.OPEN,e.dispatchEvent(new o("open"))):e._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(e){this.readyState===y.OPEN&&this.dispatchEvent(new o("message",{data:e}))},y.prototype._dispatchHeartbeat=function(e){this.readyState===y.OPEN&&this.dispatchEvent(new o("heartbeat",{}))},y.prototype._didClose=function(e,t,i){var n=this;if(n.readyState!==y.CONNECTING&&n.readyState!==y.OPEN&&n.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");n._ir&&(n._ir.nuke(),n._ir=null),n._transport&&(n._transport.doCleanup(),n._transport=null);var a=new o("close",{code:e,reason:t,wasClean:m.userSetCode(e)});if(!m.userSetCode(e)&&n.readyState===y.CONNECTING&&!i){if(n._try_next_protocol(a))return;a=new o("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:a})}n.readyState=y.CLOSED,m.delay(function(){n.dispatchEvent(a)})},y.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var i=JSON.parse(e.slice(1)||"[]"),n=0;n<i.length;n++)t._dispatchMessage(i[n]);break;case"m":i=JSON.parse(e.slice(1)||"null");t._dispatchMessage(i);break;case"c":i=JSON.parse(e.slice(1)||"[]");t._didClose(i[0],i[1]);break;case"h":t._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(e){var t=this;for(t.protocol&&(t._debug("Closed transport:",t.protocol,""+e),t.protocol=null),t._transport_tref&&(clearTimeout(t._transport_tref),t._transport_tref=null);;){var i=t.protocol=t._protocols.shift();if(!i)return!1;if(y[i]&&!0===y[i].need_body&&(!l.body||void 0!==l.readyState&&"complete"!==l.readyState))return t._protocols.unshift(i),t.protocol="waiting-for-load",m.attachEvent("load",function(){t._try_next_protocol()}),!0;if(y[i]&&y[i].enabled(t._options)){var n=y[i].roundTrips||1,a=(t._options.rto||0)*n||5e3;t._transport_tref=m.delay(a,function(){t.readyState===y.CONNECTING&&t._didClose(2007,"Transport timeouted")});var s=m.random_string(8),r=t._base_url+"/"+t._server+"/"+s;return t._debug("Opening transport:",i," url:"+r," RTO:"+t._options.rto),t._transport=new y[i](t,r,t._base_url),!0}t._debug("Skipping transport:",i)}},y.prototype.close=function(e,t){if(e&&!m.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(this.readyState===y.CONNECTING||this.readyState===y.OPEN)&&(this.readyState=y.CLOSING,this._didClose(e||1e3,t||"Normal closure"),!0)},y.prototype.send=function(e){if(this.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return this.readyState===y.OPEN&&this._transport.doSend(m.quote(""+e)),!0},y.prototype._applyInfo=function(e,t,i){var n=this;n._options.info=e,n._options.rtt=t,n._options.rto=m.countRTO(t),n._options.info.null_origin=!l.domain;var a=m.probeProtocols();n._protocols=m.detectProtocols(a,i,e)};var _=y.websocket=function(e,t){var i=this,n=t+"/websocket";n="https"===n.slice(0,5)?"wss"+n.slice(5):"ws"+n.slice(4),i.ri=e,i.url=n;var a=d.WebSocket||d.MozWebSocket;i.ws=new a(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=m.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(m.closeFrame(1006,"WebSocket connection broken"))}};_.prototype.doSend=function(e){this.ws.send("["+e+"]")},_.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),m.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},_.enabled=function(){return!(!d.WebSocket&&!d.MozWebSocket)},_.roundTrips=2;var b=function(){};b.prototype.send_constructor=function(e){this.send_buffer=[],this.sender=e},b.prototype.doSend=function(e){this.send_buffer.push(e),this.send_stop||this.send_schedule()},b.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=m.delay(25,function(){t.send_stop=null,t.send_schedule()})},b.prototype.send_schedule=function(){var i=this;if(0<i.send_buffer.length){var e="["+i.send_buffer.join(",")+"]";i.send_stop=i.sender(i.trans_url,e,function(e,t){i.send_stop=null,!1===e?i.ri._didClose(1006,"Sending error "+t):i.send_schedule_wait()}),i.send_buffer=[]}},b.prototype.send_destructor=function(){this._send_stop&&this._send_stop(),this._send_stop=null};var C=function(e,t,i){var n=this;if(!("_send_form"in n)){var a=n._send_form=l.createElement("form");(r=n._send_area=l.createElement("textarea")).name="d",a.style.display="none",a.style.position="absolute",a.method="POST",a.enctype="application/x-www-form-urlencoded",a.acceptCharset="UTF-8",a.appendChild(r),l.body.appendChild(a)}a=n._send_form;var s,r=n._send_area,o="a"+m.random_string(8);a.target=o,a.action=e+"/jsonp_send?i="+o;try{s=l.createElement('<iframe name="'+o+'">')}catch(e){(s=l.createElement("iframe")).name=o}s.id=o,a.appendChild(s),s.style.display="none";try{r.value=t}catch(e){m.log("Your browser is seriously broken. Go home! "+e.message)}a.submit();var c=function(e){s.onerror&&(s.onreadystatechange=s.onerror=s.onload=null,m.delay(500,function(){s.parentNode.removeChild(s),s=null}),r.value="",i(!0))};return s.onerror=s.onload=c,s.onreadystatechange=function(e){"complete"==s.readyState&&c()},c},S=function(e,t){var i,n,a=l.createElement("script"),s=function(e){n&&(n.parentNode.removeChild(n),n=null),a&&(clearTimeout(i),a.parentNode.removeChild(a),a.onreadystatechange=a.onerror=a.onload=a.onclick=null,a=null,t(e),t=null)},r=!1,o=null;if(a.id="a"+m.random_string(8),a.src=e,a.type="text/javascript",a.charset="UTF-8",a.onerror=function(e){o||(o=setTimeout(function(){r||s(m.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},a.onload=function(e){s(m.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},a.onreadystatechange=function(e){if(/loaded|closed/.test(a.readyState)){if(a&&a.htmlFor&&a.onclick){r=!0;try{a.onclick()}catch(e){}}a&&s(m.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===a.async&&l.attachEvent)if(/opera/i.test(navigator.userAgent))(n=l.createElement("script")).text="try{var a = document.getElementById('"+a.id+"'); if(a)a.onerror();}catch(x){};",a.async=n.async=!1;else{try{a.htmlFor=a.id,a.event="onclick"}catch(e){}a.async=!0}void 0!==a.async&&(a.async=!0),i=setTimeout(function(){s(m.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var c=l.getElementsByTagName("head")[0];return c.insertBefore(a,c.firstChild),n&&c.insertBefore(n,c.firstChild),s},k=y["jsonp-polling"]=function(e,t){m.polluteGlobalNamespace();this.ri=e,this.trans_url=t,this.send_constructor(C),this._schedule_recv()};k.prototype=new b,k.prototype._schedule_recv=function(){var t=this;t._recv_stop=T(t.trans_url+"/jsonp",S,function(e){t._recv_stop=null,e&&(t._is_closing||t.ri._didMessage(e)),t._is_closing||t._schedule_recv()})},k.enabled=function(){return!0},k.need_body=!0,k.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var T=function(e,t,i){var n="a"+m.random_string(6),a=e+"?c="+escape("_jp."+n),s=0,r=t(a,function(e){switch(s){case 0:delete d._jp[n],i(e);break;case 1:i(e),s=2;break;case 2:delete d._jp[n]}});d._jp[n]=r;return function(){d._jp[n]&&(s=1,d._jp[n](m.closeFrame(1e3,"JSONP user aborted read")))}},O=function(){};(O.prototype=new b).run=function(e,t,i,n,a){var s;this.ri=e,this.trans_url=t,this.send_constructor((s=a,function(e,t,i){return new s("POST",e+"/xhr_send",t).onfinish=function(e,t){i(200===e||204===e,"http status "+e)},function(e){i(!1,e)}})),this.poll=new q(e,n,t+i,a)},O.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};var E=y["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",J,m.XHRCorsObject)};E.prototype=new O,E.enabled=function(){return d.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},E.roundTrips=2,E.need_body=!0;var j=y["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",J,m.XDRObject)};j.prototype=new O,j.enabled=function(){return!!d.XDomainRequest},j.roundTrips=2;var N=y["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",J,m.XHRCorsObject)};N.prototype=new O,N.enabled=E.enabled,N.roundTrips=2;var A=y["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",J,m.XDRObject)};A.prototype=new O,A.enabled=j.enabled,A.roundTrips=2;var R,U=function(){};U.prototype.i_constructor=function(e,t,i){var n=this;n.ri=e,n.origin=m.getOrigin(i),n.base_url=i,n.trans_url=t;var a=i+"/iframe.html";n.ri._options.devel&&(a+="?t="+ +new Date),n.window_id=m.random_string(8),a+="#"+n.window_id,n.iframeObj=m.createIframe(a,function(e){n.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),n.onmessage_cb=m.bind(n.onmessage,n),m.attachMessage(n.onmessage_cb)},U.prototype.doCleanup=function(){var e=this;if(e.iframeObj){m.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},U.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var i=e.data.slice(0,8),n=e.data.slice(8,9),a=e.data.slice(9);if(i===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([y.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(a)}}},U.prototype.postMessage=function(e,t){this.iframeObj.post(this.window_id+e+(t||""),this.origin)},U.prototype.doSend=function(e){this.postMessage("m",e)},U.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof d.postMessage||"object"==typeof d.postMessage)&&!e};var M=function(e,t){parent!==d?parent.postMessage(R+e+(t||""),"*"):m.log("Can't postMessage, no parent window.",e,t)},L=function(){};L.prototype._didClose=function(e,t){M("t",m.closeFrame(e,t))},L.prototype._didMessage=function(e){M("t",e)},L.prototype._doSend=function(e){this._transport.doSend(e)},L.prototype._doCleanup=function(){this._transport.doCleanup()},m.parent_origin=void 0,y.bootstrap_iframe=function(){var u;R=l.location.hash.slice(1);m.attachMessage(function(e){if(e.source===parent&&(void 0===m.parent_origin&&(m.parent_origin=e.origin),e.origin===m.parent_origin)){var t=e.data.slice(0,8),i=e.data.slice(8,9),n=e.data.slice(9);if(t===R)switch(i){case"s":var a=JSON.parse(n),s=a[0],r=a[1],o=a[2],c=a[3];if(s!==y.version&&m.log('Incompatibile SockJS! Main site uses: "'+s+'", the iframe: "'+y.version+'".'),!m.flatUrl(o)||!m.flatUrl(c))return void m.log("Only basic urls are supported in SockJS");if(!m.isSameOriginUrl(o)||!m.isSameOriginUrl(c))return void m.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([d.location.href,o,c])+")");(u=new L)._transport=new L[r](u,o,c);break;case"m":u._doSend(n);break;case"c":u&&u._doCleanup(),u=null}}}),M("s")};var D=function(e,t){var i=this;m.delay(function(){i.doXhr(e,t)})};(D.prototype=new t(["finish"])).doXhr=function(e,t){var a=this,s=(new Date).getTime(),i=new t("GET",e+"/info"),r=m.delay(8e3,function(){i.ontimeout()});i.onfinish=function(e,t){if(clearTimeout(r),r=null,200===e){var i=(new Date).getTime()-s,n=JSON.parse(t);"object"!=typeof n&&(n={}),a.emit("finish",n,i)}else a.emit("finish")},i.ontimeout=function(){i.close(),a.emit("finish")}};var P=function(i){var s=this,e=function(){var a=new U;a.protocol="w-iframe-info-receiver";var e=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var t=JSON.parse(e.substr(1)),i=t[0],n=t[1];s.emit("finish",i,n)}else s.emit("finish");a.doCleanup(),a=null},t={_options:{},_didClose:e,_didMessage:e};a.i_constructor(t,i,i)};l.body?e():m.attachEvent("load",e)};P.prototype=new t(["finish"]);var I=function(){var e=this;m.delay(function(){e.emit("finish",{},2e3)})};I.prototype=new t(["finish"]);var $=function(e){if(m.isSameOriginUrl(e))return new D(e,m.XHRLocalObject);switch(m.isXHRCorsCapable()){case 1:return new D(e,m.XHRLocalObject);case 2:return new D(e,m.XDRObject);case 3:return new P(e);default:return new I}};(L["w-iframe-info-receiver"]=function(i,e,t){new D(t,m.XHRLocalObject).onfinish=function(e,t){i._didMessage("m"+JSON.stringify([e,t])),i._didClose()}}).prototype.doCleanup=function(){};var F=y["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource",this.i_constructor.apply(this,arguments)};F.prototype=new U,F.enabled=function(){return"EventSource"in d&&U.enabled()},F.need_body=!0,F.roundTrips=3,(L["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",z,m.XHRLocalObject)}).prototype=new O;var H=y["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling",this.i_constructor.apply(this,arguments)};H.prototype=new U,H.enabled=function(){return d.XMLHttpRequest&&U.enabled()},H.need_body=!0,H.roundTrips=3,(L["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",J,m.XHRLocalObject)}).prototype=new O;var X=y["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile",this.i_constructor.apply(this,arguments)};X.prototype=new U,X.enabled=function(){return U.enabled()},X.need_body=!0,X.roundTrips=3,(L["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",B,m.XHRLocalObject)}).prototype=new O;var q=function(e,t,i,n){var a=this;a.ri=e,a.Receiver=t,a.recv_url=i,a.AjaxObject=n,a._scheduleRecv()};q.prototype._scheduleRecv=function(){var t=this,i=t.poll=new t.Receiver(t.recv_url,t.AjaxObject);i.onmessage=function(e){1,t.ri._didMessage(e.data)},i.onclose=function(e){t.poll=i=i.onmessage=i.onclose=null,t.poll_is_closing||("permanent"===e.reason?t.ri._didClose(1006,"Polling error ("+e.reason+")"):t._scheduleRecv())}},q.prototype.abort=function(){this.poll_is_closing=!0,this.poll&&this.poll.abort()};var W,z=function(e){var n=this,a=new EventSource(e);a.onmessage=function(e){n.dispatchEvent(new o("message",{data:unescape(e.data)}))},n.es_close=a.onerror=function(e,t){var i=t?"user":2!==a.readyState?"network":"permanent";n.es_close=a.onmessage=a.onerror=null,a.close(),a=null,m.delay(200,function(){n.dispatchEvent(new o("close",{reason:i}))})}};z.prototype=new e,z.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var B=function(e){var i=this;m.polluteGlobalNamespace(),i.id="a"+m.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape("_jp."+i.id);var n,t=function(){if(void 0===W)if("ActiveXObject"in d)try{W=!!new ActiveXObject("htmlfile")}catch(e){}else W=!1;return W}()?m.createHtmlfile:m.createIframe;d._jp[i.id]={start:function(){n.loaded()},message:function(e){i.dispatchEvent(new o("message",{data:e}))},stop:function(){i.iframe_close({},"network")}},i.iframe_close=function(e,t){n.cleanup(),i.iframe_close=n=null,delete d._jp[i.id],i.dispatchEvent(new o("close",{reason:t}))},n=t(e,function(e){i.iframe_close({},"permanent")})};B.prototype=new e,B.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var J=function(e,t){var s=this,r=0;s.xo=new t("POST",e,null),s.xo.onchunk=function(e,t){if(200===e)for(;;){var i=t.slice(r),n=i.indexOf("\n");if(-1===n)break;r+=n+1;var a=i.slice(0,n);s.dispatchEvent(new o("message",{data:a}))}},s.xo.onfinish=function(e,t){s.xo.onchunk(e,t),s.xo=null;var i=200===e?"network":"permanent";s.dispatchEvent(new o("close",{reason:i}))}};return J.prototype=new e,J.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new o("close",{reason:"user"})),this.xo=null)},y.getUtils=function(){return m},y.getIframeTransport=function(){return U},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),function(){var w,n,v,c,a={}.hasOwnProperty,s=[].slice;w={LF:"\n",NULL:"\0"},v=function(){var r;function x(e,t,i){this.command=e,this.headers=null!=t?t:{},this.body=null!=i?i:""}return x.prototype.toString=function(){var e,t,i,n;for(t in e=[this.command],n=this.headers)a.call(n,t)&&(i=n[t],e.push(t+":"+i));return this.body&&e.push("content-length:"+x.sizeOfUTF8(this.body)),e.push(w.LF+this.body),e.join(w.LF)},x.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},r=function(e){var t,i,n,a,s,r,o,c,u,l,d,m,p,f,h,v,g;for(a=e.search(RegExp(""+w.LF+w.LF)),n=(s=e.substring(0,a).split(w.LF)).shift(),r={},m=function(e){return e.replace(/^\s+|\s+$/g,"")},p=0,h=(v=s.reverse()).length;p<h;p++)c=(l=v[p]).indexOf(":"),r[m(l.substring(0,c))]=m(l.substring(c+1));if(t="",d=a+2,r["content-length"])u=parseInt(r["content-length"]),t=(""+e).substring(d,d+u);else for(i=null,o=f=d,g=e.length;(d<=g?f<g:g<f)&&(i=e.charAt(o))!==w.NULL;o=d<=g?++f:--f)t+=i;return new x(n,r,t)},x.unmarshall=function(a){var s;return function(){var e,t,i,n;for(n=[],e=0,t=(i=a.split(RegExp(""+w.NULL+w.LF+"*"))).length;e<t;e++)0<(null!=(s=i[e])?s.length:void 0)&&n.push(r(s));return n}()},x.marshall=function(e,t,i){return new x(e,t,i).toString()+w.NULL},x}(),n=function(){var h;function e(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return e.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},h=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(e,t,i){var n;for(n=v.marshall(e,t,i),"function"==typeof this.debug&&this.debug(">>> "+n);;){if(!(n.length>this.maxWebSocketFrameSize))return this.ws.send(n);this.ws.send(n.substring(0,this.maxWebSocketFrameSize)),n=n.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+n.length)}},e.prototype._setupHeartbeat=function(a){var e,t,i,s,n,r,o=this;if((n=a.version)===c.VERSIONS.V1_1||n===c.VERSIONS.V1_2)return t=(r=function(){var e,t,i,n;for(n=[],e=0,t=(i=a["heart-beat"].split(",")).length;e<t;e++)s=i[e],n.push(parseInt(s));return n}())[0],e=r[1],0!==this.heartbeat.outgoing&&0!==e&&(i=Math.max(this.heartbeat.outgoing,e),"function"==typeof this.debug&&this.debug("send PING every "+i+"ms"),this.pinger=c.setInterval(i,function(){return o.ws.send(w.LF),"function"==typeof o.debug?o.debug(">>> PING"):void 0})),0!==this.heartbeat.incoming&&0!==t?(i=Math.max(this.heartbeat.incoming,t),"function"==typeof this.debug&&this.debug("check PONG every "+i+"ms"),this.ponger=c.setInterval(i,function(){var e;if(e=h()-o.serverActivity,2*i<e)return"function"==typeof o.debug&&o.debug("did not receive server activity for the last "+e+"ms"),o.ws.close()})):void 0},e.prototype._parseConnect=function(){var e,t,i,n;switch(n={},(e=1<=arguments.length?s.call(arguments,0):[]).length){case 2:n=e[0],t=e[1];break;case 3:e[1]instanceof Function?(n=e[0],t=e[1],i=e[2]):(n.login=e[0],n.passcode=e[1],t=e[2]);break;case 4:n.login=e[0],n.passcode=e[1],t=e[2],i=e[3];break;default:n.login=e[0],n.passcode=e[1],t=e[2],i=e[3],n.host=e[4]}return[n,t,i]},e.prototype.connect=function(){var e,p,t,i,f=this;return e=1<=arguments.length?s.call(arguments,0):[],i=this._parseConnect.apply(this,e),t=i[0],this.connectCallback=i[1],p=i[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(e){var n,a,t,i,s,r,o,c,u,l,d,m;if(i="undefined"!=typeof ArrayBuffer&&e.data instanceof ArrayBuffer?(n=new Uint8Array(e.data),"function"==typeof f.debug&&f.debug("--- got data length: "+n.length),function(){var e,t,i;for(i=[],e=0,t=n.length;e<t;e++)a=n[e],i.push(String.fromCharCode(a));return i}().join("")):e.data,f.serverActivity=h(),i!==w.LF){for("function"==typeof f.debug&&f.debug("<<< "+i),m=[],u=0,l=(d=v.unmarshall(i)).length;u<l;u++)switch((s=d[u]).command){case"CONNECTED":"function"==typeof f.debug&&f.debug("connected to server "+s.headers.server),f.connected=!0,f._setupHeartbeat(s.headers),m.push("function"==typeof f.connectCallback?f.connectCallback(s):void 0);break;case"MESSAGE":c=s.headers.subscription,(o=f.subscriptions[c]||f.onreceive)?(t=f,r=s.headers["message-id"],s.ack=function(e){return null==e&&(e={}),t.ack(r,c,e)},s.nack=function(e){return null==e&&(e={}),t.nack(r,c,e)},m.push(o(s))):m.push("function"==typeof f.debug?f.debug("Unhandled received MESSAGE: "+s):void 0);break;case"RECEIPT":m.push("function"==typeof f.onreceipt?f.onreceipt(s):void 0);break;case"ERROR":m.push("function"==typeof p?p(s):void 0);break;default:m.push("function"==typeof f.debug?f.debug("Unhandled frame: "+s):void 0)}return m}"function"==typeof f.debug&&f.debug("<<< PONG")},this.ws.onclose=function(){var e;return e="Whoops! Lost connection to "+f.ws.url,"function"==typeof f.debug&&f.debug(e),f._cleanUp(),"function"==typeof p?p(e):void 0},this.ws.onopen=function(){return"function"==typeof f.debug&&f.debug("Web Socket Opened..."),t["accept-version"]=c.VERSIONS.supportedVersions(),t["heart-beat"]=[f.heartbeat.outgoing,f.heartbeat.incoming].join(","),f._transmit("CONNECT",t)}},e.prototype.disconnect=function(e){return this._transmit("DISCONNECT"),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},e.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&c.clearInterval(this.pinger),this.ponger)return c.clearInterval(this.ponger)},e.prototype.send=function(e,t,i){return null==t&&(t={}),null==i&&(i=""),t.destination=e,this._transmit("SEND",t,i)},e.prototype.subscribe=function(e,t,i){var n;return null==i&&(i={}),i.id||(i.id="sub-"+this.counter++),i.destination=e,this.subscriptions[i.id]=t,this._transmit("SUBSCRIBE",i),n=this,{id:i.id,unsubscribe:function(){return n.unsubscribe(i.id)}}},e.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},e.prototype.begin=function(e){var t,i;return i=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:i}),t=this,{id:i,commit:function(){return t.commit(i)},abort:function(){return t.abort(i)}}},e.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},e.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},e.prototype.ack=function(e,t,i){return null==i&&(i={}),i["message-id"]=e,i.subscription=t,this._transmit("ACK",i)},e.prototype.nack=function(e,t,i){return null==i&&(i={}),i["message-id"]=e,i.subscription=t,this._transmit("NACK",i)},e}(),c={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,t){var i;return null==t&&(t=["v10.stomp","v11.stomp"]),i=new(c.WebSocketClass||WebSocket)(e,t),new n(i)},over:function(e){return new n(e)},Frame:v},"undefined"!=typeof window&&null!==window?(c.setInterval=function(e,t){return window.setInterval(t,e)},c.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=c):"undefined"!=typeof exports&&null!==exports?exports.Stomp=c:self.Stomp=c}.call(this),function(){var e=this,t=e._,r={},a=Array.prototype,i=Object.prototype,n=Function.prototype,s=a.push,o=a.slice,c=a.concat,d=i.toString,u=i.hasOwnProperty,l=a.forEach,m=a.map,p=a.reduce,f=a.reduceRight,h=a.filter,v=a.every,g=a.some,x=a.indexOf,w=a.lastIndexOf,y=Array.isArray,_=Object.keys,b=n.bind,C=function(e){return e instanceof C?e:this instanceof C?void(this._wrapped=e):new C(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=C),exports._=C):e._=C,C.VERSION="1.6.0";var S=C.each=C.forEach=function(e,t,i){if(null==e)return e;if(l&&e.forEach===l)e.forEach(t,i);else if(e.length===+e.length){for(var n=0,a=e.length;n<a;n++)if(t.call(i,e[n],n,e)===r)return}else{var s=C.keys(e);for(n=0,a=s.length;n<a;n++)if(t.call(i,e[s[n]],s[n],e)===r)return}return e};C.map=C.collect=function(e,n,a){var s=[];return null==e?s:m&&e.map===m?e.map(n,a):(S(e,function(e,t,i){s.push(n.call(a,e,t,i))}),s)};var k="Reduce of empty array with no initial value";C.reduce=C.foldl=C.inject=function(e,n,a,s){var r=2<arguments.length;if(null==e&&(e=[]),p&&e.reduce===p)return s&&(n=C.bind(n,s)),r?e.reduce(n,a):e.reduce(n);if(S(e,function(e,t,i){r?a=n.call(s,a,e,t,i):(a=e,r=!0)}),!r)throw new TypeError(k);return a},C.reduceRight=C.foldr=function(n,a,s,r){var o=2<arguments.length;if(null==n&&(n=[]),f&&n.reduceRight===f)return r&&(a=C.bind(a,r)),o?n.reduceRight(a,s):n.reduceRight(a);var c=n.length;if(c!==+c){var u=C.keys(n);c=u.length}if(S(n,function(e,t,i){t=u?u[--c]:--c,o?s=a.call(r,s,n[t],t,i):(s=n[t],o=!0)}),!o)throw new TypeError(k);return s},C.find=C.detect=function(e,n,a){var s;return T(e,function(e,t,i){if(n.call(a,e,t,i))return s=e,!0}),s},C.filter=C.select=function(e,n,a){var s=[];return null==e?s:h&&e.filter===h?e.filter(n,a):(S(e,function(e,t,i){n.call(a,e,t,i)&&s.push(e)}),s)},C.reject=function(e,n,a){return C.filter(e,function(e,t,i){return!n.call(a,e,t,i)},a)},C.every=C.all=function(e,n,a){n||(n=C.identity);var s=!0;return null==e?s:v&&e.every===v?e.every(n,a):(S(e,function(e,t,i){if(!(s=s&&n.call(a,e,t,i)))return r}),!!s)};var T=C.some=C.any=function(e,n,a){n||(n=C.identity);var s=!1;return null==e?s:g&&e.some===g?e.some(n,a):(S(e,function(e,t,i){if(s||(s=n.call(a,e,t,i)))return r}),!!s)};C.contains=C.include=function(e,t){return null!=e&&(x&&e.indexOf===x?-1!=e.indexOf(t):T(e,function(e){return e===t}))},C.invoke=function(e,t){var i=o.call(arguments,2),n=C.isFunction(t);return C.map(e,function(e){return(n?t:e[t]).apply(e,i)})},C.pluck=function(e,t){return C.map(e,C.property(t))},C.where=function(e,t){return C.filter(e,C.matches(t))},C.findWhere=function(e,t){return C.find(e,C.matches(t))},C.max=function(e,a,s){if(!a&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,o=-1/0;return S(e,function(e,t,i){var n=a?a.call(s,e,t,i):e;o<n&&(r=e,o=n)}),r},C.min=function(e,a,s){if(!a&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,o=1/0;return S(e,function(e,t,i){var n=a?a.call(s,e,t,i):e;n<o&&(r=e,o=n)}),r},C.shuffle=function(e){var t,i=0,n=[];return S(e,function(e){t=C.random(i++),n[i-1]=n[t],n[t]=e}),n},C.sample=function(e,t,i){return null==t||i?(e.length!==+e.length&&(e=C.values(e)),e[C.random(e.length-1)]):C.shuffle(e).slice(0,Math.max(0,t))};var O=function(e){return null==e?C.identity:C.isFunction(e)?e:C.property(e)};C.sortBy=function(e,n,a){return n=O(n),C.pluck(C.map(e,function(e,t,i){return{value:e,index:t,criteria:n.call(a,e,t,i)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index}),"value")};var E=function(o){return function(n,a,s){var r={};return a=O(a),S(n,function(e,t){var i=a.call(s,e,t,n);o(r,i,e)}),r}};C.groupBy=E(function(e,t,i){C.has(e,t)?e[t].push(i):e[t]=[i]}),C.indexBy=E(function(e,t,i){e[t]=i}),C.countBy=E(function(e,t){C.has(e,t)?e[t]++:e[t]=1}),C.sortedIndex=function(e,t,i,n){for(var a=(i=O(i)).call(n,t),s=0,r=e.length;s<r;){var o=s+r>>>1;i.call(n,e[o])<a?s=o+1:r=o}return s},C.toArray=function(e){return e?C.isArray(e)?o.call(e):e.length===+e.length?C.map(e,C.identity):C.values(e):[]},C.size=function(e){return null==e?0:e.length===+e.length?e.length:C.keys(e).length},C.first=C.head=C.take=function(e,t,i){if(null!=e)return null==t||i?e[0]:t<0?[]:o.call(e,0,t)},C.initial=function(e,t,i){return o.call(e,0,e.length-(null==t||i?1:t))},C.last=function(e,t,i){if(null!=e)return null==t||i?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},C.rest=C.tail=C.drop=function(e,t,i){return o.call(e,null==t||i?1:t)},C.compact=function(e){return C.filter(e,C.identity)};var j=function(e,t,i){return t&&C.every(e,C.isArray)?c.apply(i,e):(S(e,function(e){C.isArray(e)||C.isArguments(e)?t?s.apply(i,e):j(e,t,i):i.push(e)}),i)};C.flatten=function(e,t){return j(e,t,[])},C.without=function(e){return C.difference(e,o.call(arguments,1))},C.partition=function(e,t,i){t=O(t);var n=[],a=[];return S(e,function(e){(t.call(i,e)?n:a).push(e)}),[n,a]},C.uniq=C.unique=function(i,n,e,t){C.isFunction(n)&&(t=e,e=n,n=!1);var a=e?C.map(i,e,t):i,s=[],r=[];return S(a,function(e,t){(n?t&&r[r.length-1]===e:C.contains(r,e))||(r.push(e),s.push(i[t]))}),s},C.union=function(){return C.uniq(C.flatten(arguments,!0))},C.intersection=function(e){var i=o.call(arguments,1);return C.filter(C.uniq(e),function(t){return C.every(i,function(e){return C.contains(e,t)})})},C.difference=function(e){var t=c.apply(a,o.call(arguments,1));return C.filter(e,function(e){return!C.contains(t,e)})},C.zip=function(){for(var e=C.max(C.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;i<e;i++)t[i]=C.pluck(arguments,""+i);return t},C.object=function(e,t){if(null==e)return{};for(var i={},n=0,a=e.length;n<a;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},C.indexOf=function(e,t,i){if(null==e)return-1;var n=0,a=e.length;if(i){if("number"!=typeof i)return e[n=C.sortedIndex(e,t)]===t?n:-1;n=i<0?Math.max(0,a+i):i}if(x&&e.indexOf===x)return e.indexOf(t,i);for(;n<a;n++)if(e[n]===t)return n;return-1},C.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(w&&e.lastIndexOf===w)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var a=n?i:e.length;a--;)if(e[a]===t)return a;return-1},C.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=i||1;for(var n=Math.max(Math.ceil((t-e)/i),0),a=0,s=new Array(n);a<n;)s[a++]=e,e+=i;return s};var N=function(){};C.bind=function(i,n){var a,s;if(b&&i.bind===b)return b.apply(i,o.call(arguments,1));if(!C.isFunction(i))throw new TypeError;return a=o.call(arguments,2),s=function(){if(!(this instanceof s))return i.apply(n,a.concat(o.call(arguments)));N.prototype=i.prototype;var e=new N;N.prototype=null;var t=i.apply(e,a.concat(o.call(arguments)));return Object(t)===t?t:e}},C.partial=function(a){var s=o.call(arguments,1);return function(){for(var e=0,t=s.slice(),i=0,n=t.length;i<n;i++)t[i]===C&&(t[i]=arguments[e++]);for(;e<arguments.length;)t.push(arguments[e++]);return a.apply(this,t)}},C.bindAll=function(t){var e=o.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return S(e,function(e){t[e]=C.bind(t[e],t)}),t},C.memoize=function(t,i){var n={};return i||(i=C.identity),function(){var e=i.apply(this,arguments);return C.has(n,e)?n[e]:n[e]=t.apply(this,arguments)}},C.delay=function(e,t){var i=o.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},C.defer=function(e){return C.delay.apply(C,[e,1].concat(o.call(arguments,1)))},C.throttle=function(i,n,a){var s,r,o,c=null,u=0;a||(a={});var l=function(){u=!1===a.leading?0:C.now(),c=null,o=i.apply(s,r),s=r=null};return function(){var e=C.now();u||!1!==a.leading||(u=e);var t=n-(e-u);return s=this,r=arguments,t<=0?(clearTimeout(c),c=null,u=e,o=i.apply(s,r),s=r=null):c||!1===a.trailing||(c=setTimeout(l,t)),o}},C.debounce=function(t,i,n){var a,s,r,o,c,u=function(){var e=C.now()-o;e<i?a=setTimeout(u,i-e):(a=null,n||(c=t.apply(r,s),r=s=null))};return function(){r=this,s=arguments,o=C.now();var e=n&&!a;return a||(a=setTimeout(u,i)),e&&(c=t.apply(r,s),r=s=null),c}},C.once=function(e){var t,i=!1;return function(){return i||(i=!0,t=e.apply(this,arguments),e=null),t}},C.wrap=function(e,t){return C.partial(t,e)},C.compose=function(){var i=arguments;return function(){for(var e=arguments,t=i.length-1;0<=t;t--)e=[i[t].apply(this,e)];return e[0]}},C.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},C.keys=function(e){if(!C.isObject(e))return[];if(_)return _(e);var t=[];for(var i in e)C.has(e,i)&&t.push(i);return t},C.values=function(e){for(var t=C.keys(e),i=t.length,n=new Array(i),a=0;a<i;a++)n[a]=e[t[a]];return n},C.pairs=function(e){for(var t=C.keys(e),i=t.length,n=new Array(i),a=0;a<i;a++)n[a]=[t[a],e[t[a]]];return n},C.invert=function(e){for(var t={},i=C.keys(e),n=0,a=i.length;n<a;n++)t[e[i[n]]]=i[n];return t},C.functions=C.methods=function(e){var t=[];for(var i in e)C.isFunction(e[i])&&t.push(i);return t.sort()},C.extend=function(i){return S(o.call(arguments,1),function(e){if(e)for(var t in e)i[t]=e[t]}),i},C.pick=function(t){var i={},e=c.apply(a,o.call(arguments,1));return S(e,function(e){e in t&&(i[e]=t[e])}),i},C.omit=function(e){var t={},i=c.apply(a,o.call(arguments,1));for(var n in e)C.contains(i,n)||(t[n]=e[n]);return t},C.defaults=function(i){return S(o.call(arguments,1),function(e){if(e)for(var t in e)void 0===i[t]&&(i[t]=e[t])}),i},C.clone=function(e){return C.isObject(e)?C.isArray(e)?e.slice():C.extend({},e):e},C.tap=function(e,t){return t(e),e};var A=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof C&&(e=e._wrapped),t instanceof C&&(t=t._wrapped);var a=d.call(e);if(a!=d.call(t))return!1;switch(a){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=i.length;s--;)if(i[s]==e)return n[s]==t;var r=e.constructor,o=t.constructor;if(r!==o&&!(C.isFunction(r)&&r instanceof r&&C.isFunction(o)&&o instanceof o)&&"constructor"in e&&"constructor"in t)return!1;i.push(e),n.push(t);var c=0,u=!0;if("[object Array]"==a){if(u=(c=e.length)==t.length)for(;c--&&(u=A(e[c],t[c],i,n)););}else{for(var l in e)if(C.has(e,l)&&(c++,!(u=C.has(t,l)&&A(e[l],t[l],i,n))))break;if(u){for(l in t)if(C.has(t,l)&&!c--)break;u=!c}}return i.pop(),n.pop(),u};C.isEqual=function(e,t){return A(e,t,[],[])},C.isEmpty=function(e){if(null==e)return!0;if(C.isArray(e)||C.isString(e))return 0===e.length;for(var t in e)if(C.has(e,t))return!1;return!0},C.isElement=function(e){return!(!e||1!==e.nodeType)},C.isArray=y||function(e){return"[object Array]"==d.call(e)},C.isObject=function(e){return e===Object(e)},S(["Arguments","Function","String","Number","Date","RegExp"],function(t){C["is"+t]=function(e){return d.call(e)=="[object "+t+"]"}}),C.isArguments(arguments)||(C.isArguments=function(e){return!(!e||!C.has(e,"callee"))}),"function"!=typeof/./&&(C.isFunction=function(e){return"function"==typeof e}),C.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},C.isNaN=function(e){return C.isNumber(e)&&e!=+e},C.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==d.call(e)},C.isNull=function(e){return null===e},C.isUndefined=function(e){return void 0===e},C.has=function(e,t){return u.call(e,t)},C.noConflict=function(){return e._=t,this},C.identity=function(e){return e},C.constant=function(e){return function(){return e}},C.property=function(t){return function(e){return e[t]}},C.matches=function(i){return function(e){if(e===i)return!0;for(var t in i)if(i[t]!==e[t])return!1;return!0}},C.times=function(e,t,i){for(var n=Array(Math.max(0,e)),a=0;a<e;a++)n[a]=t.call(i,a);return n},C.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},C.now=Date.now||function(){return(new Date).getTime()};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};R.unescape=C.invert(R.escape);var U={escape:new RegExp("["+C.keys(R.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(R.unescape).join("|")+")","g")};C.each(["escape","unescape"],function(t){C[t]=function(e){return null==e?"":(""+e).replace(U[t],function(e){return R[t][e]})}}),C.result=function(e,t){if(null!=e){var i=e[t];return C.isFunction(i)?i.call(e):i}},C.mixin=function(i){S(C.functions(i),function(e){var t=C[e]=i[e];C.prototype[e]=function(){var e=[this._wrapped];return s.apply(e,arguments),I.call(this,t.apply(C,e))}})};var M=0;C.uniqueId=function(e){var t=++M+"";return e?e+t:t},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(s,e,t){var i;t=C.defaults({},t,C.templateSettings);var n=new RegExp([(t.escape||L).source,(t.interpolate||L).source,(t.evaluate||L).source].join("|")+"|$","g"),r=0,o="__p+='";s.replace(n,function(e,t,i,n,a){return o+=s.slice(r,a).replace(P,function(e){return"\\"+D[e]}),t&&(o+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'"),i&&(o+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),n&&(o+="';\n"+n+"\n__p+='"),r=a+e.length,e}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{i=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}if(e)return i(e,C);var a=function(e){return i.call(this,e,C)};return a.source="function("+(t.variable||"obj")+"){\n"+o+"}",a},C.chain=function(e){return C(e).chain()};var I=function(e){return this._chain?C(e).chain():e};C.mixin(C),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var i=a[t];C.prototype[t]=function(){var e=this._wrapped;return i.apply(e,arguments),"shift"!=t&&"splice"!=t||0!==e.length||delete e[0],I.call(this,e)}}),S(["concat","join","slice"],function(e){var t=a[e];C.prototype[e]=function(){return I.call(this,t.apply(this._wrapped,arguments))}}),C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return C})}.call(this),function(){var r,e=this;if("function"==typeof e.require)try{var t=e.require("crypto").randomBytes;r=t&&function(){return t(16)}}catch(e){}if(!r&&e.crypto&&crypto.getRandomValues){var i=new Uint8Array(16);r=function(){return crypto.getRandomValues(i),i}}if(!r){var n=new Array(16);r=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}for(var o="function"==typeof e.Buffer?e.Buffer:Array,a=[],s={},c=0;c<256;c++)a[c]=(c+256).toString(16).substr(1),s[a[c]]=c;function p(e,t){var i=t||0,n=a;return n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+"-"+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]+n[e[i++]]}var u=r(),f=[1|u[0],u[1],u[2],u[3],u[4],u[5]],h=16383&(u[6]<<8|u[7]),v=0,g=0;function l(e,t,i){var n=t&&i||0;"string"==typeof e&&(t="binary"==e?new o(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;s++)t[n+s]=a[s];return t||p(a)}if((uuid=l).v1=function(e,t,i){var n=t&&i||0,a=t||[],s=null!=(e=e||{}).clockseq?e.clockseq:h,r=null!=e.msecs?e.msecs:(new Date).getTime(),o=null!=e.nsecs?e.nsecs:g+1,c=r-v+(o-g)/1e4;if(c<0&&null==e.clockseq&&(s=s+1&16383),(c<0||v<r)&&null==e.nsecs&&(o=0),1e4<=o)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=r,h=s;var u=(1e4*(268435455&(r+=122192928e5))+(g=o))%4294967296;a[n++]=u>>>24&255,a[n++]=u>>>16&255,a[n++]=u>>>8&255,a[n++]=255&u;var l=r/4294967296*1e4&268435455;a[n++]=l>>>8&255,a[n++]=255&l,a[n++]=l>>>24&15|16,a[n++]=l>>>16&255,a[n++]=s>>>8|128,a[n++]=255&s;for(var d=e.node||f,m=0;m<6;m++)a[n+m]=d[m];return t||p(a)},uuid.v4=l,uuid.parse=function(e,t,i){var n=t&&i||0,a=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){a<16&&(t[n+a++]=s[e])});a<16;)t[n+a++]=0;return t},uuid.unparse=p,uuid.BufferClass=o,"function"==typeof define&&define.amd)define("uuid",[],function(){return uuid});else if("undefined"!=typeof module&&module.exports)module.exports=uuid;else{var d=e.uuid;uuid.noConflict=function(){return e.uuid=d,uuid},e.uuid=uuid}}.call(this),function(a,d){"use strict";var m="function",p="undefined",f="object",e="major",t="model",i="name",n="type",s="vendor",r="version",o="architecture",c="console",u="mobile",l="tablet",h="smarttv",v={extend:function(e,t){for(var i in t)-1!=="browser cpu device engine os".indexOf(i)&&t[i].length%2==0&&(e[i]=t[i].concat(e[i]));return e},has:function(e,t){if("string"==typeof e)return-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()}},g={rgx:function(){for(var e,t,i,n,a,s,r,o=0,c=arguments;o<c.length;o+=2){var u=c[o],l=c[o+1];if(typeof e===p)for(n in e={},l)typeof(a=l[n])===f?e[a[0]]=d:e[a]=d;for(t=i=0;t<u.length;t++)if(s=u[t].exec(this.getUA())){for(n=0;n<l.length;n++)r=s[++i],typeof(a=l[n])===f&&0<a.length?2==a.length?typeof a[1]==m?e[a[0]]=a[1].call(this,r):e[a[0]]=a[1]:3==a.length?typeof a[1]!==m||a[1].exec&&a[1].test?e[a[0]]=r?r.replace(a[1],a[2]):d:e[a[0]]=r?a[1].call(this,r,a[2]):d:4==a.length&&(e[a[0]]=r?a[3].call(this,r.replace(a[1],a[2])):d):e[a]=r||d;break}if(s)break}return e},str:function(e,t){for(var i in t)if(typeof t[i]===f&&0<t[i].length){for(var n=0;n<t[i].length;n++)if(v.has(t[i][n],e))return"?"===i?d:i}else if(v.has(t[i],e))return"?"===i?d:i;return e}},x={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},w={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[i,r,e],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[i,"Opera"],r,e],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[i,r,e],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[i,"IE"],r,e],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[i,"Yandex"],r,e],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[i,/_/g," "],r,e],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i],[i,r,e],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[i,"Dolphin"],r,e],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[i,"Chrome"],r,e],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[r,e,[i,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[r,e,i],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[i,[e,g.str,x.browser.oldsafari.major],[r,g.str,x.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[i,r,e],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[i,"Netscape"],r,e],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[i,r,e]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[o,"amd64"]],[/(ia32(?=;))/i],[[o,v.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[o,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[o,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[o,/ower/,"",v.lowerize]],[/(sun4\w)[;\)]/i],[[o,"sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[o,v.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[t,s,[n,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[t,[s,"Apple"],[n,l]],[/(apple\s{0,1}tv)/i],[[t,"Apple TV"],[s,"Apple"]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[s,t,[n,l]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[t,[s,"Amazon"],[n,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[t,g.str,x.device.amazon.model],[s,"Amazon"],[n,u]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[t,s,[n,u]],[/\((ip[honed|\s\w*]+);/i],[t,[s,"Apple"],[n,u]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[s,t,[n,u]],[/\((bb10);\s(\w+)/i],[[s,"BlackBerry"],t,[n,u]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7))/i],[[s,"Asus"],t,[n,l]],[/(sony)\s(tablet\s[ps])/i],[s,t,[n,l]],[/(nintendo)\s([wids3u]+)/i],[s,t,[n,c]],[/((playstation)\s[3portablevi]+)/i],[[s,"Sony"],t,[n,c]],[/(sprint\s(\w+))/i],[[s,g.str,x.device.sprint.vendor],[t,g.str,x.device.sprint.model],[n,u]],[/(Lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[[s,"Lenovo"],t,[n,l]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[s,[t,/_/g," "],[n,u]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[s,"Motorola"],t,[n,u]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[s,"Motorola"],t,[n,l]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[s,"Samsung"],t,[n,l]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[s,"Samsung"],t,[n,u]],[/(sie)-(\w+)*/i],[[s,"Siemens"],t,[n,u]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[s,"Nokia"],t,[n,u]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[s,"Acer"],t,[n,l]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[s,"LG"],t,[n,l]],[/(lg) netcast\.tv/i],[s,[n,h]],[/((nexus\s[45]))/i,/(lg)[e;\s\/-]+(\w+)*/i],[[s,"LG"],t,[n,u]],[/android.+((ideatab[a-z0-9\-\s]+))/i],[[s,"Lenovo"],t,[n,l]],[/linux;.+((jolla));/i],[s,t,[n,u]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[n,v.lowerize],s,t]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[i,r],[/rv\:([\w\.]+).*(gecko)/i],[r,i]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[i,r],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[i,[r,g.str,x.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[i,"Windows"],[r,g.str,x.os.windows.version]],[/\((bb)(10);/i],[[i,"BlackBerry"],r],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[i,r],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[i,"Symbian"],r],[/\((series40);/i],[i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[i,"Firefox OS"],r],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[i,r],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[i,"Chromium OS"],r],[/(sunos)\s?([\w\.]+\d)*/i],[[i,"Solaris"],r],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[i,r],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[i,"iOS"],[r,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[i,[r,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[i,r]]},y=function(e,t){if(!(this instanceof y))return new y(e,t).getResult();var i=e||(a&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:""),n=t?v.extend(w,t):w;this.getBrowser=function(){return g.rgx.apply(this,n.browser)},this.getCPU=function(){return g.rgx.apply(this,n.cpu)},this.getDevice=function(){return g.rgx.apply(this,n.device)},this.getEngine=function(){return g.rgx.apply(this,n.engine)},this.getOS=function(){return g.rgx.apply(this,n.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this.setUA(i)};if(y.VERSION="0.7.1",y.BROWSER={NAME:i,MAJOR:e,VERSION:r},y.CPU={ARCHITECTURE:o},y.DEVICE={MODEL:t,VENDOR:s,TYPE:n,CONSOLE:c,MOBILE:u,SMARTTV:h,TABLET:l},y.ENGINE={NAME:i,VERSION:r},y.OS={NAME:i,VERSION:r},typeof exports!==p)typeof module!==p&&module.exports&&(exports=module.exports=y),exports.UAParser=y;else{a.UAParser=y,typeof define===m&&define.amd&&define("UAParser",[],function(){return y});var _=a.jQuery||a.Zepto;if(typeof _!==p){var b=new y;_.ua=b.getResult(),_.ua.get=function(){return b.getUA()},_.ua.set=function(e){b.setUA(e);var t=b.getResult();for(var i in t)_.ua[i]=t[i]}}}}(this);var max=max||{};!function(s){max.views=max.views||{},s.extend(max.views,function(){function e(e){var i=this;i.minchars=e.minchars,i.maxui=e.maxui,i.source=e.source,i.action=e.action,i.filter=e.filter,i.requests={},i.$el=s(e.list),i.$list=i.$el.find("ul"),i.$el.on("click",".maxui-prediction",function(e){var t=s(e.currentTarget);i.select(t),i.choose(e)})}function t(e){var t=this;t.input=e.input,t.$input=s(t.input),t.placeholder=e.placeholder,t.$delegate=s(e.delegate),t.setBindings(),t.bindings=e.bindings,t.$input.val(t.placeholder)}return e.prototype.select=function(e){this.$list.find(".maxui-prediction.selected").removeClass("selected"),e.addClass("selected")},e.prototype.choose=function(e){var t=this.$list.find(".maxui-prediction.selected");this.action.apply(this,[t]),this.hide()},e.prototype.moveup=function(e){var t=this.$list.find(".maxui-prediction.selected"),i=t.prev();0<i.length?this.select(i):this.select(t.siblings(":last"))},e.prototype.movedown=function(e){var t=this.$list.find(".maxui-prediction.selected"),i=t.next();t.removeClass("selected"),0<i.length?this.select(i):this.select(t.siblings(":first"))},e.prototype.matchingRequest=function(e){var i,n=e.substr(0,e.length-1);if(s.each(this.requests,function(e,t){n===e&&(i=t)}),i&&!i.remaining)return i.text},e.prototype.normalizeWhiteSpace=function(e,t){e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return 1<arguments.length&&(i=t),!0===i&&(e=e.replace(/[ ]{2,}/gi," ")),e},e.prototype.show=function(e){var t=this,i=s(e.target),n=t.normalizeWhiteSpace(i.val(),!1);if(n.length>=this.minchars){var a=t.matchingRequest(n);t.requests.hasOwnProperty(n)?t.render(n,n):a?t.render(n,a):this.source.apply(this,[e,n,function(e){t.requests[n]={text:n,data:e,remaining:this.getResponseHeader("X-Has-Remaining-Items")},t.render(n,n)}])}else t.hide()},e.prototype.render=function(e,t){for(var i=this,n="",a=i.requests[t].data,s=i.filter(),r=!1,o=0;o<a.length;o++){var c=a[o],u=0<=c.username.search(new RegExp(e,"i")),l=0<=c.displayName.search(new RegExp(e,"i"))||u;if(-1===s.indexOf(c.username)&&l){var d=i.maxui.settings.avatarURLpattern.format(c.username),m={username:c.username,displayName:c.displayName,avatarURL:d,cssclass:"maxui-prediction"+(r?"":" selected")};n+=i.maxui.templates.predictive.render(m),r=!0}}""===n&&(n="<li>"+i.maxui.settings.literals.no_match_found+"</li>"),i.$list.html(n),i.$el.show()},e.prototype.hide=function(e){this.$el.hide()},t.prototype.normalizeWhiteSpace=function(e,t){e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return 1<arguments.length&&(i=t),!0===i&&(e=e.replace(/[ ]{2,}/gi," ")),e},t.prototype.bind=function(e,t){this.$delegate.on(e,this.input,t)},t.prototype.execExtraBinding=function(e,t){this.bindings.hasOwnProperty(t.type)&&this.bindings[t.type].apply(e,[t])},t.prototype.getInputValue=function(){var e=this.$input.val();return this.normalizeWhiteSpace(e,!1)},t.prototype.setBindings=function(){var t=this;t.bind("focusin",function(e){e.preventDefault(),e.stopPropagation(),t.getInputValue()===t.placeholder&&s(this).val(""),t.execExtraBinding(this,e)}),t.bind("focusout",function(e){e.preventDefault(),e.stopPropagation(),""===t.getInputValue()&&(s(this).val(t.placeholder),t.$input.toggleClass("maxui-empty",!0)),t.execExtraBinding(this,e)}),t.bind("maxui-input-submit maxui-input-cancel maxui-input-up maxui-input-down maxui-input-keypress",function(e){e.preventDefault(),e.stopPropagation(),t.execExtraBinding(this,e)}),t.bind("maxui-input-clear",function(e){t.$input.val(t.placeholder)}),t.bind("keydown",function(e){38===e.which?t.$input.trigger("maxui-input-up",[e]):40===e.which&&t.$input.trigger("maxui-input-down",[e]),t.$input.toggleClass("maxui-empty",!1)}),t.bind("keyup",function(e){e.preventDefault(),e.stopPropagation(),13!==e.which||e.shiftKey?27===e.which?t.$input.trigger("maxui-input-cancel",[e]):38!==e.which&&40!==e.which&&t.$input.trigger("maxui-input-keypress",[e]):t.$input.trigger("maxui-input-submit",[e]),t.execExtraBinding(this,e)})},{MaxInput:t,MaxPredictive:e}}())}(jQuery);var max=max||{};!function(i){max.views=max.views||{},i.extend(max.views,function(){function e(e){var t=this;t.maxui=e,t.title="Overlay Title",t.content="",t.el="#maxui-overlay-panel",t.overlay_show_class=0<i("#box_chat").length?"#box_chat .maxui-overlay":".maxui-overlay",i(t.el+" .maxui-close").click(function(e){e.preventDefault(),e.stopPropagation(),t.maxui.overlay.hide()})}return e.prototype.$el=function(){return i(this.el)},e.prototype.setTitle=function(e){this.$el().find("#maxui-overlay-title").text(e)},e.prototype.setContent=function(e){this.$el().find("#maxui-overlay-content").html(e)},e.prototype.configure=function(e){this.setTitle(e.title),this.setContent(e.content),e.bind(this)},e.prototype.show=function(e){var t=this;e.load(function(e){t.configure(e)}),i(t.overlay_show_class).show(),t.$el().animate({opacity:1},200)},e.prototype.hide=function(){var t=this;t.$el().trigger("maxui-overlay-close",[]),t.$el().animate({opacity:0},200,function(e){i(t.overlay_show_class).hide()})},{MaxOverlay:e}}())}(jQuery);var max=max||{};!function(n){max.views=max.views||{},n.extend(max.views,function(){function e(e){var t=this;t.maxui=e.maxui,t.width=e.width,t.handle=e.handle,t.dragging=!1,t.scrollbar_selector=e.scrollbar,t.$bar=n(t.scrollbar_selector),t.$dragger=t.$bar.find(".maxui-dragger"),t.target_selector=e.target,t.$target=n(t.target_selector),t.bind()}return e.prototype.bind=function(){var o=this;o.$target.on("mousewheel",function(e,t,i,n){if(e.preventDefault(),e.stopPropagation(),o.enabled()){var a=o.$target.height()-o.maxtop-o.handle.height,s=parseInt(o.$target.css("margin-top"),10)+1*n*10;0<s&&(s=0),s<-1*a&&(s=-1*a),o.$target.css({"margin-top":s});var r=100*(s*=-1)/a;o.setDraggerPosition(r)}}),n(document).on("mousemove",function(e){if(o.dragging&&(e.stopPropagation(),e.preventDefault(),o.enabled())){var t=e.clientY+n(window).scrollTop()-o.$bar.offset().top;t<0&&(t=0),t>=o.maxtop&&(t=o.maxtop);var i=100*t/o.maxtop;o.setContentPosition(i)}}),n(document.body).on("mousedown",".maxui-dragger",function(e){e.stopPropagation(),e.preventDefault(),o.dragging=!0}),n(document).on("mouseup",function(e){o.dragging=!1})},e.prototype.setHeight=function(e){var t=n("#maxui-conversations .maxui-wrapper").offset().top-this.maxui.offset().top-1;this.$bar.css({height:e,top:t}),this.maxtop=e-this.handle.height-2},e.prototype.setTarget=function(e){this.$target=n(e)},e.prototype.setDraggerPosition=function(e){var t=this.maxtop*e/100;this.$dragger.css({"margin-top":t})},e.prototype.setContentPosition=function(e){var t=this;if(t.enabled()){var i=(t.$target.height()-t.maxtop-t.handle.height)*e/100;t.$target.css({"margin-top":-1*i}),t.setDraggerPosition(e)}else t.$target.css({"margin-top":""}),t.setDraggerPosition(0)},e.prototype.enabled=function(){return this.$target.height()>this.maxtop},{MaxScrollbar:e}}())}(jQuery);var max=max||{};!function(c){max.views=max.views||{},c.extend(max.views,function(){function e(i){var n=this;n.maxui=i,n.title=i.settings.literals.conversations_info_title,n.content="<div>Hello world</div>",n.panelID="conversation-settings-panel",n.displayNameSlot={show:function(){var e=c(n.getOwnerSelector("")),t=c(n.getOwnerSelector("> #maxui-conversation-displayname-edit")),i=c(n.getOwnerSelector("> .maxui-displayname"));c(n.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname")).width(e.width()-82),i.hide(),t.show().val(i.text()).focus()},hide:function(){var e=c(n.getOwnerSelector("> #maxui-conversation-displayname-edit"));c(n.getOwnerSelector("> .maxui-displayname")).show(),e.hide().val("")},save:function(){var t=c(n.getOwnerSelector("> .maxui-displayname")),e=c(n.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname"));i.maxClient.modifyConversation(n.data.id,e.val(),function(e){n.displayNameSlot.hide(),t.text(this.displayName),i.conversations.messagesview.setTitle(this.displayName)})}}}return e.prototype.getOwnerSelector=function(e){return"#maxui-"+this.panelID+".maxui-owner "+e},e.prototype.getSelector=function(e){return"#maxui-"+this.panelID+" "+e},e.prototype.bind=function(r){var o=this;r.$el().unbind(),r.$el().on("maxui-overlay-close",function(e){var t=_.where(o.maxui.conversations.listview.conversations,{id:o.maxui.conversations.active});_.isEmpty(t)||o.maxui.conversations.listview.loadConversation(o.maxui.conversations.active)}),r.$el().on("click",o.getOwnerSelector("> .maxui-displayname"),function(e){o.displayNameSlot.show()}),r.$el().on("keyup",o.getOwnerSelector("> #maxui-conversation-displayname-edit input.maxui-displayname"),function(e){27===e.which?o.displayNameSlot.hide():13===e.which&&o.displayNameSlot.save()}),r.$el().on("click",o.getOwnerSelector("#maxui-conversation-displayname-edit i.maxui-icon-ok-circled"),function(e){o.displayNameSlot.save()}),r.$el().on("click",o.getOwnerSelector("#maxui-conversation-displayname-edit i.maxui-icon-cancel-circled"),function(e){o.displayNameSlot.hide()}),r.$el().on("click",o.getOwnerSelector(".maxui-conversation-user-action"),function(e){var t=c(e.currentTarget),i=t.closest(".maxui-participant");i.find(".maxui-conversation-confirmation:visible").hide(),i.find(".maxui-conversation-user-action.active").removeClass("active"),t.addClass("active"),t.hasClass("maxui-icon-crown-plus")?i.find(".maxui-conversation-transfer-to").show():t.hasClass("maxui-icon-trash")&&i.find(".maxui-conversation-kick-user").show()}),r.$el().on("click",o.getSelector(".maxui-participant .maxui-conversation-transfer-to .maxui-icon-ok-circled"),function(e){var t=c(e.currentTarget).closest(".maxui-participant"),i=t.attr("data-username"),n=c(o.getSelector(".maxui-participant.maxui-owner")),a=n.find(".maxui-icon-crown"),s=t.find(".maxui-icon-crown-plus");o.maxui.maxClient.transferConversationOwnership(o.data.id,i,function(e){t.find(".maxui-conversation-transfer-to").hide(),a.removeClass("maxui-icon-crown").addClass("maxui-icon-crown-plus"),s.removeClass("maxui-icon-crown-plus").addClass("maxui-icon-crown"),n.removeClass("maxui-owner"),t.addClass("maxui-owner"),r.$el().find(o.getSelector("")).toggleClass("maxui-owner",!1),r.$el().find(o.getSelector("#maxui-new-participant")).remove(),s.removeClass("active")})}),r.$el().on("click",o.getSelector(".maxui-participant .maxui-conversation-kick-user .maxui-icon-ok-circled"),function(e){var t=c(e.currentTarget).closest(".maxui-participant"),i=t.attr("data-username");o.maxui.maxClient.kickUserFromConversation(o.data.id,i,function(e){t.remove()})}),r.$el().on("click",o.getSelector(".maxui-participant .maxui-conversation-confirmation .maxui-icon-cancel-circled"),function(e){var t=c(e.currentTarget).closest(".maxui-participant");t.find(".maxui-conversation-confirmation:visible").hide(),t.find(".maxui-conversation-user-action.active").removeClass("active")}),o.predictive=new max.views.MaxPredictive({maxui:o.maxui,minchars:3,filter:function(e){return c.map(o.data.participants,function(e,t){return e.username})},source:function(e,t,i){o.maxui.maxClient.getUsersList(t,i)},action:function(e){var t=e.attr("data-username"),i={style:"opacity:0; height:0px;",username:t,displayName:e.attr("data-username"),literals:o.maxui.settings.literals,avatarURL:o.maxui.settings.avatarURLpattern.format(t)},n=o.maxui.templates.participant.render(i);c(o.getSelector(".maxui-participants > ul")).append(n);var a=c(o.getSelector(".maxui-participant:last"));a.animate({height:36},100,function(e){a.animate({opacity:1},200)}),a.find(".maxui-conversation-add-user").show().focus(),c(o.getSelector("#maxui-new-participant .maxui-text-input")).trigger("maxui-input-clear")},list:"#maxui-new-participant #maxui-conversation-predictive"}),o.newparticipant=new max.views.MaxInput({input:"#maxui-new-participant .maxui-text-input",delegate:r.el,placeholder:o.maxui.settings.literals.conversations_info_add,bindings:{"maxui-input-keypress":function(e){o.predictive.show(e)},"maxui-input-submit":function(e){o.predictive.choose(e)},"maxui-input-cancel":function(e){o.predictive.hide(e)},"maxui-input-up":function(e){o.predictive.moveup(e)},"maxui-input-down":function(e){o.predictive.movedown(e)}}}),r.$el().on("click",o.getOwnerSelector(".maxui-participant .maxui-conversation-add-user .maxui-icon-ok-circled"),function(e){var t=c(e.target).closest(".maxui-participant"),i=t.attr("data-username");o.maxui.maxClient.addUserToConversation(o.data.id,i,function(e){t.animate({opacity:0},200,function(e){t.find(".maxui-conversation-add-user").remove(),t.animate({opacity:1},200),t.find(".maxui-conversation-user-action").show()})})}),r.$el().on("click",o.getOwnerSelector(".maxui-participant .maxui-conversation-add-user .maxui-icon-cancel-circled"),function(e){var t=c(e.currentTarget).closest(".maxui-participant");t.animate({opacity:0},200,function(e){t.animate({height:0},200,function(e){t.remove()})})}),r.$el().on("click",o.getSelector("#maxui-conversation-leave .maxui-button"),function(e){var t=o.maxui.settings.username;o.maxui.maxClient.kickUserFromConversation(o.data.id,t,function(e){o.maxui.conversations.listview.remove(o.data.id),r.hide(),c("#maxui-back-conversations a").trigger("click")})}),r.$el().on("click",o.getSelector("#maxui-conversation-delete .maxui-button"),function(e){c(o.getSelector("#maxui-conversation-delete .maxui-help")).show()}),r.$el().on("click",o.getSelector("#maxui-conversation-delete .maxui-help .maxui-confirmation-ok"),function(e){o.maxui.maxClient.deleteConversation(o.data.id,function(e){o.maxui.conversations.listview.remove(o.data.id),r.hide(),c("#maxui-back-conversations a").trigger("click")})}),r.$el().on("click",o.getSelector("#maxui-conversation-delete .maxui-help .maxui-confirmation-cancel"),function(e){c(o.getSelector("#maxui-conversation-delete .maxui-help")).hide()})},e.prototype.load=function(u){var l=this;l.maxui.maxClient.getConversation(l.maxui.conversations.active,function(c){l.maxui.maxClient.getConversationSubscription(l.maxui.conversations.active,l.maxui.settings.username,function(e){l.data=c;for(var t=[],i=0;i<l.data.participants.length;i++){var n=l.data.participants[i];n.avatarURL=l.maxui.settings.avatarURLpattern.format(n.username),n.owner=n.username===l.data.owner,t.push(n)}var a=l.maxui.settings.conversationAvatarURLpattern.format(l.data.id),s=l.data.displayName;if(l.data.participants.length<=2){var r=l.data.participants[0];1===l.data.participants.length?s="[Archive] "+r.displayName:l.data.participants[0].username===l.maxui.settings.username&&1<l.data.participants.length&&(r=l.data.participants[1]),a=l.maxui.settings.avatarURLpattern.format(r.username)}var o={displayName:s,conversationAvatarURL:a,participants:t,literals:l.maxui.settings.literals,panelID:l.panelID,published:l.maxui.utils.formatDate(l.data.published,l.maxui.language),canManage:l.maxui.settings.username===l.data.owner,canAdd:_.contains(e.permissions,"invite")};l.content=l.maxui.templates.conversationSettings.render(o),u(l)})})},{MaxChatInfo:e}}())}(jQuery);var max=max||{};!function(f){max.views=max.views||{},f.extend(max.views,function(){function n(e,t){this.conversations=[],this.mainview=e,this.maxui=this.mainview.maxui}function a(e,t){var i=this;i.messages={},i.mainview=e,i.maxui=i.mainview.maxui,i.remaining=!0}function e(e,t){var i=this;i.logtag="CONVERSATIONS",i.el="#maxuichat-widget-container #maxui-conversations",i.$el=f(i.el),i.maxui=e,i.height=320,i.listview=new n(i,{}),i.messagesview=new a(i,{}),i.conversationSettings=new max.views.MaxChatInfo(i.maxui),i.active=""}return n.prototype.load=function(t){var i=this;_.isArray(t)?(i.conversations=t,i.render(!1)):_.isFunction(t)&&i.maxui.maxClient.getConversationsForUser.apply(i.maxui.maxClient,[i.maxui.settings.username,function(e){i.maxui.logger.info("Loaded {0} conversations from max".format(i.maxui.settings.username),i.mainview.logtag),i.conversations=e,i.render(),t()}])},n.prototype.loadConversation=function(e){var i,n=this;1<arguments.length&&(i=arguments[1]),n.maxui.maxClient.getConversationSubscription(e,n.maxui.settings.username,function(t){_.findWhere(n.conversations,{id:t.id})?n.conversations=_.map(n.conversations,function(e){return e.id===t.id?t:e}):(t.unread_messages=1,n.conversations.push(t)),n.sort(),n.render(),_.isUndefined(i)||i.call(n.mainview)})},n.prototype.updateLastMessage=function(t,i){var n=this;n.conversations=_.map(n.conversations,function(e){return e.id===t&&(e.lastMessage=i,_.defaults(e,{unread_messages:0}),n.maxui.settings.username!==i.user&&(e.unread_messages+=1)),e},n),n.sort()},n.prototype.resetUnread=function(t){this.conversations=_.map(this.conversations,function(e){return e.id===t&&(e.unread_messages=0),e},this),this.mainview.updateUnreadConversations()},n.prototype.sort=function(){this.conversations=_.sortBy(this.conversations,function(e){return e.lastMessage.published}),this.conversations.reverse()},n.prototype.remove=function(t){this.conversations=_.filter(this.conversations,function(e){return e.id!==t}),this.sort(),this.render()},n.prototype.insert=function(e){this.conversations.push(e),this.sort(),this.render()},n.prototype.show=function(){var e=this;e.mainview.loadWrappers(),e.mainview.$newparticipants.show(),0===e.conversations.length?e.load():e.render(),e.toggle()},n.prototype.toggle=function(){var t=this;t.mainview.loadWrappers();var e="";if(!t.mainview.visible()){t.mainview.$addpeople.css({"border-color":"#ccc"}),t.mainview.$common_header.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),t.mainview.scrollbar.setHeight(t.mainview.height-60),t.mainview.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),t.mainview.scrollbar.setContentPosition(0),t.mainview.$addpeople.animate({height:19,"padding-top":6,"padding-bottom":6},400,function(e){t.mainview.$addpeople.removeAttr("style")});var i=t.mainview.$conversations_list.width()+11;t.mainview.$conversations_list.animate({"margin-left":0},400),t.mainview.$messages.animate({left:i+20},400),t.maxui.settings.conversationsSection="conversations",e=t.maxui.settings.literals.new_conversation_text,t.mainview.$postbox.val(e).attr("data-literal",e)}},n.prototype.render=function(){var e=!0;0<arguments.length&&(e=arguments[0]);var t=this,i='<span id="maxui-info">'+t.maxui.settings.literals.no_chats+"<span>",n="conversations"===t.maxui.settings.UISection,a=!1===t.maxui.settings.disableConversations&&!n,s={avatar:t.maxui.settings.avatarURLpattern.format(t.maxui.settings.username),allowPosting:!0,buttonLiteral:t.maxui.settings.literals.new_message_post,textLiteral:t.maxui.settings.literals.new_conversation_text,literals:t.maxui.settings.literals,showConversationsToggle:a?"display:block;":"display:none;",showSubscriptionList:!1},r=t.maxui.templates.postBoxChat.render(s),o=f("#maxuichat-widget-container #maxui-newactivity-chat");e&&o.html(r),0<t.conversations.length&&(i="");for(var c=0;c<t.conversations.length;c++){var u=t.conversations[c],l=u.participants[0],d=t.maxui.settings.conversationAvatarURLpattern.format(u.id),m="";u.participants.length<=2&&(1===u.participants.length?(l=u.participants[0],m+="[Archive] "):u.participants[0].username===t.maxui.settings.username&&(l=u.participants[1]),d=t.maxui.settings.avatarURLpattern.format(l.username)),m+=u.displayName;var p={id:u.id,displayName:m,text:t.maxui.utils.formatText(u.lastMessage.content),messages:u.unread_messages,literals:t.maxui.settings.literals,date:t.maxui.utils.formatDate(u.lastMessage.published,t.maxui.language),avatarURL:d,hasUnread:0<u.unread_messages};i+=t.maxui.templates.conversation.render(p)}f("#maxuichat-widget-container #maxui-conversations-list").html(i)},a.prototype.load=function(){var n=this,i=n.mainview.active;0<arguments.length&&(i=arguments[0]),n.messages[i]=[],n.maxui.maxClient.getMessagesForConversation(i,{limit:10},function(e){n.maxui.logger.info("Loaded conversation {0} messages from max".format(i),n.mainview.logtag),n.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(e,function(e,t,i){e.ack=!0,n.append(e)});var t=_.last(n.messages[i]);n.mainview.listview.updateLastMessage(i,{content:t.data.text,published:t.published,user:t.user.username}),n.mainview.listview.resetUnread(i),n.mainview.listview.render(!1),n.mainview.updateUnreadConversations(),n.render()})},a.prototype.ack=function(t){var e=this;e.maxui.logger.info("Acknowledged Message {0} --\x3e {1}".format(t.uuid,t.data.id),e.mainview.logtag);var i=f("#"+t.uuid),n=i.hasClass("maxui-user-me"),a=i.find(".maxui-icon-check");a&&n&&(a.addClass("maxui-ack"),e.messages[e.mainview.active]=_.map(e.messages[e.mainview.active],function(e){return t.uuid===e.uuid&&(e.ack=!0),e}),i.attr("id",t.data.id))},a.prototype.exists=function(e){var t=_.findWhere(this.messages[e.destination],{uuid:e.uuid});return _.isUndefined(t)},a.prototype.setTitle=function(e){this.mainview.$common_header.find("#maxui-back-conversations .maxui-title").text(e)},a.prototype.loadNew=function(){var n=this,e=_.last(n.messages[n.mainview.active]);n.maxui.maxClient.getMessagesForConversation(n.mainview.active,{limit:10,after:e.uuid},function(e){n.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(e,function(e,t,i){e.ack=!0,n.prepend(e,t)}),n.render()})},a.prototype.loadOlder=function(){var n=this,e=_.first(n.messages[n.mainview.active]);n.maxui.maxClient.getMessagesForConversation(n.mainview.active,{limit:10,before:e.uuid},function(e){n.remaining=this.getResponseHeader("X-Has-Remaining-Items"),_.each(e,function(e,t,i){e.ack=!0,n.prepend(e,t)}),n.render()})},a.prototype.append=function(e){var t,i=this;_.has(e,"data")?t=e:(t={action:"add",object:"message",user:{username:e.actor.username,displayname:e.actor.displayName},published:e.published,data:{text:e.object.content,objectType:e.object.objectType},uuid:e.id,destination:e.contexts[0].id,ack:e.ack},_.contains(["image","file"],e.object.objectType)&&(t.data.fullURL=e.object.fullURL,t.data.thumbURL=e.object.thumbURL)),i.mainview.listview.updateLastMessage(t.destination,{content:t.data.text,published:t.published,user:t.user.username}),i.messages[t.destination]=i.messages[t.destination]||[],i.messages[t.destination].push(t)},a.prototype.prepend=function(e,t){var i,n=this;_.has(e,"data")||(i={action:"add",object:"message",user:{username:e.actor.username,displayname:e.actor.displayName},published:e.published,data:{text:e.object.content,objectType:e.object.objectType},uuid:e.id,destination:e.contexts[0].id,ack:e.ack},_.contains(["image","file"],e.object.objectType)&&(i.data.fullURL=e.object.fullURL,i.data.thumbURL=e.object.thumbURL)),n.messages[n.mainview.active]=n.messages[n.mainview.active]||[],n.messages[n.mainview.active].splice(t,0,i)},a.prototype.render=function(){var n=this,e="",t=[];if(n.messages[n.mainview.active]){n.setTitle(n.mainview.getActive().displayName);for(var i=0;i<n.messages[n.mainview.active].length;i++){var a=n.messages[n.mainview.active][i],s=n.maxui.settings.avatarURLpattern.format(a.user.username),r="maxui-user-notme",o=!0;a.user.username===n.maxui.settings.username&&(o=!(r="maxui-user-me")),_.defaults(a.data,{filename:a.uuid});var c=_.contains(_.findWhere(n.mainview.listview.conversations,{id:n.mainview.active}).tags,"group"),u={id:a.uuid,text:n.maxui.utils.formatText(a.data.text),date:n.maxui.utils.formatDate(a.published,n.maxui.language),othersMessage:o,literals:n.maxui.settings.literals,avatarURL:s,displayName:a.user.displayname,showDisplayName:o&&c,ack:!!a.ack&&"maxui-user-me"===r,fileDownload:"file"===a.data.objectType,filename:a.data.filename,auth:{token:n.maxui.settings.oAuthToken,username:n.maxui.settings.username}};e+=n.maxui.templates.message.render(u),"image"===a.data.objectType&&t.push(a)}f("#maxuichat-widget-container #maxui-messages #maxui-message-list").html(e),_.each(t,function(i,e,t){n.maxui.maxClient.getMessageImage("/messages/{0}/image/thumb".format(i.uuid),function(e){var t='<img class="maxui-embedded" alt="" src="data:image/png;base64,{0}" />'.format(e);f("#maxuichat-widget-container .maxui-message#{0} .maxui-body".format(i.uuid)).after(t),n.mainview.scrollbar.setContentPosition(100)})});var l=f("#maxuichat-widget-container #maxui-messages #maxui-more-messages");"1"===n.remaining?l.show():l.hide()}},a.prototype.show=function(e){var t=this;t.mainview.loadWrappers();var i=f("#maxuichat-widget-container #maxui-newactivity-chat").find("input.maxui-button");i.removeAttr("disabled"),i.attr("class","maxui-button"),t.mainview.$newmessagebox.find("textarea").attr("class","maxui-text-input"),t.mainview.$newmessagebox.find(".maxui-error-box").animate({"margin-top":-26},200),t.mainview.$newparticipants.hide(),t.mainview.active=e,t.mainview.listview.resetUnread(e),_.has(t.messages,e)?t.render():t.load(),t.toggle()},a.prototype.toggle=function(){var t=this;t.mainview.loadWrappers();var e="";"messages"!==t.maxui.settings.conversationsSection&&(t.mainview.$addpeople.animate({height:0,"padding-top":0,"padding-bottom":0},400,function(e){t.mainview.$addpeople.css({"border-color":"transparent"})}),t.setTitle(t.mainview.getActive().displayName),t.mainview.$common_header.removeClass("maxui-showing-conversations").addClass("maxui-showing-messages"),t.mainview.$conversations_list.animate({"margin-left":-1*t.maxui.settings.sectionsWidth},400),t.mainview.$messages.animate({left:0,"margin-left":0},400,function(e){t.mainview.scrollbar.setHeight(t.mainview.height-60),t.mainview.scrollbar.setTarget("#maxui-conversations #maxui-messages"),t.mainview.scrollbar.setContentPosition(100)}),t.mainview.$messages.width(t.maxui.settings.sectionsWidth),t.maxui.settings.conversationsSection="messages",e=t.maxui.settings.literals.new_activity_text,t.mainview.$postbox.val(e).attr("data-literal",e))},e.prototype.visible=function(){return this.$conversations.is(":visible")&&0<this.$conversations.height},e.prototype.loadScrollbar=function(){var e=this;e.scrollbar=new max.views.MaxScrollbar({maxui:e.maxui,width:e.maxui.settings.scrollbarWidth,handle:{height:20},scrollbar:e.el+" #maxui-scrollbar",target:e.el})},e.prototype.getActive=function(){return _.findWhere(this.listview.conversations,{id:this.active})},e.prototype.loadWrappers=function(){var e=this;e.$conversations=f("#maxuichat-widget-container #maxui-conversations"),e.$conversations_list=f("#maxuichat-widget-container #maxui-conversations-list"),e.$conversations_wrapper=e.$conversations.find(".maxui-wrapper"),e.$messages=f("#maxuichat-widget-container #maxui-messages"),e.$message_list=f("#maxuichat-widget-container #maxui-message-list"),e.$postbox=f("#maxuichat-widget-container #maxui-newactivity-box textarea"),e.$common_header=e.$conversations.find("#maxui-common-header"),e.$addpeople=f("#maxuichat-widget-container #maxui-add-people-box"),e.$newparticipants=f("#maxuichat-widget-container #maxui-new-participants"),e.$newmessagebox=f("#maxuichat-widget-container #maxui-newactivity-chat")},e.prototype.render=function(){this.loadScrollbar(),this.bindEventsChat()},e.prototype.bindEventsChat=function(){var i=this;f("#maxuichat-widget-container #maxui-conversation-info").click(function(e){e.preventDefault(),e.stopPropagation(),i.maxui.overlay.show(i.conversationSettings)}),f("#maxuichat-widget-container #maxui-back-conversations").on("click",function(e){e.preventDefault(),e.stopPropagation(),window.status="",i.listview.show()}),f("#maxuichat-widget-container #maxui-conversations").on("click",".maxui-conversation",function(e){e.preventDefault(),e.stopPropagation(),window.status="";var t=f(e.target).closest(".maxui-conversation").attr("id");i.messagesview.show(t)}),f("#maxuichat-widget-container #maxui-conversations").on("click","#maxui-more-messages .maxui-button",function(e){e.preventDefault(),e.stopPropagation(),window.status="",i.messagesview.loadOlder()})},e.prototype.send=function(e){var t=this,i={data:{text:e},action:"add",object:"message"},n=t.maxui.messaging.send(i,"{0}.messages".format(t.active));f("#maxuichat-widget-container #maxui-newactivity-chat textarea").val(""),f("#maxuichat-widget-container #maxui-newactivity-chat .maxui-button").attr("disabled","disabled"),n.ack=!1,n.destination=t.active,t.messagesview.append(n),t.messagesview.show(t.active),t.scrollbar.setContentPosition(100),t.listview.updateLastMessage(t.active,{content:n.data.text,published:n.published,user:n.user.username})},e.prototype.create=function(a){var s=this;a.participants.push(s.maxui.settings.username),s.maxui.maxClient.addMessageAndConversation(a,function(e){var t=this,i=t.contexts[0].id,n={id:i,displayName:t.contexts[0].displayName,lastMessage:{content:t.object.content,published:t.published},participants:a.participants,tags:t.contexts[0].tags};s.active=i,s.listview.insert(n),s.messagesview.remaining=0,t.ack=!0,s.loadWrappers(),s.messagesview.append(t),s.messagesview.render(),s.messagesview.show(i),s.hideNameChat(),s.$newparticipants[0].people=[],s.maxui.reloadPersonsChat()})},e.prototype.hideNameChat=function(){f("#maxuichat-widget-container #maxui-add-people-box #maxui-new-displayName input").val(""),f("#maxuichat-widget-container #maxui-add-people-box #maxui-new-displayName").hide()},e.prototype.updateUnreadConversations=function(e){var t=f("#maxuichat-widget-container #maxui-show-conversations .maxui-unread-conversations"),i=_.filter(this.listview.conversations,function(e){if(0<e.unread_messages)return e});0<i.length?(t.text(i.length),t.removeClass("maxui-hidden")):t.addClass("maxui-hidden")},e.prototype.ReceiveMessage=function(e){var t=this,i=e.user.username!==t.maxui.settings.username,n=t.messagesview.exists(e);(i||n)&&(i?t.maxui.logger.log("New message from user {0} on {1}".format(e.user.username,e.destination),t.logtag):t.maxui.logger.log("Updating {1} messages sent from other {0} instances".format(e.user.username,e.destination),t.logtag),t.messagesview.append(e),t.updateUnreadConversations(),"conversations"===t.maxui.settings.UISection&&"messages"===t.maxui.settings.conversationsSection?(t.messagesview.render(!1),t.scrollbar.setContentPosition(100)):"conversations"===t.maxui.settings.UISection&&"conversations"===t.maxui.settings.conversationsSection?t.listview.render(!1):"timeline"===t.maxui.settings.UISection&&t.listview.render(!1))},e.prototype.ReceiveConversation=function(t){var i=this,e=t.user.username!==i.maxui.settings.username,n=i.messagesview.exists(t);(e||n)&&("conversations"===i.maxui.settings.UISection&&"conversations"===i.maxui.settings.conversationsSection?(i.active=t.destination,i.listview.loadConversation(t.destination,function(e){this.messagesview.show(t.destination)})):"conversations"===i.maxui.settings.UISection&&"messages"===i.maxui.settings.conversationsSection?(i.active=t.destination,i.listview.loadConversation(t.destination,function(e){this.messagesview.load(),this.listview.resetUnread(t.destination)})):"timeline"===i.maxui.settings.UISection&&i.listview.loadConversation(t.destination,function(e){i.updateUnreadConversations(),i.listview.render()}))},{MaxConversations:e}}())}(jQuery);var max=max||{};max.templates=function(){return{conversation:Hogan.compile('<div class="maxui-conversation" id="{{id}}" data-displayname="{{displayName}}">            <div class="maxui-activity-content">                <div class="maxui-topright">                            <div class="maxui-publisheddate">{{date}}</div>                    <div class="maxui-enterconversation">                        <a class="maxui-enterconversation maxui-icon-" href="#"></a>                        {{#hasUnread}}<span class="maxui-unread-messages">{{messages}}</span>{{/hasUnread}}                    </div>                </div>                <div class="maxui-actor">                    <a class="maxui-filter-actor" href="#">                        <span class="maxui-avatar maxui-big"><img src="{{avatarURL}}"></span>                        <span class="maxui-displayname">{{displayName}}</span>                    </a>                </div>                <div>                    <p class="maxui-body">{{&text}}</p>                </div>            </div>                    <div class="maxui-clear"></div>        </div>            '),conversationSettings:Hogan.compile('<div id="maxui-{{panelID}}" {{#canManage}}class="maxui-owner"{{/canManage}}>          <span class="maxui-avatar maxui-big"><img src="{{conversationAvatarURL}}"></span>          <div id="maxui-conversation-displayname-edit">              <input type="text" class="maxui-displayname" value="{{displayName}}"/>              <i class="maxui-icon-cancel-circled"></i>              <i class="maxui-icon-ok-circled"></i>          </div>          <span class="maxui-displayname">{{displayName}}</span>          <span class="maxui-published">{{literals.conversations_info_created}} {{published}}</span>          <div class="maxui-participants">            <h4>{{literals.conversations_info_participants}}</h4>            <ul>              {{#participants}}              <li class="maxui-participant {{#owner}}maxui-owner{{/owner}}" data-username="{{username}}">                  <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                  <span class="maxui-displayname">{{displayName}}                      <i class="maxui-conversation-user-action maxui-icon-trash" {{^owner}}title="{{literals.conversations_info_kick_message_1}} {{displayName}} {{literals.conversations_info_kick_message_2}}"{{/owner}}></i>                      <i class="maxui-conversation-user-action maxui-icon-crown{{^owner}}-plus{{/owner}}" {{^owner}}title="{{literals.conversations_info_transfer_message_1}} {{displayName}} {{literals.conversations_info_transfer_message_2}}"{{/owner}}></i>                      <div class="maxui-conversation-transfer-to maxui-conversation-confirmation">                          <i class="maxui-icon-cancel-circled"></i>                          <i class="maxui-icon-ok-circled"></i>                      </div>                      <div class="maxui-conversation-kick-user maxui-conversation-confirmation">                          <i class="maxui-icon-cancel-circled"></i>                          <i class="maxui-icon-ok-circled"></i>                      </div>                  </span>                  <span class="maxui-username">{{username}}</span>              </li>              {{/participants}}            </ul>            {{#canAdd}}            <div id="maxui-new-participant">                <i class="maxui-icon-user-add"/>                <input type="text" class="maxui-text-input maxui-empty"/>                <div id="maxui-conversation-predictive" class="maxui-predictive" style="display:none;"><ul></ul></div>            </div>            {{/canAdd}}            </div>            <div id="maxui-conversation-leave">              <input type="button" class="maxui-button maxui-button-red maxui-button-wide" value="{{literals.conversations_info_leave}}">          </div>          <div id="maxui-conversation-delete">              <input type="button" class="maxui-button maxui-button-red maxui-button-wide" value="{{literals.conversations_info_delete}}">              <div class="maxui-help">                  <p><b>{{literals.conversations_info_delete_warning}}</b> {{literals.conversations_info_delete_help}}</p>                  <button class="maxui-button maxui-button-red maxui-confirmation-cancel">{{literals.cancel}}</button>                  <button class="maxui-button maxui-button-green maxui-confirmation-ok">{{literals.delete}}</button>              </div>          </div>        </div>            '),participant:Hogan.compile('  <li class="maxui-participant {{#owner}}maxui-owner{{/owner}}" data-username="{{username}}" style="{{style}}">              <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>              <span class="maxui-displayname">{{displayName}}                  <i class="maxui-conversation-user-action maxui-icon-trash" {{^owner}}title="Click to kick {{displayName}} out of this conversation"{{/owner}} style="display:none;"></i>                  <i class="maxui-conversation-user-action maxui-icon-crown{{^owner}}-plus{{/owner}}" {{^owner}}title="Click to make {{displayName}} the owner of this conversation"{{/owner}} style="display:none;"></i>                  <div class="maxui-conversation-transfer-to maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>                  <div class="maxui-conversation-kick-user maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>                  <div class="maxui-conversation-add-user maxui-conversation-confirmation">                      <i class="maxui-icon-cancel-circled"></i>                      <i class="maxui-icon-ok-circled"></i>                  </div>              </span>              <span class="maxui-username">{{username}}</span>          </li>            '),participants:Hogan.compile('{{#persons}}        <div class="maxui-filter maxui-participant" type="participant" username="{{username}}"><span>{{prepend}}{{displayName}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>        {{/persons}}            '),postBoxChat:Hogan.compile('      <span class="maxui-avatar maxui-big">                  <img src="{{avatar}}">              </span>              <div id="maxui-newactivity-box">                   <div class="maxui-wrapper">                       <textarea class="maxui-empty maxui-text-input" data-literal="{{textLiteral}}">{{textLiteral}}</textarea>                       <div class="maxui-error-box"></div>                   </div>                           <input disabled="disabled" type="button" class="maxui-button maxui-disabled" value="{{buttonLiteral}}">              </div>            '),predictive:Hogan.compile('<li data-username="{{username}}" data-displayname="{{displayName}}" class="{{cssclass}}">        <img src="{{avatarURL}}"/><span>{{displayName}}</span>        </li>            '),filters:Hogan.compile('{{#filters}}            {{#visible}}            <div class="maxui-filter maxui-{{type}}" type="{{type}}" value="{{value}}"><span>{{prepend}}{{value}}<a class="maxui-close" href=""><i class="maxui-icon-cancel-circled" alt="tanca"/></a></span></div>            {{/visible}}        {{/filters}}            '),message:Hogan.compile('<div class="maxui-message maxui-user-{{#othersMessage}}not{{/othersMessage}}me" id="{{id}}">            <div class="maxui-activity-content">                <span class="maxui-avatar maxui-little"><img src="{{avatarURL}}"></span>                <div class="maxui-balloon">                    {{#fileDownload}}                    <form action="/messages/{{id}}/file/download" method="POST">                        <input type="hidden" name="X-Oauth-Token" value="{{auth.token}}">                        <input type="hidden" name="X-Oauth-Username" value="{{auth.username}}">                        <input type="hidden" name="X-Oauth-Scope" value="widgetcli">                        <input type="hidden" name="X-HTTP-Method-Override" value="GET">                        <span class="maxui-icon-download"></span><input type="submit" class="maxui-download" name="submit" value="File download">                    </form>                    {{/fileDownload}}                    {{#showDisplayName}}<span class="maxui-displayname">{{displayName}}</span>{{/showDisplayName}}                    <p class="maxui-body">{{&text}}</p>                    <span class="maxui-publisheddate">{{date}}</span>                    <i class="maxui-icon-check{{#ack}} maxui-ack{{/ack}}"></i>                </div>            </div>            <div class="maxui-clear"></div>        </div>            '),mainUIChat:Hogan.compile('<div id="maxui-container" class="{{showMaxUIClass}}">        {{#username}}         <div id="maxui-mainpanel">           <div id="maxui-conversations" style="height:0px; {{showConversations}}">               <div id="maxui-common-header">                  <div id="maxui-conversations-header" class="maxui-togglebar">                      <h2 class="maxui-title">{{literals.conversations}}</h3></a>                  </div>                  <div id="maxui-back-conversations" class="maxui-togglebar">                      <a class="maxui-icon-" href="#"> {{literals.conversations_list}}                      <h2 class="maxui-title">displayName</h3></a>                      <i id="maxui-conversation-info" class="maxui-icon-cog"/>                  </div>               </div>               <div class="maxui-wrapper">                   <div id="maxui-conversations-list" class="maxui-activities">                       <span id="maxui-info">{{literals.no_chats}}<span>                   </div>                           <div id="maxui-messages" style="{{messagesStyle}}">                       <div id="maxui-more-messages">                           <input type="button" class="maxui-button maxui-button-grey" value="{{literals.chats_load_older}}">                       </div>                       <div id="maxui-message-list">                       </div>                   </div>                </div>                   <div id="maxui-scrollbar">                          <div class="maxui-dragger handle"/>                   </div>           </div>                    <div id="maxui-show-conversations" class="maxui-togglebar maxui-icon-" style="{{showConversationsToggle}}">                <span class="maxui-unread-conversations maxui-hidden"></span> <a href="#">{{literals.conversations_lower}}</a>            </div>                    <div id="maxui-conversation-predictive" class="maxui-predictive" style="display:none;"><ul></ul></div>            <div id="maxui-add-people-box" style="display:none;">                <div>                  <label class="maxui-label">{{literals.participants}}: <span class="maxui-count">(1/20)</span></label>                  <input tabindex="20" type="text" data-literal="{{literals.conversations_info_add}}" value="{{literals.conversations_info_add}}" class="maxui-text-input" id="add-user-input">                </div>                <div id="maxui-new-participants" style="display:none;"></div>                <div id="maxui-new-displayName" style="display:none;">                    <label class="maxui-label">{{literals.conversation_name}}: </label>                    <input tabindex="21" type="text" class="maxui-simple-text-input"/>                </div>            </div>                    <div id="maxui-newactivity-chat" {{#hidePostbox}}style="display:none;"{{/hidePostbox}}>            </div>                    <div id="maxui-overlay-background" class="maxui-overlay">            </div>                    <div id="maxui-overlay-wrapper" class="maxui-overlay">               <div id="maxui-overlay-panel">                   <div id="maxui-overlay-header">                        <h3 id="maxui-overlay-title">I\'m a overlay</h3>                        <i class="maxui-close maxui-icon-cancel"/>                   </div>                   <div id="maxui-overlay-content">                   </div>               </div>           </div>          </div>         </div>        {{/username}}        {{^username}}          No s\'ha definit cap usuari        {{/username}}        </div>            ')}};var max=max||{};!function(i){function e(e){var a=this;a.logtag="MESSAGING",a.maxui=e,a.active=!1,a.vhost="/",a.max_retries=3,a.retry_interval=3e3,a.debug=a.maxui.settings.enableAlerts,a.token=a.maxui.settings.oAuthToken,a.stompServer=a.maxui.settings.maxTalkURL,e.settings.domain?a.domain=e.settings.domain:a.domain=a.domainFromMaxServer(a.maxui.settings.maxServerURL),a.login="",a.domain&&(a.login+=a.domain+":"),a.login+=a.maxui.settings.username,a.ws=new SockJS(a.stompServer),a.bindings=[],a.specification={uuid:{id:"g",type:"string"},user:{id:"u",type:"object",fields:{username:{id:"u"},displayname:{id:"d"}}},action:{id:"a",type:"char",values:{add:{id:"a"},delete:{id:"d"},modify:{id:"m"},refresh:{id:"r"},ack:{id:"k"}}},object:{id:"o",type:"char",values:{message:{id:"m"},conversation:{id:"c"},tweet:{id:"t"},activity:{id:"a"},context:{id:"x"},comment:{id:"t"}}},data:{id:"d",type:"object"},source:{id:"s",type:"char",values:{max:{id:"m"},widget:{id:"w"},ios:{id:"i"},android:{id:"a"},tweety:{id:"t"},maxbunny:{id:"b"}}},domain:{id:"i",type:"string"},version:{id:"v",type:"string"},published:{id:"p",type:"date"}},a._specification={},_.each(a.specification,function(e,t,i){var n=_.clone(e);_.has(n,"values")&&(n.values={},_.each(e.values,function(e,t,i){n.values[e.id]=_.clone(e),n.values[e.id].name=t,delete n.values[e.id].id})),_.has(n,"fields")&&"object"===n.type&&(n.fields={},_.each(e.fields,function(e,t,i){n.fields[e.id]=_.clone(e),n.fields[e.id].name=t,delete n.fields[e.id].id})),n.name=t,delete n.id,a._specification[e.id]=n})}e.prototype.domainFromMaxServer=function(e){var t=e.replace(/\/$/,""),i=document.createElement("a");return i.href=t,_.last(i.pathname.split("/"))},e.prototype.start=function(){var t=this;t.maxui.logger.info("Connecting ...",t.logtag),t.connect();var i=1,n=setInterval(function(e){!t.active&&i<=t.max_retries?(t.maxui.logger.debug("Connection retry #{0}".format(i),t.logtag),t.ws.close(),t.ws=new SockJS(t.maxui.settings.maxTalkURL),t.connect()):(t.active||t.maxui.logger.error("Connection failure after {0} reconnect attempts".format(t.max_retries),t.logtag),clearInterval(n)),i+=1},t.retry_interval)},e.prototype.bind=function(e,t){this.bindings.push({key:this.pack(e),callback:t})},e.prototype.on_message=function(s,r){var o=this,e=_.filter(o.bindings,function(e){var t=_.pick(s,_.keys(e.key));if(_.isEqual(e.key,t))return e});_.isEmpty(e)?o.maxui.logger.warning("Ignoring received message\n{0}\n No binding found for this message".format(s),o.logtag):_.each(e,function(e,t,i){o.maxui.logger.debug('Matched binding "{1}"'.format(s,e.key),o.logtag);var n=o.unpack(s),a=r.replace(/(\w+)\.(.*)/g,"$1");n.destination=a,e.callback(n)})},e.prototype.disconnect=function(){this.stomp.disconnect()},e.prototype.connect=function(){var n=this;n.stomp=Stomp.over(n.ws),n.stomp.heartbeat.outgoing=0,n.stomp.heartbeat.incoming=0,n.stomp.debug=function(e){n.maxui.logger.debug(e,n.logtag)};var e="maxui";n.maxui.settings.generator&&(e+="[{0}]".format(n.maxui.settings.generator));var t={login:n.login,passcode:n.token,host:n.vhost,product:e,"product-version":n.maxui.version,platform:"{0} {1} / {2} {3}".format(i.ua.browser.name,i.ua.browser.version,i.ua.os.name,i.ua.os.version)};n.stomp.connect(t,function(e){n.stomp.subscribe("/exchange/{0}.subscribe".format(n.maxui.settings.username),function(e){var t=JSON.parse(e.body),i=/([^/])+$/.exec(e.headers.destination)[0];n.on_message(t,i)}),n.active=!0,n.maxui.logger.info("Succesfully connected to {0}".format(n.stompServer),n.logtag)},function(e){n.maxui.logger.error(e.body)})},e.prototype.pack=function(r){var o,c=this,u={};return _.each(r,function(e,t,i){var n=c.specification[t];if(_.isUndefined(n));else{var a;if(_.has(n,"values"))_.has(n.values,e)&&(a=n.values[e].id);else if(a=e,_.has(n,"fields")&&"object"===n.type&&_.isObject(a)){var s={};_.each(r[t],function(e,t,i){o=_.has(n.fields,t)?n.fields[t].id:t,s[o]=e}),a=s}_.isUndefined(a)||(u[n.id]=a)}}),u},e.prototype.unpack=function(r){var o,c=this,u={};return _.each(r,function(e,t,i){var n=c._specification[t];if(_.isUndefined(n));else{var a;if(_.has(n,"values"))_.has(n.values,e)&&(a=n.values[e].name);else if(a=e,_.has(n,"fields")&&"object"===n.type&&_.isObject(a)){var s={};_.each(r[t],function(e,t,i){o=_.has(n.fields,t)?n.fields[t].name:t,s[o]=e}),a=s}_.isUndefined(a)||(u[n.name]=a)}}),u},e.prototype.prepare=function(e){var t=this,i={source:"widget",version:t.maxui.version,user:{username:t.maxui.settings.username,displayname:t.maxui.settings.displayName},published:t.maxui.utils.rfc3339(t.maxui.utils.now()),uuid:uuid.v1()};return t.domain&&(i.domain=t.domain),_.extend(_.pick(e,_.keys(t.specification)),i)},e.prototype.send=function(e,t){var i=this.prepare(e);return this.stomp.send("/exchange/{0}.publish/{1}".format(this.maxui.settings.username,t),{},JSON.stringify(this.pack(i))),i},max.MaxMessaging=e}(jQuery);var max=max||{};!function(e){var i={debug:0,info:1,warn:2,error:3};function t(e){this.level=0}t.prototype.setLevel=function(e){this.level=i[e]},t.prototype.log=function(e,t){try{window.console.log("{0}: {1}".format(t,e))}catch(e){}},t.prototype.debug=function(e){var t="MAXUI";1<arguments.length&&(t=arguments[1]);this.level<=i.debug&&this.log(e,t)},t.prototype.info=function(e){var t="MAXUI";1<arguments.length&&(t=arguments[1]);this.level<=i.info&&this.log(e,t)},t.prototype.warn=function(e){var t="MAXUI";1<arguments.length&&(t=arguments[1]);this.level<=i.warn&&this.log(e,t)},t.prototype.error=function(e){var t="MAXUI";1<arguments.length&&(t=arguments[1]);this.level<=i.error&&this.log(e,t)},max.MaxLogging=t}(jQuery);var max=max||{};max.literals=function(e){var t={en:{cancel:"Cancel",delete:"Delete",months:["January","February","March","April","May","June","July","August","September","October","November","December"],new_activity_text:"Write something...",activity:"activity",conversations_lower:"chats",conversations:"Chats",conversations_list:"chats list",conversations_info_title:"Chat information",conversations_info_participants:"Participants",conversations_info_owner:"owner",conversations_info_add:"Add participant...",conversations_info_created:"Created",conversations_info_leave:"Leave chat",conversations_info_delete:"Delete chat",conversations_info_delete_warning:"Warning!",conversations_info_delete_help:"If you delete the chat, the participants will not be able to see the messages anymore. To avoid this, cancel and transfer the ownership to someone else.",conversations_info_kick_message_1:"Click to kick",conversations_info_kick_message_2:"out of this chat",conversations_info_transfer_message_1:"Click to make",conversations_info_transfer_message_2:"the owner of this chat",participants:"Talk to",chats_load_older:"Load older",conversation_name:"Chat name",message:"Message",no_chats:"No chats already",no_match_found:"No match found",new_conversation_text:"Add participants and send a message to start a chat",new_activity_post:"Post activity",toggle_comments:"comments",new_comment_text:"Comment something...",new_comment_post:"Post comment",load_more:"Load more",context_published_in:"Published in",generator_via:"via",search_text:"Search in posts...",and_more:"and more...",new_message_post:"Send message",post_permission_unauthorized:"You''re not authorized to post on this context",post_permission_not_here:"You're not mentioning @anyone",post_permission_not_enough_participants:"You have to add participants",post_permission_missing_displayName:"You have to name the chat",delete_activity_confirmation:"Are you sure?",delete_activity_delete:"Delete",delete_activity_cancel:"Cancel",delete_activity_icon:"delete",flag_activity_icon:"flagged",favorites_filter_hint:"Filter by favorited activity",favorites:"Favorites",favorite:"favorite",unfavorite:"unfavorite",like:"like",unlike:"unlike",recent_activity:"Latest activity",valued_activity:"Most valued activity",flagged_activity:"Flagged activity",recent_favorited_activity:"Latest favorites",valued_favorited_activity:"Most valued favorites",open_profile:"Show profile"},es:{cancel:"Cancelar",delete:"Eliminar",months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],new_activity_text:"Escribe algo...",activity:"actividad",conversations_lower:"chats",conversations:"Chats",conversations_list:"lista de chats",conversations_info_title:"Información del chat",conversations_info_participants:"Participantes",conversations_info_owner:"propietario",conversations_info_add:"Añade participante...",conversations_info_created:"Creada",conversations_info_leave:"Abandonar chat",conversations_info_delete:"Borra el chat",conversations_info_delete_warning:"Atención!",conversations_info_delete_help:"Si eliminas el chat, los participantes dejarán de ver los mensajes. Para evitar esto, cancela y luego traspasa el chat a otra persona.",conversations_info_kick_message_1:"Clica para echar a",conversations_info_kick_message_2:"de este chat",conversations_info_transfer_message_1:"Clica para dar a ",conversations_info_transfer_message_2:"la administración del chat",participants:"Chatear con",chats_load_older:"Cargar antiguos",conversation_name:"Nombre del chat",message:"Mensaje",no_chats:"No hay chats",no_match_found:"No hay coincidencias",new_conversation_text:"Añade participantes y envia el mensaje para iniciar un chat",new_activity_post:"Publica",toggle_comments:"comentarios",new_comment_text:"Comenta algo...",new_comment_post:"Comenta",load_more:"Cargar más",context_published_in:"Publicado en",generator_via:"via",search_text:"Busca en las entradas...",and_more:"i más...",new_message_post:"Envia el mensaje",post_permission_unauthorized:"No estas autorizado a publicar en este contexto",post_permission_not_here:"No estas citando a @nadie",post_permission_not_enough_participants:"Tienes que añadir participantes",post_permission_missing_displayName:"Tienes que dar un nombre al chat",delete_activity_confirmation:"Estás seguro?",delete_activity_delete:"Borrar",delete_activity_cancel:"Cancelar",delete_activity_icon:"borrar",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra por actividad favorita",favorites:"Favoritos",favorite:"favorito",unfavorite:"quitar favorito",like:"me gusta",unlike:"ya no me gusta",recent_activity:"Últimas actividades",valued_activity:"Actividades más valoradas",flagged_activity:"Actividades destacadas",recent_favorited_activity:"Últimas favoritas",valued_favorited_activity:"Favoritas más valoradas",open_profile:"Ver el perfil"},ca:{cancel:"Cancelar",delete:"Elimina",months:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],new_activity_text:"Escriu alguna cosa...",activity:"activitat",conversations_lower:"xats",conversations:"Xats",conversations_list:"llista de xats",conversations_info_title:"Informació del xat",conversations_info_participants:"Participants",conversations_info_owner:"propietari",conversations_info_add:"Afegeix participant...",conversations_info_created:"Creada",conversations_info_leave:"Marxar del xat",conversations_info_delete:"Esborra el xat",conversations_info_delete_warning:"Alerta!",conversations_info_delete_help:"Si elimines el xat, la resta de participants deixaran de veure els missatges. Per evitar-ho, cancela i traspassa el xat a algú altre.",conversations_info_kick_message_1:"Clica per fer fora a ",conversations_info_kick_message_2:"d'aquest xat",conversations_info_transfer_message_1:"Clica per fer a",conversations_info_transfer_message_2:"l'administrador d'aquest xat",participants:"Xateja amb",chats_load_older:"Carregar antics",conversation_name:"Nom del xat",message:"Missatge",no_chats:"No hi ha xats",no_match_found:"No s'han trobat coincidències",new_conversation_text:"Afegeix participants i envia el missatge per iniciar un xat",new_activity_post:"Publica",toggle_comments:"comentaris",new_comment_text:"Comenta alguna cosa...",new_comment_post:"Comenta",load_more:"Carrega'n més",context_published_in:"Publicat a",generator_via:"via",search_text:"Cerca a les entrades...",and_more:"i més...",new_message_post:"Envia el missatge",post_permission_unauthorized:"No estàs autoritzat a publicar en aquest contexte",post_permission_not_here:"No estas citant a @ningú",post_permission_not_enough_participants:"Has d'afegir participants",post_permission_missing_displayName:"Tens que posar nom al xat",delete_activity_confirmation:"Estàs segur?",delete_activity_delete:"Esborra",delete_activity_cancel:"No ho toquis!",delete_activity_icon:"esborra",flag_activity_icon:"destacada",favorites_filter_hint:"Filtra per activitat favorita",favorites:"Favorits",favorite:"favorit",unfavorite:"treure favorit",like:"m'agrada",unlike:"ja no m'agrada",recent_activity:"Darreres activitats",valued_activity:"Activitats més valorades",flagged_activity:"Activitats destacades",recent_favorited_activity:"Darreres favorites",valued_favorited_activity:"Favorites més valorades",open_profile:"Veure el perfil"}};return t[e]};var max=max||{};function MaxClient(){this.ROUTES={users:"/people",user:"/people/{0}",avatar:"/people/{0}/avatar",user_activities:"/people/{0}/activities",timeline:"/people/{0}/timeline",user_comments:"/people/{0}/comments",user_shares:"/people/{0}/shares",user_likes:"/people/{0}/likes",follows:"/people/{0}/follows",follow:"/people/{0}/follows/{1}",subscriptions:"/people/{0}/subscriptions",activities:"/contexts/{0}/activities",activity:"/activities/{0}",comments:"/activities/{0}/comments",comment:"/activities/{0}/comments/{1}",likes:"/activities/{0}/likes",like:"/activities/{0}/likes/{1}",flag:"/activities/{0}/flag",favorites:"/activities/{0}/favorites",favorite:"/activities/{0}/favorites/{1}",shares:"/activities/{0}/shares",share:"/activities/{0}/shares/{1}",conversations:"/conversations",conversation:"/conversations/{0}",conversation_owner:"/conversations/{0}/owner",user_conversation:"/people/{0}/conversations/{1}",messages:"/conversations/{0}/messages",context:"/contexts/{0}"}}max.utils=function(){var l={};return{setSettings:function(e){l=e},freezeEvent:function(e){return e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),!1},normalizeWhiteSpace:function(e,t){e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/\n /,"\n");var i=!0;return 1<arguments.length&&(i=t),!0===i&&(e=e.replace(/[ ]{2,}/gi," ")),e},formatText:function(e){return e&&(e=(e=(e=e.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(e){var t=e;return t.match("^https?://")||(t="http://"+t),'<a href="'+t+'">'+e+"</a>"})).replace(/(\s|^)#{1}(\w+)/gi,function(){var e=arguments[1],t=arguments[2];return'<a class="maxui-hashtag" href="#" value="'+t+'">'+e+"#"+t+"</a>"})).replace(/\r?\n/gi,"<br/>")),e},isCORSCapable:function(){return void 0!==(new XMLHttpRequest).withCredentials},removeValueFrom:function(e){for(var t,i,n=arguments,a=n.length;1<a&&e.length;)for(t=n[--a];-1!==(i=e.indexOf(t));)e.splice(i,1);return e},timestamp:function(){return new Date/1},now:function(){return new Date},rfc3339:function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"},formatDate:function(e,t){var i=new Date,n="",a="",s=new Date,r=e.match("^([-+]?)(\\d{4,})(?:-?(\\d{2})(?:-?(\\d{2})(?:[Tt ](\\d{2})(?::?(\\d{2})(?::?(\\d{2})(?:\\.(\\d{1,3})(?:\\d+)?)?)?)?(?:[Zz]|(?:([-+])(\\d{2})(?::?(\\d{2}))?)?)?)?)?)?$");if(r){for(var o=[2,3,4,5,6,7,8,10,11],c=o.length-1;0<=c;--c)r[o[c]]=void 0!==r[o[c]]&&0<r[o[c]].length?parseInt(r[o[c]],10):0;"-"===r[1]&&(r[2]*=-1);var u=Date.UTC(r[2],r[3]-1,r[4],r[5],r[6],r[7],r[8]);void 0!==r[9]&&0<r[9].length&&(u+=("+"===r[9]?-1:1)*(3600*r[10]*1e3+60*r[11]*1e3)),0<=r[2]&&r[2]<=99&&(u-=59958144e6);return s.setTime(u),i.getTime()-u<2592e5?n=jQuery.easydate.format_date(s,t):("en"===t?n="{0} {1}".format(r[4],l.literals.months[r[3]-1]):"es"===t?n="{0} de {1}".format(r[4],l.literals.months[r[3]-1]):"ca"===t&&(a="de ",4!==r[3]&&8!==r[3]&&10!==r[3]||(a="d'"),n="{0} {2}{1}".format(r[4],l.literals.months[r[3]-1],a)),31536e6<i.getTime()-u&&(n="{0}/{1}/{2}".format(r[4],r[3],r[2]))),n}return null},utf8_decode:function(e){var t=[],i=0,n=0,a=0,s=0,r=0;for(e+="";i<e.length;)(a=e.charCodeAt(i))<128?(t[n++]=String.fromCharCode(a),i++):191<a&&a<224?(s=e.charCodeAt(i+1),t[n++]=String.fromCharCode((31&a)<<6|63&s),i+=2):(s=e.charCodeAt(i+1),r=e.charCodeAt(i+2),t[n++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&r),i+=3);return t.join("")},sha1:function(e){function t(e,t){return e<<t|e>>>32-t}function i(e){var t,i="";for(t=7;0<=t;t--)i+=(e>>>4*t&15).toString(16);return i}var n,a,s,r,o,c,u,l,d,m=new Array(80),p=1732584193,f=4023233417,h=2562383102,v=271733878,g=3285377520,x=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):(127<n&&n<2048?t+=String.fromCharCode(n>>6|192):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128)),t+=String.fromCharCode(63&n|128))}return t}(e)).length,w=[];for(a=0;a<x-3;a+=4)s=e.charCodeAt(a)<<24|e.charCodeAt(a+1)<<16|e.charCodeAt(a+2)<<8|e.charCodeAt(a+3),w.push(s);switch(x%4){case 0:a=2147483648;break;case 1:a=e.charCodeAt(x-1)<<24|8388608;break;case 2:a=e.charCodeAt(x-2)<<24|e.charCodeAt(x-1)<<16|32768;break;case 3:a=e.charCodeAt(x-3)<<24|e.charCodeAt(x-2)<<16|e.charCodeAt(x-1)<<8|128}for(w.push(a);w.length%16!=14;)w.push(0);for(w.push(x>>>29),w.push(x<<3&4294967295),n=0;n<w.length;n+=16){for(a=0;a<16;a++)m[a]=w[n+a];for(a=16;a<=79;a++)m[a]=t(m[a-3]^m[a-8]^m[a-14]^m[a-16],1);for(r=p,o=f,c=h,u=v,l=g,a=0;a<=19;a++)d=t(r,5)+(o&c|~o&u)+l+m[a]+1518500249&4294967295,l=u,u=c,c=t(o,30),o=r,r=d;for(a=20;a<=39;a++)d=t(r,5)+(o^c^u)+l+m[a]+1859775393&4294967295,l=u,u=c,c=t(o,30),o=r,r=d;for(a=40;a<=59;a++)d=t(r,5)+(o&c|o&u|c&u)+l+m[a]+2400959708&4294967295,l=u,u=c,c=t(o,30),o=r,r=d;for(a=60;a<=79;a++)d=t(r,5)+(o^c^u)+l+m[a]+3395469782&4294967295,l=u,u=c,c=t(o,30),o=r,r=d;p=p+r&4294967295,f=f+o&4294967295,h=h+c&4294967295,v=v+u&4294967295,g=g+l&4294967295}return(d=i(p)+i(f)+i(h)+i(v)+i(g)).toLowerCase()}}},Object.keys||(Object.keys=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i}),String.prototype.format=function(){var t=arguments;return this.replace(/\{\d+\}/g,function(e){return t[e.match(/\d+/)]})},MaxClient.prototype.configure=function(e){this.url=e.server,this.mode=e.mode,this.token=e.token,this.actor={objectType:"person",username:e.username}},MaxClient.prototype.POST=function(e,t,i){var n=this,a="{0}{1}".format(this.url,e),s={};return 3<arguments.length&&(s=arguments[3]),jQuery.ajax({url:a,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",n.token),e.setRequestHeader("X-Oauth-Username",n.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli")},type:"POST",contentType:"application/json",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.PUT=function(e,t,i){var n=this,a="{0}{1}".format(this.url,e),s={};return 3<arguments.length&&(s=arguments[3]),jQuery.ajax({url:a,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",n.token),e.setRequestHeader("X-Oauth-Username",n.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli"),e.setRequestHeader("X-HTTP-Method-Override","PUT")},contentType:"application/json",type:"POST",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.DELETE=function(e,t,i){var n=this,a="{0}{1}".format(this.url,e),s={};return 2<arguments.length&&(s=i),jQuery.ajax({url:a,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",n.token),e.setRequestHeader("X-Oauth-Username",n.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli"),e.setRequestHeader("X-HTTP-Method-Override","DELETE")},type:"POST",data:JSON.stringify(t),async:!0,dataType:"json"}).done(function(e){i.call(e),s.done&&jQuery(window).trigger(s.done,e)}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail,e)}),!0},MaxClient.prototype.GET=function(e,t,n){var i=this,a="{0}{1}".format(this.url,e),s={};3<arguments.length&&(s=arguments[3]),0<Object.keys(t).length&&(a+="?"+jQuery.param(t,!0));var r={url:a,beforeSend:function(e){e.setRequestHeader("X-Oauth-Token",i.token),e.setRequestHeader("X-Oauth-Username",i.actor.username),e.setRequestHeader("X-Oauth-Scope","widgetcli")},processData:!0,type:"GET",async:!0,dataType:"json"};return 3<arguments.length&&_.extend(r,arguments[3]),jQuery.ajax(r).done(function(e,t,i){s.done&&jQuery(window).trigger(s.done),n.apply(i,[e])}).fail(function(e){jQuery(window).trigger("maxclienterror",e),s.fail&&jQuery(window).trigger(s.fail)}),!0},MaxClient.prototype.getUserData=function(e,t){var i=this.ROUTES.user.format(e);this.GET(i,{},t)},MaxClient.prototype.getUsersList=function(e,t){var i=this.ROUTES.users,n={username:e};this.GET(i,n,t)},MaxClient.prototype.getContext=function(e,t){var i=this.ROUTES.context.format(e);this.GET(i,{},t)},MaxClient.prototype.getUserTimeline=function(e,t){var i=this.ROUTES.timeline.format(e),n={};2<arguments.length&&(n=arguments[2]),this.GET(i,n,t)},MaxClient.prototype.getActivities=function(e,t){var i=this.ROUTES.activities.format(e.context),n={};2<arguments.length&&(n=arguments[2]),e.tags&&0<e.tags.length&&(n.context_tags=e.tags),this.GET(i,n,t)},MaxClient.prototype.getCommentsForActivity=function(e,t){var i=this.ROUTES.comments.format(e);this.GET(i,{},t)},MaxClient.prototype.addComment=function(e,t,i){var n={actor:{},object:{objectType:"comment",content:""}};n.actor=this.actor,n.object.content=e;var a=this.ROUTES.comments.format(t);this.POST(a,n,i)},MaxClient.prototype.addActivity=function(e,t,i){var n={object:{objectType:"note",content:""}};if(0<t.length){n.contexts=[];for(var a=0;a<t.length;a++)n.contexts.push({objectType:"context",url:t[a]})}n.object.content=e,3<arguments.length&&(n.generator=arguments[3]);var s=this.ROUTES.user_activities.format(this.actor.username);this.POST(s,n,i,{done:"maxui-posted-activity",fail:"maxui-failed-activity"})},MaxClient.prototype.removeActivity=function(e,t){var i=this.ROUTES.activity.format(e);this.DELETE(i,{},t)},MaxClient.prototype.removeActivityComment=function(e,t,i){var n=this.ROUTES.comment.format(e,t);this.DELETE(n,{},i)},MaxClient.prototype.getConversationSubscription=function(e,t,i){var n=this.ROUTES.user_conversation.format(t,e);this.GET(n,{},i)},MaxClient.prototype.getConversation=function(e,t){var i=this.ROUTES.conversation.format(e);this.GET(i,{},t)},MaxClient.prototype.modifyConversation=function(e,t,i){var n={displayName:t},a=this.ROUTES.conversation.format(e);this.PUT(a,n,i)},MaxClient.prototype.addUserToConversation=function(e,t,i){var n=this.ROUTES.user_conversation.format(t,e);this.POST(n,{},i)},MaxClient.prototype.kickUserFromConversation=function(e,t,i){var n=this.ROUTES.user_conversation.format(t,e);this.DELETE(n,{},i)},MaxClient.prototype.deleteConversation=function(e,t){var i=this.ROUTES.conversation.format(e);this.DELETE(i,{},t)},MaxClient.prototype.leaveConversation=function(e,t,i){var n=this.ROUTES.user_conversation.format(t,e);this.DELETE(n,{},i)},MaxClient.prototype.transferConversationOwnership=function(e,t,i){var n={actor:{username:t}},a=this.ROUTES.conversation_owner.format(e);this.PUT(a,n,i)},MaxClient.prototype.getConversationsForUser=function(e,t){var i=this.ROUTES.conversations;this.GET(i,{},t)},MaxClient.prototype.getMessageImage=function(e,t){var i={processData:!1,dataType:void 0,contentType:"application/base64"};this.GET(e,{},t,i)},MaxClient.prototype.getMessagesForConversation=function(e,t,i){var n=this.ROUTES.messages.format(e),a=t;this.GET(n,a,i)},MaxClient.prototype.addMessageAndConversation=function(e,t){var i={object:{objectType:"note",content:e.message},contexts:[{objectType:"conversation",participants:e.participants}]};e.displayName&&(i.contexts[0].displayName=e.displayName);var n=this.ROUTES.conversations;this.POST(n,i,t)},MaxClient.prototype.addMessage=function(e,t,i){var n={object:{objectType:"note",content:""}};n.object.content=e;var a=this.ROUTES.messages.format(t);this.POST(a,n,i)},MaxClient.prototype.follow=function(e,t){var i={object:{objectType:"person",username:""}};i.object.username=e;var n=this.ROUTES.follow.format(this.actor.username,e);this.POST(n,i,t)},MaxClient.prototype.favoriteActivity=function(e,t){var i=this.ROUTES.favorites.format(e);this.POST(i,{},t)},MaxClient.prototype.unfavoriteActivity=function(e,t){var i=this.ROUTES.favorite.format(e,this.actor.username);this.DELETE(i,{},t)},MaxClient.prototype.likeActivity=function(e,t){var i=this.ROUTES.likes.format(e);this.POST(i,{},t)},MaxClient.prototype.unlikeActivity=function(e,t){var i=this.ROUTES.like.format(e,this.actor.username);this.DELETE(i,{},t)},MaxClient.prototype.flagActivity=function(e,t){var i=this.ROUTES.flag.format(e);this.POST(i,{},t)},MaxClient.prototype.unflagActivity=function(e,t){var i=this.ROUTES.flag.format(e);this.DELETE(i,{},t)},function(b){b.fn.maxUIChat=function(e){var w=this;w.version="4.1.21",w.templates=max.templates(),w.utils=max.utils();var t={maxRequestsAPI:"jquery",maxServerURL:"https://max.upc.edu",readContext:void 0,writeContexts:[],activitySource:"timeline",enableAlerts:!1,UISection:"conversations",disableTimeline:!0,disableConversations:!1,conversationsSection:"conversations",currentConversationSection:"conversations",activitySortOrder:"comments",activitySortView:"recent",maximumConversations:20,contextTagsFilter:[],scrollbarWidth:10,widgetWidth:"0",sectionHorizontalPadding:20,widgetBorder:2,loglevel:"info",hidePostboxChatOnTimeline:!1,maxTalkURL:"",generator:"",domain:"",showSubscriptionList:!1};w.settings=b.extend(t,e),w.logger=new max.MaxLogging(w),w.logger.setLevel(w.settings.loglevel),w.utils.isCORSCapable()||w.settings.maxServerURLAlias&&(w.settings.maxServerURL=w.settings.maxServerURLAlias),w.settings.maxTalkURL=w.utils.normalizeWhiteSpace(w.settings.maxTalkURL),(_.isUndefined(w.settings.maxTalkURL)||""===w.settings.maxTalkURL)&&(w.settings.maxTalkURL=w.settings.maxServerURL+"/stomp"),w.settings.domain=w.utils.normalizeWhiteSpace(w.settings.domain),"none"===w.settings.domain.toLowerCase()&&(w.settings.domain=""),"timeline"===w.settings.UISection&&"timeline"===w.settings.activitySource&&w.settings.readContext&&(w.settings.readContext=void 0,w.settings.writeContexts=[]),w.settings.showSubscriptionList&&"activities"===w.settings.activitySource&&(w.settings.showSubscriptionList=!1),w.language=e.language||"en";var i=e.literals||{};if(w.settings.literals=b.extend(max.literals(w.language),i),w.settings.readContext){w.settings.readContextHash=w.utils.sha1(w.settings.readContext),w.settings.writeContexts.push(w.settings.readContext),w.settings.writeContextsHashes=[];for(var n=0;n<w.settings.writeContexts.length;n++)w.settings.writeContextsHashes.push(w.utils.sha1(w.settings.writeContexts[n]))}w.settings.avatarURLpattern||(w.settings.avatarURLpattern=w.settings.maxServerURL+"/people/{0}/avatar"),w.settings.contextAvatarURLpattern||(w.settings.contextAvatarURLpattern=w.settings.maxServerURL+"/contexts/{0}/avatar"),w.settings.conversationAvatarURLpattern||(w.settings.conversationAvatarURLpattern=w.settings.maxServerURL+"/conversations/{0}/avatar"),w.settings.enableAlerts&&b(window).bind("maxclienterror",function(e,t){var i=JSON.parse(t.responseText);alert('The server responded with a "{0}" error, with the following message: "{1}". \n\nPlease try again later or contact administrator at admin@max.upc.edu.'.format(i.error,i.error_description))}),w.maxClient=new MaxClient;var a={server:w.settings.maxServerURL,mode:w.settings.maxRequestsAPI,username:w.settings.username,token:w.settings.oAuthToken};return w.maxClient.configure(a),w.messaging=new max.MaxMessaging(w),w.conversations=new max.views.MaxConversations(w,{}),w.settings.disableConversations||(w.messaging.bind({action:"add",object:"message"},function(e){w.conversations.ReceiveMessage(e)}),w.messaging.bind({action:"add",object:"conversation"},function(e){w.conversations.ReceiveConversation(e)}),w.messaging.bind({action:"refresh",object:"conversation"},function(e){w.conversations.messagesview.load(e.destination)}),w.messaging.bind({action:"ack",object:"message"},function(e){w.conversations.messagesview.ack(e)})),w.utils.setSettings(w.settings),b.fn.hidePostboxChat=function(){var e=this;if("timeline"===e.settings.activitySource&&0<e.settings.subscriptionsWrite.length)return e.settings.hidePostboxChatOnTimeline;for(var t in e.settings.subscriptionsWrite){if(e.settings.subscriptionsWrite[t].hash===e.settings.readContext)return e.settings.hidePostboxChatOnTimeline}return!0},this.maxClient.getUserData(w.settings.username,function(e){w.settings.displayName=e.displayName||w.settings.username;var t={},i=[];if(e.subscribedTo&&e.subscribedTo&&0<e.subscribedTo.length)for(var n=0;n<e.subscribedTo.length;n++){var a=e.subscribedTo[n];t[a.hash]={},t[a.hash].permissions={};for(var s=0;s<a.permissions.length;s++){var r=a.permissions[s];t[a.hash].permissions[r]=!0,"write"===r&&i.push({hash:a.url,displayname:a.displayName})}}w.settings.subscriptionsWrite=i,w.settings.subscriptions=t,"timeline"===w.settings.activitySource&&0<i.length&&w.settings.writeContexts.push(i[0].hash),w.settings.disableConversations||(w.messaging.start(),b(window).on("beforeunload",function(e){return w.messaging.disconnect()}));var o="conversations"===w.settings.UISection,c="timeline"===w.settings.UISection,u=!1===w.settings.disableTimeline&&!c,l=!1===w.settings.disableConversations&&!o,d=w.width()-w.settings.scrollbarWidth,m="recent"===w.settings.activitySortView,p="likes"===w.settings.activitySortView,f="flagged"===w.settings.activitySortView,h={username:w.settings.username,literals:w.settings.literals,showMaxUIClass:o?"maxui-container-chat":"maxui-container-activity",showConversations:o?"display:block;":"display:none;",showConversationsToggle:l?"display:block;":"display:none;",showTimeline:c?"display:block;":"display:none;",showTimelineToggle:u?"display:block;":"display:none;",orderViewRecent:m?"active":"",orderViewLikes:p?"active":"",orderViewFlagged:f?"active":"",messagesStyle:"width:{0}px;left:{0}px;".format(d),hidePostboxChat:w.hidePostboxChat()},v=w.templates.mainUIChat.render(h);if(w.html(v),w.overlay=new max.views.MaxOverlay(w),w.settings.widgetWidth=w.width(),w.settings.sectionsWidth=w.settings.widgetWidth-w.settings.scrollbarWidth-w.settings.widgetBorder,w.settings.disableConversations||(w.conversations.render(),w.conversations.listview.load(e.talkingIn)),"conversations"===w.settings.UISection){w.bindEventsChat(),w.toggleSectionChat("conversations"),w.renderPostboxChat();var g=w.settings.literals.new_conversation_text;b("#maxuichat-widget-container #maxui-newactivity-box textarea").val(g).attr("data-literal",g)}else if("timeline"===w.settings.UISection){var x={recent:w.settings.activitySortOrder,likes:"likes",flagged:"flagged"};w.printActivitiesChat({sortBy:x[w.settings.activitySortView]},function(e){w.bindEventsChat()})}}),w},b.fn.bindEventsChat=function(){var x=this;b("#maxuichat-widget-container #maxui-more-activities .maxui-button").click(function(e){if(e.preventDefault(),b("#maxuichat-widget-container #maxui-search").hasClass("folded"))x.loadMoreActivitiesChat();else{var t=b(".maxui-activity:last").attr("id");x.reloadFiltersChat(t)}}),b("#maxuichat-widget-container #maxui-news-activities .maxui-button").click(function(e){x.loadNewsActivitiesChat()}),b("#maxuichat-widget-container #maxui-search-toggle").click(function(e){e.preventDefault(),b(this).hasClass("maxui-disabled")||(b("#maxuichat-widget-container #maxui-search").toggleClass("folded"),b("#maxuichat-widget-container #maxui-search").hasClass("folded")?x.printActivitiesChat({}):x.reloadFiltersChat())}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-commentaction",function(e){e.preventDefault(),window.status="",b(this).closest(".maxui-activity").find(".maxui-comments").toggle(200)}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-actor",function(e){e.preventDefault();var t=b(this).find(".maxui-username").text();x.addFilterChat({type:"actor",value:t}),b("#maxuichat-widget-container #maxui-search").toggleClass("folded",!1)}),b("#maxuichat-widget-container #maxui-search").on("click","#maxui-favorites-filter",function(e){e.preventDefault();var t=b(e.currentTarget),i=!t.hasClass("active"),n="",a="";a=i?(x.addFilterChat({type:"favorites",value:!0,visible:!1}),n=x.settings.literals.valued_favorited_activity,x.settings.literals.recent_favorited_activity):(x.delFilterChat({type:"favorites",value:!0}),n=x.settings.literals.valued_activity,x.settings.literals.recent_activity),t.toggleClass("active",i),b("#maxuichat-widget-container #maxui-activity-sort .maxui-most-recent").text(a),b("#maxuichat-widget-container #maxui-activity-sort .maxui-most-valued").text(n)}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-hashtag",function(e){e.preventDefault(),x.addFilterChat({type:"hashtag",value:b(this).attr("value")}),b("#maxuichat-widget-container #maxui-search").toggleClass("folded",!1)}),b("#maxuichat-widget-container #maxui-subscriptions").on("change",function(){var e=b("#maxuichat-widget-container #maxui-subscriptions :selected").val();if("timeline"!==e){x.settings.writeContexts=[],x.settings.writeContextsHashes=[],x.settings.writeContexts.push(e);for(var t=0;t<x.settings.writeContexts.length;t++)x.settings.writeContextsHashes.push(x.utils.sha1(x.settings.writeContexts[t]))}else x.settings.writeContexts=[],x.settings.writeContextsHashes=void 0}),b("#maxuichat-widget-container #maxui-search-filters").on("click",".maxui-close",function(e){e.preventDefault();var t=b(this.parentNode.parentNode);x.delFilterChat({type:t.attr("type"),value:t.attr("value")})}),b("#maxuichat-widget-container #maxui-new-participants").on("click",".maxui-close",function(e){e.preventDefault();var t=b(this.parentNode.parentNode);x.delPersonChat({username:t.attr("username")})}),b("#maxuichat-widget-container #maxui-new-displayName").on("keyup","input",function(e){e.preventDefault(),x.reloadPersonsChat()}),b("#maxuichat-widget-container #maxui-newactivity-chat").on("click",".maxui-prediction",function(e){e.preventDefault();var t=b(this),i=b("#maxuichat-widget-container #maxui-newactivity-box textarea"),n=b("#maxuichat-widget-container #maxui-newactivity-chat #maxui-predictive"),a=i.val(),s=new RegExp("^\\s*@([\\w\\.]+)"),r=a.replace(s,"@"+t.text()+" ");n.hide(),i.val(r),i.focus()}),b(document).on("click",function(e){b(".maxui-predictive").hide()}),b("#maxuichat-widget-container #maxui-conversation-predictive").on("click",".maxui-prediction",function(e){e.preventDefault();var t=b(this),i=b("#maxuichat-widget-container #maxui-add-people-box .maxui-text-input"),n=b("#maxuichat-widget-container #maxui-conversation-predictive"),a=t.attr("data-username"),s=t.attr("data-displayname");x.addPersonChat({username:a,displayName:s}),n.hide(),i.val("").focus()}),b("#maxuichat-widget-container #maxui-show-conversations").on("click",function(e){e.preventDefault(),window.status="",x.toggleSectionChat("conversations")}),b("#maxuichat-widget-container #maxui-show-timeline").on("click",function(e){e.preventDefault(),window.status="",x.printActivitiesChat({},function(e){x.toggleSectionChat("timeline")})}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-action.maxui-favorites",function(e){e.preventDefault();var t=b(this),i=b(this).closest(".maxui-activity").attr("id");t.hasClass("maxui-favorited")?x.maxClient.unfavoriteActivity(i,function(e){t.toggleClass("maxui-favorited",!1)}):x.maxClient.favoriteActivity(i,function(e){t.toggleClass("maxui-favorited",!0)})}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-action.maxui-likes",function(e){e.preventDefault();var t=b(this),i=b(this).closest(".maxui-activity").attr("id"),n=t.hasClass("maxui-liked"),a=t.children("strong");n?(x.maxClient.unlikeActivity(i,function(e){t.toggleClass("maxui-liked",!1)}),a.text(parseInt(a.text(),10)-1)):(x.maxClient.likeActivity(i,function(e){t.toggleClass("maxui-liked",!0)}),a.text(parseInt(a.text(),10)+1))}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-action.maxui-flag",function(e){e.preventDefault();var t=b(this),i=b(this).closest(".maxui-activity"),n=i.attr("id");t.hasClass("maxui-flagged")?x.maxClient.unflagActivity(n,function(e){t.toggleClass("maxui-flagged",!1),i.toggleClass("maxui-flagged",!1),x.printActivitiesChat({})}):x.maxClient.flagActivity(n,function(e){t.toggleClass("maxui-flagged",!0),i.toggleClass("maxui-flagged",!1),x.printActivitiesChat({})})}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-action.maxui-delete",function(e){e.preventDefault();var t=b(this).closest(".maxui-activity").find(".maxui-actions > .maxui-popover");t.is(":visible")?(t.animate({opacity:0},300),b(".maxui-popover").css({opacity:0}).hide()):(b(".maxui-popover").css({opacity:0}).hide(),t.show(),t.animate({opacity:1},300))}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-actions .maxui-button-cancel",function(e){e.preventDefault(),b(".maxui-popover:visible").css({opacity:0}).hide()}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-actions .maxui-button-delete",function(e){e.preventDefault();var i=b(this).closest(".maxui-activity"),t=i.attr("id");x.maxClient.removeActivity(t,function(e){var t=b(".maxui-popover:visible").animate({opacity:0},300);i.css({height:i.height(),"min-height":"auto"}),i.animate({height:0,opacity:0},100,function(e){i.remove(),t.hide()})})}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-delete-comment",function(e){e.preventDefault();var t=b(this).closest(".maxui-comment").find(".maxui-popover");t.is(":visible")?(t.animate({opacity:0},300),b(".maxui-popover").css({opacity:0}).hide()):(b(".maxui-popover").css({opacity:0}).hide(),t.show(),t.animate({opacity:1},300))}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-comment .maxui-button-cancel",function(e){e.preventDefault(),b(".maxui-popover").css({opacity:0}).hide()}),b("#maxuichat-widget-container #maxui-activities").on("click",".maxui-comment .maxui-button-delete",function(e){e.preventDefault();var i=b(this).closest(".maxui-comment"),n=i.closest(".maxui-activity"),t=n.attr("id"),a=i.attr("id");x.maxClient.removeActivityComment(t,a,function(){var t=b(".maxui-popover").animate({opacity:0},300);i.css({height:n.height(),"min-height":"auto"}),i.animate({height:0,opacity:0},100,function(e){i.remove(),t.hide()})})}),b("#maxuichat-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-recent",function(e){e.preventDefault();var t=b(this);t.hasClass("active")||(b("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),t.toggleClass("active",!0),x.printActivitiesChat({}))}),b("#maxuichat-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-most-valued",function(e){e.preventDefault();var t=b(this);t.hasClass("active")||(b("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),t.toggleClass("active",!0),x.printActivitiesChat({sortBy:"likes"}))}),b("#maxuichat-widget-container #maxui-activity-sort").on("click","a.maxui-sort-action.maxui-flagged",function(e){e.preventDefault();var t=b(this);t.hasClass("active")||(b("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),t.toggleClass("active",!0),x.printActivitiesChat({sortBy:"flagged"}))});var e=".maxui-text-input";b("#maxuichat-widget-container #maxui-add-people-box").on("focusin",e,function(e){e.preventDefault();var t=b(this).val(),i=b(this).attr("data-literal");x.utils.normalizeWhiteSpace(t,!1)===i&&b(this).val("")}).on("keydown",e,function(e){0<b("#maxuichat-widget-container #maxui-conversation-predictive:visible").length&&(40===e.which||38===e.which||13===e.which||9===e.which)&&x.utils.freezeEvent(e)}).on("keyup",e,function(e){e.preventDefault(),e.stopPropagation();var t=b(this).val();""===x.utils.normalizeWhiteSpace(t,!1)?(b(this).attr("class","maxui-empty maxui-text-input"),b(this).removeAttr("title")):x.settings.canwrite&&b(this).attr("class","maxui-text-input");var i=e.which,n=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*"),a=t.match(n),s=new RegExp("^\\s*([\\u00C0-\\u00FC\\w\\. ]+)\\s*$"),r=t.match(s),o=b("#maxuichat-widget-container #maxui-conversation-predictive .maxui-prediction.selected"),c=b(this),u=b("#maxuichat-widget-container #maxui-conversation-predictive"),l=u.find(".maxui-prediction").length,d=0<b("#maxuichat-widget-container #maxui-conversation-predictive:visible").length;if(40===i&&d&&1<l){var m=o.next();o.removeClass("selected"),0<m.length?m.addClass("selected"):o.siblings(":first").addClass("selected")}else if(38===i&&d&&1<l){var p=o.prev();o.removeClass("selected"),0<p.length?p.addClass("selected"):o.siblings(":last").addClass("selected")}else if(27===i)u.hide();else if(13!==i&&9!==i||!d)"conversations"===x.settings.conversationsSection&&(a?(c.attr("class","maxui-text-input"),r&&(u.show(),u.html("<ul></ul>"),x.printPredictionsChat(a[1],"#maxui-conversation-predictive"))):(u.hide(),c.attr("class","maxui-empty maxui-text-input"),t.match(new RegExp("^\\s*@"))||(c.attr("class","maxui-text-input error"),c.attr("title",x.settings.literals.post_permission_not_here))));else{var f=o.attr("data-username"),h=o.attr("data-displayname");x.addPersonChat({username:f,displayName:h}),u.hide(),c.val("").focus()}}).on("focusout",e,function(e){e.preventDefault();var t=b(this).val(),i=b(this).attr("data-literal");""===x.utils.normalizeWhiteSpace(t,!1)&&b(this).val(i)}),x.bindActionBehaviourChat("#maxuichat-widget-container #maxui-newactivity-chat","#maxui-newactivity-box",{},function(e){if("timeline"===x.settings.UISection)x.sendActivityChat(e),b("#maxuichat-widget-container #maxui-search").toggleClass("folded",!0);else if("conversations"===x.settings.UISection)if("conversations"===x.settings.conversationsSection){for(var t=b("#maxuichat-widget-container #maxui-new-participants")[0],i=[],n=0;n<t.people.length;n++)i.push(t.people[n].username);var a={participants:i,message:b("#maxuichat-widget-container #maxui-newactivity-chat textarea").val()};if(1<i.length){var s=b("#maxuichat-widget-container #maxui-add-people-box #maxui-new-displayName input").val();a.displayName=s}x.conversations.create(a)}else x.conversations.send(e)},function(e,t,i,n){var a=n.which,s=new RegExp("^\\s*@([\\w\\.]+)\\s*"),r=e.match(s),o=new RegExp("^\\s*@([\\w\\.]+)\\s*$"),c=e.match(o),u=b("#maxuichat-widget-container #maxui-newactivity-chat .maxui-prediction.selected"),l=b(t),d=b("#maxuichat-widget-container #maxui-newactivity-chat #maxui-predictive"),m=d.find(".maxui-prediction").length,p=0<b("#maxuichat-widget-container #maxui-newactivity-chat #maxui-predictive:visible").length;if(40===a&&p&&1<m){var f=u.next();u.removeClass("selected"),0<f.length?f.addClass("selected"):u.siblings(":first").addClass("selected")}else if(38===a&&p&&1<m){var h=u.prev();u.removeClass("selected"),0<h.length?h.addClass("selected"):u.siblings(":last").addClass("selected")}else if(27===a)d.hide();else if(13!==a&&9!==a||!p)""===e?"timeline"===x.settings.UISection&&b(i).val(x.settings.literals.new_activity_post):"timeline"===x.settings.UISection?r?(b(i).val(x.settings.literals.new_message_post),c&&(d.show(),d.html("<ul></ul>"),x.printPredictionsChat(r[1],"#maxui-newactivity-chat #maxui-predictive")),b(i).removeAttr("disabled"),b(i).attr("class","maxui-button"),l.attr("class","maxui-text-input")):(b(i).val(x.settings.literals.new_activity_post),d.hide(),e.match(new RegExp("^\\s*@"))||x.settings.canwrite||(l.attr("class","maxui-text-input error"),l.attr("title",x.settings.literals.post_permission_unauthorized))):"conversations"===x.settings.UISection&&("conversations"===x.settings.conversationsSection?x.reloadPersonsChat():"messages"===x.settings.conversationsSection&&(d.hide(),b(i).removeAttr("disabled"),b(i).attr("class","maxui-button"),l.attr("class","maxui-text-input")));else{var v=new RegExp("^\\s*@([\\w\\.]+)"),g=e.replace(v,"@"+u.text()+" ");d.hide(),l.val(g).focus()}}),x.bindActionBehaviourChat("#maxuichat-widget-container #maxui-activities",".maxui-newcommentbox",{},function(e){var t=b(this).closest(".maxui-activity").attr("id");x.maxClient.addComment(e,t,function(){b("#maxuichat-widget-container #activityContainer textarea").val("");var e=this.object.inReplyTo[0].id;x.printCommentsForActivityChat(e),b("#maxuichat-widget-container #"+e+" .maxui-newcommentbox textarea").val(""),b("#maxuichat-widget-container #"+e+" .maxui-newcommentbox .maxui-button").attr("disabled","disabled")})}),x.bindActionBehaviourChat("#maxuichat-widget-container #maxui-search","#maxui-search-box",{},function(e){x.textSearchChat(e),b("#maxuichat-widget-container #maxui-search").toggleClass("folded",!1),b("#maxuichat-widget-container #maxui-search-text").val("")})},b.fn.bindActionBehaviourChat=function(s,e,r,o){var c=this,t=e+" .maxui-text-input",n=null;4<arguments.length&&(n=arguments[4]),b(s).on("focusin",t,function(e){e.preventDefault();var t=b(this).val(),i=b(this).attr("data-literal");c.utils.normalizeWhiteSpace(t,!1)===i&&b(this).val("")}).on("keydown",t,function(e){if(0<b(s+" #maxui-predictive:visible").length&&(40===e.which||38===e.which||13===e.which||9===e.which))c.utils.freezeEvent(e);else if(13===e.which&&!1===e.shiftKey&&!r.ignore_button&&!b(this).is("textarea")){e.preventDefault();var t=b(this).parent().find(".maxui-text-input"),i=t.attr("data-literal"),n=t.val(),a=c.utils.normalizeWhiteSpace(n,!1);a!==i&""!==a&&o.apply(this,[n])}}).on("keyup",t,function(e){e.preventDefault(),e.stopPropagation();var t=b(this).val(),i=b(this).parent().parent().find(".maxui-button");""!==c.utils.normalizeWhiteSpace(t,!1)||r.ignore_button?c.settings.canwrite&&!r.ignore_button&&(b(i).removeAttr("disabled"),b(i).attr("class","maxui-button"),b(this).attr("class","maxui-text-input")):(b(i).attr("disabled","disabled"),b(i).attr("class","maxui-button maxui-disabled"),b(this).attr("class","maxui-empty maxui-text-input"),b(this).removeAttr("title")),null!==n&&n(t,this,i,e)}).on("paste",t,function(e){var t=b(this).parent().parent().find(".maxui-button");c.settings.canwrite&&!r.ignore_button&&(b(t).removeAttr("disabled"),b(t).attr("class","maxui-button"),b(this).attr("class","maxui-text-input"));var i=b(this).val();null!==n&&n(i,this,t,e)}).on("focusout",t,function(e){e.preventDefault();var t=b(this).val(),i=b(this).attr("data-literal");""===c.utils.normalizeWhiteSpace(t,!1)&&b(this).val(i)}).on("click",e+" .maxui-button",function(e){e.preventDefault();var t=b(this).parent().find(".maxui-text-input"),i=t.attr("data-literal"),n=t.val(),a=c.utils.normalizeWhiteSpace(n,!1);(a!==i&""!==a||r.empty_click)&&o.apply(this,[n])})},b.fn.textSearchChat=function(e){for(var t=this.utils.normalizeWhiteSpace(e).split(" "),i=0;i<t.length;i++){var n="keyword",a=t[i];switch(a[0]){case"#":n="hashtag",a=a.substr(1);break;case"@":n="actor",a=a.substr(1);break;default:n="keyword"}3<=a.length&&this.addFilterChat({type:n,value:a},!1)}this.reloadFiltersChat()},b.fn.getFiltersChat=function(){var e={filters:this.filters};void 0===e.filters&&(e.filters=[]);for(var t={},i=!1,n=0;n<e.filters.length;n++){var a=e.filters[n];a.visible&&(i=!0),t[a.type]||(t[a.type]=[]),t[a.type].push(a.value)}return 0<arguments.length&&(t.before=arguments[0]),{filters:t,visible:i}},b.fn.reloadFiltersChat=function(){var e,t=this,i={filters:t.filters},n=t.templates.filters.render(i);b("#maxuichat-widget-container #maxui-search-filters").html(n),e=0<arguments.length?t.getFiltersChat(arguments[0]):t.getFiltersChat(),t.printActivitiesChat({}),b("#maxuichat-widget-container #maxui-search").toggleClass("folded",!e.visible)},b.fn.delFilterChat=function(e){for(var t=!1,i=0;i<this.filters.length;i++)this.filters[i].value===e.value&this.filters[i].type===e.type&&(t=!0,this.filters.splice(i,1));t&&this.reloadFiltersChat()},b.fn.addFilterChat=function(e){var t=this,i=!0;switch(1<arguments.length&&(i=arguments[1]),t.filters||(t.filters=[]),e.hasOwnProperty("visible")||(e.visible=!0),e.type){case"hashtag":e.prepend="#";break;case"actor":e.prepend="@";break;default:e.prepend=""}for(var n=!1,a=0;a<t.filters.length;a++)t.filters[a].value===e.value&t.filters[a].type===e.type&&(n=!0);n||(t.filters.push(e),!0===i&&this.reloadFiltersChat())},b.fn.reloadPersonsChat=function(){var e=this,t=b("#maxuichat-widget-container #maxui-new-participants"),i=t[0];i.people||(i.people=[]);var n=b("#maxuichat-widget-container #maxui-newactivity-chat input.maxui-button"),a=b("#maxuichat-widget-container #maxui-newactivity-chat"),s=a.find("textarea").val(),r=a.find("textarea").attr("data-literal");s=e.utils.normalizeWhiteSpace(s);var o=b("#maxuichat-widget-container #maxui-add-people-box #maxui-new-displayName"),c=o.find("input").val();c=e.utils.normalizeWhiteSpace(c);var u={persons:i.people},l=e.templates.participants.render(u);(b("#maxuichat-widget-container #maxui-new-participants").html(l),b("#maxuichat-widget-container #maxui-add-people-box .maxui-label .maxui-count").text("({0}/{1})".format(i.people.length+1,e.settings.maximumConversations)),0<i.people.length)?(1<i.people.length&&!(""!==c)?(n.attr("disabled","disabled"),n.attr("class","maxui-button maxui-disabled"),""===c&&(a.find("textarea").attr("class","maxui-text-input error"),a.find(".maxui-error-box").text(e.settings.literals.post_permission_missing_displayName),a.find(".maxui-error-box").width(a.find("textarea").width()-4),a.find(".maxui-error-box").animate({bottom:-25},200))):(n.removeAttr("disabled"),n.attr("class","maxui-button"),a.find("textarea").attr("class","maxui-text-input"),a.find(".maxui-error-box").width(a.find("textarea").width()-4),a.find(".maxui-error-box").animate({bottom:0},200)),t.show(),a.show(),1<i.people.length?o.show():(o.hide(),o.find("#maxuichat-widget-container .maxui-text-input").val(""))):""!==s&&s!==r&&(n.attr("disabled","disabled"),n.attr("class","maxui-button maxui-disabled"),t.hide(),a.find("textarea").attr("class","maxui-text-input error"),a.find(".maxui-error-box").text(e.settings.literals.post_permission_not_enough_participants),a.find(".maxui-error-box").width(a.find("textarea").width()-4),a.find(".maxui-error-box").animate({bottom:-25},200),o.hide(),o.find("#maxuichat-widget-container .maxui-text-input").val(""))},b.fn.delPersonChat=function(e){for(var t=!1,i=b("#maxuichat-widget-container #maxui-new-participants")[0],n=0;n<i.people.length;n++)i.people[n].username===e.username&&(t=!0,i.people.splice(n,1));t&&this.reloadPersonsChat()},b.fn.addPersonChat=function(e){var t=b("#maxuichat-widget-container #maxui-new-participants")[0],i=!0;1<arguments.length&&(i=arguments[1]);var n=!1;if(t.people||(t.people=[]),e.username!==this.settings.username&&t.people.length<this.settings.maximumConversations-1){for(var a=0;a<t.people.length;a++)t.people[a].username===e.username&&(n=!0);n||(t.people.push(e),!0===i&&this.reloadPersonsChat())}},b.fn.toggleSectionChat=function(e){var t,i=this,n=b("#maxuichat-widget-container #maxui-search"),a=b("#maxuichat-widget-container #maxui-activity-sort"),s=b("#maxuichat-widget-container #maxui-timeline"),r=b("#maxuichat-widget-container #maxui-timeline .maxui-wrapper"),o=b("#maxuichat-widget-container #maxui-conversations"),c=b("#maxuichat-widget-container #maxui-common-header"),u=o.find("input#add-user-input"),l=b("#maxuichat-widget-container #maxui-conversations #maxui-conversations-list"),d=b("#maxuichat-widget-container #maxui-conversations .maxui-wrapper"),m=b("#maxuichat-widget-container #maxui-newactivity-box .maxui-button"),p=b("#maxuichat-widget-container #maxui-newactivity-box #maxui-subscriptions"),f=b("#maxuichat-widget-container #maxui-newactivity-chat"),h=b("#maxuichat-widget-container #maxui-newactivity-box textarea"),v=b("#maxuichat-widget-container #maxui-show-conversations"),g=b("#maxuichat-widget-container #maxui-show-timeline"),x=b("#maxuichat-widget-container #maxui-add-people-box"),w=i.width()-i.conversations.scrollbar.width-20-2;if("conversations"===e&&"conversations"===i.settings.currentConversationSection&&(p.attr("style","display:none;"),o.show(),c.removeClass("maxui-showing-messages").addClass("maxui-showing-conversations"),x.show(),u.focus(),o.animate({height:320},400,function(e){d.height(320)}),l.width(w),s.animate({height:0},400),n.hide(400),a.hide(400),i.settings.UISection="conversations",m.val(i.settings.literals.new_message_post),t=i.settings.literals.new_conversation_text,h.val(t).attr("data-literal",t),v.hide(),i.settings.disableTimeline||g.show(),i.conversations.scrollbar.setHeight(275),i.conversations.scrollbar.setTarget("#maxui-conversations #maxui-conversations-list"),f.show()),"timeline"===e){!0===i.settings.showSubscriptionList&&p.attr("style","display:inline;"),i.conversations.listview.toggle(),s.show();var y=r.height();s.animate({height:y},400,function(e){s.css("height","")}),o.animate({height:0},400,function(e){o.hide(),x.hide()}),n.show(400),a.show(400),i.settings.UISection="timeline",m.val(i.settings.literals.new_activity_post),t=i.settings.literals.new_activity_text,h.val(t).attr("data-literal",t),i.settings.disableConversations||v.show(),g.hide(),i.settings.hidePostboxChatOnTimeline&&f.hide(),i.hidePostboxChat()&&f.hide()}},b.fn.settings=function(){return this.settings},b.fn.sendActivityChat=function(){var i=this,e=b("#maxuichat-widget-container #maxui-newactivity-chat textarea").val(),t=[];b("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.active").toggleClass("active",!1),b("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-recent").toggleClass("active",!0),t.push(e),t.push(i.settings.writeContexts),t.push(function(){b("#maxuichat-widget-container #maxui-newactivity-chat textarea").val(""),b("#maxuichat-widget-container #maxui-newactivity-chat .maxui-button").attr("disabled","disabled");var e=b("#maxuichat-widget-container .maxui-activity:first");if(0<e.length){var t={after:e.attr("id")};i.printActivitiesChat(t)}else i.printActivitiesChat({})}),i.settings.generatorName&&t.push(i.settings.generatorName),i.maxClient.addActivity.apply(i.maxClient,t),b("#maxui-subscriptions option:first-child").attr("selected","selected")},b.fn.loadMoreActivitiesChat=function(){var e=b("#maxuichat-widget-container .maxui-activity:last").attr("id");b("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-recent").hasClass("active")&&0<b("#"+e+" .maxui-comment").length&&(e=b("#"+e+" .maxui-comment:last").attr("id"));var t={before:e};this.printActivitiesChat(t)},b.fn.loadNewsActivitiesChat=function(){this.printActivitiesChat()},b.fn.printPredictionsChat=function(e,t){var i=this,n=[];n.push(e),n.push(function(e){i.formatPredictionsChat(e,t)}),this.maxClient.getUsersList.apply(this.maxClient,n)},b.fn.formatPredictionsChat=function(e,t){for(var i="",n=0;n<e.length;n++){var a=e[n];if(a.username!==this.username){var s=this.settings.avatarURLpattern.format(a.username),r={username:a.username,displayName:a.displayName,avatarURL:s,cssclass:"maxui-prediction"+(0===n?" selected":"")};i+=this.templates.predictive.render(r)}}(""===i&&(i="<li>"+this.settings.literals.no_match_found+"</li>"),b(t+" ul").html(i),2<arguments.length)&&(0,arguments[2])()},b.fn.canCommentActivityChat=function(e){for(var t in this.settings.subscriptionsWrite){if(this.settings.subscriptionsWrite[t].hash===e)return!0}return!1},b.fn.formatActivitiesChat=function(e,t){for(var n=this,i="",a=[],s=0;s<e.length;s++){var r=e[s],o=null;r.hasOwnProperty("contexts")&&0<r.contexts.length&&(o=r.contexts[0]);var c=null;r.hasOwnProperty("generator")&&r.generator!==n.settings.generatorName&&(c=r.generator);var u="";"person"===r.actor.objectType?u=n.settings.avatarURLpattern.format(r.actor.username):"context"===r.actor.objectType&&(u=n.settings.contextAvatarURLpattern.format(r.actor.hash));var l=[],d="";if(r.replies&&0<r.replies.length){for(var m=0;m<r.replies.length;m++){var p=r.replies[m],f={id:p.id,actor:p.actor,date:n.utils.formatDate(p.published,n.language),text:n.utils.formatText(p.content),avatarURL:n.settings.avatarURLpattern.format(p.actor.username),canDeleteComment:p.deletable,literals:n.settings.literals};l.push(f)}d="Comentat "+l[l.length-1].date}_.defaults(r.object,{filename:r.id});var h=n.settings.canwrite;r.contexts&&(h=n.canCommentActivityChat(r.contexts[0].url));var v={id:r.id,actor:r.actor,auth:{token:n.settings.oAuthToken,username:n.settings.username},literals:n.settings.literals,date:n.utils.formatDate(r.published,n.language),dateLastComment:d,text:n.utils.formatText(r.object.content),replies:l,favorited:r.favorited,likes:r.likesCount?r.likesCount:0,showLikesCount:"likes"===n.currentSortOrder,liked:r.liked,flagged:r.flagged,avatarURL:u,publishedIn:o,canDeleteActivity:r.deletable,canFlagActivity:n.settings.canflag,via:c,fileDownload:"file"===r.object.objectType,filename:r.object.filename,canViewComments:h||0<r.replies.length,canWriteComment:h},g={comment:n.templates.comment};i+=n.templates.activity.render(v,g),"image"===r.object.objectType&&a.push(r)}if("beggining"===t){b("#maxuichat-widget-container #maxui-preload .maxui-wrapper").prepend(i);var x=b("#maxuichat-widget-container #maxui-preload .maxui-wrapper .maxui-activity"),w=0;for(s=0;s<x.length;s++)w+=b(x[s]).height()+18;var y=b("#maxuichat-widget-container #maxui-preload").height();b("#maxuichat-widget-container #maxui-preload").height(w-y),b("#maxuichat-widget-container #maxui-preload").css({"margin-top":-1*(w-y)}),b("#maxuichat-widget-container #maxui-preload").animate({"margin-top":0},200,function(){b("#maxuichat-widget-container #maxui-preload .maxui-wrapper").html(""),b("#maxuichat-widget-container #maxui-activities").prepend(i),b("#maxuichat-widget-container #maxui-preload").height(0)})}else"end"===t?b("#maxuichat-widget-container #maxui-activities").append(i):b("#maxuichat-widget-container #maxui-activities").html(i);2<arguments.length&&arguments[2].call(),_.each(a,function(i,e,t){n.maxClient.getMessageImage("/activities/{0}/image/thumb".format(i.id),function(e){var t='<img class="maxui-embedded" alt="" src="data:image/png;base64,{0}" />'.format(e);b(".maxui-activity#{0} .maxui-activity-message .maxui-body".format(i.id)).after(t)})})},b.fn.formatCommentChat=function(e,t){for(var i=this,n="",a=0;a<e.length;a++){var s=e[a],r={literals:i.settings.literals,id:s.id,actor:s.actor,date:i.utils.formatDate(s.published,i.language),text:i.utils.formatText(s.content),avatarURL:i.settings.avatarURLpattern.format(s.actor.username),canDeleteComment:s.deletable};n+=i.templates.comment.render(r)}b(".maxui-activity#"+t+" .maxui-commentsbox").html(n);var o=b(".maxui-activity#"+t+" .maxui-commentaction strong");b(o).text(parseInt(b(o).text(),10)+1)},b.fn.renderPostboxChat=function(){var e=this,t="conversations"===e.settings.UISection,i=!1===e.settings.disableConversations&&!t,n={avatar:e.settings.avatarURLpattern.format(e.settings.username),allowPosting:e.settings.canwrite,buttonLiteral:e.settings.literals.new_activity_post,textLiteral:e.settings.literals.new_activity_text,literals:e.settings.literals,showConversationsToggle:i?"display:block;":"display:none;",showSubscriptionList:e.settings.showSubscriptionList&&0<e.settings.subscriptionsWrite.length,subscriptionList:e.settings.subscriptionsWrite},a=e.templates.postBoxChat.render(n);b("#maxuichat-widget-container #maxui-newactivity-chat").html(a)},b.fn.printActivitiesChat=function(e){var s=this,t=[],r="replace",i=s.getFiltersChat().filters;b.extend(i,e),i.before&&(r="end"),i.after&&(r="beggining"),i.sortBy||(b("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.maxui-most-valued").hasClass("active")?i.sortBy="likes":b("#maxuichat-widget-container #maxui-activity-sort .maxui-sort-action.maxui-flagged").hasClass("active")?i.sortBy="flagged":i.sortBy=s.settings.activitySortOrder),s.currentSortOrder=i.sortBy;var n=null;if("timeline"===s.settings.activitySource)n=this.maxClient.getUserTimeline,t.push(s.settings.username);else if("activities"===s.settings.activitySource){n=this.maxClient.getActivities;var a={context:s.settings.readContextHash,tags:s.settings.contextTagsFilter};t.push(a)}if(1<arguments.length){var o=arguments[1];t.push(function(a){s.settings.canwrite=!0,"activities"===s.settings.activitySource?s.maxClient.getContext(s.settings.readContextHash,function(e){var t=s.settings.subscriptions;t[e.hash]||(t[e.hash]={},t[e.hash].permissions={},t[e.hash].permissions.read="public"===e.permissions.read,t[e.hash].permissions.write="public"===e.permissions.write);for(var i=0;i<s.settings.writeContexts.length;i++){var n=s.settings.writeContextsHashes[i];t[n].permissions?(!0!==t[n].permissions.write&&(s.settings.canwrite=!1),!0===t[n].permissions.flag?s.settings.canflag=!0:s.settings.canflag=!1):(s.settings.canwrite=!1,s.settings.canflag=!1)}s.renderPostboxChat(),s.formatActivitiesChat(a,r,o)}):(s.renderPostboxChat(a,r,o),s.formatActivitiesChat(a,r,o))})}else t.push(function(e){s.formatActivitiesChat(e,r)});t.push(i),n.apply(this.maxClient,t)},b.fn.printCommentsForActivityChat=function(t){var i=this,e=[];e.push(t),e.push(function(e){i.formatCommentChat(e,t)}),this.maxClient.getCommentsForActivity.apply(this.maxClient,e)},b.maxui=function(){},b.maxui.settings=function(){return this.settings}}(jQuery),window.setTimeout(function(){window._MAXUI_Chat&&window._MAXUI_Chat.onReady&&!window._MAXUI_Chat.hasRun&&(window._MAXUI_Chat.hasRun=!0,_MAXUI_Chat.onReady())},0);
//# sourceMappingURL=maxuichat.min.js.map